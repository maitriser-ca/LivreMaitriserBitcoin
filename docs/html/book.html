<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Maîtriser Bitcoin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>Maîtriser Bitcoin</h1>
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="_préface">Préface</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-4">
<h3 id="_écrire_le_livre_bitcoin">Écrire le livre Bitcoin</h3>
<div class="paragraph data-line-6">
<p>Je suis tombé sur bitcoin pour la première fois à la mi-2011. Ma réaction immédiate a été plus ou moins "Pfft ! Nerd money !" et je l&#8217;ai ignoré pendant encore six mois, n&#8217;en saisissant pas l&#8217;importance. C&#8217;est une réaction que j&#8217;ai vue se répéter chez bon nombre des personnes les plus intelligentes que je connaisse, ce qui me réconforte un peu. La deuxième fois que je suis tombé sur bitcoin, lors d&#8217;une discussion sur une liste de diffusion, j&#8217;ai décidé de lire le livre blanc écrit par Satoshi Nakamoto pour étudier la source faisant autorité et voir de quoi il s&#8217;agissait. Je me souviens encore du moment où j&#8217;ai fini de lire ces neuf pages, quand j&#8217;ai réalisé que le bitcoin n&#8217;était pas simplement une monnaie numérique, mais un réseau de confiance qui pouvait aussi fournir la base de bien plus que de simples devises. La prise de conscience que "ce n&#8217;est pas de l&#8217;argent, c&#8217;est un réseau de confiance décentralisé", m&#8217;a lancé dans un voyage de quatre mois pour dévorer toutes les informations sur le bitcoin que j&#8217;ai pu trouver. Je suis devenu obsédé et captivé, passant 12 heures ou plus par jour collé à un écran, lisant, écrivant, codant et apprenant autant que possible. Je suis sorti de cet état de fugue, plus de 20 livres en moins à cause du manque de repas réguliers, déterminé à me consacrer au travail sur le bitcoin.</p>
</div>
<div class="paragraph data-line-8">
<p>Deux ans plus tard, après avoir créé un certain nombre de petites start-ups pour explorer divers services et produits liés au bitcoin, j&#8217;ai décidé qu&#8217;il était temps d&#8217;écrire mon premier livre. Bitcoin était le sujet qui m&#8217;avait poussé dans une frénésie de créativité et consommé mes pensées; c&#8217;était la technologie la plus excitante que j&#8217;avais rencontrée depuis Internet. Il était maintenant temps de partager ma passion pour cette technologie incroyable avec un public plus large.</p>
</div>
</div>
<div class="sect2 data-line-10">
<h3 id="_public_visé">Public visé</h3>
<div class="paragraph data-line-12">
<p>Ce livre est principalement destiné aux codeurs. Si vous pouvez utiliser un langage de programmation, ce livre vous apprendra comment fonctionnent les monnaies cryptographiques, comment les utiliser et comment développer des logiciels qui fonctionnent avec elles. Les premiers chapitres conviennent également comme une introduction approfondie au bitcoin pour les non-codeurs, tel ceux qui veulent comprendre le fonctionnement interne du bitcoin et des crypto-monnaies.</p>
</div>
</div>
<div class="sect2 data-line-14">
<h3 id="_les_conventions_utilisées_dans_ce_livre">Les conventions utilisées dans ce livre</h3>
<div class="paragraph data-line-16">
<p>Les conventions typographiques suivantes sont utilisées dans ce livre :</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1"><em>Italique</em></dt>
<dd>
<p>Indique de nouveaux termes, URL, adresses e-mail, noms de fichiers et extensions de fichiers.</p>
</dd>
<dt class="hdlist1"><code>Largeur constante</code></dt>
<dd>
<p>Utilisé pour les listes de programmes, ainsi que dans les paragraphes pour faire référence à des éléments de programme tels que des noms de variables ou de fonctions, des bases de données, des types de données, des variables d&#8217;environnement, des instructions et des mots-clés.</p>
</dd>
<dt class="hdlist1"><code><strong>Largeur constante en gras</strong></code></dt>
<dd>
<p>Affiche les commandes ou tout autre texte qui doit être saisi littéralement par l&#8217;utilisateur.</p>
</dd>
<dt class="hdlist1"><code><em>Largeur constante en italique</em></code></dt>
<dd>
<p>Affiche le texte qui doit être remplacé par des valeurs fournies par l&#8217;utilisateur ou par des valeurs déterminées par le contexte.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip data-line-28">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-29">
<p>Cette icône signifie un conseil ou une suggestion.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-33">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-34">
<p>Cette icône signifie une note générale.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning data-line-38">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-39">
<p>Cette icône indique un avertissement ou une mise en garde.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_exemples_de_codes">Exemples de codes</h3>
<div class="paragraph data-line-44">
<p>Les exemples sont illustrés en Python, C++, et en utilisant la ligne de commande d&#8217;un système d&#8217;exploitation de type Unix tel que Linux ou macOS. Tous les extraits de code sont disponibles dans le référentiel GitHub (<a href="https://github.com/bitcoinbook/bitcoinbook" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a>) dans le sous-répertoire <em>code</em> du référentiel principal. Fourchez le code du livre, essayez les exemples de code ou soumettez des corrections via GitHub.</p>
</div>
<div class="paragraph data-line-46">
<p>Tous les extraits de code peuvent être répliqués sur la plupart des systèmes d&#8217;exploitation avec une installation minimale de compilateurs et d&#8217;interpréteurs pour les langages correspondants. Si nécessaire, nous fournissons des instructions d&#8217;installation de base et des exemples étape par étape de la sortie de ces instructions.</p>
</div>
<div class="paragraph data-line-48">
<p>Certains des extraits de code et des sorties de code ont été reformatés pour l&#8217;impression. Dans tous ces cas, les lignes ont été séparées par un caractère barre oblique inverse (\), suivi d&#8217;un caractère de saut de ligne. Lors de la transcription des exemples, supprimez ces deux caractères et rejoignez les lignes à nouveau et vous devriez voir des résultats identiques comme indiqué dans l&#8217;exemple.</p>
</div>
<div class="paragraph data-line-50">
<p>Tous les extraits de code utilisent des valeurs réelles et des calculs dans la mesure du possible, afin que vous puissiez construire d&#8217;exemple en exemple et voir les mêmes résultats dans n&#8217;importe quel code que vous écrivez pour calculer les mêmes valeurs. Par exemple, les clés privées et les clés et adresses publiques correspondantes sont toutes réelles. Les exemples de transactions, de blocs et de références de chaîne de blocs ont tous été introduits dans la chaîne de blocs bitcoin réelle et font partie du grand livre public, vous pouvez donc les consulter sur n&#8217;importe quel système bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-52">
<h3 id="_adresses_et_transactions_bitcoin_dans_ce_livre">Adresses et transactions Bitcoin dans ce livre</h3>
<div class="paragraph data-line-54">
<p>Les adresses bitcoin, les transactions, les clés, les codes QR et les données de chaîne de blocs utilisées dans ce livre sont, pour la plupart, réelles. Cela signifie que vous pouvez parcourir la chaîne de blocs, regarder les transactions proposées en exemple, les récupérer avec vos propres scripts ou programmes, etc.</p>
</div>
<div class="paragraph data-line-56">
<p>Cependant, notez que les clés privées utilisées pour construire les adresses sont soit imprimées dans ce livre, soit ont été "radiées". Cela signifie que si vous envoyez de l&#8217;argent à l&#8217;une de ces adresses, l&#8217;argent sera perdu pour toujours ou, dans certains cas, tous ceux qui peuvent lire ce livre peuvent le prendre en utilisant les clés privées imprimées dans celui-ci.</p>
</div>
<div class="admonitionblock warning data-line-59">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-60">
<p>N&#8217;ENVOYEZ PAS D&#8217;ARGENT AUX ADRESSES DANS CE LIVRE. Votre argent sera pris par un autre lecteur, ou perdu à jamais.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-63">
<h3 id="_publication_par_oreilly_media">Publication par O&#8217;Reilly Media</h3>
<div class="paragraph data-line-65">
<p>Ce livre est dérivé sous licence du livre "Mastering Bitcoin 2nd Edition", par O&#8217;Reilly Media.</p>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="_droit_dauteur_et_licence_de_livre">Droit d&#8217;auteur et licence de livre</h3>
<div class="paragraph data-line-69">
<p>Copyright (c) 2014 Andreas M. Antonopoulos LLC</p>
</div>
<div class="paragraph data-line-71">
<p>Ce travail est sous licence Creative Commons Attribution-ShareAlike 4.0 International License. Pour voir une copie de cette licence, visitez</p>
</div>
<div class="paragraph data-line-73">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" class="undefined" data-href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a>.</p>
</div>
<div class="paragraph data-line-75">
<p>Pour fournir une attribution, veuillez créer un lien vers le référentiel du livre :</p>
</div>
<div class="paragraph data-line-77">
<p><a href="https://github.com/bitcoinbook/bitcoinbook" class="undefined" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a></p>
</div>
<div class="paragraph data-line-79">
<p>et inclure cette licence ou une licence ouverte équivalente, pour satisfaire aux exigences ShareAlike.</p>
</div>
<div class="paragraph data-line-81">
<p>Cette licence conforme à la "Culture libre" a été approuvée par mon éditeur O&#8217;Reilly Media (<a href="http://oreilly.com" class="undefined" data-href="http://oreilly.com">http://oreilly.com</a>), qui comprend la valeur du mouvement de source ouverte. O&#8217;Reilly Media n&#8217;est pas seulement le meilleur éditeur de livres techniques au monde, mais aussi un fervent partisan d&#8217;une culture ouverte et du partage des connaissances.</p>
</div>
<div class="paragraph data-line-83">
<p>Merci O&#8217;Reilly !</p>
</div>
</div>
<div class="sect2 pagebreak-before data-line-86">
<h3 id="_contacter_lauteur">Contacter l&#8217;auteur</h3>
<div class="paragraph data-line-88">
<p>Vous pouvez me contacter, Andreas M. Antonopoulos, sur mon site personnel :
<a href="https://aantonop.com/" class="undefined" data-href="https://aantonop.com/">https://aantonop.com/</a></p>
</div>
<div class="paragraph data-line-91">
<p>Des informations sur <em>Maîtriser Bitcoin (Mastering Bitcoin en anglais)</em> ainsi que l&#8217;Édition Ouverte et les traductions sont disponibles sur :
<a href="https://bitcoinbook.info/" class="undefined" data-href="https://bitcoinbook.info/">https://bitcoinbook.info/</a></p>
</div>
<div class="paragraph data-line-94">
<p>Suivez-moi sur Twitter:
<a href="https://twitter.com/aantonop" class="undefined" data-href="https://twitter.com/aantonop">https://twitter.com/aantonop</a></p>
</div>
<div class="paragraph data-line-97">
<p>Retrouvez plus de 500 vidéos pédagogiques sur ma chaîne YouTube :
<a href="https://youtube.com/aantonop" class="undefined" data-href="https://youtube.com/aantonop">https://youtube.com/aantonop</a></p>
</div>
<div class="paragraph data-line-100">
<p>Un grand merci à tous mes mécènes qui soutiennent mon travail par des dons mensuels. Vous pouvez suivre ma page Patreon ici :
<a href="https://patreon.com/aantonop" class="undefined" data-href="https://patreon.com/aantonop">https://patreon.com/aantonop</a></p>
</div>
</div>
<div class="sect2 data-line-103">
<h3 id="_remerciements">Remerciements</h3>
<div class="paragraph data-line-105">
<p>Ce livre représente les efforts et les contributions de nombreuses personnes. Je suis reconnaissant pour toute l&#8217;aide que j&#8217;ai reçue d&#8217;amis, de collègues et même de parfaits inconnus, qui m&#8217;ont rejoint dans cet effort pour écrire le livre technique définitif sur les crypto-monnaies et le bitcoin.</p>
</div>
<div class="paragraph data-line-107">
<p>Il est impossible de faire une distinction entre la technologie bitcoin et la communauté bitcoin, et ce livre est autant un produit de cette communauté qu&#8217;un livre sur la technologie. Mon travail sur ce livre a été encouragé, applaudi, soutenu et récompensé par toute la communauté bitcoin du tout début jusqu&#8217;à la toute fin. Plus que tout, ce livre m&#8217;a permis de faire partie d&#8217;une merveilleuse communauté pendant deux ans et je ne vous remercierai jamais assez de m&#8217;avoir accepté dans cette communauté. Il y a beaucoup trop de personnes à mentionner par leur nom - des personnes que j&#8217;ai rencontrées lors de conférences, d&#8217;événements, de séminaires, de rencontres, de pizzas et de petits rassemblements privés, ainsi que beaucoup qui ont communiqué avec moi par Twitter, sur reddit, sur bitcointalk. org, et sur GitHub qui ont eu un impact sur ce livre. Chaque idée, analogie, question, réponse et explication que vous trouverez dans ce livre a été à un moment donné inspirée, testée ou améliorée grâce à mes interactions avec la communauté. Merci à tous pour votre soutien; sans vous ce livre n&#8217;aurait pas vu le jour. Je suis éternellement reconnaissant.</p>
</div>
<div class="paragraph data-line-109">
<p>Le voyage pour devenir auteur commence bien avant le premier livre, bien sûr. Ma première langue (et ma scolarité) était le grec, j&#8217;ai donc dû suivre un cours de rattrapage en anglais écrit lors de ma première année d&#8217;université. Je dois remercier Diana Kordas, mon professeur d&#8217;écriture d&#8217;anglais, qui m&#8217;a aidé à développer ma confiance et mes compétences cette année-là. Plus tard, en tant que professionnel, j&#8217;ai développé mes compétences en rédaction technique sur le thème des centres de données, en écrivant pour le magazine <em>Network World</em>. Je dois remercier John Dix et John Gallant, qui m&#8217;ont donné mon premier travail d&#8217;écriture en tant que chroniqueur à <em>Network World</em> et à mon éditeur Michael Cooney et mon collègue Johna Till Johnson qui ont édité mes chroniques et les ont rendues aptes à la publication. Écrire 500 mots par semaine pendant quatre ans m&#8217;a donné suffisamment d&#8217;expérience pour éventuellement envisager de devenir auteur.</p>
</div>
<div class="paragraph data-line-111">
<p>Merci également à ceux qui m&#8217;ont soutenu lorsque j&#8217;ai soumis ma proposition de livre à O&#8217;Reilly, en fournissant des références et en examinant la proposition. Plus précisément, merci à John Gallant, Gregory Ness, Richard Stiennon, Joel Snyder, Adam B. Levine, Sandra Gittlen, John Dix, Johna Till Johnson, Roger Ver et Jon Matonis. Remerciements particuliers à Richard Kagan et Tymon Mattoszko, qui ont révisé les premières versions de la proposition et à Matthew Taylor, qui a révisé la proposition.</p>
</div>
<div class="paragraph data-line-113">
<p>Merci à Cricket Liu, auteur du titre O&#8217;Reilly <em>DNS et BIND</em>, qui m&#8217;a présenté O&#8217;Reilly. Merci également à Michael Loukides et Allyson MacDonald de O&#8217;Reilly, qui ont travaillé pendant des mois pour aider à la réalisation de ce livre. Allyson a été particulièrement patiente lorsque les délais ont été manqués et les livrables retardés alors que la vie intervenait dans notre échéancier. Pour la deuxième édition, je remercie Timothy McGovern d&#8217;avoir guidé le processus, Kim Cofer d&#8217;avoir patiemment édité et Rebecca Panzer d&#8217;avoir illustré de nombreux nouveaux diagrammes.</p>
</div>
<div class="paragraph data-line-115">
<p>Les premières ébauches des premiers chapitres ont été les plus difficiles, car le bitcoin est un sujet difficile à démêler. Chaque fois que je tirais sur un fil de la technologie bitcoin, je devais tirer sur le tout. Je me suis retrouvé coincé à plusieurs reprises et un peu découragé alors que je luttais pour rendre le sujet facile à comprendre et créer un récit autour d&#8217;un sujet technique aussi dense. Finalement, j&#8217;ai décidé de raconter l&#8217;histoire du bitcoin à travers les histoires des personnes utilisant le bitcoin et tout le livre est devenu beaucoup plus facile à écrire. Je dois remercier mon ami et mentor, Richard Kagan, qui m&#8217;a aidé à démêler l&#8217;histoire et à surmonter les moments de blocage de l&#8217;écrivain. Je remercie Pamela Morgan, qui a révisé les premières ébauches de chaque chapitre de la première et de la deuxième édition du livre, et a posé les questions difficiles pour les améliorer. Merci également aux développeurs du groupe San Francisco Bitcoin Developers Meetup ainsi qu&#8217;à Taariq Lewis et Denise Terry pour avoir aidé à tester le premier matériel. Merci également à Andrew Naugler pour la conception infographique.</p>
</div>
<div class="paragraph data-line-117">
<p>Pendant le développement du livre, j&#8217;ai rendu les premières ébauches disponibles sur GitHub et j&#8217;ai invité les commentaires du public. Plus d&#8217;une centaine de commentaires, suggestions, corrections et contributions ont été soumis en réponse. Ces contributions sont explicitement reconnues, avec mes remerciements, dans <a href="#github_contrib">Version préliminaire (contributions GitHub)</a>. Surtout, mes sincères remerciements à mes éditeurs bénévoles de GitHub, Ming T. Nguyen (1ère édition) et Will Binns (2e édition), qui ont travaillé sans relâche pour organiser, gérer et résoudre les demandes d&#8217;extraction, publier des rapports et effectuer des corrections de bogues sur GitHub.</p>
</div>
<div class="paragraph data-line-119">
<p>Une fois le livre rédigé, il est passé par plusieurs séries d&#8217;examens techniques. Merci à Cricket Liu et Lorne Lantz pour leur examen approfondi, leurs commentaires et leur soutien.</p>
</div>
<div class="paragraph data-line-121">
<p>Plusieurs développeurs de bitcoins ont fourni des échantillons de code, des critiques, des commentaires et des encouragements. Merci à Amir Taaki et Eric Voskuil pour les extraits de code par exemple et de nombreux excellents commentaires ; Chris Kleeschulte pour sa contribution à l&#8217;annexe Bitcore ; Vitalik Buterin et Richard Kiss pour leur aide avec les mathématiques des courbes elliptiques et leurs contributions au code ; Gavin Andresen pour les corrections, les commentaires et les encouragements ; Michalis Kargakis pour les commentaires, les contributions et la rédaction de btcd ; et Robin Inge pour les soumissions d&#8217;errata améliorant la deuxième impression. Dans la deuxième édition, j&#8217;ai de nouveau reçu beaucoup d&#8217;aide de la part de nombreux développeurs de Bitcoin Core, dont Eric Lombrozo qui a démystifié le Témoin Séparé, Luke Dashjr qui a aidé à améliorer le chapitre sur les transactions, Johnson Lau qui a revu le Témoin Séparé et d&#8217;autres chapitres, et bien d&#8217;autres. Je dois remercier Joseph Poon, Tadge Dryja et Olaoluwa Osuntokun qui ont expliqué le Lightning Network, revu mes écrits et répondu aux questions lorsque je suis resté bloqué.</p>
</div>
<div class="paragraph data-line-123">
<p>Je dois mon amour des mots et des livres à ma mère, Theresa, qui m&#8217;a élevé dans une maison avec des livres tapissant tous les murs. Ma mère m&#8217;a également acheté mon premier ordinateur en 1982, bien qu&#8217;elle se décrive comme une technophobe. Mon père, Menelaos, un ingénieur civil qui vient de publier son premier livre à 80 ans, est celui qui m&#8217;a enseigné la pensée logique et analytique et l&#8217;amour de la science et de l&#8217;ingénierie.</p>
</div>
<div class="paragraph data-line-125">
<p>Merci à tous de m&#8217;avoir soutenu tout au long de ce parcours.</p>
</div>
<div class="sect3 data-line-2">
<h4 id="github_contrib">Version préliminaire (contributions GitHub)</h4>
<div class="paragraph data-line-4">
<p>De nombreux contributeurs ont proposé des commentaires, des corrections et des ajouts à la première version préliminaire sur GitHub. Merci à tous pour vos contributions à ce livre.</p>
</div>
<div class="paragraph data-line-6">
<p>Voici une liste des contributeurs notables de GitHub :</p>
</div>
<div class="ulist data-line-8">
<ul>
<li class="data-line-8">
<p>Abdussamad Abdurrazzaq (AbdussamadA)</p>
</li>
<li class="data-line-9">
<p>Adán SDPC (aesedepece)</p>
</li>
<li class="data-line-10">
<p>Akira Chiku (achiku)</p>
</li>
<li class="data-line-11">
<p>Alex Waters (alexwaters)</p>
</li>
<li class="data-line-12">
<p>Andrew Donald Kennedy (grkvlt)</p>
</li>
<li class="data-line-13">
<p>Andrey Esaulov (andremaha)</p>
</li>
<li class="data-line-14">
<p>Arthur O&#8217;Dwyer (Quuxplusone)</p>
</li>
<li class="data-line-15">
<p>bargitta</p>
</li>
<li class="data-line-16">
<p>bisqfan</p>
</li>
<li class="data-line-17">
<p>bitcoinctf</p>
</li>
<li class="data-line-18">
<p>blip151</p>
</li>
<li class="data-line-19">
<p>Bryan Gmyrek (physicsdude)</p>
</li>
<li class="data-line-20">
<p>Casey Flynn (cflynn07)</p>
</li>
<li class="data-line-21">
<p>cclauss</p>
</li>
<li class="data-line-22">
<p>Chapman Shoop (belovachap)</p>
</li>
<li class="data-line-23">
<p>Christie D&#8217;Anna (avocadobreath)</p>
</li>
<li class="data-line-24">
<p>Cihat Imamoglu (cihati)</p>
</li>
<li class="data-line-25">
<p>Cody Scott (Siecje)</p>
</li>
<li class="data-line-26">
<p>coinradar</p>
</li>
<li class="data-line-27">
<p>Cragin Godley (cgodley)</p>
</li>
<li class="data-line-28">
<p>Craig Dodd (cdodd)</p>
</li>
<li class="data-line-29">
<p>dallyshalla</p>
</li>
<li class="data-line-30">
<p>Dan Nolan (Dan-Nolan)</p>
</li>
<li class="data-line-31">
<p>Dan Raviv (danra)</p>
</li>
<li class="data-line-32">
<p>Darius Kramer (dkrmr)</p>
</li>
<li class="data-line-33">
<p>Darko Janković (trulex)</p>
</li>
<li class="data-line-34">
<p>David Huie (DavidHuie)</p>
</li>
<li class="data-line-35">
<p>didongke</p>
</li>
<li class="data-line-36">
<p>Diego Viola (diegoviola)</p>
</li>
<li class="data-line-37">
<p>Dimitris Tsapakidis (dimitris-t)</p>
</li>
<li class="data-line-38">
<p>Dirk Jäckel (biafra23)</p>
</li>
<li class="data-line-39">
<p>Dmitry Marakasov (AMDmi3)</p>
</li>
<li class="data-line-40">
<p>drstrangeM</p>
</li>
<li class="data-line-41">
<p>Ed Eykholt (edeykholt)</p>
</li>
<li class="data-line-42">
<p>Ed Leafe (EdLeafe)</p>
</li>
<li class="data-line-43">
<p>Edward Posnak (edposnak)</p>
</li>
<li class="data-line-44">
<p>Elias Rodrigues (elias19r)</p>
</li>
<li class="data-line-45">
<p>Eric Voskuil (evoskuil)</p>
</li>
<li class="data-line-46">
<p>Eric Winchell (winchell)</p>
</li>
<li class="data-line-47">
<p>Erik Wahlström (erikwam)</p>
</li>
<li class="data-line-48">
<p>effectsToCause (vericoin)</p>
</li>
<li class="data-line-49">
<p>Esteban Ordano (eordano)</p>
</li>
<li class="data-line-50">
<p>ethers</p>
</li>
<li class="data-line-51">
<p>Evlix</p>
</li>
<li class="data-line-52">
<p>fabienhinault</p>
</li>
<li class="data-line-53">
<p>Fan (whiteath)</p>
</li>
<li class="data-line-54">
<p>Francis Ballares (fballares)</p>
</li>
<li class="data-line-55">
<p>François Wirion (wirion)</p>
</li>
<li class="data-line-56">
<p>Frank Höger (francyi)</p>
</li>
<li class="data-line-57">
<p>Gabriel Montes (gabmontes)</p>
</li>
<li class="data-line-58">
<p>Gaurav Rana (bitcoinsSG)</p>
</li>
<li class="data-line-59">
<p>genjix</p>
</li>
<li class="data-line-60">
<p>Geremia</p>
</li>
<li class="data-line-61">
<p>Gerry Smith (Hermetic)</p>
</li>
<li class="data-line-62">
<p>gmr81</p>
</li>
<li class="data-line-63">
<p>Gregory Trubetskoy (grisha)</p>
</li>
<li class="data-line-64">
<p>Gus (netpoe)</p>
</li>
<li class="data-line-65">
<p>halseth</p>
</li>
<li class="data-line-66">
<p>harelw</p>
</li>
<li class="data-line-67">
<p>Harry Moreno (morenoh149)</p>
</li>
<li class="data-line-68">
<p>Holger Schinzel (schinzelh)</p>
</li>
<li class="data-line-69">
<p>Ioannis Cherouvim (cherouvim)</p>
</li>
<li class="data-line-70">
<p>Ish Ot Jr. (ishotjr)</p>
</li>
<li class="data-line-71">
<p>ivangreene</p>
</li>
<li class="data-line-72">
<p>James Addison (jayaddison)</p>
</li>
<li class="data-line-73">
<p>Jameson Lopp (jlopp)</p>
</li>
<li class="data-line-74">
<p>Jason Bisterfeldt (jbisterfeldt)</p>
</li>
<li class="data-line-75">
<p>Javier Rojas (fjrojasgarcia)</p>
</li>
<li class="data-line-76">
<p>Jordan Baczuk (JBaczuk)</p>
</li>
<li class="data-line-77">
<p>Jeremy Bokobza (bokobza)</p>
</li>
<li class="data-line-78">
<p>JerJohn15</p>
</li>
<li class="data-line-79">
<p>Jimmy DeSilva (jimmydesilva)</p>
</li>
<li class="data-line-80">
<p>Jo Wo (jowo-io)</p>
</li>
<li class="data-line-81">
<p>Joe Bauers (joebauers)</p>
</li>
<li class="data-line-82">
<p>joflynn</p>
</li>
<li class="data-line-83">
<p>Johnson Lau (jl2012)</p>
</li>
<li class="data-line-84">
<p>Jonathan Cross (jonathancross)</p>
</li>
<li class="data-line-85">
<p>Jorgeminator</p>
</li>
<li class="data-line-86">
<p>jwbats</p>
</li>
<li class="data-line-87">
<p>Kai Bakker (kaibakker)</p>
</li>
<li class="data-line-88">
<p>kollokollo</p>
</li>
<li class="data-line-89">
<p>lightningnetworkstores</p>
</li>
<li class="data-line-90">
<p>lilianrambu</p>
</li>
<li class="data-line-91">
<p>Liu Yue (lyhistory)</p>
</li>
<li class="data-line-92">
<p>Lucas Betschart (lclc)</p>
</li>
<li class="data-line-93">
<p>Magomed Aliev (30mb1)</p>
</li>
<li class="data-line-94">
<p>Mai-Hsuan Chia (mhchia)</p>
</li>
<li class="data-line-95">
<p>Marco Falke (MarcoFalke)</p>
</li>
<li class="data-line-96">
<p>María Martín (mmartinbar)</p>
</li>
<li class="data-line-97">
<p>Mark Pors (pors)</p>
</li>
<li class="data-line-98">
<p>Martin Harrigan (harrigan)</p>
</li>
<li class="data-line-99">
<p>Martin Vseticka (MartyIX)</p>
</li>
<li class="data-line-100">
<p>Marzig (marzig76)</p>
</li>
<li class="data-line-101">
<p>Matt McGivney (mattmcgiv)</p>
</li>
<li class="data-line-102">
<p>Maximilian Reichel (phramz)</p>
</li>
<li class="data-line-103">
<p>Michalis Kargakis (kargakis)</p>
</li>
<li class="data-line-104">
<p>Michael C. Ippolito (michaelcippolito)</p>
</li>
<li class="data-line-105">
<p>Michael Galero (mikong)</p>
</li>
<li class="data-line-106">
<p>Michael Newman (michaelbnewman)</p>
</li>
<li class="data-line-107">
<p>Mihail Russu (MihailRussu)</p>
</li>
<li class="data-line-108">
<p>Minh T. Nguyen (enderminh)</p>
</li>
<li class="data-line-109">
<p>montvid</p>
</li>
<li class="data-line-110">
<p>Morfies (morfies)</p>
</li>
<li class="data-line-111">
<p>Nagaraj Hubli (nagarajhubli)</p>
</li>
<li class="data-line-112">
<p>Nekomata (nekomata-3)</p>
</li>
<li class="data-line-113">
<p>nekonenene</p>
</li>
<li class="data-line-114">
<p>Nhan Vu (jobnomade)</p>
</li>
<li class="data-line-115">
<p>Nicholas Chen (nickycutesc)</p>
</li>
<li class="data-line-116">
<p>Omar Boukli-Hacene (oboukli)</p>
</li>
<li class="data-line-117">
<p>Parzival (Parz-val)</p>
</li>
<li class="data-line-118">
<p>Philipp Gille (philippgille)</p>
</li>
<li class="data-line-119">
<p>ratijas</p>
</li>
<li class="data-line-120">
<p>Reproducibility Matters (TheCharlatan)</p>
</li>
<li class="data-line-121">
<p>Reuben Thomas (rrthomas)</p>
</li>
<li class="data-line-122">
<p>Robert Furse (Rfurse)</p>
</li>
<li class="data-line-123">
<p>Roberto Mannai (robermann)</p>
</li>
<li class="data-line-124">
<p>Richard Kiss (richardkiss)</p>
</li>
<li class="data-line-125">
<p>rszheng</p>
</li>
<li class="data-line-126">
<p>Ruben Alexander (hizzvizz)</p>
</li>
<li class="data-line-127">
<p>Sam Ritchie (sritchie)</p>
</li>
<li class="data-line-128">
<p>Sanjay Sanathanan (sanjays95)</p>
</li>
<li class="data-line-129">
<p>Sebastian Falbesoner (theStack)</p>
</li>
<li class="data-line-130">
<p>Sergej Kotliar (ziggamon)</p>
</li>
<li class="data-line-131">
<p>Seiichi Uchida (topecongiro)</p>
</li>
<li class="data-line-132">
<p>shaysw</p>
</li>
<li class="data-line-133">
<p>Simon de la Rouviere (simondlr)</p>
</li>
<li class="data-line-134">
<p>Stacie (staciewaleyko)</p>
</li>
<li class="data-line-135">
<p>Stephan Oeste (Emzy)</p>
</li>
<li class="data-line-136">
<p>Stéphane Roche (Janaka-Steph)</p>
</li>
<li class="data-line-137">
<p>takaya-imai</p>
</li>
<li class="data-line-138">
<p>Thiago Arrais (thiagoarrais)</p>
</li>
<li class="data-line-139">
<p>Thomas Kerin (afk11)</p>
</li>
<li class="data-line-140">
<p>Tochi Obudulu (tochicool)</p>
</li>
<li class="data-line-141">
<p>venzen</p>
</li>
<li class="data-line-142">
<p>Vlad Stan (motorina0)</p>
</li>
<li class="data-line-143">
<p>Vijay Chavda (VijayChavda)</p>
</li>
<li class="data-line-144">
<p>Vincent Déniel (vincentdnl)</p>
</li>
<li class="data-line-145">
<p>weinim</p>
</li>
<li class="data-line-146">
<p>wenzhenxiang</p>
</li>
<li class="data-line-147">
<p>Will Binns (wbnns)</p>
</li>
<li class="data-line-148">
<p>wintercooled</p>
</li>
<li class="data-line-149">
<p>wjx</p>
</li>
<li class="data-line-150">
<p>Wojciech Langiewicz (wlk)</p>
</li>
<li class="data-line-151">
<p>Yancy Ribbens (yancyribbens)</p>
</li>
<li class="data-line-152">
<p>yjjnls</p>
</li>
<li class="data-line-153">
<p>Yoshimasa Tanabe (emag)</p>
</li>
<li class="data-line-154">
<p>yuntai</p>
</li>
<li class="data-line-155">
<p>yurigeorgiev4</p>
</li>
<li class="data-line-156">
<p>Zheng Jia (zhengjia)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="_glossaire_rapide">Glossaire rapide</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-4">
<p>Ce glossaire rapide contient de nombreux termes utilisés en relation avec le bitcoin. Ces termes sont utilisés tout au long du livre, alors mettez-les en signet pour une référence rapide.</p>
</div>
<div class="dlist data-line-6">
<dl>
<dt class="hdlist1">adresse</dt>
<dd>
<p>Une adresse Bitcoin ressemble à <code>1DSrfJdB2AnWaFNgSbv3MZC2m74996JafV</code>. Il se compose d&#8217;une suite de lettres et de chiffres. Il s&#8217;agit en réalité d&#8217;une version codée en base58check d&#8217;un résultat de hachage à clé publique de 160 bits. Tout comme vous demandez aux autres d&#8217;envoyer un courriel à l&#8217;adresse de celle-ci, vous demanderez aux autres de vous envoyer des bitcoins à l&#8217;une de vos adresses Bitcoin.</p>
</dd>
<dt class="hdlist1">adresse P2SH</dt>
<dd>
<p>Les adresses P2SH sont des encodages Base58Check du résultat de hachage de 20 octets d&#8217;un script. Ils utilisent le préfixe de version "5", ce qui donne des adresses encodées en Base58Check qui commencent par un "3". Les adresses P2SH cachent toute la complexité, de sorte que la personne effectuant un paiement ne voit pas le script.</p>
</dd>
<dt class="hdlist1">arbre de Merkle</dt>
<dd>
<p>Un arbre construit en hachant des données appariées (les feuilles), puis en appariant et en hachant les résultats jusqu&#8217;à ce qu&#8217;il ne reste qu&#8217;un seul résultat de hachage, la racine de Merkle. En bitcoin, les feuilles sont presque toujours des transactions d&#8217;un seul bloc.</p>
</dd>
<dt class="hdlist1">bassin de transactions</dt>
<dd>
<p>Une collection non ordonnée de transactions qui ne sont pas en blocs dans la chaîne principale, mais pour lesquelles nous avons des transactions d&#8217;entrée.</p>
</dd>
<dt class="hdlist1">bip</dt>
<dd>
<p>Bitcoin Improvement Proposals (ou Propositions d&#8217;amélioration de Bitcoin). Un ensemble de propositions que les membres de la communauté Bitcoin ont soumises pour améliorer Bitcoin. Par exemple, BIP-21 est une proposition visant à améliorer le schéma d&#8217;identificateur de ressource uniforme (URI) bitcoin.</p>
</dd>
<dt class="hdlist1">bitcoin</dt>
<dd>
<p>Le nom de l&#8217;unité monétaire (unité de cryptomonnaie), du réseau et du logiciel.</p>
</dd>
<dt class="hdlist1">bloc</dt>
<dd>
<p>Regroupement de transactions, marqué d&#8217;un horodatage et d&#8217;une empreinte digitale du bloc précédent. L&#8217;en-tête du bloc est haché (c.-à-d., on obtient un résultat de hachage) pour produire une preuve de travail, validant ainsi les transactions. Les blocs valides sont ajoutés à la chaîne de blocs principale par consensus du réseau.</p>
</dd>
<dt class="hdlist1">bloc candidat</dt>
<dd>
<p>Un bloc qu&#8217;un mineur essaie toujours d&#8217;exploiter. Ce n&#8217;est pas encore un bloc valide, car il ne contient pas de Proof-of-Work (ou Preuve de travail) valide.</p>
</dd>
<dt class="hdlist1">bloc de genèse</dt>
<dd>
<p>Le premier bloc de la chaîne de blocs, utilisé pour initialiser la cryptomonnaie (ou cybermonnaie).</p>
</dd>
<dt class="hdlist1">bloc orphelin</dt>
<dd>
<p>Les blocs dont le bloc parent n&#8217;a pas été traité par le nœud local, ils ne peuvent donc pas encore être entièrement validés. À ne pas confondre avec le bloc obsolète.</p>
</dd>
<dt class="hdlist1">bloc périmé</dt>
<dd>
<p>Un bloc valide qui a été extrait avec succès mais qui n&#8217;est pas inclus dans la branche principale actuelle (avec la plupart des preuves de travail cumulatives), car un autre bloc valide qui a été extrait à la même hauteur a vu sa chaîne étendue en premier. Le mineur d&#8217;un bloc périmé ne reçoit pas la récompense du bloc ni les frais de transaction de ce bloc.
À ne pas confondre avec le bloc orphelin ou le bloc candidat.</p>
</dd>
<dt class="hdlist1">canaux de paiement</dt>
<dd>
<p>Un canal de micropaiement ou canal de paiement est une classe de techniques conçues pour permettre aux utilisateurs d&#8217;effectuer plusieurs transactions bitcoin sans engager toutes les transactions dans la chaîne de blocs Bitcoin. Dans un canal de paiement typique, seules deux transactions sont ajoutées à la chaîne de blocs, mais un nombre illimité ou presque illimité de paiements peut être effectué entre les participants.</p>
</dd>
<dt class="hdlist1">chaîne de blocs (ou blockchain)</dt>
<dd>
<p>Une liste de blocs validés, chacun lié à son prédécesseur jusqu&#8217;au bloc de genèse.</p>
</dd>
<dt class="hdlist1">cible de difficulté</dt>
<dd>
<p>Une difficulté pour le calcul dans tout le réseau et qui permet de solutionner et valider l&#8217;ajout d&#8217;un bloc environ toutes les 10 minutes.</p>
</dd>
<dt class="hdlist1">clé secrète (ou clé privée)</dt>
<dd>
<p>Le numéro secret qui déverrouille le bitcoin envoyé à l&#8217;adresse correspondante. <span class="keep-together">Une clé secrète</span> ressemble à ceci :</p>
<div class="listingblock data-line-53">
<div class="content">
<pre>5J76sF8L5jTtzE96r66Sf8cka9y44wdpJjMwCxR3tzLh3ibVPxh</pre>
</div>
</div>
</dd>
<dt class="hdlist1">coinbase (ou unité de monnaie primaire du bloc) (alias donnée coinbase)</dt>
<dd>
<p>Un champ spécial utilisé comme seule entrée pour les transactions coinbase. Le champ de données coinbase permet de réclamer la récompense de bloc et fournit jusqu&#8217;à 100 octets pour les données arbitraires.
À ne pas confondre avec la "transaction coinbase" ou la "récompense coinbase".</p>
</dd>
<dt class="hdlist1">complétude de Turing</dt>
<dd>
<p>Un langage de programmation est appelé "Turing complet" s&#8217;il peut exécuter n&#8217;importe quel programme qu&#8217;une machine de Turing peut exécuter, avec suffisamment de temps et de mémoire.</p>
</dd>
<dt class="hdlist1">confirmations</dt>
<dd>
<p>Une fois qu&#8217;une transaction est incluse dans un bloc, elle a une confirmation. Dès qu&#8217;un autre bloc est miné sur la même chaîne de blocs, la transaction a deux confirmations, et ainsi de suite. Six confirmations ou plus sont considérées comme une preuve suffisante qu&#8217;une transaction ne peut pas être annulée.</p>
</dd>
<dt class="hdlist1">consensus</dt>
<dd>
<p>Lorsque plusieurs nœuds, généralement la plupart des nœuds du réseau, ont tous les mêmes blocs dans leur meilleure chaîne de blocs validée localement.
À ne pas confondre avec les règles de consensus.</p>
</dd>
<dt class="hdlist1">difficulté</dt>
<dd>
<p>Un paramètre à l&#8217;échelle du réseau qui contrôle la quantité de calculs nécessaires pour produire une preuve de travail (ou le Proof-of-Work).</p>
</dd>
<dt class="hdlist1">double dépense</dt>
<dd>
<p>La double dépense est le résultat d&#8217;avoir réussi à dépenser de l&#8217;argent plus d&#8217;une fois. Bitcoin protège contre les doubles dépenses en vérifiant chaque transaction ajoutée à la chaîne de blocs pour s&#8217;assurer que les entrées de la transaction n&#8217;avaient pas déjà été dépensées auparavant.</p>
</dd>
<dt class="hdlist1">ECDSA</dt>
<dd>
<p>Elliptic Curve Digital Signature Algorithm ou ECDSA est un algorithme cryptographique utilisé par bitcoin pour garantir que les fonds ne peuvent être dépensés que par leurs propriétaires légitimes.</p>
</dd>
<dt class="hdlist1">embranchement convergent (ou soft fork)</dt>
<dd>
<p>L&#8217;embranchement convergent ou le Soft-Forking Change est un fourche temporaire dans la chaîne de blocs qui se produit généralement lorsque les mineurs utilisant des nœuds non mis à niveau ne suivent pas une nouvelle règle de consensus que leurs nœuds ne connaissent pas.
À ne pas confondre avec fourche, embranchement divergent (hard fork), fourche logicielle ou fourche de Git.</p>
</dd>
<dt class="hdlist1">embranchement divergent (ou hard fork)</dt>
<dd>
<p>L&#8217;embranchement divergent, également connu sous le nom de Hard-Forking Change, est une divergence permanente dans la chaîne de blocs, se produit généralement lorsque les nœuds non mis à niveau ne peuvent pas valider les blocs créés par les nœuds mis à niveau qui suivent les nouvelles règles de consensus.
À ne pas confondre avec une fourche, une fourche molle, une fourche de code ou une fourche Git, mais tout de même un nouvel embranchement d&#8217;une arborescence de données (avec une source parent unique).</p>
</dd>
<dt class="hdlist1">exploitation minière groupée</dt>
<dd>
<p>L&#8217;exploitation minière en groupe est une approche d&#8217;exploitation minière dans laquelle plusieurs clients générateurs contribuent à la génération d&#8217;un bloc, puis divisent la récompense du bloc en fonction de la puissance de traitement apportée.</p>
</dd>
<dt class="hdlist1">extrant (ou output)</dt>
<dd>
<p>Le produit sorti ou l&#8217;extrant (ou output), la sortie de transaction ou TxOut est une sortie dans une transaction qui contient deux champs : un champ de valeur pour transférer zéro ou plusieurs satoshis et un script pubkey pour indiquer quelles conditions doivent être remplies pour que ces satoshis soient dépensés davantage.</p>
</dd>
<dt class="hdlist1">format d&#8217;importation de portefeuille (WIF ou Wallet Import Format)</dt>
<dd>
<p>Le format d&#8217;importation de portefeuille (WIF ou Wallet Import Format) est un format d&#8217;échange de données conçu pour permettre l&#8217;exportation et l&#8217;importation d&#8217;une seule clé privée avec un indicateur indiquant s&#8217;il utilise ou non une clé publique compressée.</p>
</dd>
<dt class="hdlist1">fourche</dt>
<dd>
<p>La fourche, également connue sous le nom de fourche accidentelle, se produit lorsque deux blocs ou plus ont la même hauteur de bloc, forçant la chaîne de blocs à se dédoubler. Cela se produit généralement lorsque deux mineurs ou plus trouvent des blocs presque en même temps. Peut également se produire dans le cadre d&#8217;une attaque.</p>
</dd>
<dt class="hdlist1">frais</dt>
<dd>
<p>L&#8217;expéditeur d&#8217;une transaction inclut souvent une valeur de frais au réseau pour le traitement de la transaction demandée. La plupart des transactions nécessitent des frais minimum de 0,5 mBTC.</p>
</dd>
<dt class="hdlist1">HTLC</dt>
<dd>
<p>Un contrat Hashed TimeLock ou HTLC est une classe de paiements qui utilisent des hashlocks (ou serrures par empreintes numériques) et des timelocks (ou serrures par horodatage) pour exiger que le destinataire d&#8217;un paiement reconnaisse avoir reçu le paiement avant une date limite en générant une preuve cryptographique de paiement ou renonce à la possibilité de réclamer le paiement, le retournant au payeur.</p>
</dd>
<dt class="hdlist1">KYC</dt>
<dd>
<p>Know Your Customer (ou Connaître son client) (KYC) est le processus d&#8217;une entreprise qui identifie et vérifie l&#8217;identité de ses clients. Le terme est également utilisé pour désigner la réglementation bancaire qui régit ces activités.</p>
</dd>
<dt class="hdlist1">LevelDB</dt>
<dd>
<p>LevelDB est un moyen de stockage clé-valeur open source sur disque. LevelDB est une bibliothèque légère à usage unique pour la persistance avec des liaisons sur de nombreuses plates-formes.</p>
</dd>
<dt class="hdlist1">Lightning Networks</dt>
<dd>
<p>Lightning Network est une implémentation de Hashed Timelock Contracts (HTLC) avec des canaux de paiement bidirectionnels qui permettent aux paiements d&#8217;être acheminés en toute sécurité sur plusieurs canaux de paiement pair à pair. Cela permet la formation d&#8217;un réseau où n&#8217;importe quel pair sur le réseau peut payer n&#8217;importe quel autre pair même s&#8217;ils n&#8217;ont pas directement de canal ouvert entre eux.</p>
</dd>
<dt class="hdlist1">mempool</dt>
<dd>
<p>Le bitcoin Mempool (bassin de mémoire) est une collection de toutes les données de transaction dans un bloc qui ont été vérifiées par les nœuds Bitcoin, mais qui ne sont pas encore confirmées.</p>
</dd>
<dt class="hdlist1">mineur</dt>
<dd>
<p>Un nœud de réseau qui trouve une preuve de travail valide pour les nouveaux blocs, par hachage répété.</p>
</dd>
<dt class="hdlist1">multisignature</dt>
<dd>
<p>La multisignature (multisig) fait référence à l&#8217;exigence d&#8217;un nombre minimum (M) de clés (N) pour autoriser une transaction M-sur-N.</p>
</dd>
<dt class="hdlist1">nombre aléatoire explicite (ou nonce)</dt>
<dd>
<p>Le "nombre aléatoire explicite" (ou nonce) dans un bloc bitcoin est un champ de 32 bits (4 octets) dont la valeur est définie de manière à ce que le résultat de hachage du bloc contienne une série de zéros non significatifs. Les autres champs ne peuvent pas être modifiés, car ils ont une signification définie.</p>
</dd>
<dt class="hdlist1">nombre aléatoire explicite supplémentaire</dt>
<dd>
<p>Au fur et à mesure que la difficulté augmentait, les mineurs parcouraient souvent les 4 milliards de nombres aléatoires explicites (nonce) sans trouver de bloc. Étant donné que le script coinbase peut stocker entre 2 et 100 octets de données, les mineurs ont commencé à utiliser cet espace comme espace pour un nombre aléatoire explicite supplémentaire, leur permettant d&#8217;explorer une gamme beaucoup plus large de valeurs d&#8217;en-tête de bloc pour trouver des blocs valides.</p>
</dd>
<dt class="hdlist1">opcode</dt>
<dd>
<p>Codes d&#8217;opération du langage de script bitcoin qui poussent des données ou exécutent des fonctions dans un script pubkey ou un script de signature.</p>
</dd>
<dt class="hdlist1">OP_RETURN</dt>
<dd>
<p>Un opcode (ou code d&#8217;opération) utilisé dans l&#8217;une des sorties d&#8217;une transaction OP_RETURN. A ne pas confondre avec la transaction OP_RETURN.</p>
</dd>
<dt class="hdlist1">phrase secrète</dt>
<dd>
<p>Une phrase secrète (ou phrase de passe) est une chaîne de caractères facultative créée par l&#8217;utilisateur qui sert de facteur de sécurité supplémentaire protégeant la valeur d&#8217;amorçage, même lorsque la valeur d&#8217;amorçage est compromise par un voleur. Il peut également être utilisé comme une forme de pot de miel, où une phrase de passe choisie (une adresse bitcoin, un URL ou autre) mène à un portefeuille avec une petite quantité de fonds utilisée pour distraire un attaquant du "vrai" portefeuille qui contient la majorité des fonds.</p>
</dd>
<dt class="hdlist1">portefeuille</dt>
<dd>
<p>Logiciel qui contient toutes vos adresses Bitcoin et clés secrètes. Utilisez-le pour envoyer, recevoir et stocker vos bitcoins.</p>
</dd>
<dt class="hdlist1">portefeuille d&#8217;amorçage HD</dt>
<dd>
<p>Le portefeuille d&#8217;amorçage HD ou la valeur d&#8217;amorçage est une valeur potentiellement courte utilisée comme valeur racine pour générer la clé privée principale et le code de chaîne principal pour un portefeuille HD.</p>
</dd>
<dt class="hdlist1">portefeuille HD</dt>
<dd>
<p>Portefeuilles utilisant le protocole de création et de transfert de clés Hierarchical Deterministic (HD Protocol) (BIP-32).</p>
</dd>
<dt class="hdlist1">portefeuille matériel (hardware)</dt>
<dd>
<p>Un portefeuille matériel est un type spécial de portefeuille bitcoin qui stocke les clés privées de l&#8217;utilisateur dans un périphérique matériel sécurisé.</p>
</dd>
<dt class="hdlist1">portefeuille papier</dt>
<dd>
<p>Dans le sens le plus spécifique, un portefeuille papier est un document contenant toutes les données nécessaires pour générer un nombre quelconque de clés privées bitcoin, formant un portefeuille de clés. Cependant, les gens utilisent souvent le terme pour désigner tout moyen de stocker des bitcoins hors ligne en tant que document physique. Cette deuxième définition comprend également les clés papier et les codes échangeables.</p>
</dd>
<dt class="hdlist1">preuve d&#8217;enjeu (ou Proof-of-Stake)</dt>
<dd>
<p>La preuve d&#8217;enjeu (PoS) est une méthode par laquelle un réseau de chaîne de blocs de cryptomonnaie vise à atteindre un consensus distribué. La preuve d&#8217;enjeu demande aux utilisateurs de prouver qu&#8217;ils sont propriétaires d&#8217;un certain montant de devise (leur « enjeu » ou « participation » dans la devise).</p>
</dd>
<dt class="hdlist1">preuve de travail (ou Proof-of-Work)</dt>
<dd>
<p>Une donnée qui nécessite des calculs importants pour être trouvée. Dans le bitcoin, les mineurs doivent trouver une solution numérique à l&#8217;algorithme SHA256 qui répond à une cible à l&#8217;échelle du réseau, la cible de difficulté.</p>
</dd>
<dt class="hdlist1">problème des généraux Byzantins (ou Byzantine Generals Problem)</dt>
<dd>
<p>Un système informatique fiable doit pouvoir faire face à la défaillance d&#8217;un ou plusieurs de ses composants. Un composant défaillant peut présenter un type de comportement souvent négligé, à savoir l&#8217;envoi d&#8217;informations contradictoires à différentes parties du système. Le problème de faire face à ce type d&#8217;échec est exprimé abstraitement comme le Byzantine Generals Problem (ou Problème des généraux byzantins) (voir <a href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_des_g%C3%A9n%C3%A9raux_byzantins" class="undefined" data-href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_des_g%C3%A9n%C3%A9raux_byzantins">https://fr.wikipedia.org/wiki/Probl%C3%A8me_des_g%C3%A9n%C3%A9raux_byzantins</a>).</p>
</dd>
<dt class="hdlist1">protocole d&#8217;actifs ouverts (ou Open Assets protocol)</dt>
<dd>
<p>Le protocole d&#8217;actifs ouverts (ou Open Assets protocol) est un protocole simple et puissant construit au-dessus de la chaîne de blocs Bitcoin. Il permet l&#8217;émission et le transfert d&#8217;actifs créés par l&#8217;utilisateur.</p>
</dd>
<dt class="hdlist1">protocole HD</dt>
<dd>
<p>Le protocole de création et de transfert de clés Hierarchical Deterministic (HD) (BIP-32), qui permet de créer des clés enfants à partir de clés parents dans une hiérarchie.</p>
</dd>
<dt class="hdlist1">P2PKH</dt>
<dd>
<p>Les transactions qui paient une adresse Bitcoin contiennent des scripts P2PKH ou Pay To PubKey Hash. Une sortie verrouillée par un script P2PKH peut être déverrouillée (dépensée) en présentant une clé publique et une signature numérique créée par la clé privée correspondante.</p>
</dd>
<dt class="hdlist1">P2SH</dt>
<dd>
<p>P2SH ou Pay-to-Script-Hash est un nouveau type de transaction puissant qui simplifie grandement l&#8217;utilisation de scripts de transaction complexes. Avec P2SH le script complexe qui détaille les conditions de dépense de la sortie (redeem script) n&#8217;est pas présenté dans le script de verrouillage. Au lieu de cela, seul un résultat de hachage de celui-ci se trouve dans le script de verrouillage.</p>
</dd>
<dt class="hdlist1">P2WPKH</dt>
<dd>
<p>La signature d&#8217;un P2WPKH (Pay-to-Witness-Public-Key-Hash) contient les mêmes informations qu&#8217;une dépense P2PKH, mais se trouve dans le champ témoin au lieu du champ scriptSig. Le scriptPubKey est également modifié.</p>
</dd>
<dt class="hdlist1">P2WSH</dt>
<dd>
<p>La différence entre P2SH et P2WSH (Pay-to-Witness-Script-Hash) concerne le changement d&#8217;emplacement de la preuve cryptographique du champ scriptSig au champ témoin et le scriptPubKey qui est également modifié.</p>
</dd>
<dt class="hdlist1">racine de Merkle</dt>
<dd>
<p>Le nœud racine d&#8217;un arbre de Merkle, un descendant de toutes les paires hachées de l&#8217;arbre. Les en-têtes de bloc doivent inclure une racine de Merkle valide issue de toutes les transactions de ce bloc.</p>
</dd>
<dt class="hdlist1">reciblage de difficulté</dt>
<dd>
<p>Un recalcul à l&#8217;échelle du réseau de la difficulté qui se produit une fois tous les 2 016 blocs et prend en compte la puissance de hachage des 2 016 blocs précédents.</p>
</dd>
<dt class="hdlist1">récompense de bloc (alias récompense coinbase (ou unité de monnaie primaire du bloc)</dt>
<dd>
<p>Un montant inclus dans chaque nouveau bloc comme récompense par le réseau au mineur qui a trouvé la solution Proof-of-Work (ou Preuve de travail)). Environ tous les quatre ans, ou plus précisément tous les 210 000 blocs, la récompense de bloc globale est réduite de moitié. Il est actuellement de 6,25 BTC par bloc.</p>
</dd>
<dt class="hdlist1">récompense minière</dt>
<dd>
<p>Les récompense que les mineurs reçoivent en échange de la sécurité fournie par l&#8217;exploitation minière, comprend les nouvelles pièces bitcoin créées avec chaque nouveau bloc, également appelées récompense de bloc ou récompense coinbase, et les frais de transaction de toutes les transactions incluses dans le bloc.</p>
</dd>
<dt class="hdlist1">réduction de moitié (ou halving)</dt>
<dd>
<p>Un événement de réduction de moitié se produit lorsque la récompense de bloc est réduite de moitié, ce qui se produit environ tous les quatre ans (ou précisément tous les 210 000 blocs). Bitcoin a déjà connu trois événements de réduction de moitié : en 2012 (de 50 à 25 BTC), en 2016 (de 25 à 12,5 BTC) et en 2020 (de 12,5 à 6,25 BTC).</p>
</dd>
<dt class="hdlist1">règles de consensus</dt>
<dd>
<p>Les règles de validation de bloc que les nœuds complets suivent pour rester en consensus avec les autres nœuds.
A ne pas confondre avec le consensus.</p>
</dd>
<dt class="hdlist1">réseau</dt>
<dd>
<p>Un réseau pair à pair qui propage les transactions et les bloques à chaque nœud Bitcoin du réseau.</p>
</dd>
<dt class="hdlist1">résultat de hachage (ou hash)</dt>
<dd>
<p>Une empreinte numérique d&#8217;une entrée binaire.</p>
</dd>
<dt class="hdlist1">RIPEMD-160</dt>
<dd>
<p>RIPEMD-160 est une fonction de hachage cryptographique 160 bits. RIPEMD-160 est une version renforcée de RIPEMD avec un résultat de hachage de 160 bits, et devrait être sécurisé pour les dix prochaines années ou plus.</p>
</dd>
<dt class="hdlist1">satoshi</dt>
<dd>
<p>Un satoshi est la plus petite dénomination de bitcoin pouvant être enregistrée sur la chaîne de blocs. Il équivaut à 0,00000001 bitcoin et porte le nom du créateur du bitcoin, Satoshi Nakamoto. </p>
</dd>
<dt class="hdlist1">Satoshi Nakamoto</dt>
<dd>
<p>Satoshi Nakamoto est le nom utilisé par la ou les personnes qui ont conçu le bitcoin et créé son implémentation de référence originale, Bitcoin Core. Dans le cadre de la mise en œuvre, ils ont également conçu la première base de données chaîne de blocs. Dans le processus, ils ont été les premiers à résoudre le problème de la double dépense pour la monnaie numérique. Leur véritable identité reste inconnue.</p>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>Bitcoin utilise un système de script pour les transactions. Comme Forth, Script est simple, basé sur une pile et traité de gauche à droite. Il n&#8217;est délibérément pas complet de Turing et sans boucles.</p>
</dd>
<dt class="hdlist1">ScriptPubKey (alias script pubkey)</dt>
<dd>
<p>ScriptPubKey ou script pubkey, est un script inclus dans les sorties qui définit les conditions qui doivent être remplies pour que ces satoshis soient dépensés. Les données permettant de remplir les conditions peuvent être fournies dans un script de signature.</p>
</dd>
<dt class="hdlist1">ScriptSig (ou Script de signature)</dt>
<dd>
<p>ScriptSig ou script de signature, sont les données générées par un dépensier qui sont presque toujours utilisées comme variables pour satisfaire un script pubkey.</p>
</dd>
<dt class="hdlist1">serrure par empreinte numérique (ou hashlocks)</dt>
<dd>
<p>Un serrure par empreinte numérique (ou hashlock) est un type de contrainte qui limite les dépenses d&#8217;une sortie jusqu&#8217;à ce qu&#8217;une donnée spécifique soit révélée publiquement. Les hashlocks ont la propriété utile qu&#8217;une fois qu&#8217;un hashlock est ouvert publiquement, tout autre hashlock sécurisé à l&#8217;aide de la même clé peut également être ouvert. Cela permet de créer plusieurs sorties qui sont toutes encombrées par le même hashlock et qui deviennent toutes dépensables en même temps.</p>
</dd>
<dt class="hdlist1">SHA</dt>
<dd>
<p>Le Secure Hash Algorithm ou SHA est une famille de fonctions de hachage cryptographiques publiées par le National Institute of Standards and Technology (NIST).</p>
</dd>
<dt class="hdlist1">sortie de transaction non dépensée (UTXO ou unspent transaction output)</dt>
<dd>
<p>UTXO est une sortie de transaction non dépensée qui peut être dépensée comme entrée dans une nouvelle transaction.</p>
</dd>
<dt class="hdlist1">stockage à froid</dt>
<dd>
<p>Fait référence à la conservation d&#8217;une réserve de bitcoins hors ligne. Le stockage à froid est réalisé lorsque les clés privées bitcoin sont créées et stockées dans un environnement hors ligne sécurisé. Le stockage à froid est important pour quiconque possède des avoirs en bitcoins. Les ordinateurs en ligne sont vulnérables aux pirates et ne doivent pas être utilisés pour stocker une quantité importante de bitcoins. (note du traducteur : l&#8217;auteur est un peu paranoïde; les nœuds sont en ligne. Si les nœuds sont insécures, c&#8217;est la fin de ce système et de ce livre.) ;)</p>
</dd>
<dt class="hdlist1">témoin séparé</dt>
<dd>
<p>Le témoin séparé est une mise à niveau du protocole Bitcoin dans laquelle les données de signature ("témoin") sont séparées des données de l&#8217;expéditeur/destinataire pour optimiser davantage la structure des transactions. Le témoin Séparé a été implémenté comme un embranchement convergent ; un changement qui rend techniquement les règles du protocole de bitcoin plus restrictives.</p>
</dd>
<dt class="hdlist1">transaction</dt>
<dd>
<p>En termes simples, un transfert de bitcoin d&#8217;une adresse à une autre. Plus précisément, une transaction est une structure de données signée exprimant un transfert de valeur. Les transactions sont transmises sur le réseau Bitcoin, collectées par les mineurs et incluses dans des blocs, rendus permanents sur la chaîne de blocs.</p>
</dd>
<dt class="hdlist1">transaction coinbase</dt>
<dd>
<p>La première transaction d&#8217;un bloc; toujours créé par un mineur. Le coinbase est unique dans le bloc.
À ne pas confondre avec coinbase (données coinbase) ou "récompense coinbase".</p>
</dd>
<dt class="hdlist1">Transaction OP_RETURN</dt>
<dd>
<p>Un type de transaction qui ajoute des données arbitraires à un script pubkey prouvé que les nœuds complets n&#8217;ont pas à stocker dans leur base de données UTXO. A ne pas confondre avec l&#8217;opcode OP_RETURN.</p>
</dd>
<dt class="hdlist1">transactions hors chaîne</dt>
<dd>
<p>Une transaction hors chaîne est le mouvement de valeur en dehors de la chaîne de blocs, alors qu&#8217;une transaction en chaîne&amp;#x2014 est  simplement appelée <em>une transaction</em>&amp;#x2014. La transaction hors chaîne modifie la chaîne de blocs et dépend de cette dernière pour déterminer sa validité. Une transaction hors chaîne de blocs s&#8217;appuie sur d&#8217;autres méthodes pour enregistrer et valider la transaction.</p>
</dd>
<dt class="hdlist1">transactions orphelines</dt>
<dd>
<p>Transactions qui ne peuvent pas entrer dans le bassin de mémoire (Mempool) en raison d&#8217;une ou plusieurs transactions d&#8217;entrée manquantes.</p>
</dd>
<dt class="hdlist1">valeur de relâche de transaction (ou Locktime)</dt>
<dd>
<p>Locktime, ou plus techniquement nLockTime, est la partie d&#8217;une transaction qui indique la première heure où le premier bloc auquel cette transaction peut être ajoutée à la chaîne de blocs. C&#8217;est une valeur horodatée servant de date ultérieur pour une transaction; comme un chèque postdaté.</p>
</dd>
<dt class="hdlist1">vérification simplifiée des paiements (SPV ou Simplified Payment Verification)</dt>
<dd>
<p>La vérification simplifiée des paiements (SPV ou Simplified Payment Verification) est une méthode permettant de vérifier que des transactions particulières ont été incluses dans un bloc, sans télécharger le bloc entier. Cette méthode de vérification est souvent utilisée par les clients Bitcoin légers.</p>
</dd>
<dt class="hdlist1">verrou temporels (ou timelocks)</dt>
<dd>
<p>Un verrou temporel (ou timelock) est un type de contrainte qui limite la dépense de certains bitcoins jusqu&#8217;à une heure future ou une hauteur de bloc spécifiée. Les timelocks figurent en bonne place dans de nombreux contrats bitcoin, y compris les canaux de paiement et les contrats de timelock hachés.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-7">
<p>Certaines définitions fournies ont été extraites sous une licence CC-BY de <a href="https://en.bitcoin.it/wiki/Main_Page" data-href="https://en.bitcoin.it/wiki/Main_Page">bitcoin Wiki</a> ou d&#8217;autres documentations à source libre.</p>
</div>
</div>
</div>
<div class="sect1 pagenumrestart data-line-3">
<h2 id="ch01_intro_what_is_bitcoin">Présentation</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-5">
<h3 id="_quest_ce_que_bitcoin">Qu&#8217;est-ce que Bitcoin ?</h3>
<div class="paragraph data-line-7">
<p>Bitcoin est un ensemble de concepts et de technologies qui constituent la base d&#8217;un écosystème de monnaie numérique. Les unités monétaires appelées bitcoin sont utilisées pour stocker et transmettre de la valeur entre les participants au réseau Bitcoin. Les utilisateurs de Bitcoin communiquent entre eux en utilisant le protocole Bitcoin principalement via Internet, bien que d&#8217;autres réseaux de transport puissent également être utilisés. La pile de protocole Bitcoin, disponible en tant que logiciel à source libre, peut être exécutée sur une large gamme d&#8217;appareils informatiques, y compris les ordinateurs portables et les smartphones, ce qui rend la technologie facilement accessible.</p>
</div>
<div class="admonitionblock tip data-line-10">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-11">
<p>Remarquez comment l&#8217;unité monétaire s&#8217;appelle "bitcoin" avec un petit <em>b</em>, et le système s&#8217;appelle "Bitcoin", avec un <em>B</em> majuscule.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-14">
<p>Les utilisateurs peuvent transférer des bitcoins sur le réseau pour faire à peu près tout ce qui peut être fait avec des devises conventionnelles, y compris acheter et vendre des biens, envoyer de l&#8217;argent à des personnes ou à des organisations ou accorder un crédit. Le bitcoin peut être acheté, vendu et échangé contre d&#8217;autres devises dans des bureaux de change spécialisés. Le bitcoin est en un sens la forme d&#8217;argent idéale pour Internet car il est rapide, sécurisé et sans frontières.</p>
</div>
<div class="paragraph data-line-16">
<p>Contrairement aux monnaies traditionnelles, le bitcoin est entièrement virtuel. Il n&#8217;y a pas de pièces physiques ni même de pièces numériques en soi. Les pièces sont impliquées dans des transactions qui transfèrent de la valeur de l&#8217;expéditeur au destinataire. Les utilisateurs de Bitcoin possèdent des clés qui leur permettent de prouver la propriété du bitcoin dans le réseau Bitcoin. Avec ces clés, ils peuvent signer des transactions pour débloquer la valeur et la dépenser en la transférant à un nouveau propriétaire. Les clés sont souvent stockées dans un portefeuille numérique sur l&#8217;ordinateur ou le smartphone de chaque utilisateur. La possession de la clé qui peut signer une transaction est la seule condition préalable pour dépenser du bitcoin, mettant le contrôle entièrement entre les mains de chaque utilisateur.</p>
</div>
<div class="paragraph data-line-18">
<p>Bitcoin est un système distribué pair à pair. En tant que tel, il n&#8217;y a pas de serveur "central" ou de point de contrôle. Les unités de bitcoin sont créés par un processus appelé "minage", qui implique une compétition pour trouver des solutions à un problème mathématique lors du traitement des transactions Bitcoin. Tout participant au réseau Bitcoin (c&#8217;est-à-dire toute personne utilisant un appareil exécutant la pile complète du protocole Bitcoin) peut opérer en tant que mineur, en utilisant la puissance de traitement de son ordinateur pour vérifier et enregistrer les transactions. Toutes les 10 minutes, en moyenne, un mineur de Bitcoin peut valider les transactions et est récompensé par un tout nouveau bitcoin. Essentiellement, l&#8217;extraction de Bitcoin décentralise les fonctions d&#8217;émission et de compensation de devises d&#8217;une banque centrale et remplace le besoin de cette dernière.</p>
</div>
<div class="paragraph data-line-20">
<p>Le protocole Bitcoin comprend des algorithmes intégrés qui régulent la fonction de minage sur le réseau. La difficulté de la tâche de traitement que les mineurs doivent effectuer est ajustée dynamiquement de sorte qu&#8217;en moyenne, quelqu&#8217;un réussisse toutes les 10 minutes, quel que soit le nombre de mineurs (et la quantité de traitement) en compétition à tout moment. Le protocole réduit également de moitié le taux de création de nouveaux bitcoins tous les 4 ans et limite le nombre total de bitcoins qui seront créés à un total fixe juste en dessous de 21 millions de pièces. Le résultat est que le nombre de bitcoins en circulation suit de près une courbe facilement prévisible qui approche les 21 millions d&#8217;ici 2140. En raison du taux d&#8217;émission décroissant du bitcoin, sur le long terme, la monnaie Bitcoin est déflationniste. De plus, le bitcoin ne peut pas être gonflé en "imprimant" de la nouvelle monnaie au-delà du taux d&#8217;émission prévu.</p>
</div>
<div class="paragraph data-line-22">
<p>Dans les coulisses, Bitcoin est aussi le nom du protocole, un réseau pair à pair et une innovation informatique distribuée. La monnaie bitcoin n&#8217;est vraiment que la première application de cette invention. Bitcoin représente l&#8217;aboutissement de décennies de recherche en cryptographie et en systèmes distribués et comprend quatre innovations clés réunies dans une combinaison unique et puissante. Bitcoin se compose de :</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Un réseau pair à pair décentralisé (le protocole Bitcoin)</p>
</li>
<li class="data-line-25">
<p>Un registre public des transactions (la chaîne de blocs)</p>
</li>
<li class="data-line-26">
<p>Un ensemble de règles pour la validation indépendante des transactions et l&#8217;émission de devises (règles de consensus)</p>
</li>
<li class="data-line-27">
<p>Un mécanisme pour parvenir à un consensus mondial décentralisé sur la chaîne de blocs valide (algorithme de Proof-of-Work (ou Preuve de travail))</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>En tant que développeur, je vois Bitcoin comme un Internet de l&#8217;argent, un réseau pour propager la valeur et sécuriser la propriété des actifs numériques via un calcul distribué. Il y a beaucoup plus à Bitcoin qu&#8217;il n&#8217;y paraît à première vue.</p>
</div>
<div class="paragraph data-line-31">
<p>Dans ce chapitre, nous commencerons par expliquer certains des concepts et termes principaux, et obtenir le logiciel nécessaire et utiliser Bitcoin pour des transactions simples. Dans les chapitres suivants, nous commencerons à déballer les couches de technologie qui rendent Bitcoin possible et examinerons le fonctionnement interne du réseau et du protocole Bitcoin.</p>
</div>
<div class="sidebarblock pagebreak-before less_space data-line-35">
<div class="content">
<div class="title">Devises numériques avant Bitcoin</div>
<div class="paragraph data-line-37">
<p>L&#8217;émergence d&#8217;une monnaie numérique viable est étroitement liée aux développements de la cryptographie. Cela n&#8217;est pas surprenant si l&#8217;on considère les défis fondamentaux liés à l&#8217;utilisation de bits pour représenter la valeur qui peut être échangée contre des biens et des services. Trois questions fondamentales pour quiconque accepte de l&#8217;argent numérique sont :</p>
</div>
<div class="olist arabic data-line-39">
<ol class="arabic">
<li class="data-line-39">
<p>Puis-je avoir la certitude que l&#8217;argent est authentique et non contrefait ?</p>
</li>
<li class="data-line-40">
<p>Puis-je avoir confiance que l&#8217;argent numérique ne peut être dépensé qu&#8217;une seule fois (connu sous le nom de problème de « double dépense ») ?</p>
</li>
<li class="data-line-41">
<p>Puis-je être sûr que personne d&#8217;autre ne pourra prétendre que cet argent lui appartient et pas à moi ?</p>
</li>
</ol>
</div>
<div class="paragraph data-line-43">
<p>Les émetteurs de papier-monnaie luttent constamment contre le problème de la contrefaçon en utilisant des papiers et des technologies d&#8217;impression de plus en plus sophistiqués. L&#8217;argent physique résout facilement le problème des doubles dépenses, car le même billet papier ne peut pas se trouver à deux endroits à la fois. Bien sûr, l&#8217;argent conventionnel est aussi souvent stocké et transmis numériquement. Dans ces cas, les problèmes de contrefaçon et de double dépense sont traités en compensant toutes les transactions électroniques par des autorités centrales qui ont une vue globale de la monnaie en circulation. Pour la monnaie numérique, qui ne peut tirer profit des encres ésotériques ou des bandes holographiques, la cryptographie fournit la base pour faire confiance à la légitimité de la revendication de valeur d&#8217;un utilisateur. Plus précisément, les signatures numériques cryptographiques permettent à un utilisateur de signer un actif numérique ou une transaction prouvant la propriété de cet actif. Avec l&#8217;architecture appropriée, les signatures numériques peuvent également être utilisées pour résoudre le problème des doubles dépenses.</p>
</div>
<div class="paragraph data-line-45">
<p>Lorsque la cryptographie a commencé à devenir plus largement disponible et comprise à la fin des années 1980, de nombreux chercheurs ont commencé à essayer d&#8217;utiliser la cryptographie pour créer des monnaies numériques. Ces premiers projets de monnaie numérique émettaient de la monnaie numérique, généralement adossée à une monnaie nationale ou à un métal précieux comme l&#8217;or.</p>
</div>
<div class="paragraph data-line-47">
<p> Bien que ces anciennes monnaies numériques fonctionnaient, elles étaient centralisées et, par conséquent, faciles à attaquer par les gouvernements et les pirates. Les premières monnaies numériques utilisaient une chambre de compensation centrale pour régler toutes les transactions à intervalles réguliers, tout comme un système bancaire traditionnel. Malheureusement, dans la plupart des cas, ces monnaies numériques naissantes ont été ciblées par des gouvernements inquiets et ont finalement été dissoutes. Certains ont échoué dans des crashs spectaculaires lorsque la société mère a été liquidée brutalement. Pour être robuste contre l&#8217;intervention d&#8217;antagonistes, qu&#8217;il s&#8217;agisse de gouvernements légitimes ou d&#8217;éléments criminels, une monnaie numérique <em>décentralisée</em> était nécessaire pour éviter un seul point d&#8217;attaque. Bitcoin est un tel système, décentralisé par conception, et libre de toute autorité centrale ou point de contrôle qui peut être attaqué ou corrompu.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-51">
<h3 id="_histoire_de_bitcoin">Histoire de Bitcoin</h3>
<div class="paragraph data-line-53">
<p>Bitcoin a été inventé en 2008 avec la publication d&#8217;un article intitulé "Bitcoin : A Peer-to-Peer Electronic Cash System,"<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> écrit sous l&#8217;alias de Satoshi Nakamoto (voir <a href="#satoshi_whitepaper">Le livre blanc Bitcoin de Satoshi Nakamoto</a>). Nakamoto a combiné plusieurs inventions antérieures telles que b-money et HashCash pour créer un système de paiement électronique entièrement décentralisé qui ne repose pas sur une autorité centrale pour l&#8217;émission de devises ou le règlement et la validation des transactions. L&#8217;innovation clé consistait à utiliser un système de calcul distribué (appelé algorithme de « preuve de travail ») pour effectuer une « élection » globale toutes les 10 minutes, permettant au réseau décentralisé d&#8217;arriver à un <em>consensus</em> sur l&#8217;état des transactions. Cela résout élégamment le problème de la double dépense où une seule unité monétaire peut être dépensée deux fois. Auparavant, le problème des doubles dépenses était une faiblesse de la monnaie numérique et était résolu en compensant toutes les transactions via une chambre de compensation centrale.</p>
</div>
<div class="paragraph data-line-55">
<p>Le réseau Bitcoin a démarré en 2009, sur la base d&#8217;une référence d&#8217;implémentation publiée par Nakamoto et révisée depuis par de nombreux autres programmeurs. La mise en œuvre de l&#8217;algorithme Proof-of-Work (ou Preuve de travail ou minage) qui assure la sécurité et la résilience de Bitcoin a augmenté de manière exponentielle et dépasse désormais la puissance de traitement combinée des meilleurs supercalculateurs du monde. La valeur marchande totale de Bitcoin a parfois dépassé 1 billion de dollars américains, selon le taux de change bitcoin-dollar. La transaction la plus importante traitée jusqu&#8217;à présent par le réseau était de 1,1 milliard de dollars américains, transmise instantanément et traitée pour des frais de seulement 0,68 $.</p>
</div>
<div class="paragraph data-line-57">
<p>Satoshi Nakamoto s&#8217;est retiré du public en avril 2011, laissant la responsabilité de développer le code et le réseau à un groupe prospère de bénévoles. L&#8217;identité de la personne ou des personnes derrière Bitcoin est encore inconnue. Cependant, ni Satoshi Nakamoto ni personne d&#8217;autre n&#8217;exerce de contrôle individuel sur le système Bitcoin, qui fonctionne sur la base de principes mathématiques totalement transparents, d&#8217;un code à source libre et d&#8217;un consensus entre les participants. L&#8217;invention elle-même est révolutionnaire et a déjà engendré une nouvelle science dans les domaines de l&#8217;informatique distribuée, de l&#8217;économie et de l&#8217;économétrie.</p>
</div>
<div class="sidebarblock data-line-61">
<div class="content">
<div class="title">Une solution à un problème de calcul distribué</div>
<div class="paragraph data-line-62">
<p>L&#8217;invention de Satoshi Nakamoto est également une solution pratique et nouvelle à un problème d&#8217;informatique distribuée, connu sous le nom de "Problème des généraux byzantins". Brièvement, le problème consiste à essayer de s&#8217;entendre sur une ligne de conduite ou sur l&#8217;état d&#8217;un système en échangeant des informations sur un réseau peu fiable et potentiellement compromis. La solution de Satoshi Nakamoto, qui utilise le concept de preuve de travail pour parvenir à un consensus <em>sans autorité centrale de confiance</em>, représente une percée dans l&#8217;informatique distribuée et a une large applicabilité au-delà de la monnaie. Il peut être utilisé pour parvenir à un consensus sur les réseaux décentralisés afin de prouver l&#8217;équité des élections, des loteries, des registres d&#8217;actifs, de la notarisation numérique, etc.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="user-stories">Utilisations, utilisateurs et histoires de Bitcoin</h3>
<div class="paragraph data-line-69">
<p>Bitcoin est une innovation dans l&#8217;ancienne technologie de l&#8217;argent. À la base, l&#8217;argent facilite simplement l&#8217;échange de valeur entre les personnes. Par conséquent, afin de bien comprendre Bitcoin et ses utilisations, nous l&#8217;examinerons du point de vue des personnes qui l&#8217;utilisent. Chacune des personnes et de leurs histoires, telles qu&#8217;énumérées ici, illustre un ou plusieurs cas d&#8217;utilisation spécifiques. Nous les verrons tout au long du livre :</p>
</div>
<div class="dlist data-line-71">
<dl>
<dt class="hdlist1">Vente au détail de faible valeur en Amérique du Nord</dt>
<dd>
<p>Alice vit dans la région de la baie de Californie du Nord. Elle a entendu parler de Bitcoin par ses amis technophiles et veut commencer à l&#8217;utiliser. Nous suivrons son histoire au fur et à mesure qu&#8217;elle découvre le Bitcoin, en acquiert, puis dépense une partie de son bitcoin pour acheter une tasse de café au Bob&#8217;s Cafe à Palo Alto. Cette histoire nous présentera le logiciel, les échanges et les transactions de base du point de vue d&#8217;un consommateur de détail.</p>
</dd>
<dt class="hdlist1">Vente au détail de grande valeur en Amérique du Nord</dt>
<dd>
<p>Carol est propriétaire d&#8217;une galerie d&#8217;art à San Francisco. Elle vend des peintures chères pour Bitcoin. Cette histoire présentera les risques d&#8217;une attaque de consensus "51%" pour les détaillants d&#8217;articles de grande valeur.</p>
</dd>
<dt class="hdlist1">Services contractuels extraterritorial</dt>
<dd>
<p>Bob, le propriétaire d&#8217;un café à Palo Alto, est en train de créer un nouveau site Web. Il a passé un contrat avec un développeur Web indien, Gopesh, qui vit à Bangalore, en Inde. Gopesh a accepté d&#8217;être payé en bitcoin. Cette histoire examinera l&#8217;utilisation de Bitcoin pour l&#8217;externalisation, les services contractuels et les virements internationaux.</p>
</dd>
<dt class="hdlist1">Commerce en ligne</dt>
<dd>
<p>Gabriel est un jeune adolescent entreprenant à Rio de Janeiro, qui dirige une petite boutique en ligne qui vend des t-shirts, des tasses à café et des autocollants de marque Bitcoin. Gabriel est trop jeune pour avoir un compte bancaire, mais ses parents encouragent son esprit d&#8217;entreprise.</p>
</dd>
<dt class="hdlist1">Dons caritatifs</dt>
<dd>
<p>Eugenia est directrice d&#8217;une association caritative pour enfants aux Philippines. Récemment, elle a découvert Bitcoin et souhaite l&#8217;utiliser pour atteindre un tout nouveau groupe de donateurs étrangers et nationaux afin de collecter des fonds pour son association caritative. Elle étudie également les moyens d&#8217;utiliser Bitcoin pour distribuer rapidement des fonds aux zones qui en ont besoin. Cette histoire montrera l&#8217;utilisation de Bitcoin pour la collecte de fonds mondiale à travers les devises et les frontières et l&#8217;utilisation d&#8217;un registre ouvert pour la transparence dans les organisations caritatives.</p>
</dd>
<dt class="hdlist1">Importation/Exportation</dt>
<dd>
<p>Mohammed est un importateur d&#8217;électronique à Dubaï. Il essaie d&#8217;utiliser Bitcoin pour acheter des appareils électroniques aux États-Unis et en Chine pour les importer aux Émirats arabes unis afin d&#8217;accélérer le processus de paiement des importations. Cette histoire montrera comment Bitcoin peut être utilisé pour d&#8217;importants paiements internationaux interentreprises liés à des biens physiques.</p>
</dd>
<dt class="hdlist1">Miner des bitcoins</dt>
<dd>
<p>Jing est un étudiant en génie informatique à Shanghai. Il a construit une plate-forme «minière» pour exploiter le bitcoin en utilisant ses compétences en ingénierie pour compléter ses revenus. Cette histoire examinera la base "industrielle" de Bitcoin : l&#8217;équipement spécialisé utilisé pour sécuriser le réseau Bitcoin et émettre de nouvelles devises.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-92">
<p>Chacune de ces histoires est basée sur de vraies personnes et de vraies industries utilisant actuellement Bitcoin pour créer de nouveaux marchés, de nouvelles industries et des solutions innovantes aux problèmes économiques mondiaux.</p>
</div>
</div>
<div class="sect2 data-line-94">
<h3 id="_mise_en_route">Mise en route</h3>
<div class="paragraph data-line-96">
<p>Bitcoin est un protocole accessible à l&#8217;aide d&#8217;une application cliente qui parle le protocole. Un "portefeuille Bitcoin" est l&#8217;interface utilisateur la plus courante du système Bitcoin, tout comme un navigateur Web est l&#8217;interface utilisateur la plus courante pour le protocole HTTP. Il existe de nombreuses implémentations et marques de portefeuilles Bitcoin, tout comme il existe de nombreuses marques de navigateurs Web (par exemple, Chrome, Safari, Firefox et Internet Explorer). Et tout comme nous avons tous nos navigateurs préférés (Mozilla Firefox, Yé !) et nos méchants (Internet Explorer, Beurk !), les portefeuilles Bitcoin varient en termes de qualité, de performances, de sécurité, de confidentialité et de fiabilité. Il existe également une implémentation de référence du protocole Bitcoin qui inclut un portefeuille, connu sous le nom de "Satoshi Client" ou "Bitcoin Core", qui est dérivé de l&#8217;implémentation originale écrite par Satoshi Nakamoto.</p>
</div>
<div class="sect3 data-line-98">
<h4 id="_choisir_un_portefeuille_bitcoin">Choisir un portefeuille Bitcoin</h4>
<div class="paragraph data-line-100">
<p>Les portefeuilles Bitcoin sont l&#8217;une des applications les plus activement développées dans l&#8217;écosystème Bitcoin. La concurrence est intense et, bien qu&#8217;un nouveau portefeuille soit probablement en cours de développement, plusieurs portefeuilles de l&#8217;année dernière ne sont plus activement maintenus. De nombreux portefeuilles se concentrent sur des plates-formes spécifiques ou des utilisations spécifiques et certains sont plus adaptés aux débutants tandis que d&#8217;autres sont remplis de fonctionnalités pour les utilisateurs avancés. Le choix d&#8217;un portefeuille est très subjectif et dépend de l&#8217;utilisation et de l&#8217;expertise de l&#8217;utilisateur. Par conséquent, il serait inutile de recommander une marque ou un portefeuille spécifique. Cependant, nous pouvons classer les portefeuilles Bitcoin en fonction de leur plate-forme et de leur fonction et fournir des éclaircissements sur tous les différents types de portefeuilles qui existent. Mieux encore, déplacer des clés ou des valeurs d&#8217;amorçages (les "seeds") entre les portefeuilles Bitcoin est relativement facile, il vaut donc la peine d&#8217;essayer plusieurs portefeuilles différents jusqu&#8217;à ce que vous en trouviez un qui corresponde à vos besoins.</p>
</div>
<div class="paragraph pagebreak-before data-line-103">
<p>Les portefeuilles Bitcoin peuvent être classés comme suit, selon la plateforme :</p>
</div>
<div class="dlist data-line-105">
<dl>
<dt class="hdlist1">Portefeuille de bureau</dt>
<dd>
<p>Un portefeuille de bureau a été le premier type de portefeuille Bitcoin créé comme implémentation de référence et de nombreux utilisateurs utilisent des portefeuilles de bureau pour les fonctionnalités, l&#8217;autonomie et le contrôle qu&#8217;ils offrent. L&#8217;exécution sur des systèmes d&#8217;exploitation à usage général tels que Windows et Mac OS présente cependant certains inconvénients en matière de sécurité, car ces plates-formes sont souvent non sécurisées et mal configurées.</p>
</dd>
<dt class="hdlist1">Portefeuille mobile</dt>
<dd>
<p>Un portefeuille mobile est le type le plus courant de portefeuille Bitcoin. Fonctionnant sur des systèmes d&#8217;exploitation de téléphones intelligents tels qu&#8217;Apple iOS et Android, ces portefeuilles sont souvent un excellent choix pour les nouveaux utilisateurs. Beaucoup sont conçus pour être simples et faciles à utiliser, mais il existe également des portefeuilles mobiles complets pour les utilisateurs expérimentés.</p>
</dd>
<dt class="hdlist1">Portefeuille Web</dt>
<dd>
<p>Les portefeuilles Web sont accessibles via un navigateur Web et stockent le portefeuille de l&#8217;utilisateur sur un serveur appartenant à un tiers. Ceci est similaire au webmail en ce sens qu&#8217;il repose entièrement sur un serveur tiers. Certains de ces services fonctionnent à l&#8217;aide d&#8217;un code côté client exécuté dans le navigateur web de l&#8217;utilisateur, qui garde le contrôle des clés Bitcoin entre les mains de l&#8217;utilisateur. La plupart, cependant, présentent un compromis en prenant le contrôle des clés Bitcoin des utilisateurs en échange d&#8217;une facilité d&#8217;utilisation. Il est déconseillé de stocker de grandes quantités de bitcoins sur des systèmes tiers.</p>
</dd>
<dt class="hdlist1">Portefeuille matériel (hardware)</dt>
<dd>
<p>Les portefeuilles matériels sont des appareils qui exploitent un portefeuille Bitcoin autonome sécurisé sur du matériel à usage spécial. Ils se connectent généralement à un ordinateur de bureau ou à un appareil mobile via un câble USB ou une communication en champ proche (NFC) et fonctionnent avec un navigateur Web ou un logiciel associé. En gérant toutes les opérations liées au Bitcoin sur le matériel spécialisé, ces portefeuilles sont considérés comme très sécurisés et adaptés au stockage de grandes quantités de Bitcoin.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-113">
<p>Une autre façon de catégoriser les portefeuilles bitcoin est leur degré d&#8217;autonomie et la façon dont ils interagissent avec le réseau Bitcoin :</p>
</div>
<div class="dlist data-line-115">
<dl>
<dt class="hdlist1">Client de nœud complet</dt>
<dd>
<p> Un client complet, ou "nœud complet", est un client qui stocke l&#8217;historique complet des transactions Bitcoin (chaque transaction par chaque utilisateur, toujours), gère les portefeuilles des utilisateurs et peuvent initier des transactions directement sur le réseau Bitcoin. Un nœud complet gère tous les aspects du protocole et peut valider indépendamment l&#8217;ensemble de la chaîne de blocs et toute transaction. Un client à nœud complet consomme des ressources informatiques importantes (par exemple, plus de 125 Go de disque, 2 Go de RAM) mais offre une autonomie complète et une vérification indépendante des transactions.</p>
</dd>
<dt class="hdlist1">Client léger</dt>
<dd>
<p>Un client léger, également connu sous le nom de client de vérification de paiement simplifié (SPV ou  simplified-payment-verification), se connecte aux nœuds complets Bitcoin (mentionnés précédemment) pour l&#8217;accès aux informations de transaction Bitcoin, mais stocke le portefeuille de l&#8217;utilisateur localement et crée, valide et transmet indépendamment les transactions. Les clients légers interagissent directement avec le réseau Bitcoin, sans intermédiaire.</p>
</dd>
<dt class="hdlist1">Client API tiers</dt>
<dd>
<p> Un client API tiers est un client qui interagit avec Bitcoin via un système tiers d&#8217;interfaces de programmation d&#8217;applications (API), plutôt qu&#8217;en se connectant directement au réseau Bitcoin. Le portefeuille peut être stocké par l&#8217;utilisateur ou par des serveurs tiers, mais toutes les transactions passent par un tiers.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-121">
<p>En combinant ces catégorisations, de nombreux portefeuilles Bitcoin se répartissent en quelques groupes, les trois plus courants étant le client complet de bureau, le portefeuille léger mobile et le portefeuille Web tiers. Les frontières entre les différentes catégories sont souvent floues, car de nombreux portefeuilles fonctionnent sur plusieurs plates-formes et peuvent interagir avec le réseau de différentes manières.</p>
</div>
<div class="paragraph data-line-123">
<p>Pour les besoins de ce livre, nous démontrerons l&#8217;utilisation d&#8217;une variété de clients Bitcoin téléchargeables, de l&#8217;implémentation de référence (Bitcoin Core) aux portefeuilles mobiles et Web. Certains des exemples nécessiteront l&#8217;utilisation de Bitcoin Core, qui, en plus d&#8217;être un client complet, expose également les API au portefeuille, au réseau et aux services de transaction. Si vous envisagez d&#8217;explorer les interfaces de programmation dans le système Bitcoin, vous devrez exécuter Bitcoin Core ou l&#8217;un des clients alternatifs.</p>
</div>
</div>
<div class="sect3 data-line-125">
<h4 id="_démarrage_rapide">Démarrage rapide</h4>
<div class="paragraph data-line-127">
<p>Alice, que nous avons présenté dans <a href="#user-stories">Utilisations, utilisateurs et histoires de Bitcoin</a>, n&#8217;est pas une utilisatrice technique et n&#8217;a entendu parler de Bitcoin que récemment par son ami Joe. Lors d&#8217;une fête, Joe explique à nouveau avec enthousiasme Bitcoin à tout le monde et propose une démonstration. Intriguée, Alice demande comment elle peut démarrer avec Bitcoin. Joe dit qu&#8217;un portefeuille mobile est ce qu&#8217;il y a de mieux pour les nouveaux utilisateurs et il recommande quelques-uns de ses portefeuilles préférés. Alice télécharge "Bluewallet" (disponible pour iOS et Android) et l&#8217;installe sur son téléphone.</p>
</div>
<div class="paragraph data-line-129">
<p>Quand Alice exécute son application de portefeuille pour la première fois, elle choisit l&#8217;option de créer un nouveau portefeuille Bitcoin et prend un moment <strong>loin de Joe et de toutes les autres parties</strong> pour écrire une phrase mnémonique secrète <em>dans l&#8217;ordre</em> sur un morceau de papier. Comme expliqué par le portefeuille mobile et par Joe plus tôt, la phrase mnémotechnique permet à Alice de restaurer son portefeuille au cas où elle perdrait son appareil mobile et lui donne accès à ses fonds sur un autre appareil. Après avoir créé son portefeuille et sécurisé sa phrase mnémonique, Alice peut appuyer sur son portefeuille pour voir son montant en bitcoins, l&#8217;historique des transactions, ainsi que deux boutons qui lui permettent de <em>recevoir</em> ou <em>envoyer</em> des bitcoins, illustrés dans <a href="#bluewallet-welcome">Alice utilise l&#8217;écran de réception sur son portefeuille Bitcoin mobile Bluewallet et affiche son adresse à Bob au format de code QR</a>.</p>
</div>
</div>
<div class="sect3 data-line-131">
<h4 id="_mots_mnémoniques">Mots Mnémoniques</h4>
<div class="paragraph data-line-133">
<p>Un portefeuille Bitcoin moderne fournira une <em>phrase mnémonique</em> (aussi parfois appelée "valeur d&#8217;amorçage" ou "phrase de récupération") qu&#8217;Alice pourra sauvegarder. La phrase mnémonique se compose de 12 à 24 mots anglais, sélectionnés au hasard par le logiciel, et utilisés comme base pour les clés générées par le portefeuille. La phrase mnémotechnique peut être utilisée par Alice pour restaurer toutes les transactions et tous les fonds de son portefeuille en cas d&#8217;événement tel qu&#8217;un appareil mobile perdu, un bogue logiciel ou une corruption de la mémoire.</p>
</div>
<div class="admonitionblock tip data-line-136">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-137">
<p>Le terme correct pour ces mots de sauvegarde est "phrase mnémonique". Nous évitons d&#8217;utiliser le terme "valeur d&#8217;amorçage" pour désigner une phrase mnémotechnique, car même si son utilisation est la même, son usage initial est différent.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-141">
<h4 id="mnemonic-storage">Stocker le mnémonique en toute sécurité</h4>
<div class="paragraph data-line-143">
<p>Alice doit faire attention à stocker la phrase mnémonique d&#8217;une manière qui équilibre la nécessité d&#8217;empêcher le vol et la perte accidentelle. Si elle ne le protège pas suffisamment, son mnémonique risque de se faire voler. Si elle le protège trop, son mnémonique risque d&#8217;être définitivement perdu. La méthode recommandée pour équilibrer correctement ces risques est d&#8217;écrire deux copies de la phrase mnémonique sur papier, avec chacun des mots numérotés selon l&#8217;ordre.</p>
</div>
<div class="paragraph data-line-145">
<p>Une fois qu&#8217;Alice a enregistré la phrase mnémotechnique, elle doit prévoir de stocker chaque copie dans un endroit sécurisé séparé, tel qu&#8217;un tiroir de bureau verrouillé ou un coffre-fort ignifuge.</p>
</div>
<div class="admonitionblock warning data-line-148">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-149">
<p>N&#8217;essayez jamais un système de sécurité "bricolage" qui s&#8217;écarte de quelque manière que ce soit de la recommandation des meilleures pratiques dans <a href="#mnemonic-storage">Stocker le mnémonique en toute sécurité</a>. Ne coupez pas votre mnémonique en deux, ne faites pas de captures d&#8217;écran, ne stockez pas sur des clés USB, des e-mails ou des lecteurs cloud, ne le cryptez pas ou n&#8217;essayez aucune autre méthode non standard. Vous ferez pencher la balance de manière à risquer une perte permanente ou un vol. De nombreuses personnes ont perdu de l&#8217;argent, non pas à cause d&#8217;un vol, mais parce qu&#8217;elles ont essayé une solution non standard sans avoir l&#8217;expertise pour équilibrer les risques encourus. La recommandation des meilleures pratiques est soigneusement équilibrée par des experts et adaptée à la grande majorité des utilisateurs.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="bluewallet-welcome" class="imageblock data-line-153">
<div class="content">
<img src="images/mbc2_0101.png" alt="Écran de bienvenue Bluewallet">
</div>
<div class="title">Figure 1. Alice utilise l&#8217;écran de réception sur son portefeuille Bitcoin mobile Bluewallet et affiche son adresse à Bob au format de code QR</div>
</div>
<div class="paragraph data-line-155">
<p>La vue principale du portefeuille affiche le montant en bitcoins, l&#8217;historique des transactions et les boutons <em>Receive</em> et <em>Send</em>. En outre, de nombreux portefeuilles offrent la possibilité d&#8217;acheter des Bitcoins directement via un échange ou un service similaire où vous pouvez offrir de l&#8217;argent fiduciaire en échange de cryptomonnaie, ce qui est fait par <a href="#bitcoin_price">Trouver le prix actuel du Bitcoin</a> et vendre à l&#8217;utilisateur du portefeuille à ce prix ou au-dessus. Le bouton <em>Buy Bitcoin</em> permettrait à Alice d&#8217;acheter des Bitcoins de cette manière.</p>
</div>
<div class="paragraph data-line-157">
<p>Alice est maintenant prête à commencer à utiliser son nouveau portefeuille Bitcoin. Son application de portefeuille a généré aléatoirement une clé privée (décrite plus en détail dans <a href="#private_keys">Clés privées</a>) qui sera utilisé pour dériver des adresses Bitcoin qui dirigent vers son portefeuille. À ce stade, ses adresses Bitcoin ne sont pas connues du réseau Bitcoin ou "enregistrées" auprès d&#8217;une quelconque partie du système Bitcoin. Ses adresses Bitcoin sont simplement des nombres aléatoires qui correspondent à sa clé privée qu&#8217;elle peut utiliser pour contrôler l&#8217;accès aux fonds. Les adresses sont générées indépendamment par son portefeuille sans référence ni inscription à aucun service. En fait, dans la plupart des portefeuilles, il n&#8217;y a aucune association entre une adresse Bitcoin et toute information d&#8217;identification externe, y compris l&#8217;identité de l&#8217;utilisateur. Jusqu&#8217;au moment où une adresse est référencée comme destinataire de la valeur dans une transaction publiée sur le grand livre bitcoin, l&#8217;adresse Bitcoin fait simplement partie du grand nombre d&#8217;adresses possibles valides en bitcoin. Ce n&#8217;est qu&#8217;une fois qu&#8217;une adresse a été associée à une transaction qu&#8217;elle fait partie des adresses connues du réseau.</p>
</div>
<div class="paragraph data-line-159">
<p>Alice utilise le bouton <em>Receive</em>, qui affiche un code QR avec une adresse Bitcoin. Le code QR est le carré avec un motif de points noirs et blancs, servant de forme de code-barres contenant les mêmes informations dans un format pouvant être scanné par l&#8217;appareil photo du smartphone de Joe. À côté du code QR du portefeuille se trouve l&#8217;adresse Bitcoin qu&#8217;il encode, et Alice peut choisir d&#8217;envoyer manuellement son adresse à Joe en la copiant dans son presse-papiers d&#8217;un simple toucher. Il convient de noter que lorsque vous recevez des fonds sur un nouveau portefeuille mobile pour la première fois, de nombreux portefeuilles revérifieront souvent que vous avez bien sécurisé votre phrase mnémonique. Cela peut aller d&#8217;une simple invitation à demander à l&#8217;utilisateur de ressaisir manuellement la phrase.</p>
</div>
<div class="admonitionblock tip data-line-162">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-163">
<p>Les adresses Bitcoin commencent par 1, 3 ou bc1. Comme les adresses e-mail, elles peuvent être partagées avec d&#8217;autres utilisateurs de bitcoins qui peuvent les utiliser pour envoyer des bitcoins directement dans votre portefeuille. Il n&#8217;y a rien de sensible, du point de vue de la sécurité, à propos de l&#8217;adresse Bitcoin. Il peut être affiché n&#8217;importe où sans risquer la sécurité du compte. Contrairement aux adresses e-mail, vous pouvez créer de nouvelles adresses aussi souvent que vous le souhaitez, qui dirigeront toutes les fonds vers votre portefeuille. En fait, de nombreux portefeuilles modernes créent automatiquement une nouvelle adresse pour chaque transaction afin de maximiser la confidentialité. Un portefeuille est simplement une collection d&#8217;adresses et les clés qui débloquent les fonds à l&#8217;intérieur.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-168">
<h4 id="getting_first_bitcoin">Obtenir son premier Bitcoin</h4>
<div class="paragraph data-line-170">
<p>Il existe plusieurs façons pour Alice d&#8217;acquérir des bitcoins :</p>
</div>
<div class="ulist data-line-172">
<ul>
<li class="data-line-172">
<p>Elle peut échanger une partie de sa monnaie nationale (par exemple USD) à un échange de crypto-monnaie</p>
</li>
<li class="data-line-173">
<p>Elle peut en acheter à un ami ou à une connaissance d&#8217;un Meetup Bitcoin, en échange d&#8217;argent</p>
</li>
<li class="data-line-174">
<p>Elle peut trouver un <em>guichet Bitcoin</em> dans sa région, qui agit comme un distributeur automatique, vendant des bitcoins contre de l&#8217;argent</p>
</li>
<li class="data-line-175">
<p>Elle peut offrir ses compétences ou un produit qu&#8217;elle vend et accepte le paiement en bitcoin</p>
</li>
<li class="data-line-176">
<p>Elle peut demander à son employeur ou à ses clients de la payer en bitcoin</p>
</li>
</ul>
</div>
<div class="paragraph data-line-178">
<p>Toutes ces méthodes présentent des degrés de difficulté variables et nombre d&#8217;entre elles impliquent le paiement de frais. Certaines institutions financières exigeront également qu&#8217;Alice fournisse des documents d&#8217;identification pour se conformer aux réglementations bancaires locales/aux pratiques de lutte contre le blanchiment d&#8217;argent (AML), un processus connu sous le nom de Know Your Customer (KYC). Cependant, avec toutes ces méthodes, Alice pourra recevoir des bitcoins.</p>
</div>
<div class="admonitionblock tip data-line-181">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-182">
<p>L&#8217;un des avantages du bitcoin par rapport aux autres systèmes de paiement est que, lorsqu&#8217;il est utilisé correctement, il offre aux utilisateurs beaucoup plus d&#8217;intimité. Acquérir, détenir et dépenser des bitcoins ne vous oblige pas à divulguer des informations sensibles et personnellement identifiables à des tiers. Cependant, lorsque le bitcoin touche les systèmes traditionnels, tels que les échanges de devises, les réglementations nationales et internationales s&#8217;appliquent souvent. Afin d&#8217;échanger des bitcoins contre votre monnaie nationale, il vous sera souvent demandé de fournir une preuve d&#8217;identité et des informations bancaires. Les utilisateurs doivent savoir qu&#8217;une fois qu&#8217;une adresse Bitcoin est associée à une identité, toutes les transactions Bitcoin associées sont également faciles à identifier et à suivre. C&#8217;est l&#8217;une des raisons pour lesquelles de nombreux utilisateurs choisissent de maintenir des comptes d&#8217;échange dédiés non liés à leurs portefeuilles.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-185">
<p>Alice a été initiée au bitcoin par un ami, elle a donc un moyen facile d&#8217;acquérir son premier bitcoin. Ensuite, nous verrons comment elle achète des bitcoins à son ami Joe et comment Joe envoie les bitcoins dans son portefeuille.</p>
</div>
</div>
<div class="sect3 data-line-188">
<h4 id="bitcoin_price">Trouver le prix actuel du Bitcoin</h4>
<div class="paragraph data-line-190">
<p>Avant qu&#8217;Alice puisse acheter du bitcoin à Joe, ils doivent s&#8217;entendre sur le <em>taux de change</em> entre le bitcoin et le dollar américain . Cela soulève une question courante pour ceux qui découvrent le bitcoin : "Qui fixe le prix du bitcoin ?" La réponse courte est que le prix est fixé par les marchés.</p>
</div>
<div class="paragraph data-line-192">
<p>Le bitcoin, comme la plupart des autres devises, a un <em>cours du change flottant</em>. Cela signifie que la valeur du bitcoin vis-à-vis de toute autre devise fluctue en fonction de l&#8217;offre et de la demande sur les différents marchés où il est négocié. Par exemple, le « prix » du bitcoin en dollars américains est calculé sur chaque marché en fonction de la transaction la plus récente de bitcoin et de dollars américains. En tant que tel, le prix a tendance à fluctuer minutieusement plusieurs fois par seconde. Un service de tarification regroupera les prix de plusieurs marchés et calculera une moyenne pondérée en fonction du volume représentant le taux de change général du marché d&#8217;une paire de devises (par exemple, BTC/USD).</p>
</div>
<div class="paragraph data-line-194">
<p>Il existe des centaines d&#8217;applications et de sites Web qui peuvent fournir le taux actuel du marché. Voici quelques-uns des plus populaires :</p>
</div>
<div class="dlist data-line-196">
<dl>
<dt class="hdlist1"><a href="https://bitcoinaverage.com/" data-href="https://bitcoinaverage.com/">Bitcoin Average</a> </dt>
<dd>
<p>Un site qui fournit une vue simple de la moyenne pondérée en fonction du volume pour chaque devise.</p>
</dd>
<dt class="hdlist1"><a href="https://coincap.io/" data-href="https://coincap.io/">CoinCap</a> </dt>
<dd>
<p>Un service répertoriant la capitalisation boursière et les taux de change de centaines de crypto-monnaies, dont le bitcoin.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/cmebrr" data-href="https://bit.ly/cmebrr">Chicago Mercantile Exchange Bitcoin Reference Rate</a></dt>
<dd>
<p>Un taux de référence qui peut être utilisé comme référence institutionnelle et contractuelle, fourni dans le cadre des flux de données d&#8217;investissement par le CME.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-200">
<p>En plus de ces différents sites et applications, la plupart des portefeuilles bitcoin convertiront automatiquement les montants entre le bitcoin et d&#8217;autres devises. Joe utilisera son portefeuille pour convertir automatiquement le prix avant d&#8217;envoyer des bitcoins à Alice.</p>
</div>
</div>
<div class="sect3 data-line-203">
<h4 id="sending_receiving">Envoi et réception de Bitcoin</h4>
<div class="paragraph data-line-205">
<p>Alice a décidé d&#8217;échanger 10 dollars américains contre des bitcoins, afin de ne pas risquer trop d&#8217;argent sur cette nouvelle technologie. Elle donne à Joe 10 $ en espèces, ouvre son application de portefeuille mobile Bluewallet et sélectionne Recevoir. Cela affiche un code QR avec la première adresse Bitcoin d&#8217;Alice.</p>
</div>
<div class="paragraph data-line-207">
<p>Joe sélectionne ensuite <em>Envoyer</em> sur son portefeuille de smartphone Bluewallet et un écran contenant les entrées suivantes s&#8217;affiche :</p>
</div>
<div class="ulist data-line-209">
<ul>
<li class="data-line-209">
<p>Le montant à envoyer, en bitcoin (BTC) ou sa devise locale (USD)</p>
</li>
<li class="data-line-210">
<p>Une adresse Bitcoin de destination</p>
</li>
<li class="data-line-211">
<p>Une note de transaction (description)</p>
</li>
<li class="data-line-212">
<p>Des frais de transaction</p>
</li>
</ul>
</div>
<div class="paragraph data-line-214">
<p>Dans le champ de saisie de l&#8217;adresse Bitcoin, il y a un petit bouton <em>Scan</em>. Cela permet à Joe de scanner le code QR avec l&#8217;appareil photo de son smartphone afin de ne pas avoir à taper l&#8217;adresse Bitcoin d&#8217;Alice, qui est assez longue et difficile à taper. Joe appuie sur le bouton <em>Scan</em> et il active la caméra du smartphone, scannant le code QR affiché sur le smartphone d&#8217;Alice.</p>
</div>
<div class="paragraph data-line-216">
<p>Joe a maintenant l&#8217;adresse Bitcoin d&#8217;Alice définie comme destinataire. Joe saisit le montant de 10 dollars américains et son portefeuille le convertit en accédant au taux de change le plus récent à partir d&#8217;un service en ligne. Le taux de change à l&#8217;époque est de 100 dollars américains par bitcoin, donc 10 dollars américains valent 0,10 bitcoin (BTC) ou 100 millibitcoin (mBTC) comme le montre la capture d&#8217;écran du portefeuille de Joe (voir <a href="#bluewallet-mobile-send">Écran d&#8217;envoi du portefeuille bitcoin mobile Bluewallet</a>).</p>
</div>
<div class="paragraph data-line-218">
<p>Dans la saisie de la note/description de la transaction, Joe saisit « Alice ». Il peut utiliser ce champ pour ajouter des informations concernant sa transaction pour référence future. Cette fonction est pour sa tenue de dossiers uniquement. La note de transaction sera stockée dans son portefeuille et seul Joe pourra la voir. Il ne sera pas envoyé à Alice, ni stocké sur la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-220">
<p>Il sélectionne également des frais de transaction pour sa transaction. Plus les frais de transaction sont élevés, plus vite sa transaction sera confirmée (incluse dans un bloc par un mineur). Il sélectionne les frais de transaction minimum possibles à ce moment-là (0 satoshis/octet).</p>
</div>
<div class="admonitionblock tip data-line-223">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-224">
<p>Le prix du bitcoin a beaucoup changé au fil du temps, et une quantité incroyable depuis la rédaction de la première édition de ce livre. En mars 2021, une personne aurait besoin d&#8217;environ 54 000 USD pour acheter un bitcoin entier. De nombreux exemples dans ce livre font référence à des transactions passées réelles, lorsque le prix du bitcoin était beaucoup plus bas et que des transactions sans frais étaient encore possibles. Pensez à quel point Joe aurait été un ami généreux s&#8217;il avait conclu le même accord avec Alice aujourd&#8217;hui !</p>
</div>
</td>
</tr>
</table>
</div>
<div id="bluewallet-mobile-send" class="imageblock smallereighty data-line-230">
<div class="content">
<img src="images/mbc2_0102.png" alt="Écran d&#8217;envoi Bluewallet">
</div>
<div class="title">Figure 2. Écran d&#8217;envoi du portefeuille bitcoin mobile Bluewallet</div>
</div>
<div class="paragraph data-line-232">
<p>À l&#8217;aide de Bluewallet, Joe vérifie soigneusement qu&#8217;il a saisi le bon montant, car il est sur le point de transmettre de l&#8217;argent et les erreurs sont irréversibles. Par souci de simplicité, nous supposerons que Joe ne paie aucun frais de transaction. L&#8217;objet et la fixation des frais de transaction sont traités dans les chapitres suivants. Après avoir revérifié l&#8217;adresse et le montant, il appuie sur <em>Envoyer</em> pour transmettre la transaction. Le portefeuille bitcoin mobile de Joe construit une transaction qui attribue 0,10 BTC à l&#8217;adresse fournie par Alice, puise les fonds dans le portefeuille de Joe et signe la transaction avec les clés privées de Joe. Cela indique au réseau Bitcoin que Joe a autorisé un transfert de valeur vers la nouvelle adresse d&#8217;Alice. Comme la transaction est transmise via le protocole pair à pair, elle se propage rapidement sur le réseau Bitcoin. En moins d&#8217;une seconde, la plupart des nœuds bien connectés du réseau reçoivent la transaction et voient l&#8217;adresse d&#8217;Alice pour la première fois.</p>
</div>
<div class="paragraph data-line-234">
<p>Pendant ce temps, le portefeuille d&#8217;Alice "écoute" constamment les transactions publiées sur le réseau Bitcoin, à la recherche de celles qui correspondent aux adresses qu&#8217;il contient. Quelques secondes après que le portefeuille de Joe ait transmis la transaction, le portefeuille d&#8217;Alice indiquera qu&#8217;il reçoit 0,10 BTC.</p>
</div>
<div class="admonitionblock tip data-line-237">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-238">
<p>Chaque bitcoin peut être subdivisé en 100 millions d&#8217;unités, chacune appelée "satoshi" (singulier) ou "satoshis" (pluriel). Nommé en l&#8217;honneur du créateur du bitcoin, le Satoshi est la plus petite unité de bitcoin, équivalente à 0,00000001 BTC.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="confirmations" class="paragraph data-line-243">
<div class="title">Confirmations</div>
<p>Au début, le portefeuille d&#8217;Alice affichera la transaction de Joe comme "Non confirmée". Cela signifie que la transaction a été propagée au réseau mais n&#8217;a pas encore été enregistrée dans le registre des transactions bitcoin, connu sous le nom de blockchain ou la chaîne de blocs. Pour être confirmée, une transaction doit être incluse dans un bloc et ajoutée à la chaîne de blocs, ce qui se produit toutes les 10 minutes en moyenne. En termes financiers traditionnels, cela s&#8217;appelle <em>liquidation (ou clearing)</em>. Ce livre couvrira en détail la propagation, la validation et la liquidation (ou la confirmation) des transactions bitcoin.</p>
</div>
<div class="paragraph data-line-9">
<p>Alice est maintenant l&#8217;heureuse propriétaire de 0,10 BTC qu&#8217;elle peut dépenser. Dans le chapitre suivant, nous examinerons son premier achat avec Bitcoin et examinerons plus en détail les technologies sous-jacentes de transaction et de propagation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ch02_bitcoin_overview">Comment fonctionne Bitcoin</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-4">
<h3 id="_transactions_blocs_minage_et_la_chaîne_de_blocs">Transactions, blocs, minage et la chaîne de blocs</h3>
<div class="paragraph data-line-6">
<p>Le système Bitcoin, contrairement aux systèmes bancaires et de paiement traditionnels, est basé sur la confiance décentralisée. Au lieu d&#8217;une autorité centrale de confiance, dans le bitcoin, la confiance est obtenue en tant que propriété émergente à partir des interactions des différents participants au système Bitcoin. Dans ce chapitre, nous examinerons le bitcoin d&#8217;un niveau élevé en suivant une seule transaction via le système Bitcoin et en observant qu&#8217;elle devient "de confiance" et acceptée par le mécanisme de consensus distribué bitcoin et est finalement enregistrée sur la chaîne de blocs, le grand livre distribué de toutes transactions. Les chapitres suivants approfondiront la technologie derrière les transactions, le réseau et l&#8217;exploitation minière.</p>
</div>
<div class="sect3 data-line-8">
<h4 id="_présentation_de_bitcoin">Présentation de Bitcoin</h4>
<div class="paragraph data-line-10">
<p>Dans le schéma d&#8217;ensemble présenté dans <a href="#bitcoin-overview">Présentation de Bitcoin</a>, nous voyons que le système Bitcoin se compose d&#8217;utilisateurs avec des portefeuilles contenant des clés, des transactions qui se propagent à travers le réseau et des mineurs qui produisent (par le calcul concurrentiel) le consensus de la chaîne de blocs, qui est le registre faisant autorité de toutes les transactions.</p>
</div>
<div class="paragraph data-line-13">
<p>Chaque exemple de ce chapitre est basé sur une transaction réelle effectuée sur le réseau Bitcoin, simulant les interactions entre les utilisateurs (Joe, Alice, Bob et Gopesh) en envoyant des fonds à partir d&#8217;un portefeuille à un autre. Lors du suivi d&#8217;une transaction via le réseau Bitcoin jusqu&#8217;à la chaîne de blocs, nous utiliserons un site <em>explorateur de chaîne de blocs</em> pour visualiser chaque étape. Un explorateur de chaîne de blocs est une application Web qui fonctionne comme un moteur de recherche bitcoin, en ce sens qu&#8217;il vous permet de rechercher des adresses, des transactions et des blocs et de voir les relations et les flux entre eux.</p>
</div>
<div id="bitcoin-overview" class="imageblock data-line-17">
<div class="content">
<img src="images/mbc2_0201.png" alt="Survol de Bitcoin">
</div>
<div class="title">Figure 3. Présentation de Bitcoin</div>
</div>
<div class="paragraph data-line-19">
<p>Les explorateurs des chaînes de blocs populaires incluent :</p>
</div>
<div class="ulist data-line-21">
<ul>
<li class="data-line-21">
<p><a href="https://live.blockcypher.com" data-href="https://live.blockcypher.com">Explorateur BlockCypher</a></p>
</li>
<li class="data-line-22">
<p><a href="https://blockchain.com" data-href="https://blockchain.com">Blockchain.com</a></p>
</li>
<li class="data-line-23">
<p><a href="https://insight.bitpay.com" data-href="https://insight.bitpay.com">BitPay Insight</a></p>
</li>
<li class="data-line-24">
<p><a href="https://blockstream.info" data-href="https://blockstream.info">Blockstream Explorer</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-26">
<p>Chacun d&#8217;eux a une fonction de recherche qui peut prendre une adresse Bitcoin, un hachage de transaction, un numéro de bloc ou un hachage de bloc et récupérer les informations correspondantes du réseau Bitcoin. Avec chaque exemple de transaction ou de bloc, nous fournirons une URL afin que vous puissiez la rechercher vous-même et l&#8217;étudier en détail.</p>
</div>
</div>
<div class="sect3 data-line-30">
<h4 id="cup_of_coffee">Acheter une tasse de café</h4>
<div class="paragraph data-line-32">
<p>Alice, présentée dans le chapitre précédent, est une nouvelle utilisatrice qui vient d&#8217;acquérir son premier bitcoin. Dans <a href="#getting_first_bitcoin">Obtenir son premier Bitcoin</a>, Alice a rencontré son ami Joe pour échanger de l&#8217;argent contre du bitcoin. La transaction créée par Joe a financé le portefeuille d&#8217;Alice avec 0,10 BTC. Alice va maintenant faire sa première transaction de vente au détail en achetant une tasse de café au Bob&#8217;s Café à Palo Alto, en Californie.</p>
</div>
<div class="paragraph data-line-34">
<p>Bob&#8217;s Cafe a récemment commencé à accepter les paiements en bitcoin en ajoutant une option bitcoin à son système de point de vente. Les prix au Bob&#8217;s Cafe sont indiqués dans la devise locale (dollars américains), mais à la caisse, les clients ont la possibilité de payer en dollars ou en bitcoins. Alice passe sa commande pour une tasse de café et Bob l&#8217;inscrit dans le registre, comme il le fait pour toutes les transactions. Le système de point de vente convertit automatiquement le prix total des dollars américains en bitcoins au taux du marché en vigueur et affiche le prix dans les deux devises :</p>
</div>
<div class="listingblock data-line-36">
<div class="content">
<pre>Total:
1,50 USD
0,015 BTC</pre>
</div>
</div>
<div class="paragraph data-line-43">
<p>Bob dit : "C&#8217;est un dollar cinquante, ou quinze millibits."</p>
</div>
<div class="paragraph data-line-45">
<p>Le système de point de vente de Bob créera également automatiquement un code QR spécial contenant une <em>demande de paiement</em> (voir <a href="#payment-request-QR">Code QR de la demande de paiement</a>).</p>
</div>
<div class="paragraph data-line-47">
<p>Contrairement à un code QR qui contient simplement une adresse Bitcoin de destination, une demande de paiement est une URL encodée QR qui contient une adresse de destination, un montant de paiement et une description générique telle que "Bob&#8217;s Cafe". Cela permet à une application de portefeuille bitcoin de pré-remplir les informations utilisées pour envoyer le paiement tout en affichant une description lisible par l&#8217;utilisateur à l&#8217;utilisateur. Vous pouvez scanner le code QR avec une application de portefeuille bitcoin pour voir ce qu&#8217;Alice verrait.</p>
</div>
<div id="payment-request-QR" class="imageblock data-line-52">
<div class="content">
<img src="images/mbc2_0202.png" alt="requête de paiement">
</div>
<div class="title">Figure 4. Code QR de la demande de paiement</div>
</div>
<div class="admonitionblock tip data-line-55">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-56">
<p>Essayez de scanner ceci avec votre portefeuille pour voir l&#8217;adresse et le montant, mais N&#8217;ENVOYEZ PAS D&#8217;ARGENT.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="payment-request-URL" class="listingblock data-line-60">
<div class="title">Le QR code de demande de paiement encode l&#8217;URL suivante, définie dans BIP-21 :</div>
<div class="content">
<pre>bitcoin:1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA?
amount=0.015&amp;
label=Bob%27s%20Cafe&amp;
message=Purchase%20at%20Bob%27s%20Cafe

Composants de l'URL

Une adresse Bitcoin : "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
Le montant du paiement : "0,015"
Une étiquette pour l'adresse du destinataire : "Bob's Cafe"
Une description du paiement : "Purchase at Bob's Cafe"</pre>
</div>
</div>
<div class="paragraph data-line-74">
<p>Alice utilise son smartphone pour scanner le code-barres affiché. Son smartphone affiche un paiement de <code>0,0150 BTC</code> à <code>Bob&#8217;s Cafe</code> et elle sélectionne Envoyer pour autoriser le paiement. En quelques secondes (environ le même temps qu&#8217;une autorisation de carte de crédit), Bob voit la transaction sur le registre, complétant la transaction.</p>
</div>
<div class="paragraph data-line-76">
<p>Dans les sections suivantes, nous examinerons cette transaction plus en détail. Nous verrons comment le portefeuille d&#8217;Alice l&#8217;a construit, comment il s&#8217;est propagé sur le réseau, comment il a été vérifié et enfin, comment Bob peut dépenser ce montant lors de transactions ultérieures.</p>
</div>
<div class="admonitionblock note data-line-79">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-80">
<p>Le réseau Bitcoin peut effectuer des transactions en valeurs fractionnaires, par exemple à partir de millibitcoin (1/1000e de bitcoin ) jusqu&#8217;à 1/100 000 000e de bitcoin, connu sous le nom de satoshi. Tout au long de ce livre, nous utiliserons le terme "bitcoin" pour désigner toute quantité de monnaie bitcoin, de la plus petite unité (1 satoshi) au nombre total (21 000 000) de tous les bitcoins qui seront extraits.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-83">
<p>Vous pouvez examiner la transaction d&#8217;Alice avec Bob&#8217;s Cafe sur la chaîne de blocs en utilisant un site d&#8217;exploration de blocs (<a href="#view_alice_transaction">Voir la transaction d&#8217;Alice sur blockchain.com</a>):</p>
</div>
<div id="view_alice_transaction" class="exampleblock data-line-87">
<div class="title">Example 1. Voir la transaction d&#8217;Alice sur <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">blockchain.com</a></div>
<div class="content">
<div class="listingblock data-line-88">
<div class="content">
<pre>https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-93">
<h3 id="_transactions_en_bitcoins">Transactions en bitcoins</h3>
<div class="paragraph data-line-95">
<p>En termes simples, une transaction indique au réseau que le propriétaire d&#8217;une valeur bitcoin a autorisé le transfert de cette valeur à un autre propriétaire. Le nouveau propriétaire peut désormais dépenser le bitcoin en créant une autre transaction qui autorise le transfert à un autre propriétaire, et ainsi de suite, dans une chaîne de propriété.</p>
</div>
<div class="sect3 data-line-97">
<h4 id="_entrées_et_sorties_de_transactions">Entrées et sorties de transactions</h4>
<div class="paragraph data-line-99">
<p>Les transactions sont comme des lignes dans un livre comptable en partie double. Chaque transaction contient une ou plusieurs "entrées", qui sont comme des débits sur un compte bitcoin. De l&#8217;autre côté de la transaction, il y a une ou plusieurs "sorties", qui sont comme des crédits ajoutés à un compte bitcoin. Les entrées et les sorties (débits et crédits) ne totalisent pas nécessairement le même montant. Au lieu de cela, les sorties s&#8217;additionnent légèrement moins que les entrées et la différence représente des <em>frais de transaction</em> implicites, qui sont un petit paiement perçu par le mineur qui inclut la transaction dans le grand livre. Une transaction bitcoin s&#8217;affiche sous la forme d&#8217;une écriture comptable dans <a href="#transaction-double-entry">Transaction comptable en double parties</a>.</p>
</div>
<div class="paragraph data-line-101">
<p>La transaction contient également une preuve de propriété pour chaque montant de bitcoin (entrées) dont la valeur est dépensée, sous la forme d&#8217;une signature numérique du propriétaire, qui peut être validée indépendamment par n&#8217;importe qui. En termes de bitcoin, "dépenser" consiste à signer une transaction qui transfère la valeur d&#8217;une transaction précédente à un nouveau propriétaire identifié par une adresse Bitcoin.</p>
</div>
<div id="transaction-double-entry" class="imageblock data-line-105">
<div class="content">
<img src="images/mbc2_0203.png" alt="Transaction en double saisie">
</div>
<div class="title">Figure 5. Transaction comptable en double parties</div>
</div>
</div>
<div class="sect3 data-line-107">
<h4 id="_chaînes_de_transaction">Chaînes de transaction</h4>
<div class="paragraph data-line-109">
<p>Le paiement d&#8217;Alice à Bob&#8217;s Cafe utilise la sortie d&#8217;une transaction précédente comme entrée. Dans le chapitre précédent, Alice a reçu des bitcoins de son ami Joe en échange d&#8217;argent. Cette transaction a créé une valeur bitcoin verrouillée par la clé d&#8217;Alice. Sa nouvelle transaction avec Bob&#8217;s Cafe fait référence à la transaction précédente comme entrée et crée de nouvelles sorties pour payer la tasse de café et recevoir la monnaie. Les transactions forment une chaîne, où les entrées de la dernière transaction correspondent aux sorties des transactions précédentes. La clé d&#8217;Alice fournit la signature qui déverrouille ces sorties de transaction précédentes, prouvant ainsi au réseau Bitcoin qu&#8217;elle possède les fonds. Elle joint le paiement du café à l&#8217;adresse de Bob, "encombrant" ainsi cette sortie avec l&#8217;exigence que Bob produise une signature afin de dépenser ce montant. Cela représente un transfert de valeur entre Alice et Bob. Cette chaîne de transactions, de Joe à Alice à Bob, est illustrée dans <a href="#blockchain-mnemonic">Une chaîne de transactions, où la sortie d&#8217;une transaction est l&#8217;entrée de la transaction suivante</a>.</p>
</div>
<div id="blockchain-mnemonic" class="imageblock data-line-113">
<div class="content">
<img src="images/mbc2_0204.png" alt="Chaîne de transaction">
</div>
<div class="title">Figure 6. Une chaîne de transactions, où la sortie d&#8217;une transaction est l&#8217;entrée de la transaction suivante</div>
</div>
</div>
<div class="sect3 data-line-115">
<h4 id="_faire_du_change_ou_de_la_petite_monnaie">Faire du change (ou de la petite monnaie)</h4>
<div class="paragraph data-line-117">
<p>De nombreuses transactions bitcoin incluront des sorties qui référencent à la fois une adresse du nouveau propriétaire et une adresse du propriétaire actuel, appelée <em>adresse de change</em>. En effet, les entrées de transaction, comme les billets de banque, ne peuvent pas être divisées. Si vous achetez un article de 5 dollars américains dans un magasin mais que vous utilisez un billet de 20 dollars américains pour payer l&#8217;article, vous vous attendez à recevoir 15 dollars américains en monnaie. Le même concept s&#8217;applique aux entrées de transaction bitcoin. Si vous avez acheté un article qui coûte 5 bitcoins mais que vous n&#8217;aviez qu&#8217;une entrée de 20 bitcoins à utiliser, votre portefeuille créerait une seule transaction qui enverrait deux sorties, une sortie de 5 bitcoins au propriétaire du magasin et une sortie de 15 bitcoins à vous-même comme changement (moins les frais de transaction applicables). Il est important de noter que l&#8217;adresse de change ne doit pas nécessairement être la même que celle de l&#8217;entrée et, pour des raisons de confidentialité, il s&#8217;agit souvent d&#8217;une nouvelle adresse du portefeuille du propriétaire.</p>
</div>
<div class="paragraph data-line-119">
<p>Différents portefeuilles peuvent utiliser différentes stratégies lors de l&#8217;agrégation des entrées pour effectuer un paiement demandé par l&#8217;utilisateur. Ils peuvent regrouper de nombreux petits intrants ou en utiliser un égal ou supérieur au paiement souhaité. À moins que le portefeuille ne puisse agréger les entrées de manière à correspondre exactement au paiement souhaité plus les frais de transaction, le portefeuille devra générer du change. C&#8217;est très similaire à la façon dont les gens gèrent l&#8217;argent liquide. Si vous utilisez toujours le plus gros billet dans votre poche, vous vous retrouverez avec une poche pleine de monnaie. Si vous n&#8217;utilisez que la petite monnaie, vous n&#8217;aurez toujours que de gros billets. Les gens trouvent inconsciemment un équilibre entre ces deux extrêmes, et les développeurs de portefeuilles Bitcoin s&#8217;efforcent de programmer cet équilibre.</p>
</div>
<div class="paragraph data-line-121">
<p>En résumé, les <em>transactions</em> déplacent des valeurs des <em>entrées de transaction</em> aux <em>sorties de transaction</em>. Une entrée est une référence à la sortie d&#8217;une transaction précédente, indiquant d&#8217;où provient la valeur. Une transaction comprend généralement une sortie qui dirige une valeur spécifique vers l&#8217;adresse Bitcoin d&#8217;un nouveau propriétaire et une sortie de modification vers le propriétaire d&#8217;origine. Les sorties d&#8217;une transaction peuvent être utilisées comme entrées dans une nouvelle transaction, créant ainsi une chaîne de propriété lorsque la valeur est déplacée d&#8217;un propriétaire à l&#8217;autre (voir <a href="#blockchain-mnemonic">Une chaîne de transactions, où la sortie d&#8217;une transaction est l&#8217;entrée de la transaction suivante</a>).</p>
</div>
</div>
<div class="sect3 data-line-123">
<h4 id="_formulaires_de_transaction_communs">Formulaires de transaction communs</h4>
<div class="paragraph data-line-125">
<p>La forme de transaction la plus courante est un simple paiement d&#8217;une adresse à une autre, qui comprend souvent une « monnaie » rendue au propriétaire d&#8217;origine. Ce type de transaction a une entrée et deux sorties et est affiché dans <a href="#transaction-common">Transaction la plus courante</a>.</p>
</div>
<div id="transaction-common" class="imageblock data-line-129">
<div class="content">
<img src="images/mbc2_0205.png" alt="Transaction commune">
</div>
<div class="title">Figure 7. Transaction la plus courante</div>
</div>
<div class="paragraph data-line-131">
<p>Une autre forme courante de transaction est celle qui agrège plusieurs entrées en une seule sortie (voir <a href="#transaction-aggregating">Transaction agrégeant des fonds</a>). Cela représente l&#8217;équivalent réel de l&#8217;échange d&#8217;une pile de pièces et de billets de banque contre un seul billet plus gros. Des transactions comme celles-ci sont parfois générées par des applications de portefeuille pour nettoyer de nombreux petits montants reçus en monnaie de paiement.</p>
</div>
<div id="transaction-aggregating" class="imageblock data-line-135">
<div class="content">
<img src="images/mbc2_0206.png" alt="Aggrégation de transaction">
</div>
<div class="title">Figure 8. Transaction agrégeant des fonds</div>
</div>
<div class="paragraph data-line-137">
<p>Enfin, une autre forme de transaction que l&#8217;on voit souvent sur le grand livre bitcoin est une transaction par lots, qui distribue une entrée à plusieurs sorties représentant plusieurs destinataires, une technique appelée "transactions par lot" (voir <a href="#transaction-distributing">Transaction distribuant des fonds</a>). Étant donné que ce type de transaction est utile pour économiser sur les frais de transaction, il est couramment utilisé par les entités commerciales pour distribuer des fonds, par exemple lorsqu&#8217;une entreprise traite les paiements de paie à plusieurs employés ou lorsqu&#8217;un échange de bitcoins traite les retraits de plusieurs clients en un seul. transaction.</p>
</div>
<div id="transaction-distributing" class="imageblock data-line-141">
<div class="content">
<img src="images/mbc2_0207.png" alt="Distribution des transaction">
</div>
<div class="title">Figure 9. Transaction distribuant des fonds</div>
</div>
</div>
</div>
<div class="sect2 data-line-143">
<h3 id="_construction_dune_transaction">Construction d&#8217;une transaction</h3>
<div class="paragraph data-line-145">
<p>L&#8217;application de portefeuille d&#8217;Alice contient toute la logique pour sélectionner les entrées et les sorties appropriées pour construire une transaction à la spécification d&#8217;Alice. Alice n&#8217;a qu&#8217;à spécifier une destination et un montant, et le reste se passe dans l&#8217;application portefeuille sans qu&#8217;elle ne voie les détails. Il est important de noter qu&#8217;une application de portefeuille peut créer des transactions même si elle est complètement hors ligne. Comme écrire un chèque à la maison et l&#8217;envoyer plus tard à la banque dans une enveloppe, la transaction n&#8217;a pas besoin d&#8217;être construite et signée tout en étant connectée au réseau Bitcoin.</p>
</div>
<div class="sect3 data-line-147">
<h4 id="_obtenir_les_bonnes_entrées">Obtenir les bonnes entrées</h4>
<div class="paragraph data-line-149">
<p>L&#8217;application de portefeuille d&#8217;Alice devra d&#8217;abord trouver des entrées qui peuvent payer le montant qu&#8217;elle veut envoyer à Bob. La plupart des portefeuilles gardent une trace de toutes les sorties disponibles appartenant aux adresses du portefeuille. Par conséquent, le portefeuille d&#8217;Alice contiendrait une copie de la sortie de transaction de la transaction de Joe, qui a été créée en échange d&#8217;argent (voir <a href="#getting_first_bitcoin">Obtenir son premier Bitcoin</a>). Une application de portefeuille bitcoin qui s&#8217;exécute en tant que client à nœud complet contient en fait une copie de chaque sortie non dépensée de chaque transaction dans la chaîne de blocs. Cela permet à un portefeuille de construire des entrées de transaction ainsi que de vérifier rapidement les transactions entrantes comme ayant des entrées correctes. Cependant, comme un client à nœud complet occupe beaucoup d&#8217;espace disque, la plupart des portefeuilles d&#8217;utilisateurs exécutent des clients "légers" qui ne suivent que les sorties non dépensées de l&#8217;utilisateur.</p>
</div>
<div class="paragraph data-line-151">
<p>Si l&#8217;application de portefeuille ne conserve pas une copie des sorties de transaction non dépensées, elle peut interroger le réseau Bitcoin pour récupérer ces informations à l&#8217;aide d&#8217;une variété d&#8217;API disponibles par différents fournisseurs ou en demandant à un nœud complet via l&#8217;aide d&#8217;un appel d&#8217;interface de programmation d&#8217;application (API). <a href="#example_2-2">Recherchez toutes les sorties non dépensées pour l&#8217;adresse Bitcoin d&#8217;Alice</a> montre une requête API, construite comme une commande HTTP GET vers une URL spécifique. Cette URL renverra toutes les sorties de transaction non dépensées pour une adresse, donnant à toute application les informations dont elle a besoin pour construire des entrées de transaction pour les dépenses. Nous utilisons le simple client HTTP en ligne de commande <em>cURL</em> pour récupérer la réponse.</p>
</div>
<div id="example_2-2" class="exampleblock data-line-155">
<div class="title">Example 2. Recherchez toutes les sorties non dépensées pour l&#8217;adresse Bitcoin d&#8217;Alice</div>
<div class="content">
<div class="listingblock data-line-157">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock data-line-163">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{

	"unspent_outputs":[

		{
			"tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
			"tx_index":104810202,
			"tx_output_n": 0,
			"script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
			"value": 10000000,
			"value_hex": "00989680",
			"confirmations":0
		}

	]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-183">
<p>La réponse en <a href="#example_2-2">Recherchez toutes les sorties non dépensées pour l&#8217;adresse Bitcoin d&#8217;Alice</a> montre une sortie non dépensée (une qui n&#8217;a pas encore été échangée) sous la propriété de l&#8217;adresse d&#8217;Alice 1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK. La réponse inclut la référence à la transaction dans laquelle cette sortie non dépensée est contenue (le paiement de Joe) et sa valeur en satoshis, à 10 millions, équivalent à 0,10 bitcoin. Avec ces informations, l&#8217;application de portefeuille d&#8217;Alice peut construire une transaction pour transférer cette valeur aux nouvelles adresses de propriétaire.</p>
</div>
<div class="admonitionblock tip data-line-186">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-187">
<p>Voir la <a href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18" data-href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18">transaction de Joe à Alice</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-190">
<p>Comme vous pouvez le voir, le portefeuille d&#8217;Alice contient suffisamment de bitcoins en une seule sortie non dépensée pour payer la tasse de café. Si cela n&#8217;avait pas été le cas, l&#8217;application de portefeuille d&#8217;Alice aurait peut-être dû "fouiller" dans une pile de petites sorties non dépensées, comme prendre des pièces dans un sac à main jusqu&#8217;à ce qu&#8217;elle puisse en trouver assez pour payer le café. Dans les deux cas, il peut être nécessaire de récupérer de la monnaie, ce que nous verrons dans la section suivante, car l&#8217;application de portefeuille crée les sorties de transaction (paiements).</p>
</div>
</div>
<div class="sect3 data-line-193">
<h4 id="_création_des_sorties">Création des sorties</h4>
<div class="paragraph data-line-195">
<p>Une sortie de transaction est créée sous la forme d&#8217;un script qui crée une charge sur la valeur et ne peut être rachetée que par l&#8217;introduction d&#8217;une solution au script. En termes plus simples, la sortie de transaction d&#8217;Alice contiendra un script qui dit quelque chose comme "Cette sortie est payable à quiconque peut présenter une signature à partir de la clé correspondant à l&#8217;adresse de Bob." Étant donné que seul Bob possède le portefeuille avec les clés correspondant à cette adresse, seul le portefeuille de Bob peut présenter une telle signature pour racheter cette sortie. Alice « encombrera » donc la valeur de sortie avec une demande de signature de Bob.</p>
</div>
<div class="paragraph data-line-197">
<p>Cette transaction comprendra également une deuxième sortie, car les fonds d&#8217;Alice se présentent sous la forme d&#8217;une sortie à 0,10 BTC, trop d&#8217;argent pour la tasse de café à 0,015 BTC. Alice aura besoin de 0,085 BTC en monnaie. Le paiement de monnaie d&#8217;Alice est créé par le portefeuille d&#8217;Alice en tant que sortie dans la même transaction que le paiement à Bob. Essentiellement, le portefeuille d&#8217;Alice divise ses fonds en deux paiements : un à Bob et un à elle-même. Elle peut ensuite utiliser (dépenser) la sortie de monnaie dans une transaction ultérieure.</p>
</div>
<div class="paragraph data-line-199">
<p>Enfin, pour que la transaction soit traitée par le réseau en temps opportun, l&#8217;application de portefeuille d&#8217;Alice ajoutera une somme modique. Ce n&#8217;est pas explicite dans la transaction ; il est impliqué par la différence entre les entrées et les sorties. Si au lieu de prendre 0,085 en monnaie, Alice ne crée que 0,0845 comme deuxième sortie, il restera 0,0005 BTC (un demi-millibitcoin). Le 0,10 BTC de l&#8217;entrée n&#8217;est pas entièrement dépensé avec les deux sorties, car elles totaliseront moins de 0,10. La différence qui en résulte est le <em>frais de transaction</em> qui est perçu par le mineur en tant que frais de validation et d&#8217;inclusion de la transaction dans un bloc à enregistrer sur la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-201">
<p>La transaction résultante peut être vue à l&#8217;aide d&#8217;une application Web d&#8217;exploration de chaîne de blocs, comme indiqué dans <a href="#transaction-alice">Transaction d&#8217;Alice au Bob&#8217;s Cafe</a>.</p>
</div>
<div id="transaction-alice" class="imageblock data-line-206">
<div class="content">
<img src="images/mbc2_0208.png" alt="Transaction du café d&#8217;Alice">
</div>
<div class="title">Figure 10. Transaction d&#8217;Alice au Bob&#8217;s Cafe</div>
</div>
<div id="transaction-alice-url" class="admonitionblock tip data-line-210">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-211">
<p>Voir la <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">transaction d&#8217;Alice à Bob&#8217;s Cafe</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-214">
<h4 id="_ajout_de_la_transaction_au_grand_livre">Ajout de la transaction au grand livre</h4>
<div class="paragraph data-line-216">
<p>La transaction créée par l&#8217;application du portefeuille d&#8217;Alice fait 258 octets et contient tout le nécessaire pour confirmer la propriété des fonds et attribuer à de nouveaux propriétaires. Désormais, la transaction doit être transmise au réseau Bitcoin où elle fera partie de la chaîne de blocs. Dans la section suivante, nous verrons comment une transaction devient partie intégrante d&#8217;un nouveau bloc et comment le bloc est « miné ». Enfin, nous verrons comment le nouveau bloc, une fois ajouté à la chaîne de blocs, est de plus en plus approuvé par le réseau au fur et à mesure que de nouveaux blocs sont ajoutés.</p>
</div>
<div class="sect4 data-line-218">
<h5 id="_transmission_de_la_transaction">Transmission de la transaction</h5>
<div class="paragraph data-line-220">
<p>La transaction contient toutes les informations nécessaires au traitement, et ce peu importe comment et où elle est transmise au réseau Bitcoin. Le réseau Bitcoin est un réseau pair à pair, chaque client Bitcoin participant en se connectant à plusieurs autres clients Bitcoin. Le but du réseau Bitcoin est de propager les transactions et les blocages à tous les participants.</p>
</div>
</div>
<div class="sect4 data-line-222">
<h5 id="_comment_ça_se_propage">Comment ça se propage</h5>
<div class="paragraph data-line-224">
<p>Tout système, tel qu&#8217;un serveur, une application de bureau ou un portefeuille, qui participe au réseau Bitcoin en "parlant", le protocole Bitcoin est appelé un <em>nœud Bitcoin</em>. L&#8217;application de portefeuille d&#8217;Alice peut envoyer la nouvelle transaction à n&#8217;importe quel nœud Bitcoin auquel elle est connectée via n&#8217;importe quel type de connexion : filaire, Wi-Fi, mobile, etc. Son portefeuille Bitcoin n&#8217;a pas besoin d&#8217;être connecté directement au portefeuille Bitcoin de Bob et elle n&#8217;a pas à nécessairement utiliser la connexion Internet offerte par le café, bien que ces deux options soient également possibles. Tout nœud Bitcoin qui reçoit une transaction valide qu&#8217;il n&#8217;a pas vue auparavant la transmettra immédiatement à tous les autres nœuds auxquels il est connecté , une technique de propagation connue sous le nom d'<em>inondation</em>. Ainsi, la transaction se propage (en inondant ou distribuant) rapidement à travers le réseau pair à pair, atteignant un grand pourcentage de nœuds en quelques secondes.</p>
</div>
</div>
<div class="sect4 data-line-226">
<h5 id="_le_point_de_vue_de_bob">Le point de vue de Bob</h5>
<div class="paragraph data-line-228">
<p>Si l&#8217;application de portefeuille bitcoin de Bob est directement connectée à l&#8217;application de portefeuille d&#8217;Alice, l&#8217;application de portefeuille de Bob peut être le premier nœud à recevoir la transaction. Cependant, même si le portefeuille d&#8217;Alice envoie la transaction via d&#8217;autres nœuds, elle atteindra le portefeuille de Bob en quelques secondes. Le portefeuille de Bob identifiera immédiatement la transaction d&#8217;Alice comme un paiement entrant car il contient des sorties remboursables par les clés de Bob. L&#8217;application de portefeuille de Bob peut également vérifier de manière indépendante que la transaction est bien formée, utilise des sorties précédemment non dépensées et contient des frais de transaction suffisants pour être inclus dans le bloc suivant. À ce stade, Bob peut supposer, avec peu de risques, que la transaction sera bientôt incluse dans un bloc et confirmée.</p>
</div>
<div class="admonitionblock tip data-line-231">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-232">
<p>Une idée fausse courante à propos des transactions bitcoin est qu&#8217;elles doivent être "confirmées" en attendant 10 minutes pour un nouveau bloc, ou jusqu&#8217;à 60 minutes pour six confirmations complètes. Bien que les confirmations garantissent que la transaction a été acceptée par l&#8217;ensemble du réseau, un tel délai n&#8217;est pas nécessaire pour les articles de petite valeur comme une tasse de café. Un commerçant peut accepter une transaction valide de petite valeur sans confirmation, sans plus de risque qu&#8217;un paiement par carte de crédit effectué sans pièce d&#8217;identité ni signature, comme les commerçants l&#8217;acceptent couramment aujourd&#8217;hui.("", startref="Tconstruct02" )</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-235">
<h3 id="_extraction_de_bitcoins">Extraction de bitcoins</h3>
<div class="paragraph data-line-237">
<p>La transaction d&#8217;Alice est maintenant propagé sur le réseau Bitcoin. Il ne fait pas partie de la <em>chaîne de blocs</em> tant qu&#8217;il n&#8217;est pas vérifié et inclus dans un bloc par un processus appelé <em>minage</em>. Voir <a href="#mining">Minage et Consensus</a> pour une explication détaillée.</p>
</div>
<div class="paragraph data-line-239">
<p>Le système de confiance Bitcoin est basé sur le calcul. Les transactions sont regroupées en <em>blocs</em>, qui nécessitent une énorme quantité de calculs pour prouver, mais seulement une petite quantité de calculs pour vérifier comme prouvé. Le processus de minage sert à deux fins dans le bitcoin :</p>
</div>
<div class="ulist data-line-241">
<ul>
<li class="data-line-241">
<p>Les nœuds de minage valident toutes les transactions en se référant au <em>consensus des règles de bitcoin</em>. Par conséquent, le minage assure la sécurité des transactions bitcoin en rejetant les transactions invalides ou malformées.</p>
</li>
<li class="data-line-242">
<p>L&#8217;exploitation minière crée de nouveaux bitcoins dans chaque bloc, presque comme une banque centrale imprimant de la nouvelle monnaie. La quantité de bitcoin créée par bloc est limitée et diminue avec le temps, suivant un calendrier d&#8217;émission fixe.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-245">
<p>L&#8217;exploitation minière atteint un bon équilibre entre le coût et la récompense. L&#8217;exploitation minière utilise l&#8217;électricité pour résoudre un problème mathématique. Un mineur qui réussit recevra une <em>récompense</em> sous la forme de nouveaux bitcoins et de frais de transaction. Cependant, la récompense ne sera perçue que si le mineur a correctement validé toutes les transactions, à la satisfaction des règles de <em>consensus</em>. Cet équilibre délicat assure la sécurité du bitcoin sans autorité centrale.</p>
</div>
<div class="paragraph data-line-247">
<p>Une bonne façon de décrire l&#8217;exploitation minière est comme un jeu compétitif géant de sudoku qui se réinitialise chaque fois que quelqu&#8217;un trouve une solution et dont la difficulté s&#8217;ajuste automatiquement de sorte qu&#8217;il faut environ 10 minutes pour trouver une solution. Imaginez un puzzle sudoku géant, de plusieurs milliers de lignes et de colonnes. Si je vous montre un puzzle terminé, vous pouvez le vérifier assez rapidement. Cependant, si le puzzle a quelques cases remplies et que les autres sont vides, cela demande beaucoup de travail à résoudre ! La difficulté du sudoku peut être ajustée en modifiant sa taille (plus ou moins de lignes et de colonnes), mais elle peut toujours être vérifiée assez facilement même si elle est très grande. Le "casse-tête" utilisé dans le bitcoin est basé sur un hachage cryptographique et présente des caractéristiques similaires : il est asymétriquement difficile à résoudre mais facile à vérifier, et sa difficulté peut être ajustée.</p>
</div>
<div class="paragraph data-line-249">
<p>In <a href="#user-stories">Utilisations, utilisateurs et histoires de Bitcoin</a>, nous avons présenté Jing est un entrepreneur à Shanghai. Jing dirige une <em>ferme minière</em>, qui est une entreprise qui gère des milliers d&#8217;ordinateurs miniers spécialisés, en compétition pour la récompense. Toutes les 10 minutes environ, les ordinateurs miniers de Jing rivalisent avec des milliers de systèmes similaires dans une course mondiale pour trouver une solution à un bloc de transactions. Trouver une telle solution, la soi-disant <em>Proof-of-Work (ou Preuve de travail)</em> (PoW), nécessite des quadrillions d&#8217;opérations de hachage par seconde sur l&#8217;ensemble du réseau Bitcoin. L&#8217;algorithme de preuve de travail implique de hacher à plusieurs reprises l&#8217;en-tête du bloc et un nombre aléatoire avec l&#8217;algorithme cryptographique SHA256 jusqu&#8217;à ce qu&#8217;une solution correspondant à un modèle prédéterminé émerge. Le premier mineur à trouver une telle solution remporte la compétition et publie ce bloc dans la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-251">
<p>Jing a commencé l&#8217;exploitation minière en 2010 en utilisant un ordinateur de bureau très rapide pour trouver une preuve de travail appropriée pour les nouveaux blocs. Au fur et à mesure que de plus en plus de mineurs rejoignaient le réseau Bitcoin, la difficulté du problème augmentait rapidement. Bientôt, Jing et d&#8217;autres mineurs sont passés à du matériel plus spécialisé, avec des unités de traitement graphique (GPU) dédiées de haute de gamme, souvent utilisées dans les ordinateurs de bureau ou les consoles de jeu. Au moment d&#8217;écrire ces lignes, la difficulté est si élevée qu&#8217;il n&#8217;est rentable de miner qu&#8217;avec des circuits intégrés à application spécifique (ASIC), essentiellement des centaines d&#8217;algorithmes de minage imprimé en matériel, fonctionnant en parallèle sur une seule puce de silicium. La société de Jing participe également à un <em>groupe ou bassin de mineurs</em>, qui, tout comme un groupe de loterie, permet à plusieurs participants de partager leurs efforts et leurs récompenses. La société de Jing gère désormais un entrepôt contenant des milliers de mineurs ASIC pour extraire du bitcoin 24 heures sur 24. L&#8217;entreprise paie ses frais d&#8217;électricité en vendant le bitcoin qu&#8217;elle est capable de générer à partir de l&#8217;exploitation minière, créant ainsi des revenus à partir des bénéfices.</p>
</div>
</div>
<div class="sect2 data-line-253">
<h3 id="_transactions_minières_en_blocs">Transactions minières en blocs</h3>
<div class="paragraph data-line-255">
<p> De nouvelles transactions affluent constamment sur le réseau à partir des portefeuilles des utilisateurs et d&#8217;autres applications. Comme ceux-ci sont vus par les nœuds du réseau Bitcoin, ils sont ajoutés à un bassin temporaire de transactions non vérifiées maintenues par chaque nœud. Lorsque les mineurs construisent un nouveau bloc, ils ajoutent des transactions non vérifiées de ce bassin au nouveau bloc, puis tentent de prouver la validité de ce nouveau bloc, avec l&#8217;algorithme de minage (la preuve de travail). Le processus d&#8217;extraction est expliqué en détail dans <a href="#mining">Minage et Consensus</a>.</p>
</div>
<div class="paragraph data-line-257">
<p>Les transactions sont ajoutées au nouveau bloc, classées par ordre de priorité par les transactions les plus payantes en premier et quelques autres critères. Chaque mineur commence le processus d&#8217;extraction d&#8217;un nouveau bloc de transactions dès qu&#8217;il reçoit le bloc précédent du réseau, sachant qu&#8217;il a perdu le tour de compétition précédent. Ils créent immédiatement un nouveau bloc, le remplissent avec les transactions et l&#8217;empreinte numérique du bloc précédent, et commencent à calculer la preuve de travail pour le nouveau bloc. Chaque mineur inclut une transaction spéciale dans son bloc, une transaction qui paie à sa propre adresse Bitcoin la récompense du bloc (actuellement 6,25 bitcoins nouvellement créés) plus la somme des frais de transaction de toutes les transactions incluses dans le bloc. S&#8217;ils trouvent une solution qui rend ce bloc valide, ils "gagnent" cette récompense car leur bloc réussi est ajouté à la chaîne de blocs mondiale et la transaction de récompense qu&#8217;ils ont incluse devient dépensable. Jing, qui participe à un groupe de minage, a mis en place son logiciel pour créer de nouveaux blocs qui attribuent la récompense à une adresse de pool. À partir de là, une part de la récompense est distribuée à Jing et aux autres mineurs proportionnellement à la quantité de travail qu&#8217;ils ont apportée lors du dernier tour.</p>
</div>
<div class="paragraph data-line-259">
<p>La transaction d&#8217;Alice a été récupérée par le réseau et incluse dans le groupe de transactions non vérifiées. Une fois validé par le logiciel de minage, il a été inclus dans un nouveau bloc, appelé <em>bloc candidat</em>, généré par le pool de minage de Jing. Tous les mineurs participant à ce pool de minage commencent immédiatement à calculer la preuve de travail pour le bloc candidat. Environ cinq minutes après la première transmission de la transaction par le portefeuille d&#8217;Alice, l&#8217;un des mineurs ASIC de Jing a trouvé une solution pour le bloc candidat et l&#8217;a annoncée au réseau. Une fois que les autres mineurs ont validé le bloc gagnant, ils ont commencé la course pour générer le bloc suivant.</p>
</div>
<div class="paragraph data-line-261">
<p>Le bloc gagnant de Jing est devenu une partie de la chaîne de blocs en tant que bloc # 277316, contenant 419 transactions, y compris la transaction d&#8217;Alice. Le bloc contenant la transaction d&#8217;Alice est compté comme une "confirmation" de cette transaction.</p>
</div>
<div class="admonitionblock tip data-line-264">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-265">
<p>Vous pouvez voir le bloc qui inclut <a href="https://www.blockchain.com/btc/block/277316" data-href="https://www.blockchain.com/btc/block/277316">Transaction d&#8217;Alice</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-268">
<p> Environ 20 minutes plus tard, un nouveau bloc, #277317, est miné par un autre mineur. Parce que ce nouveau bloc est construit au-dessus du bloc #277316 qui contenait la transaction d&#8217;Alice, il a ajouté encore plus de calculs à la chaîne de blocs, renforçant ainsi la confiance dans ces transactions. Chaque bloc miné en plus de celui contenant la transaction compte comme une confirmation supplémentaire pour la transaction d&#8217;Alice. Au fur et à mesure que les blocs s&#8217;empilent les uns sur les autres, il devient exponentiellement plus difficile d&#8217;inverser la transaction, ce qui la rend de plus en plus fiable par le réseau.</p>
</div>
<div class="paragraph data-line-270">
<p>Dans le diagramme en <a href="#block-alice1">Transaction d&#8217;Alice incluse dans le bloc #277316</a>, nous pouvons voir le bloc #277316, qui contient la transaction d&#8217;Alice. En dessous se trouvent 277 316 blocs (y compris le bloc #0), liés les uns aux autres dans une chaîne de blocs jusqu&#8217;au bloc #0, connu sous le nom de <em>bloc d&#8217;origine</em>. Au fil du temps, à mesure que la "hauteur" des blocs augmente, la difficulté de calcul de chaque bloc et de la chaîne dans son ensemble augmente également. Les blocs extraits après celui qui contient la transaction d&#8217;Alice agissent comme une assurance supplémentaire, car ils accumulent plus de calculs dans une chaîne de plus en plus longue. Par convention, tout bloc avec plus de six confirmations est considéré comme irrévocable, car il faudrait une immense quantité de calculs pour invalider et recalculer six blocs. Nous examinerons plus en détail le processus d&#8217;exploitation minière et la manière dont il renforce la confiance dans <a href="#mining">Minage et Consensus</a>.</p>
</div>
<div id="block-alice1" class="imageblock data-line-274">
<div class="content">
<img src="images/mbc2_0209.png" alt="Transaction d&#8217;Alice incluse dans un bloc">
</div>
<div class="title">Figure 11. Transaction d&#8217;Alice incluse dans le bloc #277316</div>
</div>
</div>
<div class="sect2 data-line-276">
<h3 id="_dépenser_la_transaction">Dépenser la transaction</h3>
<div class="paragraph data-line-278">
<p> Maintenant que la transaction d&#8217;Alice a été intégrée à la chaîne de blocs dans le cadre d&#8217;un bloc, il fait partie du grand livre distribué de Bitcoin et est visible par toutes les applications Bitcoin. Chaque client Bitcoin peut indépendamment vérifier que la transaction est valide et utilisable. Les clients du nœud complet peuvent suivre la source des fonds à partir du moment où les bitcoins ont été générés pour la première fois dans un bloc, progressivement d&#8217;une transaction à l&#8217;autre, jusqu&#8217;à ce qu&#8217;ils atteignent l&#8217;adresse de Bob. Les clients légers peuvent faire ce qu&#8217;on appelle une vérification de paiement simplifiée (voir <a href="#spv_nodes">Nœuds de vérification simplifiée des paiements, ou Simplified Payment Verification (SPV)</a>) en confirmant que la transaction est dans la chaîne de blocs et qu&#8217;elle a plusieurs blocs extraits après elle, fournissant ainsi l&#8217;assurance que les mineurs l&#8217;ont acceptée comme valide.</p>
</div>
<div class="paragraph data-line-280">
<p>Bob peut maintenant dépenser le résultat de cette transaction et d&#8217;autres transactions. Par exemple, Bob peut payer un entrepreneur ou un fournisseur en transférant la valeur du paiement de la tasse de café d&#8217;Alice à ces nouveaux propriétaires. Très probablement, le logiciel Bitcoin de Bob regroupera de nombreux petits paiements en un paiement plus important, concentrant peut-être tous les revenus Bitcoin de la journée en une seule transaction. Cela regrouperait les différents paiements en un seul résultat (et une seule adresse). Pour un diagramme d&#8217;une transaction d&#8217;agrégation, voir <a href="#transaction-aggregating">Transaction agrégeant des fonds</a>.</p>
</div>
<div class="paragraph data-line-282">
<p>Au fur et à mesure que Bob dépense les paiements reçus d&#8217;Alice et d&#8217;autres clients, il étend la chaîne des transactions. Supposons que Bob paie son concepteur Web Gopesh à Bangalore pour une nouvelle page Web. Maintenant, la chaîne de transactions ressemblera à <a href="#block-alice2">La transaction d&#8217;Alice dans le cadre d&#8217;une chaîne de transactions de Joe à Gopesh, où la sortie d&#8217;une transaction est utilisée comme entrée de la transaction suivante</a>.</p>
</div>
<div id="block-alice2" class="imageblock data-line-286">
<div class="content">
<img src="images/mbc2_0210.png" alt="Transaction d&#8217;Alice comme partie d&#8217;une chaîne de transactions">
</div>
<div class="title">Figure 12. La transaction d&#8217;Alice dans le cadre d&#8217;une chaîne de transactions de Joe à Gopesh, où la sortie d&#8217;une transaction est utilisée comme entrée de la transaction suivante</div>
</div>
<div class="paragraph data-line-11">
<p>Dans ce chapitre, nous avons vu comment les transactions construisent une chaîne qui déplace la valeur d&#8217;un propriétaire à l&#8217;autre. Nous avons également suivi la transaction d&#8217;Alice, à partir du moment où elle a été créée dans son portefeuille, via le réseau Bitcoin et jusqu&#8217;aux mineurs qui l&#8217;ont enregistrée sur la chaîne de blocs. Dans le reste de ce livre, nous examinerons les technologies spécifiques derrière les portefeuilles, les adresses, les signatures, les transactions, le réseau et enfin le minage. </p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ch03_bitcoin_client">Bitcoin Core : La référence d&#8217;implémentation</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-4">
<p>Bitcoin est un projet <em>source libre</em> et le code source est disponible sous une licence ouverte (MIT), téléchargeable et utilisable à n&#8217;importe quelle fin. Source libre signifie plus que simplement libre d&#8217;utilisation. Cela signifie également que le bitcoin est développé par une communauté ouverte de bénévoles. Au début, cette communauté se composait uniquement de Satoshi Nakamoto. En 2016, le code source de Bitcoin comptait plus de 400 contributeurs avec une douzaine de développeurs travaillant sur le code presque à temps plein et plusieurs dizaines d&#8217;autres à temps partiel. Tout le monde peut contribuer au code, y compris vous !</p>
</div>
<div class="paragraph data-line-7">
<p>Lorsque bitcoin a été créé par Satoshi Nakamoto, le logiciel était en fait terminé avant le livre blanc reproduit dans <a href="#satoshi_whitepaper">Le livre blanc Bitcoin de Satoshi Nakamoto</a>. Satoshi voulait s&#8217;assurer que cela fonctionnait avant d&#8217;écrire à ce sujet. Cette première implémentation, alors simplement connue sous le nom de "Bitcoin" ou "client Satoshi", a été fortement modifiée et améliorée. Il a évolué vers ce qu&#8217;on appelle <em>Bitcoin Core</em>, pour le différencier des autres implémentations compatibles. Bitcoin Core est la <em>mise en œuvre de référence</em> du système Bitcoin, ce qui signifie qu&#8217;il s&#8217;agit de la référence faisant autorité sur la manière dont chaque partie de la technologie doit être mise en œuvre. Bitcoin Core implémente tous les aspects du bitcoin, y compris les portefeuilles, un moteur de validation des transactions et des blocs et un nœud de réseau complet dans le réseau Bitcoin pair à pair.</p>
</div>
<div class="admonitionblock warning data-line-10">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-11">
<p>Même si Bitcoin Core inclut une implémentation de référence d&#8217;un portefeuille, celui-ci n&#8217;est pas destiné à être utilisé comme portefeuille de production pour les utilisateurs ou pour les applications. Il est conseillé aux développeurs d&#8217;applications de créer des portefeuilles en utilisant des normes modernes telles que BIP-39 et BIP-32 (voir <a href="#mnemonic_code_words">Mots de code mnémonique (BIP-39)</a> et <a href="#hd_wallets">Portefeuilles HD (BIP-32/BIP-44)</a>). BIP signifie <em>Bitcoin Improvement Proposal</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-14">
<p><a href="#bitcoin_core_architecture">Architecture Bitcoin Core (Source : Eric Lombrozo)</a> montre l&#8217;architecture de Bitcoin Core.</p>
</div>
<div id="bitcoin_core_architecture" class="imageblock data-line-18">
<div class="content">
<img src="images/mbc2_0301.png" alt="Architecture de base Bitcoin">
</div>
<div class="title">Figure 13. Architecture Bitcoin Core (Source : Eric Lombrozo)</div>
</div>
<div class="sect2 data-line-21">
<h3 id="_environnement_de_développement_bitcoin">Environnement de développement Bitcoin</h3>
<div class="paragraph data-line-23">
<p> Si vous êtes un développeur, vous souhaiterez configurer un environnement de développement avec tous les outils, bibliothèques et logiciels de support pour le développement d&#8217;applications bitcoin. Dans ce chapitre très technique, nous allons parcourir ce processus étape par étape. Si le matériel devient trop dense (et que vous n&#8217;êtes pas en train de mettre en place un environnement de développement), n&#8217;hésitez pas à passer au chapitre suivant, qui est moins technique.</p>
</div>
</div>
<div class="sect2 data-line-26">
<h3 id="compiling_core">Compilation de Bitcoin Core à partir du code source</h3>
<div class="paragraph data-line-28">
<p>Le code source de Bitcoin Core peut être téléchargé sous forme d&#8217;archive ou en clonant le référentiel source faisant autorité à partir de GitHub. Sur la <a href="https://bitcoincore.org/bin/" data-href="https://bitcoincore.org/bin/">page de téléchargement de Bitcoin Core</a>, sélectionnez la version la plus récente et téléchargez l&#8217;archive compressée du code source, par exemple, bitcoin-0.15.0.2.tar.gz. Vous pouvez également utiliser la ligne de commande git pour créer une copie locale du code source à partir de la <a href="https://github.com/bitcoin/bitcoin" data-href="https://github.com/bitcoin/bitcoin">page GitHub de bitcoin</a>.</p>
</div>
<div class="admonitionblock tip data-line-31">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-32">
<p>Dans de nombreux exemples de ce chapitre, nous utiliserons l&#8217;interface de de commande du système d&#8217;exploitation ( également appelé "shell" ou "interface système" ou "coque logicielle"), accessible via une application "terminal". L&#8217;interface système affichera une invite; vous tapez une commande; et l&#8217;interface système répond avec du texte et une nouvelle invite pour votre prochaine commande. L&#8217;invite peut sembler différente sur votre système, mais dans les exemples suivants, elle est indiquée par un symbole $. Dans les exemples, lorsque vous voyez du texte après un symbole $, ne tapez pas le symbole <code>$</code> mais tapez la commande qui le suit immédiatement, puis appuyez sur Entrée pour exécuter la commande. Dans les exemples, les lignes sous chaque commande sont les réponses du système d&#8217;exploitation à cette commande. Lorsque vous verrez le prochain préfixe $, vous saurez qu&#8217;il s&#8217;agit d&#8217;une nouvelle commande et vous devrez répéter le processus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-35">
<p> Dans cet exemple, nous utilisons la commande <code>git</code> pour créer une copie locale (un "clone") du code source :</p>
</div>
<div class="listingblock data-line-37">
<div class="content">
<pre>$ git clone https://github.com/bitcoin/bitcoin.git
Cloning into 'bitcoin'...
remote: Counting objects: 102071, done.
remote: Compressing objects: 100% (10/10), done.
Receiving objects: 100% (102071/102071), 86.38 MiB | 730.00 KiB/s, done.
remote: Total 102071 (delta 4), reused 5 (delta 1), pack-reused 102060
Resolving deltas: 100% (76168/76168), done.
Checking connectivity... done.
$</pre>
</div>
</div>
<div class="admonitionblock tip data-line-50">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-51">
<p>Git est le système de contrôle de version distribué le plus largement utilisé et un élément essentiel de la boîte à outils de tout développeur de logiciels. Vous devrez peut-être installer la commande git, ou une interface utilisateur graphique pour git, sur votre système d&#8217;exploitation si vous ne l&#8217;avez pas déjà.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-54">
<p>Une fois l&#8217;opération de clonage git terminée, vous aurez une copie locale complète du référentiel de code source dans le répertoire <em>bitcoin</em>. Accédez à ce répertoire en tapant <code><strong>cd bitcoin</strong></code> à l&#8217;invite :</p>
</div>
<div class="listingblock data-line-56">
<div class="content">
<pre>$ cd bitcoin</pre>
</div>
</div>
<div class="sect3 data-line-60">
<h4 id="_sélection_dune_version_de_bitcoin_core">Sélection d&#8217;une version de Bitcoin Core</h4>
<div class="paragraph data-line-61">
<p>Par défaut, la copie locale sera synchronisée avec le code le plus récent, qui peut être une version instable ou bêta de bitcoin. Avant de compiler le code, sélectionnez une version spécifique en consultant une version avec la commande Git <em>tag</em>. Cela synchronisera la copie locale avec un instantané (snapshot) spécifique du référentiel de code identifié par une balise de mot-clé (le <em>tag</em>.) Les balises sont utilisées par les développeurs pour marquer des versions spécifiques du code par numéro de version. Tout d&#8217;abord, pour trouver les balises disponibles, nous utilisons la commande git tag :</p>
</div>
<div class="listingblock data-line-63">
<div class="content">
<pre>$ git tag
v0.1.5
v0.1.6test1
v0.10.0
...
v0.11.2
v0.11.2rc1
v0.12.0rc1
v0.12.0rc2
...</pre>
</div>
</div>
<div class="paragraph data-line-76">
<p>La liste des balises montre toutes les versions publiées de bitcoin. Par convention, les <em>release candidates</em> (ou <em>versions d&#8217;évaluations</em>), qui sont destinées aux tests, ont le suffixe "rc". Les versions stables pouvant être exécutées sur des systèmes de production n&#8217;ont pas de suffixe. Dans la liste précédente, sélectionnez la version la plus élevée, qui au moment de la rédaction était v0.15.0. Pour synchroniser le code local avec cette version, utilisez la commande git checkout :</p>
</div>
<div class="listingblock data-line-78">
<div class="content">
<pre>$ git checkout v0.15.0
HEAD is now at 3751912... Merge #11295: doc: Old fee_estimates.dat are discarded by 0.15.0</pre>
</div>
</div>
<div class="paragraph data-line-83">
<p>Vous pouvez confirmer que vous avez la version souhaitée "extraite" en lançant la commande git status :</p>
</div>
<div class="listingblock data-line-85">
<div class="content">
<pre>$ git status
HEAD detached at v0.15.0
nothing to commit, working directory clean</pre>
</div>
</div>
</div>
<div class="sect3 data-line-91">
<h4 id="_configuration_de_la_construction_de_bitcoin_core">Configuration de la construction de Bitcoin Core</h4>
<div class="paragraph data-line-93">
<p>Le code source inclut la documentation, qui peut être trouvée dans un certain nombre de fichiers. Passez en revue la documentation principale située dans <em>README.md</em> dans le répertoire <em>bitcoin</em> en tapant <code><strong>more README.md</strong></code> à l&#8217;invite et en utilisant la barre d&#8217;espace pour passer à la page suivante. Dans ce chapitre, nous allons construire le client Bitcoin en ligne de commande, également connu sous le nom de <code>bitcoind</code> sous Linux. Passez en revue les instructions pour compiler le client de ligne de commande <code>bitcoind</code> sur votre plate-forme en tapant <code><strong>more doc/build-unix.md</strong></code>. Des instructions alternatives pour macOS et Windows peuvent être trouvées dans le répertoire <em>doc</em>, comme <em>build-osx.md</em> ou <em>build-windows.md</em>, respectivement.</p>
</div>
<div class="paragraph data-line-95">
<p>Examinez attentivement les prérequis de construction, qui se trouvent dans la première partie de la documentation de construction. Ce sont des bibliothèques qui doivent être présentes sur votre système avant de pouvoir commencer à compiler Bitcoin. Si ces conditions préalables sont manquantes, le processus de génération échouera avec une erreur. Si cela se produit parce que vous avez manqué une condition préalable, vous pouvez l&#8217;installer, puis reprendre le processus de génération là où vous l&#8217;avez laissé. En supposant que les prérequis sont installés, vous démarrez le processus de génération en générant un ensemble de scripts de génération à l&#8217;aide du script <em>autogen.sh</em>.</p>
</div>
<div class="listingblock data-line-97">
<div class="content">
<pre>$ ./autogen.sh
...
glibtoolize: copying file 'build-aux/m4/libtool.m4'
glibtoolize: copying file 'build-aux/m4/ltoptions.m4'
glibtoolize: copying file 'build-aux/m4/ltsugar.m4'
glibtoolize: copying file 'build-aux/m4/ltversion.m4'
...
configure.ac:10: installing 'build-aux/compile'
configure.ac:5: installing 'build-aux/config.guess'
configure.ac:5: installing 'build-aux/config.sub'
configure.ac:9: installing 'build-aux/install-sh'
configure.ac:9: installing 'build-aux/missing'
Makefile.am: installing 'build-aux/depcomp'
...</pre>
</div>
</div>
<div class="paragraph data-line-114">
<p>Le script <em>autogen.sh</em> crée un ensemble de scripts de configuration automatique qui interrogeront votre système pour découvrir les paramètres corrects et s&#8217;assurer que vous disposez de toutes les bibliothèques nécessaires pour compiler le code. Le plus important d&#8217;entre eux est le script <code>configure</code> qui offre un certain nombre d&#8217;options différentes pour personnaliser le processus de construction. Tapez <code><strong>./configure --help</strong></code> pour voir les différentes options:</p>
</div>
<div class="listingblock data-line-116">
<div class="content">
<pre>$ ./configure --help
`configure' configures Bitcoin Core 0.15.0 to adapt to many kinds of systems.

Usage: ./configure [OPTION]... [VAR=VALUE]...

...
Optional Features:
  --disable-option-checking  ignore unrecognized --enable/--with options
  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]

  --enable-wallet         enable wallet (default is yes)

  --with-gui[=no|qt4|qt5|auto]
...</pre>
</div>
</div>
<div class="paragraph data-line-134">
<p>Le script <code>configure</code> vous permet d&#8217;activer ou de désactiver certaines fonctionnalités de <code>bitcoind</code> grâce à l&#8217;utilisation des drapeaux <code>--enable-FEATURE</code> et --disable-FEATURE, où <span class="keep-together"><code>FEATURE</code></span> est remplacé par le nom de la fonctionnalité, comme indiqué dans la sortie d&#8217;aide. Dans ce chapitre, nous allons construire le client <code>bitcoind</code> avec toutes les fonctionnalités par défaut. Nous n&#8217;utiliserons pas les indicateurs de configuration, mais vous devriez les consulter pour comprendre quelles fonctionnalités facultatives font partie du client. Si vous êtes dans un environnement universitaire, les restrictions du laboratoire informatique peuvent vous obliger à installer des applications dans votre répertoire personnel (par exemple, en utilisant --prefix=$HOME).</p>
</div>
<div class="paragraph data-line-136">
<p>Voici quelques options utiles qui remplacent le comportement par défaut du script configure:</p>
</div>
<dl>
<dt><code>--prefix=$HOME</code></dt>
<dd><p>Cela remplace l'emplacement d'installation par défaut (qui est <em>/usr/local/</em> ) pour l'exécutable résultant. Utilisez <code>$HOME</code> pour tout mettre dans votre répertoire personnel, ou un chemin différent.</p></dd>

<dt><code>--disable-wallet</code></dt>
<dd><p>Ceci est utilisé pour désactiver l'implémentation du portefeuille de référence.</p></dd>

<dt><code>--with-incompatible-bdb</code></dt>
<dd><p>Si vous construisez un portefeuille, autorisez l'utilisation d'une version incompatible de la bibliothèque Berkeley DB.</p></dd>

<dt><code>--with-gui=no</code></dt>
<dd><p>Ne construisez pas l'interface utilisateur graphique, qui nécessite la bibliothèque Qt. Cela construit uniquement le bitcoin du serveur et de la ligne de commande.</p></dd>
</dl>
<div class="paragraph data-line-154">
<p>Ensuite, exécutez le script <code>configure</code> pour découvrir automatiquement toutes les bibliothèques nécessaires et créer un script de construction personnalisé pour votre système :</p>
</div>
<div class="listingblock data-line-156">
<div class="content">
<pre>$ ./configure
checking build system type... x86_64-unknown-linux-gnu
checking host system type... x86_64-unknown-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
...
[de nombreuses pages de tests de configuration suivent]
...
$</pre>
</div>
</div>
<div class="paragraph data-line-172">
<p>Si tout s&#8217;est bien passé, la commande <code>configure</code> se terminera par la création des scripts de construction personnalisés qui nous permettront de compiler bitcoind. S&#8217;il y a des bibliothèques manquantes ou des erreurs, la commande <code>configure</code> se terminera par une erreur au lieu de créer les scripts de construction. Si une erreur se produit, elle est probablement due à une bibliothèque manquante ou incompatible. Relisez à nouveau la documentation de build et assurez-vous d&#8217;installer les prérequis manquants. Ensuite, exécutez à nouveau <code>configure</code> et voyez si cela corrige l&#8217;erreur.</p>
</div>
</div>
<div class="sect3 data-line-174">
<h4 id="_construire_les_exécutables_bitcoin_core">Construire les exécutables Bitcoin Core</h4>
<div class="paragraph data-line-176">
<p> Ensuite, vous allez compiler le code source, un processus qui peut prendre jusqu&#8217;à une heure, en fonction de la vitesse de votre processeur et de la mémoire disponible. Pendant le processus de compilation, vous devriez voir une sortie toutes les quelques secondes ou toutes les quelques minutes, ou une erreur si quelque chose ne va pas. Si une erreur se produit ou si le processus de compilation est interrompu, il peut être repris à tout moment en tapant à nouveau make. Tapez <code><strong>make</strong></code> pour lancer la compilation de l&#8217;application exécutable :</p>
</div>
<div class="listingblock data-line-178">
<div class="content">
<pre>$ make
Making all in src
  CXX      crypto/libbitcoinconsensus_la-hmac_sha512.lo
  CXX      crypto/libbitcoinconsensus_la-ripemd160.lo
  CXX      crypto/libbitcoinconsensus_la-sha1.lo
  CXX      crypto/libbitcoinconsensus_la-sha256.lo
  CXX      crypto/libbitcoinconsensus_la-sha512.lo
  CXX      libbitcoinconsensus_la-hash.lo
  CXX      primitives/libbitcoinconsensus_la-transaction.lo
  CXX      libbitcoinconsensus_la-pubkey.lo
  CXX      script/libbitcoinconsensus_la-bitcoinconsensus.lo
  CXX      script/libbitcoinconsensus_la-interpreter.lo

[... de nombreux autres messages de compilation suivent ...]

$</pre>
</div>
</div>
<div class="paragraph data-line-197">
<p>Sur un système rapide avec plusieurs processeurs, vous souhaiterez peut-être définir le nombre de tâches de compilation parallèles. Par exemple, <code>make -j 2</code> utilisera deux cœurs s&#8217;ils sont disponibles. Si tout se passe bien, Bitcoin Core est maintenant compilé. Vous devez exécuter la suite de tests unitaires avec <code>make check</code> pour vous assurer que les bibliothèques liées ne sont pas cassées de manière évidente. La dernière étape consiste à installer les différents exécutables sur votre système à l&#8217;aide de la commande make install. Vous serez peut-être invité à saisir votre mot de passe utilisateur, car cette étape nécessite des privilèges d&#8217;administrateur:</p>
</div>
<div class="listingblock data-line-199">
<div class="content">
<pre>$ make check &amp;&amp; sudo make install
Password:
Making install in src
 ../build-aux/install-sh -c -d '/usr/local/lib'
libtool: install: /usr/bin/install -c bitcoind /usr/local/bin/bitcoind
libtool: install: /usr/bin/install -c bitcoin-cli /usr/local/bin/bitcoin-cli
libtool: install: /usr/bin/install -c bitcoin-tx /usr/local/bin/bitcoin-tx
...
$</pre>
</div>
</div>
<div class="paragraph data-line-211">
<p>L&#8217;installation par défaut de <code>bitcoind</code> le place dans <em>/usr/local/bin</em>. Vous pouvez confirmer que Bitcoin Core est correctement installé en demandant au système le chemin des exécutables, comme suit:</p>
</div>
<div class="listingblock data-line-213">
<div class="content">
<pre>$ which bitcoind
/usr/local/bin/bitcoind

$ which bitcoin-cli
/usr/local/bin/bitcoin-cli</pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-221">
<h3 id="_exécution_dun_nœud_bitcoin_core">Exécution d&#8217;un nœud Bitcoin Core</h3>
<div class="paragraph data-line-223">
<p>Le réseau pair à pair de Bitcoin est composé de "nœuds" de réseau, gérés principalement par des bénévoles et certaines des entreprises qui créent des applications bitcoin. Ceux qui exécutent des nœuds Bitcoin ont une vue directe et faisant autorité sur la chaîne de blocs Bitcoin, avec une copie locale de toutes les transactions, validées indépendamment par leur propre système. En exécutant un nœud, vous n&#8217;avez pas besoin de faire appel à un tiers pour valider une transaction. De plus, en exécutant un nœud Bitcoin, vous contribuez au réseau Bitcoin en le rendant plus robuste et sécuritaire.</p>
</div>
<div class="paragraph data-line-225">
<p>Cependant, l&#8217;exécution d&#8217;un nœud nécessite un système connecté en permanence avec suffisamment de ressources pour traiter toutes les transactions bitcoin. Selon que vous choisissez d&#8217;indexer toutes les transactions et de conserver une copie complète de la chaîne de blocs, vous pouvez également avoir besoin de beaucoup d&#8217;espace disque et de mémoire RAM. Au début de 2021, un nœud à index complet a besoin de 2 Go de RAM et d&#8217;un minimum de 360 Go d&#8217;espace disque (voir <a href="https://www.blockchain.com/charts/blocks-size" class="undefined" data-href="https://www.blockchain.com/charts/blocks-size">https://www.blockchain.com/charts/blocks-size</a>). Les nœuds Bitcoin transmettent et reçoivent également des transactions et des blocs Bitcoin, consommant de la bande passante Internet. Si votre connexion Internet est limitée, a un faible plafond de données ou est mesurée (facturée au gigabit), vous ne devriez probablement pas exécuter un nœud Bitcoin, ou l&#8217;exécuter d&#8217;une manière qui limite sa bande passante (voir <a href="#constrained_resources">Exemple de configuration d&#8217;un système à ressources limitées</a>).</p>
</div>
<div class="admonitionblock tip data-line-228">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-229">
<p>Bitcoin Core conserve une copie complète de la chaîne de blocs par défaut, avec chaque transaction qui s&#8217;est déjà produite sur le Bitcoin réseau depuis sa création en 2009. Cet ensemble de données a une taille de dizaines de gigaoctets et est téléchargé de manière incrémentielle sur plusieurs jours ou semaines, en fonction de la vitesse de votre CPU et de votre connexion Internet. Bitcoin Core ne pourra pas traiter les transactions ou mettre à jour les soldes des comptes tant que l&#8217;ensemble de données complet de la chaîne de blocs n&#8217;aura pas été téléchargé. Assurez-vous que vous disposez de suffisamment d&#8217;espace disque, de bande passante et de temps pour effectuer la synchronisation initiale. Vous pouvez configurer Bitcoin Core pour réduire la taille de la chaîne de blocs en supprimant les anciens blocs (voir <a href="#constrained_resources">Exemple de configuration d&#8217;un système à ressources limitées</a>), mais il téléchargera tout de même l&#8217;intégralité de l&#8217;ensemble de données avant de les supprimer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-232">
<p>Malgré ces besoins en ressources, des milliers de bénévoles gèrent des nœuds Bitcoin. Certains fonctionnent sur des systèmes aussi simples qu&#8217;un Raspberry Pi (un ordinateur à 35 $ US de la taille d&#8217;un paquet de cartes). De nombreux volontaires exécutent également des nœuds Bitcoin sur des serveurs loués, généralement une variante de Linux. Une instance de <em>Virtual Private Server</em> (VPS ou serveur virtuel privé) ou <em>Cloud Computing Server</em> (ou serveur en infonuagique) peut être utilisée pour exécuter un nœud Bitcoin. Ces serveurs peuvent être loués pour 25 $ à 50 $ US par mois auprès de divers fournisseurs.</p>
</div>
<div class="paragraph data-line-234">
<p>Pourquoi voudriez-vous exécuter un nœud ? Voici quelques-unes des raisons les plus courantes :</p>
</div>
<div class="ulist data-line-236">
<ul>
<li class="data-line-236">
<p>Si vous développez un logiciel bitcoin et que vous devez vous fier à un nœud Bitcoin pour un accès programmable (API) au réseau et à la chaîne de blocs.</p>
</li>
<li class="data-line-238">
<p>Si vous créez des applications qui doivent valider les transactions selon les règles de consensus de bitcoin. En règle générale, les éditeurs de logiciels Bitcoin exécutent plusieurs nœuds.</p>
</li>
<li class="data-line-240">
<p>Si vous souhaitez prendre en charge le bitcoin. L&#8217;exécution d&#8217;un nœud rend le réseau plus robuste et capable de servir plus de portefeuilles, plus d&#8217;utilisateurs et plus de transactions.</p>
</li>
<li class="data-line-242">
<p>Si vous ne souhaitez pas vous fier à un tiers pour traiter ou valider vos transactions.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-244">
<p>Si vous lisez ce livre et êtes intéressé par le développement d&#8217;un logiciel Bitcoin, vous devriez exécuter votre propre nœud.</p>
</div>
<div class="sect3 data-line-246">
<h4 id="_configuration_du_nœud_bitcoin_core">Configuration du nœud Bitcoin Core</h4>
<div class="paragraph data-line-248">
<p>( "sécurité", "mots de passe")Bitcoin Core recherchera un fichier de configuration dans son répertoire de données à chaque démarrage. Dans cette section, nous examinerons les différentes options de configuration et créerons un fichier de configuration. Pour localiser le fichier de configuration, exécutez <code>bitcoind -printtoconsole</code> dans votre terminal et recherchez les deux premières lignes.</p>
</div>
<div class="listingblock data-line-250">
<div class="content">
<pre>$ bitcoind -printtoconsole
Bitcoin version v0.15.0
Using the 'standard' SHA256 implementation
Using data directory /home/ubuntu/.bitcoin/
Using config file /home/ubuntu/.bitcoin/bitcoin.conf
...
[beaucoup plus de sortie de débogage]
...</pre>
</div>
</div>
<div class="paragraph data-line-261">
<p>Vous pouvez appuyer sur Ctrl-C pour fermer le nœud une fois que vous avez déterminé l&#8217;emplacement du fichier de configuration. Habituellement, le fichier de configuration se trouve dans le répertoire de données <em>.bitcoin</em> sous le répertoire personnel de votre utilisateur. Il n&#8217;est pas créé automatiquement, mais vous pouvez créer un fichier de configuration de démarrage en copiant et collant à partir de l&#8217;exemple <a href="#full_index_node">Exemple de configuration d&#8217;un nœud à index complet</a> ci-dessous. Vous pouvez créer ou modifier le fichier de configuration dans votre éditeur préféré.</p>
</div>
<div class="paragraph data-line-263">
<p>Bitcoin Core propose plus de 100 options de configuration qui modifient le comportement du nœud de réseau, le stockage de la chaîne de blocs et de nombreux autres aspects de son fonctionnement. Pour voir une liste de ces options, exécutez bitcoind --help :</p>
</div>
<div class="listingblock data-line-265">
<div class="content">
<pre>$ bitcoind --help
Bitcoin Core Daemon version v0.15.0

Usage:
  bitcoind [options]                     Start Bitcoin Core Daemon

Options:

  -?
       Print this help message and exit

  -version
       Print version and exit

  -alertnotify=&lt;cmd&gt;
       Execute command when a relevant alert is received or we see a really
       long fork (%s in cmd is replaced by message)
...
[beaucoup plus d'options]
...

  -rpcthreads=&lt;n&gt;
       Set the number of threads to service RPC calls (default: 4)</pre>
</div>
</div>
<div class="paragraph data-line-291">
<p>Voici quelques-unes des options les plus importantes que vous pouvez définir dans le fichier de configuration, ou en tant que paramètres de ligne de commande pour bitcoind :</p>
</div>
<div class="dlist data-line-293">
<dl>
<dt class="hdlist1">alertnotify</dt>
<dd>
<p>Exécute une commande ou un script spécifié pour envoyer des alertes d&#8217;urgence au propriétaire de ce nœud, généralement par courriel.</p>
</dd>
<dt class="hdlist1">conf</dt>
<dd>
<p>Un emplacement alternatif pour le fichier de configuration. Cela n&#8217;a de sens qu&#8217;en tant que paramètre de ligne de commande pour bitcoind, car il ne peut pas se trouver dans le fichier de configuration auquel il se réfère.</p>
</dd>
<dt class="hdlist1">datadir</dt>
<dd>
<p>Sélectionnez le répertoire et le système de fichiers dans lesquels vous placer toutes les données de la chaîne de blocs. Par défaut, il s&#8217;agit d&#8217;un sous-répertoire de <em>.bitcoin</em> de votre répertoire personnel. Assurez-vous que ce système de fichiers dispose de plusieurs gigaoctets d&#8217;espace libre.</p>
</dd>
<dt class="hdlist1">prune</dt>
<dd>
<p>Réduisez les besoins en espace disque à ce nombre de mégaoctets, en supprimant les anciens blocs. Utilisez ceci sur un nœud à ressources limitées qui ne peut pas contenir la chaîne de blocs complète.</p>
</dd>
<dt class="hdlist1">txindex</dt>
<dd>
<p>Maintient un index de toutes les transactions. Cela signifie une copie complète de la chaîne de blocs. Cela vous permet de récupérer par programmation toute transaction par identifiant (ID).</p>
</dd>
<dt class="hdlist1">dbcache</dt>
<dd>
<p>La taille du cache UTXO. La valeur par défaut est 450 Mio. Augmentez cette valeur sur le matériel haut de gamme et réduisez la taille sur le matériel bas de gamme pour économiser de la mémoire au détriment des entrées-sorties des disques lents.</p>
</dd>
<dt class="hdlist1">maxconnections</dt>
<dd>
<p>Définissez le nombre maximal de nœuds à partir desquels accepter les connexions. Le réduire par défaut réduira votre consommation de bande passante. À utiliser si vous avez un plafond de données ou si vous payez au gigaoctet.</p>
</dd>
<dt class="hdlist1">maxmempool</dt>
<dd>
<p>Limite le bassin de mémoire de transaction à ce nombre de mégaoctets. Utilisez-le pour réduire l&#8217;utilisation de la mémoire sur les nœuds à mémoire limitée.</p>
</dd>
<dt class="hdlist1">maxreceivebuffer/maxsendbuffer</dt>
<dd>
<p>Limite la mémoire tampon par connexion à ce nombre de multiples de 1000 octets. À utiliser sur les nœuds à mémoire limitée.</p>
</dd>
<dt class="hdlist1">minrelaytxfee</dt>
<dd>
<p>Définissez le taux de frais minimum pour la transaction que vous relayerez. En dessous de cette valeur, la transaction est traitée non standard, rejetée du bassin de transactions et non relayée.</p>
</dd>
</dl>
</div>
<div id="txindex" class="sidebarblock data-line-316">
<div class="content">
<div class="title">Index de la base de données des transactions et option txindex</div>
<div class="paragraph data-line-317">
<p>Par défaut, Bitcoin Core construit une base de données contenant <em>uniquement</em> les transactions liées au portefeuille de l&#8217;utilisateur. Si vous voulez pouvoir accéder à <em>n&#8217;importe quelle</em> transaction avec des commandes comme <code>getrawtransaction</code> (voir <a href="#exploring_and_decoding_transanctions">Explorer et décoder les transactions</a>), vous devez configurer Bitcoin Core pour créer un index de transaction complet, ce qui peut être réalisé avec l&#8217;option txindex. Définissez <code>txindex=1</code> dans le fichier de configuration de Bitcoin Core. Si vous ne définissez pas cette option au début et que vous la réglez ensuite sur l&#8217;indexation complète, vous devez redémarrer <code>bitcoind</code> avec l&#8217;option <code>-reindex</code> et attendre qu&#8217;elle reconstruise l&#8217;index.</p>
</div>
</div>
</div>
<div class="paragraph data-line-320">
<p><a href="#full_index_node">Exemple de configuration d&#8217;un nœud à index complet</a> montre comment vous pouvez combiner les options précédentes, avec un nœud entièrement indexé, fonctionnant comme un backend API pour une application bitcoin.</p>
</div>
<div id="full_index_node" class="exampleblock data-line-324">
<div class="title">Example 3. Exemple de configuration d&#8217;un nœud à index complet</div>
<div class="content">
<div class="listingblock data-line-325">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerte : %s"
datadir=/lotsofspace/bitcoin
index_tx=1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-332">
<p><a href="#constrained_resources">Exemple de configuration d&#8217;un système à ressources limitées</a> montre un nœud à ressources limitées s&#8217;exécutant sur un serveur plus petit.</p>
</div>
<div id="constrained_resources" class="exampleblock data-line-336">
<div class="title">Example 4. Exemple de configuration d&#8217;un système à ressources limitées</div>
<div class="content">
<div class="listingblock data-line-337">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerte : %s"
maxconnexions=15
prune=5000
dbcache=150
maxmempool=150
maxreceivebuffer=2500
maxsendbuffer=500</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-348">
<p>Une fois que vous avez modifié le fichier de configuration et défini les options qui représentent le mieux vos besoins, vous pouvez tester <code>bitcoind</code> avec cette configuration. Exécutez Bitcoin Core avec l&#8217;option <code>printtoconsole</code> pour s&#8217;exécuter au premier plan avec une sortie vers la console :</p>
</div>
<div class="listingblock data-line-350">
<div class="content">
<pre>$ bitcoind -printtoconsole

Bitcoin version v0.15.0
InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -&gt; setting -whitelistrelay=1
Assuming ancestors of block 0000000000000000003b9ce759c2a087d52abc4266f8f4ebd6d768b89defa50a have valid signatures.
Using the 'standard' SHA256 implementation
Default data directory /home/ubuntu/.bitcoin
Using data directory /lotsofspace/.bitcoin
Using config file /home/ubuntu/.bitcoin/bitcoin.conf
Using at most 125 automatic connections (1048576 file descriptors available)
Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements
Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements
Using 2 threads for script verification
HTTP: creating work queue of depth 16
No rpcpassword set - using random cookie authentication
Generated RPC authentication cookie /lotsofspace/.bitcoin/.cookie
HTTP: starting 4 worker threads
init message: Verifying wallet(s)...
Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)
Using wallet wallet.dat
CDBEnv::Open: LogDir=/lotsofspace/.bitcoin/database ErrorFile=/lotsofspace/.bitcoin/db.log
scheduler thread start
Cache configuration:
* Using 250.0MiB for block index database
* Using 8.0MiB for chain state database
* Using 1742.0MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)
init message: Loading block index...
Opening LevelDB in /lotsofspace/.bitcoin/blocks/index
Opened LevelDB successfully

[... plus de messages de démarrage ...]</pre>
</div>
</div>
<div class="paragraph data-line-384">
<p>Vous pouvez appuyer sur Ctrl-C pour interrompre le processus une fois que vous êtes convaincu qu&#8217;il charge les paramètres correctement et s&#8217;exécute comme prévu.</p>
</div>
<div class="paragraph data-line-386">
<p>Pour exécuter Bitcoin Core en arrière-plan en tant que processus, démarrez-le avec l&#8217;option daemon, en tant que bitcoind -daemon.</p>
</div>
<div class="paragraph data-line-388">
<p>Pour surveiller la progression et l&#8217;état d&#8217;exécution de votre nœud Bitcoin, utilisez la commande bitcoin-cli getblockchaininfo :</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>$ bitcoin-cli getblockchaininfo</pre>
</div>
</div>
<div class="listingblock data-line-395">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "chain": "main",
  "blocks": 0,
  "headers": 83999,
  "bestblockhash": "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
  "difficulty": 1,
  "mediantime": 1231006505,
  "verificationprogress": 3.783041623201835e-09,
  "chainwork": "0000000000000000000000000000000000000000000000000000000100010001",
  "pruned": false,
  [...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-410">
<p>Cela montre un nœud avec une hauteur de chaîne de blocs de 0 blocs et 83999 en-têtes. Le nœud récupère actuellement les en-têtes de bloc de la meilleure chaîne et continue ensuite à télécharger les blocs complets.</p>
</div>
<div class="paragraph data-line-412">
<p>Une fois que vous êtes satisfait des options de configuration que vous avez sélectionnées, vous devez ajouter <em>bitcoin</em> aux scripts de démarrage de votre système d&#8217;exploitation, afin qu&#8217;il s&#8217;exécute en continu et au redémarrage du système d&#8217;exploitation. Vous trouverez un certain nombre d&#8217;exemples de scripts de démarrage pour différents systèmes d&#8217;exploitation dans le répertoire source de bitcoin sous <em>contrib/init</em> et un fichier <em>README.md</em> indiquant quel système utilise quel script.("", startref="BNcore03")</p>
</div>
</div>
</div>
<div class="sect2 data-line-414">
<h3 id="_interface_de_programmation_dapplication_api_de_base_bitcoin">Interface de programmation d&#8217;application (API) de base Bitcoin</h3>
<div class="paragraph data-line-416">
<p>Le client Bitcoin Core implémente une interface JSON-RPC accessible également à l&#8217;aide de l&#8217;assistant de ligne de commande bitcoin-cli. La ligne de commande nous permet d&#8217;expérimenter de manière interactive les fonctionnalités qui sont également disponibles par programmation via l&#8217;API. Pour commencer, appelez la commande <code>help</code> pour voir une liste des commandes RPC bitcoin disponibles :</p>
</div>
<div id="bitcoind_commands" class="listingblock data-line-420">
<div class="content">
<pre>$ bitcoin-cli help
addmultisigaddress nrequired ["key",...] ( "account" )
addnode "node" "add|remove|onetry"
backupwallet "destination"
createmultisig nrequired ["key",...]
createrawtransaction [{"txid":"id","vout":n},...] {"address":amount,...}
decoderawtransaction "hexstring"
...
...
verifymessage "bitcoinaddress" "signature" "message"
walletlock
walletpassphrase "passphrase" timeout
walletpassphrasechange "oldpassphrase" "newpassphrase"</pre>
</div>
</div>
<div class="paragraph data-line-436">
<p>Chacune de ces commandes peut prendre un certain nombre de paramètres. Pour obtenir une aide supplémentaire, une description détaillée et des informations sur les paramètres, ajoutez le nom de la commande après help. Par exemple, pour voir l&#8217;aide sur la commande <code>getblockhash</code> RPC :</p>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre>$ bitcoin-cli help getblockhash
getblockhash height

Returns hash of block in best-block-chain at height provided.

Arguments:
1. height         (numeric, required) The height index

Result:
"hash"         (string) The block hash

Examples:
&gt; bitcoin-cli getblockhash 1000
&gt; curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockhash", "params": [1000] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-455">
<p>À la fin des informations d&#8217;aide, vous verrez deux exemples de la commande RPC, utilisant l&#8217;assistant <code>bitcoin-cli</code> ou le client HTTP curl. Ces exemples montrent comment vous pouvez appeler la commande. Copiez le premier exemple et voyez le résultat :</p>
</div>
<div class="listingblock data-line-457">
<div class="content">
<pre>$ bitcoin-cli getblockhash 1000
00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09</pre>
</div>
</div>
<div class="paragraph data-line-462">
<p>Le résultat est un hachage de bloc, qui est décrit plus en détail dans les chapitres suivants. Mais pour l&#8217;instant, cette commande devrait renvoyer le même résultat sur votre système, démontrant que votre nœud Bitcoin Core est en cours d&#8217;exécution, accepte les commandes et dispose d&#8217;informations sur le bloc 1000 à vous renvoyer.</p>
</div>
<div class="paragraph data-line-464">
<p>Dans les sections suivantes, nous allons démontrer quelques commandes RPC très utiles et leur sortie attendue.</p>
</div>
<div class="sect3 data-line-466">
<h4 id="_obtenir_des_informations_sur_létat_du_client_bitcoin_core">Obtenir des informations sur l&#8217;état du client Bitcoin Core</h4>
<div class="paragraph data-line-468">
<p>Bitcoin Core fournit des rapports d&#8217;état sur différents modules via l&#8217;interface JSON-RPC. Les commandes les plus importantes incluent getblockchaininfo, getmempoolinfo, <code>getnetworkinfo</code> et getwalletinfo.</p>
</div>
<div class="paragraph data-line-470">
<p>La commande <code>getblockchaininfo</code> RPC de Bitcoin a été introduite plus tôt. La commande <code>getnetworkinfo</code> affiche des informations de base sur l&#8217;état du nœud de réseau Bitcoin. Utilisez <code>bitcoin-cli</code> pour l&#8217;exécuter :</p>
</div>
<div class="listingblock data-line-472">
<div class="content">
<pre>$ bitcoin-cli getnetworkinfo</pre>
</div>
</div>
<div class="listingblock data-line-476">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">  "version": 150000,
  "subversion": "/Satoshi:0.15.0/",
  "protocolversion": 70015,
  "localservices": "000000000000000d",
  "localrelay": true,
  "timeoffset": 0,
  "networkactive": true,
  "connections": 8,
  "networks": [
    ...
    des informations détaillées sur tous les réseaux (ipv4, ipv6 ou onion)
    ...
  ],
  "relayfee": 0.00001000,
  "incrementalfee": 0.00001000,
  "localaddresses": [
  ],
  "warnings": ""
}</code></pre>
</div>
</div>
<div class="paragraph data-line-499">
<p>Les données sont renvoyées en JavaScript Object Notation (JSON), un format qui peut facilement être "consommé" par tous les langages de programmation mais qui est également assez lisible par l&#8217;homme. Parmi ces données, nous voyons les numéros de version du client logiciel bitcoin (150000) et du protocole Bitcoin (70015). On y voit le nombre actuel de connexions (8) et diverses informations sur le réseau Bitcoin et les paramètres liés à ce client.</p>
</div>
<div class="admonitionblock tip data-line-502">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-503">
<p>Il faudra un certain temps, peut-être plus d&#8217;une journée, pour que le client <code>bitcoind</code> "rattrape" la hauteur actuelle de la chaîne de blocs lorsqu&#8217;il télécharge des blocs d&#8217;autres clients Bitcoin. Vous pouvez vérifier sa progression en utilisant <code>getblockchaininfo</code> pour voir le nombre de blocs connus.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-507">
<h4 id="exploring_and_decoding_transanctions">Explorer et décoder les transactions</h4>
<div class="paragraph data-line-509">
<p>Commandes : getrawtransaction, decoderawtransaction</p>
</div>
<div class="paragraph data-line-513">
<p>Dans <a href="#cup_of_coffee">Acheter une tasse de café</a>, Alice a acheté une tasse de café au Bob&#8217;s Cafe. Sa transaction a été enregistrée sur la chaîne de blocs avec l&#8217;identifiant de transaction (txid) 0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2. Utilisons l&#8217;API pour récupérer et examiner cette transaction en transmettant l&#8217;identifiant de transaction en tant que paramètre :</p>
</div>
<div class="listingblock data-line-515">
<div class="content">
<pre>$ bitcoin-cli getrawtransaction 0627052b6f28912f2703066a912ea577f2ce4da4caa5a&amp;#x21b5;
5fbd8a57286c345c2f2

0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd734d2804fe65fa35779000&amp;#x21b5;
000008b483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4&amp;#x21b5;
ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813014&amp;#x21b5;
10484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc54123363767&amp;#x21b5;
89d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adfffffffff0260e3160000000&amp;#x21b5;
0001976a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef8000000000001976a9&amp;#x21b5;
147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000000</pre>
</div>
</div>
<div class="admonitionblock tip data-line-529">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-530">
<p>Un identifiant de transaction ne fait pas autorité tant qu&#8217;une transaction n&#8217;a pas été confirmée. L&#8217;absence d&#8217;un hachage de transaction dans la chaîne de blocs ne signifie pas que la transaction n&#8217;a pas été traitée. C&#8217;est ce qu&#8217;on appelle la "malléabilité des transactions", car les hachages de transaction peuvent être modifiés avant la confirmation dans un bloc. Après confirmation, le <code>txid</code> est immuable et fait autorité.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-533">
<p>La commande <code>getrawtransaction</code> renvoie une transaction sérialisée en notation hexadécimale. Pour décoder cela, nous utilisons la commande decoderawtransaction, en passant les données hexadécimales en paramètre. Vous pouvez copier l&#8217;hex renvoyé par <code>getrawtransaction</code> et le coller en tant que paramètre dans decoderawtransaction :</p>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre>$ bitcoin-cli decoderawtransaction 0100000001186f9f998a5aa6f048e51dd8419a14d8&amp;#x21b5;
a0f1a8a2836dd734d2804fe65fa35779000000008b483045022100884d142d86652a3f47ba474&amp;#x21b5;
6ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298&amp;#x21b5;
cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fd&amp;#x21b5;
e0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa&amp;#x21b5;
336a8d752adfffffffff0260e31600000000001976a914ab68025513c3dbd2f7b92a94e0581f5&amp;#x21b5;
d50f654e788acd0ef8000000000001976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8&amp;#x21b5;
88ac00000000</pre>
</div>
</div>
<div class="listingblock data-line-546">
<div class="content">
<pre>{
  "txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
  "size": 258,
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2...8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig": {
        "asm":"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1decc...",
        "hex":"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1de..."
      },
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 ab68...5f654e7 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
        ]
      }
    },
    {
      "value": 0.08450000,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 7f9b1a...025a8 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK"
        ]
      }
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph data-line-594">
<p>Le décodage de la transaction montre tous les composants de cette transaction, y compris les entrées et les sorties de la transaction. Dans ce cas, nous voyons que la transaction qui a crédité notre nouvelle adresse de 15 millibits a utilisé une entrée et généré deux sorties. L&#8217;entrée de cette transaction était la sortie d&#8217;une transaction précédemment confirmée (indiquée par <code>txid</code> commençant par 7957a35fe). Les deux sorties correspondent au crédit de 15 millibits et une sortie avec retour à l&#8217;expéditeur.</p>
</div>
<div class="paragraph data-line-596">
<p>Nous pouvons explorer davantage la chaîne de blocs en examinant la transaction précédente référencée par son <code>txid</code> dans cette transaction en utilisant les mêmes commandes (par exemple, getrawtransaction). En sautant d&#8217;une transaction à l&#8217;autre, nous pouvons suivre une chaîne de transactions à mesure que les pièces sont transmises d&#8217;adresse de propriétaire à adresse de propriétaire.</p>
</div>
</div>
<div class="sect3 data-line-600">
<h4 id="_explorer_les_blocs">Explorer les blocs</h4>
<div class="paragraph data-line-602">
<p>Commandes : getblock, getblockhash</p>
</div>
<div class="paragraph data-line-604">
<p>L&#8217;exploration de blocs est similaire à l&#8217;exploration de transactions. Cependant, les blocs peuvent être référencés soit par la <em>hauteur</em> du bloc (<em>height</em>), soit par le résultat de <em>hachage</em> (ou <em>hash</em>) du bloc. Tout d&#8217;abord, trouvons un bloc par sa hauteur. Dans <a href="#cup_of_coffee">Acheter une tasse de café</a>, nous avons vu que la transaction d&#8217;Alice était incluse dans le bloc 277316.</p>
</div>
<div class="paragraph data-line-606">
<p>Nous utilisons la commande getblockhash, qui prend la hauteur du bloc comme paramètre et renvoie le hachage pour ce bloc :</p>
</div>
<div class="listingblock data-line-608">
<div class="content">
<pre>$ bitcoin-cli getblockhash 277316
0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</pre>
</div>
</div>
<div class="paragraph data-line-613">
<p>Maintenant que nous savons dans quel bloc la transaction d&#8217;Alice était incluse, nous pouvons interroger ce bloc. Nous utilisons la commande <code>getblock</code> avec le hachage de bloc comme paramètre :</p>
</div>
<div class="listingblock data-line-615">
<div class="content">
<pre>$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b3&amp;#x21b5;
1b2cc7bdc4</pre>
</div>
</div>
<div class="listingblock data-line-620">
<div class="content">
<pre>{
  "hash": "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
  "confirmations": 37371,
  "size": 218629,
  "height": 277316,
  "version": 2,
  "merkleroot": "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
  "tx": [
    "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",
    "04905ff987ddd4cfe603b03cfb7ca50ee81d89d1f8f5f265c38f763eea4a21fd",
    "32467aab5d04f51940075055c2f20bbd1195727c961431bf0aff8443f9710f81",
    "561c5216944e21fa29dd12aaa1a45e3397f9c0d888359cb05e1f79fe73da37bd",
[... des centaines de transactions ...]
    "78b300b2a1d2d9449b58db7bc71c3884d6e0579617e0da4991b9734cef7ab23a",
    "6c87130ec283ab4c2c493b190c20de4b28ff3caf72d16ffa1ce3e96f2069aca9",
    "6f423dbc3636ef193fd8898dfdf7621dcade1bbe509e963ffbff91f696d81a62",
    "802ba8b2adabc5796a9471f25b02ae6aeee2439c679a5c33c4bbcee97e081196",
    "eaaf6a048588d9ad4d1c092539bd571dd8af30635c152a3b0e8b611e67d1a1af",
    "e67abc6bd5e2cac169821afc51b207127f42b92a841e976f9b752157879ba8bd",
    "d38985a6a1bfd35037cb7776b2dc86797abbb7a06630f5d03df2785d50d5a2ac",
    "45ea0a3f6016d2bb90ab92c34a7aac9767671a8a84b9bcce6c019e60197c134b",
    "c098445d748ced5f178ef2ff96f2758cbec9eb32cb0fc65db313bcac1d3bc98f"
  ],
  "time": 1388185914,
  "mediantime": 1388183675,
  "nonce": 924591752,
  "bits": "1903a30c",
  "difficulty": 1180923195.258026,
  "chainwork": "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
  "previousblockhash": "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569",
  "nextblockhash": "000000000000000010236c269dd6ed714dd5db39d36b33959079d78dfd431ba7"
}</pre>
</div>
</div>
<div class="paragraph data-line-656">
<p>Le bloc contient 419 transactions et la 64ème transaction répertoriée (0627052b...) est le paiement du café d&#8217;Alice. L&#8217;entrée ` hauteur ` nous indique qu&#8217;il s&#8217;agit du 277316e bloc de la chaîne de blocs.</p>
</div>
</div>
<div class="sect3 data-line-658">
<h4 id="_utilisation_de_linterface_de_programmation_de_bitcoin_core">Utilisation de l&#8217;interface de programmation de Bitcoin Core</h4>
<div class="paragraph data-line-660">
<p>L&#8217;assistant <code>bitcoin-cli</code> est très utile pour explorer la bibliothèue (API) Bitcoin Core et les fonctions de test. Mais tout l&#8217;intérêt d&#8217;une interface de programmation d&#8217;application est d&#8217;accéder aux fonctions par programmation. Dans cette section, nous montrerons comment accéder à Bitcoin Core à partir d&#8217;un autre programme.</p>
</div>
<div class="paragraph data-line-662">
<p>L&#8217;API de Bitcoin Core est une interface JSON-RPC. JSON signifie JavaScript Object Notation et c&#8217;est un moyen très pratique de présenter des données que les humains et les programmes peuvent facilement lire. RPC signifie Remote Procedure Call (ou appel de procédure à distance), ce qui signifie que nous appelons des procédures (fonctions) distantes (sur le nœud Bitcoin Core) via un protocole réseau. Dans ce cas, le protocole réseau est HTTP ou HTTPS (pour les connexions cryptées).</p>
</div>
<div class="paragraph data-line-664">
<p>Lorsque nous avons utilisé la commande <code>bitcoin-cli</code> pour obtenir de l&#8217;aide sur une commande, elle nous a montré un exemple d&#8217;utilisation de curl, le client HTTP polyvalent en ligne de commande pour construire l&#8217;un de ces appels JSON-RPC :</p>
</div>
<div class="listingblock data-line-666">
<div class="content">
<pre>$ curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockchaininfo", "params": [] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-670">
<p>Cette commande montre que <code>curl</code> soumet une requête HTTP à l&#8217;hôte local (127.0.0.1), se connecte au port bitcoin par défaut (8332) et soumet une requête <code>jsonrpc</code> pour la méthode <code>getblockchaininfo</code> en utilisant l&#8217;encodage text/plain.</p>
</div>
<div class="paragraph data-line-672">
<p>Vous remarquerez peut-être que curl demandera que les informations d&#8217;identification soient envoyées avec la demande. Bitcoin Core créera un mot de passe aléatoire à chaque démarrage et le placera dans le répertoire de données sous le nom .cookie. L&#8217;assistant <code>bitcoin-cli</code> peut lire ce fichier de mots de passe étant donné le répertoire de données. De même, vous pouvez copier le mot de passe et le transmettre à curl (ou à tout wrapper Bitcoin Core RPC de niveau supérieur). Alternativement, vous pouvez créer un mot de passe statique avec le script d&#8217;assistance fourni dans <em>./share/rpcauth/rpcauth.py</em> dans le répertoire source de Bitcoin Core.</p>
</div>
<div class="paragraph data-line-674">
<p>Si vous implémentez un appel JSON-RPC dans votre propre programme, vous pouvez utiliser une bibliothèque HTTP générique pour construire l&#8217;appel, similaire à ce qui est montré dans l&#8217;exemple <code>curl</code> précédent.</p>
</div>
<div class="paragraph data-line-676">
<p>Cependant, il existe des bibliothèques dans la plupart des langages de programmation qui "enveloppent" l&#8217;API Bitcoin Core d&#8217;une manière qui rend cela beaucoup plus simple. Nous utiliserons la bibliothèque <code>python-bitcoinlib</code> pour simplifier l&#8217;accès à l&#8217;API. N&#8217;oubliez pas que cela nécessite que vous disposiez d&#8217;une instance Bitcoin Core en cours d&#8217;exécution, qui sera utilisée pour effectuer des appels JSON-RPC.</p>
</div>
<div class="paragraph data-line-678">
<p>Le script Python dans <a href="#rpc_example">Exécution de getblockchaininfo via l&#8217;API JSON-RPC de Bitcoin Core</a> effectue un simple appel <code>getblockchaininfo</code> et imprime le paramètre <code>blocks</code> à partir des données renvoyées par Bitcoin Core (nœud complet requis).</p>
</div>
<div id="rpc_example" class="exampleblock data-line-682">
<div class="title">Example 5. Exécution de getblockchaininfo via l&#8217;API JSON-RPC de Bitcoin Core</div>
<div class="content">
<div class="listingblock data-line-684">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from bitcoin.rpc import RawProxy

# Créer une connexion au nœud local Bitcoin Core
p = RawProxy()

# Exécutez la commande getinfo, stockez les données résultantes dans info
info = p.getinfo()

# Récupérer l'élément 'blocks' de l'info
print(info['blocks'])</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-689">
<p>Son exécution nous donne le résultat suivant:</p>
</div>
<div class="listingblock data-line-691">
<div class="content">
<pre>$ python rpc_example.py
394075</pre>
</div>
</div>
<div class="paragraph data-line-696">
<p>Il nous indique que notre nœud local Bitcoin Core a 394075 blocs dans sa chaîne de blocs. Ce n&#8217;est pas un résultat spectaculaire, mais cela démontre l&#8217;utilisation de base de la bibliothèque en tant qu&#8217;interface simplifiée avec l&#8217;API JSON-RPC de Bitcoin Core.</p>
</div>
<div class="paragraph data-line-698">
<p>Ensuite, utilisons les appels <code>getrawtransaction</code> et <code>decodetransaction</code> pour récupérer les détails du paiement du café d&#8217;Alice. Dans <a href="#rpc_transaction">Récupérer une transaction et itérer ses sorties</a>, nous récupérons la transaction d&#8217;Alice et listons les sorties de la transaction. Pour chaque sortie, nous affichons l&#8217;adresse et la valeur du destinataire. Pour rappel, la transaction d&#8217;Alice avait une sortie pour payer Bob&#8217;s Cafe et une sortie pour rendre la monnaie à Alice.</p>
</div>
<div id="rpc_transaction" class="exampleblock data-line-702">
<div class="title">Example 6. Récupérer une transaction et itérer ses sorties</div>
<div class="content">
<div class="listingblock data-line-704">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from bitcoin.rpc import RawProxy

p = RawProxy()

# ID de transaction d'Alice
txid = "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2"

# Tout d'abord, récupérez la transaction brute en hexadécimal
raw_tx = p.getrawtransaction(txid)

# Décodez l'hex de transaction en un objet JSON
decoded_tx = p.decoderawtransaction(raw_tx)

# Récupérer chacune des sorties de la transaction
for output in decoded_tx['vout']:
    print(output['scriptPubKey']['addresses'], output['value'])</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-709">
<p>En exécutant ce code, nous obtenons :</p>
</div>
<div class="listingblock data-line-711">
<div class="content">
<pre>$ python rpc_transaction.py
([u'1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA'], Decimal('0.01500000'))
([u'1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK'], Decimal('0.08450000'))</pre>
</div>
</div>
<div class="paragraph data-line-717">
<p>Les deux exemples précédents sont assez simples. Vous n&#8217;avez pas vraiment besoin d&#8217;un programme pour les exécuter ; vous pouvez tout aussi bien utiliser l&#8217;assistant bitcoin-cli. L&#8217;exemple suivant, cependant, nécessite plusieurs centaines d&#8217;appels RPC et démontre plus clairement l&#8217;utilisation d&#8217;une interface de programmation.</p>
</div>
<div class="paragraph data-line-719">
<p>Dans <a href="#rpc_block">Récupération d&#8217;un bloc et ajout de toutes les sorties de transaction</a>, nous récupérons d&#8217;abord le bloc 277316, puis récupérons chacune des 419 transactions en référence à chaque identifiant de transaction. Ensuite, nous parcourons chacune des sorties de la transaction et additionnons la valeur.</p>
</div>
<div id="rpc_block" class="exampleblock data-line-723">
<div class="title">Example 7. Récupération d&#8217;un bloc et ajout de toutes les sorties de transaction</div>
<div class="content">
<div class="listingblock data-line-725">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from bitcoin.rpc import RawProxy

p = RawProxy()

# La hauteur du bloc où la transaction d'Alice a été enregistrée
blockheight = 277316

# Obtenez le hachage de bloc du bloc de hauteur 277316
blockhash = p.getblockhash(blockheight)

# Récupérer le bloc par son hachage
block = p.getblock(blockhash)

# L'élément tx contient la liste de tous les ID de transaction dans le bloc
transactions = block['tx']

block_value = 0

# Itérer à travers chaque ID de transaction dans le bloc
for txid in transactions:
    tx_value = 0
    # Récupérer la transaction brute par ID
    raw_tx = p.getrawtransaction(txid)
    # Décoder la transaction
    decoded_tx = p.decoderawtransaction(raw_tx)
    # Itérer à travers chaque sortie de la transaction
    for output in decoded_tx['vout']:
        # Additionnez la valeur de chaque sortie
        tx_value = tx_value + output['value']

    # Ajouter la valeur de cette transaction au total
    block_value = block_value + tx_value

print("Total value in block: ", block_value)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-730">
<p>En exécutant ce code, nous obtenons :</p>
</div>
<div class="listingblock data-line-732">
<div class="content">
<pre>$ python rpc_block.py

('Total value in block: ', Decimal('10322.07722534'))</pre>
</div>
</div>
<div class="paragraph data-line-738">
<p>Notre exemple de code calcule que la valeur totale des transactions dans ce bloc est de 10 322,07722534 BTC (dont 25 BTC de récompense et 0,0909 BTC de frais). Comparez cela au montant rapporté par un site d&#8217;exploration de blocs en recherchant le hachage ou la hauteur du bloc. Certains explorateurs de blocs rapportent la valeur totale hors récompense et hors frais. Voyez si vous pouvez repérer la différence.</p>
</div>
</div>
</div>
<div class="sect2 data-line-741">
<h3 id="alt_libraries">Clients, bibliothèques et boîtes à outils alternatifs</h3>
<div class="paragraph data-line-743">
<p> Il existe de nombreux clients alternatifs, bibliothèques, boîtes à outils et même des implémentations de nœuds complets dans l&#8217;écosystème bitcoin. Ceux-ci sont implémentés dans une variété de langages de programmation, offrant aux programmeurs des interfaces natives dans leur langue préférée.</p>
</div>
<div class="paragraph data-line-745">
<p>Les sections suivantes répertorient certaines des meilleures bibliothèques, clients et kits d&#8217;outils, organisés par langages de programmation.</p>
</div>
<div class="sect3 data-line-747">
<h4 id="_cc">C/C++</h4>
<div class="dlist data-line-748">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bitcoin" data-href="https://github.com/bitcoin/bitcoin">Bitcoin Core</a></dt>
<dd>
<p>L&#8217;implémentation de référence de bitcoin</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin-system" data-href="https://github.com/libbitcoin/libbitcoin-system">libbitcoin</a></dt>
<dd>
<p>Boîte à outils de développement C++ multiplateforme, nœud et bibliothèque de consensus</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">bitcoin explorer</a></dt>
<dd>
<p>L&#8217;outil de ligne de commande de Libbitcoin</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/jgarzik/picocoin" data-href="https://github.com/jgarzik/picocoin">picocoin</a></dt>
<dd>
<p>Bibliothèque cliente légère en langage C pour bitcoin par Jeff Garzik</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-753">
<h4 id="_javascript">JavaScript</h4>
<div class="dlist data-line-754">
<dl>
<dt class="hdlist1"><a href="https://bcoin.io/" data-href="https://bcoin.io/">bcoin</a></dt>
<dd>
<p>Une implémentation modulaire et évolutive de nœud complet avec API</p>
</dd>
<dt class="hdlist1"><a href="https://bitcore.io/" data-href="https://bitcore.io/">Bitcore</a></dt>
<dd>
<p>Nœud complet, API et bibliothèque par Bitpay</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoinjs/bitcoinjs-lib" data-href="https://github.com/bitcoinjs/bitcoinjs-lib">BitcoinJS</a></dt>
<dd>
<p>Une pure bibliothèque Bitcoin en JavaScript pour node.js et les navigateurs</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-758">
<h4 id="_java">Java</h4>
<div class="dlist data-line-759">
<dl>
<dt class="hdlist1"><a href="https://bitcoinj.github.io" data-href="https://bitcoinj.github.io">bitcoinj</a> </dt>
<dd>
<p>Une bibliothèque client Java à nœud complet</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-761">
<h4 id="_php">PHP</h4>
<div class="dlist data-line-762">
<dl>
<dt class="hdlist1"><a href="https://github.com/bit-wasp/bitcoin-php" data-href="https://github.com/bit-wasp/bitcoin-php">bitwasp/bitcoin</a></dt>
<dd>
<p>Une bibliothèque Bitcoin en PHP et des projets associés</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-764">
<h4 id="_python">Python</h4>
<div class="dlist data-line-765">
<dl>
<dt class="hdlist1"><a href="https://github.com/petertodd/python-bitcoinlib" data-href="https://github.com/petertodd/python-bitcoinlib">python-bitcoinlib</a></dt>
<dd>
<p>Une bibliothèque Bitcoin en Python dont une bibliothèque de consensus et un nœud par Peter Todd</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a></dt>
<dd>
<p>Une bibliothèque Bitcoin en Python par Richard Kiss</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/primal100/pybitcointools" data-href="https://github.com/primal100/pybitcointools">pybitcointools</a></dt>
<dd>
<p>Une fourche archivé de la bibliothèque Bitcoin en Python par Vitalik Buterin</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-769">
<h4 id="_ruby">Ruby</h4>
<div class="dlist data-line-770">
<dl>
<dt class="hdlist1"><a href="https://github.com/sinisterchipmunk/bitcoin-client" data-href="https://github.com/sinisterchipmunk/bitcoin-client">bitcoin-client</a></dt>
<dd>
<p>Un wrapper de bibliothèque Ruby pour l&#8217;API JSON-RPC</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-772">
<h4 id="_go">Go</h4>
<div class="dlist data-line-773">
<dl>
<dt class="hdlist1"><a href="https://github.com/btcsuite/btcd" data-href="https://github.com/btcsuite/btcd">btcd</a></dt>
<dd>
<p>Un client Bitcoin à nœud complet en langage Go</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-775">
<h4 id="_rust">Rust</h4>
<div class="dlist data-line-776">
<dl>
<dt class="hdlist1"><a href="https://github.com/rust-bitcoin/rust-bitcoin" data-href="https://github.com/rust-bitcoin/rust-bitcoin">rust-bitcoin</a></dt>
<dd>
<p>Bibliothèque Bitcoin Rust pour la sérialisation, l&#8217;analyse et les appels d&#8217;API</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-778">
<h4 id="_c">C#</h4>
<div class="dlist data-line-779">
<dl>
<dt class="hdlist1"><a href="https://github.com/MetacoSA/NBitcoin" data-href="https://github.com/MetacoSA/NBitcoin">NBitcoin</a></dt>
<dd>
<p>Bibliothèque Bitcoin complète pour le framework .NET</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-781">
<h4 id="_objective_c">Objective-C</h4>
<div class="dlist data-line-782">
<dl>
<dt class="hdlist1"><a href="https://github.com/oleganza/CoreBitcoin" data-href="https://github.com/oleganza/CoreBitcoin">CoreBitcoin</a> </dt>
<dd>
<p>Boîte à outils Bitcoin pour ObjC et Swift</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-13">
<p>De nombreuses autres bibliothèques existent dans une variété d&#8217;autres langages de programmation et d&#8217;autres sont créées tout le temps.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-4">
<h2 id="ch04_keys_addresses">Clés et adresses</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-6">
<p>Vous avez peut-être entendu dire que le bitcoin est basé sur la <em>cryptographie</em>, qui est une branche des mathématiques largement utilisée en sécurité informatique. La cryptographie signifie "écriture secrète" en grec, mais la science de la cryptographie englobe plus que la simple écriture secrète, appelée cryptage. La cryptographie peut également être utilisée pour prouver la connaissance d&#8217;un secret sans révéler ce secret (signature numérique), ou prouver l&#8217;authenticité des données (empreinte numérique). Ces types de preuves cryptographiques sont les outils mathématiques essentiels au bitcoin et largement utilisés dans les applications bitcoin. Ironiquement, le cryptage n&#8217;est pas une partie importante du bitcoin, car ses communications et ses données de transaction ne sont pas cryptées et ne doivent être chiffrés pour protéger les fonds. Dans ce chapitre, nous présenterons une partie de la cryptographie utilisée dans le bitcoin pour contrôler la propriété des fonds, sous la forme de clés, d&#8217;adresses et de portefeuilles.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_présentation">Présentation</h3>
<div class="paragraph data-line-10">
<p> La propriété du bitcoin est établie par le biais de <em>clés numériques</em>, <em>adresses Bitcoin</em> et <em>signatures numériques</em>. Les clés numériques ne sont pas réellement stockées dans le réseau, mais sont plutôt créées et stockées par les utilisateurs dans un fichier, ou une simple base de données, appelée <em>wallet</em>. Les clés numériques du portefeuille d&#8217;un utilisateur sont totalement indépendantes du protocole Bitcoin et peuvent être générées et gérées par le logiciel du portefeuille de l&#8217;utilisateur sans référence à la chaîne de blocs ni accès à Internet. Les clés permettent de nombreuses propriétés intéressantes du bitcoin, notamment la confiance et le contrôle décentralisés, l&#8217;attestation de propriété et le modèle de sécurité à l&#8217;épreuve de la cryptographie.</p>
</div>
<div class="paragraph data-line-12">
<p>La plupart des transactions bitcoin nécessitent une signature numérique valide à inclure dans la chaîne de blocs, qui ne peut être générée qu&#8217;avec une clé secrète ; par conséquent, toute personne possédant une copie de cette clé a le contrôle du bitcoin.  La signature numérique utilisée pour dépenser des fonds est également appelée <em>témoin</em>, un terme utilisé en cryptographie. Les données témoins dans une transaction bitcoin témoignent de la véritable propriété des fonds dépensés.</p>
</div>
<div class="paragraph data-line-14">
<p>Les clés sont fournies par paires constituées d&#8217;une clé privée (secrète) et une clé publique. Considérez la clé publique comme similaire à un numéro de compte bancaire et la clé privée comme similaire au code PIN secret, ou à la signature d&#8217;un chèque, qui permet de contrôler le compte. Ces clés numériques sont très rarement vues par les utilisateurs de bitcoin. Pour la plupart, ils sont stockés dans le fichier du portefeuille et gérés par le logiciel du portefeuille bitcoin.</p>
</div>
<div class="paragraph data-line-16">
<p>Dans la partie paiement d&#8217;une transaction bitcoin, la clé publique du destinataire est représentée par son empreinte numérique, appelée <em>adresse Bitcoin</em>, qui est utilisée de la même manière que le nom du bénéficiaire sur un chèque (c&#8217;est-à-dire "Payer à l&#8217;ordre de") . Dans la plupart des cas, une adresse Bitcoin correspond et est générée à partir d&#8217;une clé publique. Cependant, toutes les adresses Bitcoin ne représentent pas des clés publiques ; ils peuvent également représenter d&#8217;autres bénéficiaires tels que des scripts, comme nous le verrons plus loin dans ce chapitre. De cette manière, les adresses Bitcoin font abstraction du destinataire des fonds, ce qui rend les destinations de transaction flexibles, similaires aux chèques papier : un instrument de paiement unique qui peut être utilisé pour payer les comptes des personnes, payer les comptes de l&#8217;entreprise, payer des factures ou payer en espèces. L&#8217;adresse Bitcoin est la seule représentation des clés que les utilisateurs verront régulièrement, car c&#8217;est la partie qu&#8217;ils doivent partager avec le monde.</p>
</div>
<div class="paragraph data-line-18">
<p>Tout d&#8217;abord, nous présenterons la cryptographie et expliquerons les mathématiques utilisées dans le bitcoin. Ensuite, nous verrons comment les clés sont générées, stockées et gérées. Nous passerons en revue les différents formats de codage utilisés pour représenter les clés privées et publiques, les adresses et les adresses de script. Enfin, nous nous pencherons sur l&#8217;utilisation avancée des clés et des adresses : adresses personnalisées, multisignatures, scripts et portefeuilles papier.</p>
</div>
<div class="sect3 data-line-20">
<h4 id="_cryptographie_à_clé_publique_et_cryptomonnaie">Cryptographie à clé publique et cryptomonnaie</h4>
<div class="paragraph data-line-22">
<p>La cryptographie à clé publique a été inventée dans les années 1970 et constitue une base mathématique pour informatique et sécurité de l&#8217;information.</p>
</div>
<div class="paragraph data-line-24">
<p>Depuis l&#8217;invention de la cryptographie à clé publique, plusieurs fonctions mathématiques appropriées, telles que l&#8217;exponentiation des nombres premiers et la multiplication des courbes elliptiques, ont été découvertes. Ces fonctions mathématiques sont pratiquement irréversibles, ce qui signifie qu&#8217;elles sont faciles à calculer dans un sens et impossibles à calculer dans le sens opposé. Sur la base de ces fonctions mathématiques, la cryptographie permet la création de secrets numériques et de signatures numériques infalsifiables. Bitcoin utilise la multiplication de courbes elliptiques comme base de sa cryptographie.</p>
</div>
<div class="paragraph data-line-26">
<p>En bitcoin, nous utilisons la cryptographie à clé publique pour créer une paire de clés qui contrôle l&#8217;accès au bitcoin. La paire de clés se compose d&#8217;une clé privée et - dérivée de celle-ci - d&#8217;une clé publique unique. La clé publique est utilisée pour recevoir des fonds et la clé privée est utilisée pour signer des transactions afin de dépenser les fonds.</p>
</div>
<div class="paragraph data-line-28">
<p>Il existe une relation mathématique entre la clé publique et la clé privée qui permet d&#8217;utiliser la clé privée pour générer des signatures sur les messages. Ces signatures peuvent être validées par rapport à la clé publique sans révéler la clé privée.</p>
</div>
<div class="paragraph data-line-30">
<p>Lorsqu&#8217;il dépense des bitcoins, le propriétaire actuel de bitcoins présente sa clé publique et une signature (différente à chaque fois, mais créée à partir de la même clé privée) dans une transaction pour dépenser ces bitcoins. Grâce à la présentation de la clé publique et de la signature, tous les membres du réseau Bitcoin peuvent vérifier et accepter la transaction comme valide, confirmant que la personne transférant le bitcoin en était propriétaire au moment du transfert.</p>
</div>
<div class="admonitionblock tip data-line-33">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-34">
<p> Dans la plupart des implémentations de portefeuille, les clés privées et publiques sont stockées ensemble sous la forme d&#8217;une <em>paire de clés</em> pour plus de commodité. Cependant, la clé publique peut être calculée à partir de la clé privée, de sorte qu&#8217;il est également possible de ne stocker que la clé privée.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-38">
<h4 id="private_public_keys">Clés privées et publiques</h4>
<div class="paragraph data-line-40">
<p> Un portefeuille bitcoin contient une collection de paires de clés, chacune composée d&#8217;une clé privée et d&#8217;une clé publique. La clé privée (k) est un nombre, généralement choisi au hasard. A partir de la clé privée, nous utilisons la multiplication par courbe elliptique, une fonction cryptographique à sens unique, pour générer une clé publique (K). A partir de la clé publique (K), nous utilisons une fonction de hachage cryptographique unidirectionnelle pour générer une adresse Bitcoin (A). Dans cette section, nous commencerons par générer la clé privée, examinerons les mathématiques de la courbe elliptique utilisées pour la transformer en clé publique, et enfin, générerons une adresse Bitcoin à partir de la clé publique. La relation entre la clé privée, la clé publique et l&#8217;adresse Bitcoin est indiquée dans <a href="#k_to_K_to_A">Clé privée, clé publique et adresse Bitcoin</a>.</p>
</div>
<div id="k_to_K_to_A" class="imageblock data-line-44">
<div class="content">
<img src="images/mbc2_0401.png" alt="privk à pubK à adresse A">
</div>
<div class="title">Figure 14. Clé privée, clé publique et adresse Bitcoin</div>
</div>
<div class="sidebarblock data-line-47">
<div class="content">
<div class="title">Pourquoi utiliser la cryptographie asymétrique (clés publiques/privées) ?</div>
<div class="paragraph data-line-48">
<p>Pourquoi la cryptographie asymétrique est-elle utilisée dans le bitcoin ? Elle n&#8217;est pas utilisée pour "crypter" (rendre secrètes) les transactions. Au contraire, la propriété utile de la cryptographie asymétrique est la capacité à générer des <em>signatures numériques</em>. Une clé privée peut être appliquée à l&#8217;empreinte numérique d&#8217;une transaction pour produire une signature numérique. Cette signature ne peut être produite que par une personne connaissant la clé privée. Cependant, toute personne ayant accès à la clé publique et à l&#8217;empreinte digitale de la transaction peut les utiliser pour <em>vérifier</em> la signature. Cette propriété utile de la cryptographie asymétrique permet à quiconque de vérifier chaque signature sur chaque transaction, tout en garantissant que seuls les propriétaires de clés privées peuvent produire des signatures valides.</p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-52">
<h4 id="private_keys">Clés privées</h4>
<div class="paragraph data-line-54">
<p>Une clé privée est simplement un nombre, choisi au hasard . La propriété et le contrôle de la clé privée sont à la base du contrôle de l&#8217;utilisateur sur tous les fonds associés à l&#8217;adresse Bitcoin correspondante. La clé privée est utilisée pour créer des signatures nécessaires pour dépenser des bitcoins en prouvant la propriété des fonds utilisés dans une transaction. La clé privée doit rester secrète à tout moment, car la révéler à des tiers équivaut à leur donner le contrôle sur le bitcoin sécurisé par cette clé. La clé privée doit également être sauvegardée et protégée contre toute perte accidentelle, car si elle est perdue, elle ne peut pas être récupérée et les fonds qu&#8217;elle garantit sont également perdus à jamais.</p>
</div>
<div class="admonitionblock tip data-line-57">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-58">
<p>La clé privée bitcoin n&#8217;est qu&#8217;un nombre. Vous pouvez choisir vos clés privées au hasard en utilisant simplement une pièce de monnaie, un crayon et du papier : lancez une pièce 256 fois et vous avez les chiffres binaires d&#8217;une clé privée aléatoire que vous pouvez utiliser dans un portefeuille bitcoin. La clé publique peut alors être générée à partir de la clé privée.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-61">
<h5 id="_générer_une_clé_privée_à_partir_dun_nombre_aléatoire">Générer une clé privée à partir d&#8217;un nombre aléatoire</h5>
<div class="paragraph data-line-63">
<p>La première et la plus importante étape de la génération de clés consiste à trouver une source sécurisée d&#8217;entropie ou de caractère aléatoire. La création d&#8217;une clé bitcoin est essentiellement la même que "Choisissez un nombre entre 1 et 2<sup>256</sup>". La méthode exacte que vous utilisez pour choisir ce nombre n&#8217;a pas d&#8217;importance tant qu&#8217;elle n&#8217;est pas prévisible ou reproductible. Le logiciel Bitcoin utilise les générateurs de nombres aléatoires du système d&#8217;exploitation sous-jacent pour produire 256 bits d&#8217;entropie (aléatoire). Habituellement, le générateur de nombres aléatoires du système d&#8217;exploitation est initialisé par une source humaine d&#8217;aléatoire, c&#8217;est pourquoi il peut vous être demandé de remuer votre souris pendant quelques secondes.</p>
</div>
<div class="paragraph data-line-65">
<p>Plus précisément, la clé privée peut être n&#8217;importe quel nombre compris entre <code>0</code> et <code>n - 1</code> inclus, où n est une constante (n = 1,1578 * 10<sup>77</sup>, légèrement inférieure à 2<sup>256</sup>) définie comme l&#8217;ordre de la courbe elliptique utilisée dans le bitcoin (voir <a href="#elliptic_curve">La cryptographie à courbe elliptique expliquée</a>). Pour créer une telle clé, nous choisissons au hasard un nombre de 256 bits et vérifions qu&#8217;il est inférieur à n. En termes de programmation, cela est généralement réalisé en alimentant une plus grande chaîne de bits aléatoires, collectés à partir d&#8217;une source aléatoire sécurisée par cryptographie, dans l&#8217;algorithme de hachage SHA256, qui produira commodément un nombre de 256 bits. Si le résultat est inférieur à n, nous avons une clé privée appropriée. Sinon, nous réessayons simplement avec un autre nombre aléatoire.</p>
</div>
<div class="admonitionblock warning data-line-68">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-69">
<p>N&#8217;écrivez pas votre propre code pour créer un nombre aléatoire ou n&#8217;utilisez pas un nombre aléatoire "simple" généré par votre langage de programmation. Utilisez un générateur de nombres pseudo-aléatoires cryptographiquement sécurisé (CSPRNG) avec une valeur d&#8217;amorçage provenant d&#8217;une source d&#8217;entropie suffisante. Étudiez la documentation de la bibliothèque de générateurs de nombres aléatoires que vous choisissez pour vous assurer qu&#8217;elle est cryptographiquement sécurisée. La mise en œuvre correcte du CSPRNG est essentielle à la sécurité des clés.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-72">
<p>Ce qui suit est une clé privée générée aléatoirement (k) affichée au format hexadécimal (256 bits affichés sous la forme de 64 chiffres hexadécimaux, chacun de 4 bits) :</p>
</div>
<div class="listingblock data-line-74">
<div class="content">
<pre>1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</pre>
</div>
</div>
<div class="admonitionblock tip data-line-80">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-81">
<p>La taille de l&#8217;espace de clé privée de bitcoin, (2<sup>256</sup>) est un nombre insondable. Il est d&#8217;environ 10<sup>77</sup> en décimal. À titre de comparaison, on estime que l&#8217;univers visible contient 10<sup>80</sup> atomes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-84">
<p>Pour générer une nouvelle clé avec le client Bitcoin Core (voir <a href="#ch03_bitcoin_client">Bitcoin Core : La référence d&#8217;implémentation</a>), utilisez la commande getnewaddress. Pour des raisons de sécurité, il affiche uniquement l&#8217;adresse, pas la clé privée. Pour demander à <code>bitcoind</code> d&#8217;exposer la clé privée, utilisez la commande dumpprivkey. La commande <code>dumpprivkey</code> affiche la clé privée dans un format de somme de contrôle Base58 appelé <em>Wallet Import Format</em> (WIF ou format d&#8217;importation de portefeuille), que nous examinerons plus en détail dans <a href="#priv_formats">Formats de clé privée</a>. Voici un exemple de génération et d&#8217;affichage d&#8217;une clé privée à l&#8217;aide de ces deux commandes :</p>
</div>
<div class="listingblock data-line-86">
<div class="content">
<pre>$ bitcoin-cli getnewaddress
1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
$ bitcoin-cli dumpprivkey 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-93">
<p>La commande <code>dumpprivkey</code> ouvre le portefeuille et extrait la clé privée qui a été générée par la commande getnewaddress. Il n&#8217;est pas possible pour <code>bitcoind</code> de connaître la clé privée à partir de l&#8217;adresse à moins qu&#8217;elles ne soient toutes deux stockées dans le portefeuille.</p>
</div>
<div class="admonitionblock tip data-line-96">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-97">
<p>La commande <code>dumpprivkey</code> ne génère pas de clé privée à partir d&#8217;une adresse, car cela est impossible. La commande révèle simplement la clé privée qui est déjà connue du portefeuille et qui a été générée par la commande getnewaddress.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph pagebreak-before data-line-101">
<p>Vous pouvez également utiliser l&#8217;outil de ligne de commande Bitcoin Explorer (voir <a href="#appdx_bx">Commandes de l&#8217;explorateur Bitcoin (bx)</a>) pour générer et afficher des clés privées avec les commandes seed, <code>ec-new</code> et ec-to-wif :</p>
</div>
<div class="listingblock data-line-103">
<div class="content">
<pre>$ bx seed | bx ec-new | bx ec-to-wif
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-109">
<h4 id="pubkey">Clés publiques</h4>
<div class="paragraph data-line-111">
<p>La clé publique est calculée à partir de la clé privée en utilisant la multiplication par courbe elliptique, qui est irréversible : <em>K</em> = <em>k</em> * <em>G</em>, où <em>k</em> est la clé privée, <em>G</em> est un point constant appelé <em>point générateur</em> et <em>K</em> est la clé publique résultante. L&#8217;opération inverse, connue sous le nom de "trouver le logarithme discret" - calculer <em>k</em> si vous connaissez <em>K</em> - est aussi difficile que d&#8217;essayer toutes les valeurs possibles de <em>k</em>, c&#8217;est-à-dire par une recherche par force brute. Avant de montrer comment générer une clé publique à partir d&#8217;une clé privée, examinons un peu plus en détail la cryptographie à courbe elliptique.</p>
</div>
<div class="admonitionblock tip data-line-114">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-115">
<p>La multiplication de courbe elliptique est un type de fonction que les cryptographes appellent une fonction « à sens unique » : elle est facile à faire dans un sens (multiplication) et impossible à faire dans le sens inverse (« division », ou trouver le logarithme discret). Le propriétaire de la clé privée peut facilement créer la clé publique, puis la partager avec le monde entier, sachant que personne ne peut inverser la fonction et calculer la clé privée à partir de la clé publique. Cette astuce mathématique devient la base de signatures numériques infalsifiables et sécurisées qui prouvent la propriété des fonds bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-119">
<h4 id="elliptic_curve">La cryptographie à courbe elliptique expliquée</h4>
<div class="paragraph data-line-121">
<p> La cryptographie à courbe elliptique est un type de cryptographie asymétrique ou à clé publique basée sur le problème du logarithme discret exprimé par addition et multiplication sur les points d&#8217;une courbe elliptique.</p>
</div>
<div class="paragraph data-line-123">
<p><a href="#ecc-curve">Une courbe elliptique</a> est un exemple de courbe elliptique, similaire à celle utilisée par le bitcoin.</p>
</div>
<div id="ecc-curve" class="imageblock smallerthirty data-line-128">
<div class="content">
<img src="images/mbc2_0402.png" alt="courbe ecc">
</div>
<div class="title">Figure 15. Une courbe elliptique</div>
</div>
<div class="paragraph data-line-130">
<p>Bitcoin utilise une courbe elliptique spécifique et un ensemble de constantes mathématiques, telles que définies dans une norme appelée secp256k1, établie par le National Institute of Standards and Technology (NIST). La courbe <code>secp256k1</code> est définie par la fonction suivante, qui produit une courbe elliptique :</p>
</div>
<div class="stemblock data-line-133">
<div class="content">
\[\begin{equation}
{y^2 = (x^3 + 7)}~\text{over}~(\mathbb{F}_p)
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-139">
<p>ou</p>
</div>
<div class="stemblock data-line-142">
<div class="content">
\[\begin{equation}
{y^2 \mod p = (x^3 + 7) \mod p}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-148">
<p>Le <em>mod p</em> (modulo nombre premier p) indique que cette courbe est sur un corps fini d&#8217;ordre premier <em>p</em>, également écrit comme \(\mathbb{F}_p\), où p = 2<sup>256</sup> – 2<sup>32</sup> – 2<sup>9</sup> – 2<sup>8</sup> – 2<sup>7</sup> – 2<sup>6</sup> – 2<sup>4</sup> – 1, un très grand nombre premier.</p>
</div>
<div class="paragraph data-line-150">
<p>Parce que cette courbe est définie sur un champ fini d&#8217;ordre premier au lieu de sur les nombres réels, elle ressemble à un motif de points dispersés en deux dimensions, ce qui la rend difficile à visualiser. Cependant, le calcul est identique à celui d&#8217;une courbe elliptique sur des nombres réels. A titre d&#8217;exemple, <a href="#ecc-over-F17-math">Cryptographie sur courbe elliptique : visualisation d&#8217;une courbe elliptique sur F(p), avec p=17</a> montre la même courbe elliptique sur un champ fini beaucoup plus petit d&#8217;ordre premier 17, montrant un motif de points sur une grille. La courbe elliptique du bitcoin <code>secp256k1</code> peut être considérée comme un motif beaucoup plus complexe de points sur une grille insondable.</p>
</div>
<div id="ecc-over-F17-math" class="imageblock smallersixty data-line-155">
<div class="content">
<img src="images/mbc2_0403.png" alt="ecc sur mathématiques F17">
</div>
<div class="title">Figure 16. Cryptographie sur courbe elliptique : visualisation d&#8217;une courbe elliptique sur F(p), avec p=17</div>
</div>
<div class="paragraph data-line-157">
<p>Ainsi, par exemple, ce qui suit est un point P de coordonnées (x,y) qui est un point sur la courbe secp256k1 :</p>
</div>
<div class="listingblock data-line-159">
<div class="content">
<pre>P = (55066263022277343669578718895168534326250603453777594175500187360389116729240, 32670510020758816978083085130507043184471273380659243275938904335757337482424)</pre>
</div>
</div>
<div class="paragraph data-line-163">
<p><a href="#example_4_1">Utiliser Python pour confirmer que ce point est sur la courbe elliptique</a> montre comment vous pouvez vérifier cela vous-même en utilisant Python :</p>
</div>
<div id="example_4_1" class="exampleblock data-line-167">
<div class="title">Example 8. Utiliser Python pour confirmer que ce point est sur la courbe elliptique</div>
<div class="content">
<div class="listingblock data-line-169">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.4.0 (default, Mar 30 2014, 19:23:13)
[GCC 4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.38)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; p = 115792089237316195423570985008687907853269984665640564039457584007908834671663
&gt;&gt;&gt; x = 55066263022277343669578718895168534326250603453777594175500187360389116729240
&gt;&gt;&gt; y = 32670510020758816978083085130507043184471273380659243275938904335757337482424
&gt;&gt;&gt; (x ** 3 + 7 - y**2) % p
0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-181">
<p>Dans les mathématiques des courbes elliptiques, il existe un point appelé le "point à l&#8217;infini", qui correspond à peu près au rôle de zéro. Sur les ordinateurs, il est parfois représenté par x = y = 0 (ce qui ne satisfait pas l&#8217;équation de la courbe elliptique, mais c&#8217;est un cas séparé facile qui peut être vérifié).</p>
</div>
<div class="paragraph data-line-183">
<p>Il existe également un opérateur +, appelé "addition", qui possède certaines propriétés similaires à l&#8217;addition traditionnelle de nombres réels apprise par les élèves du primaire. Étant donné deux points P<sub>1</sub> et P<sub>2</sub> sur la courbe elliptique, il existe un troisième point P<sub>3</sub> = P<sub>1</sub> + P<sub>2</sub>, également sur la courbe elliptique.</p>
</div>
<div class="paragraph data-line-185">
<p>Géométriquement, ce troisième point P<sub>3</sub> est calculé en traçant une ligne entre P<sub>1</sub> et P<sub>2</sub>. Cette ligne coupera la courbe elliptique exactement à un endroit supplémentaire. Appelons ce point P<sub>3</sub> = (x, y). Renvoyé ensuite sur l&#8217;axe des x pour obtenir P<sub>3</sub> = (x, –y).</p>
</div>
<div class="paragraph data-line-187">
<p>Il y a quelques cas particuliers qui expliquent la nécessité du "point à l&#8217;infini".</p>
</div>
<div class="paragraph data-line-189">
<p>Si P<sub>1</sub> et P<sub>2</sub> sont le même point, la ligne "entre" P<sub>1</sub> et P<sub>2</sub> doit s&#8217;étendre pour être la tangente sur la courbe en ce point P<sub>1</sub>. Cette tangente coupera la courbe en exactement un nouveau point. Vous pouvez utiliser des techniques de calcul pour déterminer la pente de la ligne tangente. Ces techniques fonctionnent curieusement, même si nous restreignons notre intérêt aux points de la courbe à deux coordonnées entières !</p>
</div>
<div class="paragraph data-line-191">
<p>Dans certains cas (par exemple, si P<sub>1</sub> et P<sub>2</sub> ont les mêmes valeurs x mais des valeurs y différentes), la ligne entre P<sub>1</sub> et P<sub>2</sub> sera exactement verticale, auquel cas P<sub>3</sub> = "point à l&#8217;infini."</p>
</div>
<div class="paragraph data-line-193">
<p>Si P<sub>1</sub> est le "point à l&#8217;infini", alors P<sub>1</sub> ` P<sub>2</sub> = P<sub>2</sub>. De même, si P<sub>2</sub> est le point à l&#8217;infini, alors P<sub>1</sub> ` P<sub>2</sub> = P<sub>1</sub>. Cela montre comment le point à l&#8217;infini joue le rôle de zéro.</p>
</div>
<div class="paragraph data-line-195">
<p>Il s&#8217;avère que + est associatif, ce qui signifie que (A + B) + C = A + (B + C). Cela signifie que nous pouvons écrire A + B + C sans parenthèses et sans ambiguïté.</p>
</div>
<div class="paragraph data-line-197">
<p>Maintenant que nous avons défini l&#8217;addition, nous pouvons définir la multiplication de la manière standard qui extensionne l&#8217;addition. Pour un point P sur la courbe elliptique, si k est un nombre entier, alors kP = P ` P ` P ` &#8230;&#8203; ` P (k fois). Notez que k est parfois appelé un "exposant" dans ce cas.</p>
</div>
</div>
<div class="sect3 data-line-200">
<h4 id="public_key_derivation">Génération d&#8217;une clé publique</h4>
<div class="paragraph data-line-202">
<p>En partant d&#8217;une clé privée sous la forme d&#8217;un nombre généré aléatoirement <em>k</em>, nous la multiplions par un point prédéterminé sur la courbe appelé <em>point générateur</em> <em>G</em> pour produire un autre point ailleurs sur la courbe, qui est la clé publique correspondante <em>K</em>. Le point générateur est spécifié dans le cadre de la norme <code>secp256k1</code> et est toujours le même pour toutes les clés en bitcoin :</p>
</div>
<div class="stemblock data-line-205">
<div class="content">
\[\begin{equation}
{K = k * G}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-211">
<p>où <em>k</em> est la clé privée, <em>G</em> est le point générateur et <em>K</em> est la clé publique résultante, un point sur la courbe. Comme le point générateur est toujours le même pour tous les utilisateurs de bitcoins, une clé privée <em>k</em> multipliée par <em>G</em> donnera toujours la même clé publique <em>K</em>. La relation entre <em>k</em> et <em>K</em> est fixe, mais ne peut être calculée que dans un sens, de <em>k</em> vers <em>K</em>. C&#8217;est pourquoi une adresse Bitcoin (dérivée de <em>K</em>) peut être partagée avec n&#8217;importe qui et ne révèle pas la clé privée de l&#8217;utilisateur (<em>k</em>).</p>
</div>
<div class="admonitionblock tip data-line-214">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-215">
<p>Une clé privée peut être convertie en clé publique, mais une clé publique ne peut pas être reconvertie en clé privée car le calcul ne fonctionne que dans un sens.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-218">
<p>En implémentant la multiplication par courbe elliptique, nous prenons la clé privée <em>k</em> générée précédemment et la multiplions avec le point générateur G pour trouver la clé publique <em>K</em> :</p>
</div>
<div class="listingblock data-line-220">
<div class="content">
<pre>K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G</pre>
</div>
</div>
<div class="paragraph data-line-224">
<p>La clé publique <em>K</em> est définie comme un point K = (x,y) :</p>
</div>
<div class="listingblock data-line-226">
<div class="content">
<pre>K = (x, y)

où,

x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-235">
<p>Pour visualiser la multiplication d&#8217;un point avec un nombre entier, nous utiliserons la courbe elliptique plus simple sur des nombres réels - rappelez-vous, le calcul est le même. Notre objectif est de trouver le multiple <em>kG</em> du point générateur <em>G</em>, ce qui revient à ajouter <em>G</em> à lui-même, <em>k</em> fois de suite. Dans les courbes elliptiques, l&#8217;ajout d&#8217;un point à lui-même équivaut à tracer une ligne tangente sur le point et à trouver à nouveau l&#8217;endroit où il coupe la courbe, puis à refléter ce point sur l&#8217;axe des x.</p>
</div>
<div class="paragraph data-line-237">
<p><a href="#ecc_illustrated">Cryptographie sur courbe elliptique : visualisation de la multiplication d&#8217;un point G par un entier k sur une courbe elliptique</a> montre le processus de dérivation de <em>G</em>, <em>2G</em>, <em>4G</em> et <em>8G</em> en tant qu&#8217;opération géométrique sur la courbe.</p>
</div>
<div class="admonitionblock tip data-line-240">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-241">
<p>Bitcoin utilise la <a href="https://github.com/bitcoin-core/secp256k1" data-href="https://github.com/bitcoin-core/secp256k1">bibliothèque C optimisée secp256k1</a> pour effectuer les calculs de la courbe elliptique.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecc_illustrated" class="imageblock data-line-246">
<div class="content">
<img src="images/mbc2_0404.png" alt="illustration d&#8217;ecc">
</div>
<div class="title">Figure 17. Cryptographie sur courbe elliptique : visualisation de la multiplication d&#8217;un point G par un entier k sur une courbe elliptique</div>
</div>
</div>
</div>
<div class="sect2 data-line-248">
<h3 id="_adresses_bitcoin">Adresses Bitcoin</h3>
<div class="paragraph data-line-250">
<p>Une adresse Bitcoin est une chaîne de chiffres et de caractères qui peut être partagée avec toute personne souhaitant vous envoyer de l&#8217;argent. Les adresses produites à partir de clés publiques consistent en une chaîne de chiffres et de lettres commençant par le chiffre "1". Voici un exemple d&#8217;adresse Bitcoin :</p>
</div>
<div class="listingblock data-line-252">
<div class="content">
<pre>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</pre>
</div>
</div>
<div class="paragraph data-line-257">
<p>L&#8217;adresse Bitcoin est ce qui apparaît le plus souvent dans une transaction en tant que "destinataire" des fonds. Si nous comparons une transaction bitcoin à un chèque papier, l&#8217;adresse Bitcoin est le bénéficiaire, c&#8217;est ce que nous écrivons sur la ligne après "Payer à l&#8217;ordre de". Sur un chèque papier, ce bénéficiaire peut parfois être le nom d&#8217;un titulaire de compte bancaire, mais peut également inclure des sociétés, des institutions ou même des espèces. Étant donné que les chèques papier n&#8217;ont pas besoin de spécifier un compte, mais utilisent plutôt un nom abstrait en tant que destinataire des fonds, ce sont des instruments de paiement très flexibles. Les transactions Bitcoin utilisent une abstraction similaire, l&#8217;adresse Bitcoin, pour les rendre très flexibles. Une adresse Bitcoin peut représenter le propriétaire d&#8217;une paire de clés privée/publique, ou elle peut représenter autre chose, comme un script de paiement, comme nous le verrons dans <a href="#p2sh">Pay-to-Script-Hash (P2SH)</a>. Pour l&#8217;instant, examinons le cas simple; une adresse Bitcoin qui représente et est dérivée d&#8217;une clé publique.</p>
</div>
<div class="paragraph data-line-259">
<p>L&#8217;adresse Bitcoin est dérivée de la clé publique grâce à l&#8217;utilisation d&#8217;un hachage cryptographique unidirectionnel. Un "algorithme de hachage" ou simplement "algorithme de hachage" est une fonction à sens unique qui produit une empreinte digitale ou un "hachage" (ou un "résultat de hachage") d&#8217;une entrée de taille arbitraire. Les fonctions de hachage cryptographiques sont largement utilisées dans le bitcoin : dans les adresses Bitcoin, dans les adresses de script et dans l&#8217;algorithme de minage de preuve de travail. Les algorithmes utilisés pour créer une adresse Bitcoin à partir d&#8217;une clé publique sont le Secure Hash Algorithm (SHA) et le RACE Integrity Primitives Evaluation Message Digest (RIPEMD), ou plus précisément SHA256 et RIPEMD160.</p>
</div>
<div class="paragraph data-line-261">
<p>En commençant par la clé publique <em>K</em>, nous calculons le hachage SHA256, puis calculons le hachage RIPEMD160 du résultat, produisant un nombre de 160 bits (20 octets) :</p>
</div>
<div class="stemblock data-line-264">
<div class="content">
\[\begin{equation}
{A = RIPEMD160(SHA256(K))}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-270">
<p>où <em>K</em> est la clé publique et <em>A</em> est l&#8217;adresse Bitcoin résultante.</p>
</div>
<div class="admonitionblock tip data-line-274">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-275">
<p>Une adresse Bitcoin n&#8217;est <em>pas</em> la même chose qu&#8217;une clé publique. Les adresses Bitcoin sont dérivées d&#8217;une clé publique à l&#8217;aide d&#8217;une fonction unidirectionnelle.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-278">
<p>Les adresses Bitcoin sont presque toujours encodées en "Base58Check" (voir <a href="#base58">Encodage Base58 et Base58Check</a>), qui utilise 58 caractères (un système de numérotation Base58) et une somme de contrôle pour faciliter la lisibilité humaine, éviter toute ambiguïté et protéger contre les erreurs de transcription et de saisie d&#8217;adresse. Base58Check est également utilisé de nombreuses autres manières dans Bitcoin, par exemple lorsque chaque fois qu&#8217;un utilisateur a besoin de lire et de transcrire correctement un numéro, tel qu&#8217;une adresse Bitcoin, une clé privée, une clé cryptée ou un hachage de script. Dans la section suivante, nous examinerons les mécanismes d&#8217;encodage et de décodage Base58Check et les représentations qui en résultent. <a href="#pubkey_to_address">Clé publique vers adresse Bitcoin : conversion d&#8217;une clé publique en adresse Bitcoin</a> illustre la conversion d&#8217;une clé publique en une adresse Bitcoin.</p>
</div>
<div id="pubkey_to_address" class="imageblock data-line-282">
<div class="content">
<img src="images/mbc2_0405.png" alt="pubkey à adresse">
</div>
<div class="title">Figure 18. Clé publique vers adresse Bitcoin : conversion d&#8217;une clé publique en adresse Bitcoin</div>
</div>
<div class="sect3 data-line-285">
<h4 id="base58">Encodage Base58 et Base58Check</h4>
<div class="paragraph data-line-287">
<p>Afin de représenter les nombres longs de manière compacte, en utilisant moins de symboles, de nombreux systèmes informatiques utilisent des représentations alphanumériques mixtes avec une base supérieure à 10. Par exemple, alors que le système décimal traditionnel utilise les 10 chiffres de 0 à 9, le système hexadécimal utilise 16, avec les lettres A à F comme six symboles supplémentaires. Un nombre représenté au format hexadécimal est plus court que la représentation décimale équivalente. Encore plus compacte, la représentation Base64 utilise 26 lettres minuscules, 26 lettres majuscules, 10 chiffres et 2 caractères supplémentaires tels que &#8220;+&#8221; et "/" pour transmettre des données binaires sur des supports textuels tels que le courrier électronique. Base64 est le plus couramment utilisé pour ajouter des pièces jointes binaires aux e-mails. Base58 est un format de codage binaire basé sur du texte développé pour être utilisé dans le bitcoin et utilisé dans de nombreuses autres cryptomonnaies. Il offre un équilibre entre représentation compacte, lisibilité et détection et prévention des erreurs. Base58 est un sous-ensemble de Base64, utilisant des lettres et des chiffres majuscules et minuscules, mais omettant certains caractères qui sont fréquemment confondus et qui peuvent apparaître identiques lorsqu&#8217;ils sont affichés dans certaines polices. Plus précisément, Base58 est Base64 sans le 0 (chiffre zéro), O (o majuscule), l (L inférieur), I (i majuscule) et les symboles &#8220;+&#8221; et "/". Ou, plus simplement, c&#8217;est un ensemble de lettres minuscules et majuscules et de chiffres sans les quatre (0, O, l, I) que nous venons de mentionner. <a href="#base58alphabet">Alphabet Base58 de Bitcoin</a> affiche l&#8217;alphabet Base58 complet.</p>
</div>
<div id="base58alphabet" class="exampleblock data-line-291">
<div class="title">Example 9. Alphabet Base58 de Bitcoin</div>
<div class="content">
<div class="listingblock data-line-292">
<div class="content">
<pre>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-298">
<p>Pour ajouter une sécurité supplémentaire contre les fautes de frappe ou les erreurs de transcription, Base58Check est un format d&#8217;encodage Base58, fréquemment utilisé dans le bitcoin, qui possède un code de vérification des erreurs intégré. La somme de contrôle est constituée de quatre octets supplémentaires ajoutés à la fin des données en cours de codage. La somme de contrôle est dérivée du hachage des données codées et peut donc être utilisée pour détecter et prévenir les erreurs de transcription et de frappe. Lorsqu&#8217;il est présenté avec le code Base58Check, le logiciel de décodage calcule la somme de contrôle des données et la compare à la somme de contrôle incluse dans le code. Si les deux ne correspondent pas, une erreur a été introduite et les données Base58Check ne sont pas valides. Cela empêche qu&#8217;une adresse Bitcoin mal saisie soit acceptée par le logiciel du portefeuille comme destination valide, une erreur qui entraînerait autrement une perte de fonds.</p>
</div>
<div class="paragraph data-line-300">
<p>Pour convertir des données (un nombre) dans un format Base58Check, nous ajoutons d&#8217;abord un préfixe aux données, appelé "octet de version", qui sert à identifier facilement le type de données encodées. Par exemple, dans le cas d&#8217;une adresse Bitcoin, le préfixe est zéro (0x00 en hexadécimal), alors que le préfixe utilisé lors de l&#8217;encodage d&#8217;une clé privée est 128 (0x80 en hexadécimal). Une liste des préfixes de version courants est affichée dans <a href="#base58check_versions">Base58Check préfixe de version et exemples de résultats encodés</a>.</p>
</div>
<div class="paragraph data-line-302">
<p>Ensuite, nous calculons la somme de contrôle "double-SHA", ce qui signifie que nous appliquons l&#8217;algorithme de hachage SHA256 deux fois sur le résultat précédent (préfixe et données):</p>
</div>
<div class="listingblock data-line-304">
<div class="content">
<pre>somme de contrôle (checksum) = SHA256(SHA256(préfixe+données))</pre>
</div>
</div>
<div class="paragraph data-line-308">
<p>À partir du hachage de 32 octets résultant (hachage-d&#8217;un-hachage), nous ne prenons que les quatre premiers octets. Ces quatre octets servent de code de contrôle d&#8217;erreur ou de somme de contrôle (checksum). La somme de contrôle est concaténée (ajoutée) à la fin.</p>
</div>
<div class="paragraph data-line-310">
<p>Le résultat est composé de trois éléments : un préfixe, les données et une somme de contrôle. Ce résultat est encodé en utilisant l&#8217;alphabet Base58 décrit précédemment. <a href="#base58check_encoding">Encodage Base58Check : un format Base58, versionné et à somme de contrôle pour encoder sans ambiguïté les données bitcoin</a> illustre le processus d&#8217;encodage Base58Check.</p>
</div>
<div id="base58check_encoding" class="imageblock data-line-314">
<div class="content">
<img src="images/mbc2_0406.png" alt="Base58CheckEncoding">
</div>
<div class="title">Figure 19. Encodage Base58Check : un format Base58, versionné et à somme de contrôle pour encoder sans ambiguïté les données bitcoin</div>
</div>
<div class="paragraph data-line-316">
<p>En bitcoin, la plupart des données présentées à l&#8217;utilisateur sont encodées en Base58Check pour les rendre compactes, faciles à lire et faciles à détecter les erreurs. Le préfixe de version dans l&#8217;encodage Base58Check est utilisé pour créer des formats faciles à distinguer qui, lorsqu&#8217;ils sont encodés en Base58, contiennent des caractères spécifiques au début de la charge utile encodée en Base58Check. Ces caractères permettent aux humains d&#8217;identifier facilement le type de données codées et comment les utiliser. C&#8217;est ce qui différencie, par exemple, une adresse Bitcoin encodée en Base58Check qui commence par un 1 d&#8217;une clé privée WIF encodée en Base58Check qui commence par un 5. Quelques exemples de préfixes de version et les caractères Base58 résultants sont affichés dans <a href="#base58check_versions">Base58Check préfixe de version et exemples de résultats encodés</a>.</p>
</div>
<table id="base58check_versions" class="tableblock frame-all grid-all stretch data-line-321">
<caption class="title">Table 1. Base58Check préfixe de version et exemples de résultats encodés</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Préfixe de version (hex)</th>
<th class="tableblock halign-left valign-top">Préfixe de résultat Base58</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse de hachage Pay-to-Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse de test Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clé privée WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5, K ou L</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clé privée cryptée BIP-38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0142</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clé publique étendue BIP-32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0488B21E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xpub</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3 data-line-331">
<h4 id="_formats_de_clé">Formats de clé</h4>
<div class="paragraph data-line-333">
<p> Les clés privées et publiques peuvent être représentées dans un certain nombre de formats différents. Ces représentations codent tous le même nombre, même si elles semblent différentes. Ces formats sont principalement utilisés pour faciliter la lecture et la transcription des clés sans introduire d&#8217;erreurs.</p>
</div>
<div class="sect4 data-line-336">
<h5 id="priv_formats">Formats de clé privée</h5>
<div class="paragraph data-line-338">
<p> La clé privée peut être représentée dans un certain nombre de formats différents, qui correspondent tous au même nombre de 256 bits. <a href="#table_4-2">Représentations de clés privées (formats d&#8217;encodage)</a> montre trois formats courants utilisés pour représenter les clés privées. Différents formats sont utilisés dans différentes circonstances. Les formats binaires hexadécimaux et bruts sont utilisés en interne dans les logiciels et rarement montrés aux utilisateurs. Le WIF est utilisé pour l&#8217;importation/exportation de clés entre portefeuilles et souvent utilisé dans les représentations de code QR (code-barres) des clés privées.</p>
</div>
<table id="table_4-2" class="tableblock frame-all grid-all stretch data-line-343">
<caption class="title">Table 2. Représentations de clés privées (formats d&#8217;encodage)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Préfixe</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aucun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aucun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 chiffres hexadécimaux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encodage Base58Check : Base58 avec préfixe de version 0x80 et somme de contrôle de 4 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF compressé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">K ou L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comme ci-dessus, avec le suffixe ajouté 0x01 avant l&#8217;encodage</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-351">
<p><a href="#table_4-3">Exemple : même clé, différents formats</a> affiche la clé privée générée dans ces trois formats.</p>
</div>
<table id="table_4-3" class="tableblock frame-all grid-all stretch data-line-356">
<caption class="title">Table 3. Exemple : même clé, différents formats</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Clé privée</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF compressé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-363">
<p>Toutes ces représentations sont des manières différentes de montrer le même numéro, la même clé privée. Ils semblent différents, mais n&#8217;importe quel format peut facilement être converti en n&#8217;importe quel autre format. Notez que le "binaire brut" n&#8217;est pas affiché dans <a href="#table_4-3">Exemple : même clé, différents formats</a> car tout encodage à afficher ici ne serait, par définition, pas une donnée binaire brute.</p>
</div>
<div class="paragraph data-line-365">
<p>Nous utilisons la commande <code>wif-to-ec</code> de Bitcoin Explorer (voir <a href="#appdx_bx">Commandes de l&#8217;explorateur Bitcoin (bx)</a>) pour montrer que les deux clés WIF représentent la même clé privée :</p>
</div>
<div class="listingblock data-line-367">
<div class="content">
<pre>$ bx wif-to-ec 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd

$ bx wif-to-ec KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</pre>
</div>
</div>
</div>
<div class="sect4 data-line-375">
<h5 id="_décoder_à_partir_de_base58check">Décoder à partir de Base58Check</h5>
<div class="paragraph data-line-377">
<p>Les commandes de Bitcoin Explorer (voir <a href="#appdx_bx">Commandes de l&#8217;explorateur Bitcoin (bx)</a>) facilitent l&#8217;écriture de scripts interface système (ou shell) à l&#8217;aide d'"opérateurs de transfert de données" en ligne de commande (ou "command-line pipes") qui manipulent les clés, les adresses et les transactions bitcoin. Vous pouvez utiliser Bitcoin Explorer pour décoder le format Base58Check sur la ligne de commande.</p>
</div>
<div class="paragraph data-line-379">
<p>Nous utilisons la commande <code>base58check-decode</code> pour décoder la clé non compressée :</p>
</div>
<div class="listingblock data-line-381">
<div class="content">
<pre>$ bx base58check-decode 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
wrapper
{
    checksum 4286807748
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd
    version 128
}</pre>
</div>
</div>
<div class="paragraph data-line-391">
<p>Le résultat contient la clé comme charge utile (payload), le préfixe de version WIF 128 et une somme de contrôle (checksum).</p>
</div>
<div class="paragraph data-line-393">
<p>Notez que la "charge utile" (ou "payload") de la clé compressée est ajoutée avec le suffixe 01, signalant que la clé publique dérivée doit être compressée :</p>
</div>
<div class="listingblock data-line-395">
<div class="content">
<pre>$ bx base58check-decode KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
wrapper
{
    checksum 2339607926
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01
    version 128
}</pre>
</div>
</div>
</div>
<div class="sect4 data-line-405">
<h5 id="_encoder_de_lhex_vers_base58check">Encoder de l&#8217;hex vers Base58Check</h5>
<div class="paragraph data-line-407">
<p>Pour encoder en Base58Check (l&#8217;inverse de la commande précédente), nous utilisons la commande <code>base58check-encode</code> de Bitcoin Explorer (voir <a href="#appdx_bx">Commandes de l&#8217;explorateur Bitcoin (bx)</a>) et indiquez la clé privée hexadécimale, suivie du préfixe de version WIF 128 :</p>
</div>
<div class="listingblock data-line-409">
<div class="content">
<pre>bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd --version 128
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
</div>
<div class="sect4 data-line-414">
<h5 id="_encoder_de_lhex_clé_compressée_à_base58check">Encoder de l&#8217;hex (clé compressée) à Base58Check</h5>
<div class="paragraph data-line-416">
<p>Pour encoder dans Base58Check comme une clé privée "compressée" (voir <a href="#comp_priv">Clés privées compressées</a>), nous ajoutons le suffixe <code>01</code> à la clé hexadécimale puis encodons comme dans la section précédente :</p>
</div>
<div class="listingblock data-line-418">
<div class="content">
<pre>$ bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01 --version 128
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-423">
<p>Le format compressé WIF résultant commence par un "K". Cela indique que la clé privée à l&#8217;intérieur a un suffixe de "01" et sera utilisée pour produire des clés publiques compressées uniquement (voir <a href="#comp_pub">Clés publiques compressées</a>).</p>
</div>
</div>
<div class="sect4 data-line-425">
<h5 id="_formats_de_clé_publique">Formats de clé publique</h5>
<div class="paragraph data-line-427">
<p>Les clés publiques sont également présentées de différentes manières, généralement sous forme de clés publiques <em>compressées</em> ou <em>non compressées</em>.</p>
</div>
<div class="paragraph data-line-429">
<p>Comme nous l&#8217;avons vu précédemment, la clé publique est un point de la courbe elliptique constitué d&#8217;un couple de coordonnées (x,y). Il est généralement présenté avec le préfixe <code>04</code> suivi de deux nombres de 256 bits : un pour la coordonnée <em>x</em> du point, l&#8217;autre pour la coordonnée <em>y</em>. Le préfixe <code>04</code> est utilisé pour distinguer les clés publiques non compressées des clés publiques compressées qui commencent par un <code>02</code> ou un 03.</p>
</div>
<div class="paragraph data-line-431">
<p>Voici la clé publique générée par la clé privée que nous avons créée précédemment, indiquée par les coordonnées <code>x</code> et y :</p>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-438">
<p>Voici la même clé publique affichée sous la forme d&#8217;un nombre de 520 bits (130 chiffres hexadécimaux) avec le préfixe <code>04</code> suivi de <code>x</code> puis des coordonnées y, sous la forme 04 x y :</p>
</div>
<div class="listingblock data-line-440">
<div class="content">
<pre>K = 04F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A&amp;#x21b5;
07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
</div>
<div class="sect4 data-line-446">
<h5 id="comp_pub">Clés publiques compressées</h5>
<div class="paragraph data-line-448">
<p>Des clés publiques compressées ont été introduites dans le bitcoin pour réduire la taille des transactions et économiser de l&#8217;espace disque sur les nœuds qui stockent la base de données de la chaîne de blocs Bitcoin. La plupart des transactions incluent la clé publique, qui est nécessaire pour valider les informations d&#8217;identification du propriétaire et dépenser le bitcoin. Chaque clé publique nécessite 520 bits (préfixe ` x ` y), ce qui, multiplié par plusieurs centaines de transactions par bloc, soit des dizaines de milliers de transactions par jour, ajoute une quantité importante de données à la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-450">
<p>Comme nous l&#8217;avons vu dans la section <a href="#pubkey">Clés publiques</a>, une clé publique est un point (x,y) sur une courbe elliptique. Parce que la courbe exprime une fonction mathématique, un point sur la courbe représente une solution à l&#8217;équation et, par conséquent, si nous connaissons la coordonnée <em>x</em>, nous pouvons calculer la coordonnée <em>y</em> en résolvant l&#8217;équation y<sup>2</sup> mod p = (x<sup>3</sup> + 7) mod p. Cela nous permet de stocker uniquement la coordonnée <em>x</em> du point de clé publique, en omettant la coordonnée <em>y</em> et en réduisant la taille de la clé et l&#8217;espace requis pour la stocker de 256 bits. Une réduction de près de 50 % de la taille de chaque transaction représente une grande quantité de données enregistrées au fil du temps !</p>
</div>
<div class="paragraph data-line-452">
<p>Alors que les clés publiques non compressées ont un préfixe de 04, les clés publiques compressées commencent par un préfixe <code>02</code> ou 03. Regardons pourquoi il y a deux préfixes possibles : parce que le côté gauche de l&#8217;équation est <em>y</em><sup>2</sup>, la solution pour <em>y</em> est une racine carrée, qui peut avoir une valeur positive ou négative. Visuellement, cela signifie que la coordonnée <em>y</em> résultante peut être au-dessus ou au-dessous de l&#8217;axe des x. Comme vous pouvez le voir sur le graphique de la courbe elliptique en <a href="#ecc-curve">Une courbe elliptique</a>, la courbe est symétrique, c&#8217;est-à-dire qu&#8217;elle est réfléchie comme par un miroir à l&#8217;axe des abscisses. Ainsi, bien que nous puissions omettre la coordonnée <em>y</em>, nous devons stocker le <em>signe</em> de <em>y</em> (positif ou négatif) ; ou en d&#8217;autres termes, nous devons nous rappeler si c&#8217;était au-dessus ou au-dessous de l&#8217;axe des x parce que chacune de ces options représente un point différent et une clé publique différente. Lors du calcul de la courbe elliptique en arithmétique binaire sur le corps fini d&#8217;ordre premier p, la coordonnée <em>y</em> est paire ou impaire, ce qui correspond au signe positif/négatif comme expliqué précédemment. Ainsi, pour distinguer les deux valeurs possibles de <em>y</em>, on stocke une clé publique compressée avec le préfixe <code>02</code> si le <em>y</em> est pair, et <code>03</code> s&#8217;il est impair, permettant au logiciel de déduire correctement la coordonnée <em>y</em> de la coordonnée <em>x</em> et de décompresser la clé publique aux coordonnées complètes du point. La compression de clé publique est illustrée dans <a href="#pubkey_compression">Compression de clé publique</a>.</p>
</div>
<div class="paragraph data-line-454">
<p>Voici la même clé publique générée précédemment, présentée sous la forme d&#8217;une clé publique compressée stockée sur 264 bits (66 chiffres hexadécimaux) avec le préfixe <code>03</code> indiquant que la coordonnée <em>y</em> est impaire :</p>
</div>
<div class="listingblock data-line-456">
<div class="content">
<pre>K = 03F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A</pre>
</div>
</div>
<div class="paragraph data-line-460">
<p>Cette clé publique compressée correspond à la même clé privée, c&#8217;est-à-dire qu&#8217;elle est générée à partir de la même clé privée. Cependant, il semble différent de la clé publique non compressée. Plus important encore, si nous convertissons cette clé publique compressée en une adresse Bitcoin à l&#8217;aide de la fonction de double hachage (RIPEMD160(SHA256(K))), cela produira une adresse Bitcoin <em>différente</em>. Cela peut prêter à confusion, car cela signifie qu&#8217;une seule clé privée peut produire une clé publique exprimée dans deux formats différents (compressé et non compressé) qui produisent deux adresses Bitcoin différentes. Cependant, la clé privée est identique pour les deux adresses Bitcoin.</p>
</div>
<div id="pubkey_compression" class="imageblock smallerseventy data-line-465">
<div class="content">
<img src="images/mbc2_0407.png" alt="Compression de pubkey">
</div>
<div class="title">Figure 20. Compression de clé publique</div>
</div>
<div class="paragraph data-line-467">
<p>Les clés publiques compressées deviennent progressivement la valeur par défaut pour les clients Bitcoin, ce qui a un impact significatif sur la réduction de la taille des transactions et donc de la chaîne de blocs. Cependant, tous les clients ne prennent pas encore en charge les clés publiques compressées. Les clients plus récents qui prennent en charge les clés publiques compressées doivent comptabiliser les transactions des clients plus anciens qui ne prennent pas en charge les clés publiques compressées. Ceci est particulièrement important lorsqu&#8217;une application de portefeuille importe des clés privées à partir d&#8217;une autre application de portefeuille bitcoin, car le nouveau portefeuille doit analyser la chaîne de blocs pour trouver les transactions correspondant à ces clés importées. Quelles adresses Bitcoin le portefeuille Bitcoin doit-il rechercher ? Les adresses Bitcoin produites par des clés publiques non compressées, ou les adresses Bitcoin produites par des clés publiques compressées ? Les deux sont des adresses Bitcoin valides et peuvent être signées par la clé privée, mais ce sont des adresses différentes !</p>
</div>
<div class="paragraph data-line-469">
<p>Pour résoudre ce problème, lorsque des clés privées sont exportées depuis un portefeuille, le WIF utilisé pour les représenter est implémenté différemment dans les nouveaux portefeuilles Bitcoin, pour indiquer que ces clés privées ont été utilisées pour produire des clés publiques <em>compressées</em> et donc des adresses Bitcoin <em>compressées</em>. Cela permet au portefeuille importateur de faire la distinction entre les clés privées provenant de portefeuilles plus anciens ou plus récents et de rechercher dans la chaîne de blocs des transactions avec des adresses Bitcoin correspondant respectivement aux clés publiques non compressées ou compressées. Voyons comment cela fonctionne plus en détail, dans la section suivante.</p>
</div>
</div>
<div class="sect4 data-line-472">
<h5 id="comp_priv">Clés privées compressées</h5>
<div class="paragraph data-line-474">
<p>Ironiquement, le terme "clé privée compressée" est un abus de langage, car lorsqu&#8217;une clé privée est exportée au format WIF compressé, elle est en fait un octet <em>plus long</em> qu&#8217;une clé privée "non compressée". C&#8217;est parce que la clé privée a un suffixe d&#8217;un octet ajouté (affiché comme 01 en hexadécimal dans <a href="#table_4-4">Exemple : même clé, différents formats</a>), ce qui signifie que la clé privée provient d&#8217;un portefeuille plus récent et ne doit être utilisée que pour produire des clés publiques compressées. Les clés privées ne sont pas elles-mêmes compressées et ne peuvent pas être compressées. Le terme "clé privée compressée" signifie en réalité "clé privée à partir de laquelle seules les clés publiques compressées doivent être dérivées", tandis que "clé privée non compressée" signifie en réalité "clé privée à partir de laquelle seules les clés publiques non compressées doivent être dérivées". Vous devez uniquement faire référence au format d&#8217;exportation en tant que "WIF-compressé" ou "WIF" et ne pas faire référence à la clé privée elle-même en tant que "compressée" pour éviter toute confusion supplémentaire.</p>
</div>
<div class="paragraph data-line-476">
<p><a href="#table_4-4">Exemple : même clé, différents formats</a> affiche la même clé, encodée aux formats WIF et WIF compressé.</p>
</div>
<table id="table_4-4" class="tableblock frame-all grid-all stretch data-line-481">
<caption class="title">Table 4. Exemple : même clé, différents formats</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Clé privée</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex-compressé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF compressé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-489">
<p>Notez que le format de clé privée compressée en hexadécimal a un octet supplémentaire à la fin (01 en hexadécimal). Bien que le préfixe de version Base58Check soit le même (0x80) pour les formats WIF et WIF compressés, l&#8217;ajout d&#8217;un octet à la fin du numéro fait passer le premier caractère de l&#8217;encodage Base58 de 5 à <em>K</em> ou <em>L</em> . Considérez cela comme l&#8217;équivalent Base58 de la différence de codage décimal entre le nombre 100 et le nombre 99. Alors que 100 est un chiffre plus long que 99, il a également un préfixe de 1 au lieu d&#8217;un préfixe de 9. Lorsque la longueur change, il affecte le préfixe. En Base58, le préfixe 5 se transforme en <em>K</em> ou <em>L</em> lorsque la longueur du nombre augmente d&#8217;un octet.</p>
</div>
<div class="paragraph data-line-491">
<p>N&#8217;oubliez pas que ces formats ne sont <em>pas</em> utilisés de manière interchangeable. Dans un portefeuille plus récent qui implémente des clés publiques compressées, les clés privées ne seront exportées qu&#8217;au format WIF compressé (avec un préfixe <em>K</em> ou <em>L</em>). Si le portefeuille est une implémentation plus ancienne et n&#8217;utilise pas de clés publiques compressées, les clés privées ne seront exportées qu&#8217;au format WIF (avec un préfixe 5). Le but ici est de signaler au portefeuille qui importe ces clés privées s&#8217;il doit rechercher dans la chaîne de blocs des clés et des adresses publiques compressées ou non.</p>
</div>
<div class="paragraph data-line-493">
<p>Si un portefeuille bitcoin est capable d&#8217;implémenter des clés publiques compressées, il les utilisera dans toutes les transactions. Les clés privées du portefeuille seront utilisées pour dériver les points de clé publique sur la courbe, qui seront compressés. Les clés publiques compressées seront utilisées pour produire des adresses Bitcoin et celles-ci seront utilisées dans les transactions. Lors de l&#8217;exportation de clés privées à partir d&#8217;un nouveau portefeuille qui implémente des clés publiques compressées, le WIF est modifié, avec l&#8217;ajout d&#8217;un suffixe d&#8217;un octet <code>01</code> à la clé privée. La clé privée encodée en Base58Check qui en résulte est appelée "WIF compressé" et commence par la lettre <em>K</em> ou <em>L</em>, au lieu de commencer par "5" comme c&#8217;est le cas avec les clés encodées en WIF (non compressées) des portefeuilles plus anciens.</p>
</div>
<div class="admonitionblock tip data-line-497">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-498">
<p>"Clés privées compressées" est un terme impropre ! Ils ne sont pas compressés ; au lieu de cela, WIF-compressé signifie que les clés ne doivent être utilisées que pour dériver des clés publiques compressées et leurs adresses Bitcoin correspondantes. Ironiquement, une clé privée codée "compressée en WIF" est plus longue d&#8217;un octet car elle a le suffixe <code>01</code> ajouté pour la distinguer d&#8217;une clé "non compressée".</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-501">
<h3 id="_implémentation_des_clés_et_des_adresses_dans_c">Implémentation des clés et des adresses dans C++</h3>
<div class="paragraph data-line-503">
<p>Regardons le processus complet de création d&#8217;une adresse Bitcoin, d&#8217;une clé privée, à une clé publique (un point sur la courbe elliptique), à une adresse à hachage double, et enfin, l&#8217;encodage Base58Check. Le code C++ dans <a href="#addr_example">Création d&#8217;une adresse Bitcoin encodée en Base58Check à partir d&#8217;une clé privée</a> montre le processus complet étape par étape, de la clé privée à l&#8217;adresse Bitcoin encodée en Base58Check. L&#8217;exemple de code utilise la bibliothèque libbitcoin introduite dans <a href="#alt_libraries">Clients, bibliothèques et boîtes à outils alternatifs</a> pour certaines fonctions d&#8217;assistance.</p>
</div>
<div id="addr_example" class="exampleblock data-line-507">
<div class="title">Example 10. Création d&#8217;une adresse Bitcoin encodée en Base58Check à partir d&#8217;une clé privée</div>
<div class="content">
<div class="listingblock c_less_space data-line-510">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;bitcoin/bitcoin.hpp&gt;

int main()
{
    // Chaîne de clé secrète privée en base16
    bc::ec_secret decoded;
    bc::decode_base16(decoded,
        "038109007313a5807b2eccc082c8c3fbb988a973cacf1a7df9ce725c31b14776");

    bc::wallet::ec_private secret(
        decoded, bc::wallet::ec_private::mainnet_p2kh);

    // Obtenir la clé publique.
    bc::wallet::ec_public public_key(secret);
    std::cout &lt;&lt; "Public key: " &lt;&lt; public_key.encoded() &lt;&lt; std::endl;

    // Créer une adresse Bitcoin.
    // Normalement, vous pouvez utiliser :
    //    bc::wallet::payment_address payaddr =
    //        public_key.to_payment_address(
    //            bc::wallet::ec_public::mainnet_p2kh);
    //  const std::string address = payaddr.encoded();

    // Calcule le hachage de la clé publique pour l'adresse P2PKH.
    bc::data_chunk public_key_data;
    public_key.to_data(public_key_data);
    const auto hash = bc::bitcoin_short_hash(public_key_data);

    bc::data_chunk unencoded_address;
    // Réserver 25 octets
    //   [ version:1  ]
    //   [ hash:20    ]
    //   [ checksum:4 ]
    unencoded_address.reserve(25);
    // Octet de version, 0 est l'adresse BTC normale (P2PKH).
    unencoded_address.push_back(0);
    // Données de hachage
    bc::extend_data(unencoded_address, hash);
    // La somme de contrôle est calculée en hachant les données et en ajoutant 4 octets à partir du hachage.
    bc::append_checksum(unencoded_address);
    // Enfin, nous devons encoder le résultat dans l'encodage base58 de Bitcoin.
    assert(unencoded_address.size() == 25);
    const std::string address = bc::encode_base58(unencoded_address);

    std::cout &lt;&lt; "Address: " &lt;&lt; address &lt;&lt; std::endl;
    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-515">
<p>Le code utilise une clé privée prédéfinie pour produire la même adresse Bitcoin à chaque exécution, comme indiqué dans <a href="#addr_example_run">Compilation et exécution du code addr</a>.</p>
</div>
<div id="addr_example_run" class="exampleblock data-line-519">
<div class="title">Example 11. Compilation et exécution du code addr</div>
<div class="content">
<div class="listingblock data-line-521">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compiler le code addr.cpp
$ g++ -o addr addr.cpp -std=c++11 $(pkg-config --cflags --libs libbitcoin)
# Lancer l'exécutable addr
$ ./addr
Public key: 0202a406624211f2abbdc68da3df929f938c3399dd79fac1b51b0e4ad1d26a47aa
Address: 1PRTTaJesdNovgne6Ehcdu1fpEdX7913CK</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip data-line-532">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-533">
<p>Le code dans <a href="#addr_example_run">Compilation et exécution du code addr</a> produit une adresse Bitcoin (1PRTT...) à partir d&#8217;une clé publique <em>compressée</em> (voir <a href="#comp_pub">Clés publiques compressées</a>). Si vous utilisiez la clé publique non compressée à la place, cela produirait une adresse Bitcoin différente (14K1y...).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-536">
<h3 id="_implémenter_des_clés_et_des_adresses_en_python">Implémenter des clés et des adresses en Python</h3>
<div class="paragraph data-line-538">
<p> La bibliothèque bitcoin la plus complète en Python est <a href="https://github.com/vbuterin/pybitcointools" data-href="https://github.com/vbuterin/pybitcointools">pybitcointools</a> par Vitalik Buterin. Dans <a href="#key-to-address_script">Génération et formatage de clés et d&#8217;adresses avec la bibliothèque pybitcointools</a>, nous utilisons la bibliothèque pybitcointools (importée en tant que "bitcoin") pour générer et afficher des clés et des adresses dans différents formats.</p>
</div>
<div id="key-to-address_script" class="exampleblock data-line-542">
<div class="title">Example 12. Génération et formatage de clés et d&#8217;adresses avec la bibliothèque pybitcointools</div>
<div class="content">
<div class="listingblock data-line-544">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import bitcoin

# Générer une clé privée aléatoire
valid_private_key = False
while not valid_private_key:
    private_key = bitcoin.random_key()
    decoded_private_key = bitcoin.decode_privkey(private_key, 'hex')
    valid_private_key =  0 &lt; decoded_private_key &lt; bitcoin.N

print "Private Key (hex) is: ", private_key
print "Private Key (decimal) is: ", decoded_private_key

# Convertir la clé privée au format WIF
wif_encoded_private_key = bitcoin.encode_privkey(decoded_private_key, 'wif')
print "Private Key (WIF) is: ", wif_encoded_private_key

# Ajouter le suffixe "01" pour indiquer une clé privée compressée
compressed_private_key = private_key + '01'
print "Private Key Compressed (hex) is: ", compressed_private_key

# Générer un format WIF à partir de la clé privée compressée (WIF-compressé)
wif_compressed_private_key = bitcoin.encode_privkey(
    bitcoin.decode_privkey(compressed_private_key, 'hex'), 'wif')
print "Private Key (WIF-Compressed) is: ", wif_compressed_private_key

# Multipliez le point générateur EC G avec la clé privée pour obtenir un point de clé publique
public_key = bitcoin.fast_multiply(bitcoin.G, decoded_private_key)
print "Public Key (x,y) coordinates is:", public_key

# Encoder en hexadécimal, préfixe 04
hex_encoded_public_key = bitcoin.encode_pubkey(public_key,'hex')
print "Public Key (hex) is:", hex_encoded_public_key

# Compressez la clé publique, ajustez le préfixe selon que y est pair ou impair
(public_key_x, public_key_y) = public_key
if (public_key_y % 2) == 0:
    compressed_prefix = '02'
else:
    compressed_prefix = '03'
hex_compressed_public_key = compressed_prefix + bitcoin.encode(public_key_x, 16)
print "Compressed Public Key (hex) is:", hex_compressed_public_key

# Générer une adresse bitcoin à partir de la clé publique
print "Bitcoin Address (b58check) is:", bitcoin.pubkey_to_address(public_key)

# Générer une adresse bitcoin compressée à partir d'une clé publique compressée
print "Compressed Bitcoin Address (b58check) is:", \
    bitcoin.pubkey_to_address(hex_compressed_public_key)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-549">
<p><a href="#key-to-address_script_run">Exécution de key-to-address-ecc-example.py</a> affiche la sortie de l&#8217;exécution de ce code.</p>
</div>
<div id="key-to-address_script_run" class="exampleblock data-line-553">
<div class="title">Example 13. Exécution de key-to-address-ecc-example.py</div>
<div class="content">
<div class="listingblock data-line-554">
<div class="content">
<pre>$ python key-to-address-ecc-example.py
Private Key (hex) is:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa6
Private Key (decimal) is:
 26563230048437957592232553826663696440606756685920117476832299673293013768870
Private Key (WIF) is:
 5JG9hT3beGTJuUAmCQEmNaxAuMacCTfXuw1R3FCXig23RQHMr4K
Private Key Compressed (hex) is:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa601
Private Key (WIF-Compressed) is:
 KyBsPXxTuVD82av65KZkrGrWi5qLMah5SdNq6uftawDbgKa2wv6S
Public Key (x,y) coordinates is:
 (41637322786646325214887832269588396900663353932545912953362782457239403430124L,
 16388935128781238405526710466724741593761085120864331449066658622400339362166L)
Public Key (hex) is:
 045c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec&amp;#x21b5;
243bcefdd4347074d44bd7356d6a53c495737dd96295e2a9374bf5f02ebfc176
Compressed Public Key (hex) is:
 025c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec
Bitcoin Address (b58check) is:
 1thMirt546nngXqyPEz532S8fLwbozud8
Compressed Bitcoin Address (b58check) is:
 14cxpo3MBCYYWCgF74SWTdcmxipnGUsPw3</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-582">
<p><a href="#ec_math">Un script démontrant les mathématiques de la courbe elliptique utilisées pour les clés bitcoin</a> est un autre exemple, utilisant la bibliothèque Python ECDSA pour les mathématiques de la courbe elliptique et sans utiliser de bibliothèques bitcoin spécialisées.</p>
</div>
<div id="ec_math" class="exampleblock data-line-586">
<div class="title">Example 14. Un script démontrant les mathématiques de la courbe elliptique utilisées pour les clés bitcoin</div>
<div class="content">
<div class="listingblock data-line-588">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import ecdsa
import os
from ecdsa.util import string_to_number, number_to_string

# secp256k1, http://www.oid-info.com/get/1.3.132.0.10
_p = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2FL
_r = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141L
_b = 0x0000000000000000000000000000000000000000000000000000000000000007L
_a = 0x0000000000000000000000000000000000000000000000000000000000000000L
_Gx = 0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798L
_Gy = 0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8L
curve_secp256k1 = ecdsa.ellipticcurve.CurveFp(_p, _a, _b)
generator_secp256k1 = ecdsa.ellipticcurve.Point(curve_secp256k1, _Gx, _Gy, _r)
oid_secp256k1 = (1, 3, 132, 0, 10)
SECP256k1 = ecdsa.curves.Curve("SECP256k1", curve_secp256k1, generator_secp256k1, oid_secp256k1)
ec_order = _r

curve = curve_secp256k1
generator = generator_secp256k1

def random_secret():
    convert_to_int = lambda array: int("".join(array).encode("hex"), 16)

    # Collectez 256 bits de données aléatoires à partir du générateur aléatoire cryptographiquement sécurisé du système d'exploitation
    byte_array = os.urandom(32)

    return convert_to_int(byte_array)

def get_point_pubkey(point):
    if point.y() &amp; 1:
        key = '03' + '%064x' % point.x()
    else:
        key = '02' + '%064x' % point.x()
    return key.decode('hex')

def get_point_pubkey_uncompressed(point):
    key = '04' + \
          '%064x' % point.x() + \
          '%064x' % point.y()
    return key.decode('hex')


# Générez une nouvelle clé privée.
secret = random_secret()
print "Secret: ", secret

# Obtenez le point de clé publique.
point = secret * generator
print "EC point:", point

print "BTC public key:", get_point_pubkey(point).encode("hex")

# Étant donné le point (x, y), nous pouvons créer l'objet en utilisant :
point1 = ecdsa.ellipticcurve.Point(curve, point.x(), point.y(), ec_order)
assert point1 == point</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-593">
<p><a href="#ec_math_run">Installation de la bibliothèque Python ECDSA et exécution du script ec_math.py</a> affiche la sortie produite en exécutant ce script.</p>
</div>
<div class="admonitionblock warning data-line-596">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-597">
<p><a href="#ec_math">Un script démontrant les mathématiques de la courbe elliptique utilisées pour les clés bitcoin</a> utilise os.urandom, qui reflète un générateur de nombres aléatoires cryptographiquement sécurisé (CSRNG) fourni par le système d&#8217;exploitation sous-jacent. Attention : Selon le système d&#8217;exploitation, <code>os.urandom</code> peut <em>ne pas</em> être implémenté avec une sécurité suffisante ou correctement amorcé et peut <em>ne pas</em> être approprié pour générer des clés bitcoin de qualité production.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ec_math_run" class="exampleblock data-line-602">
<div class="title">Example 15. Installation de la bibliothèque Python ECDSA et exécution du script ec_math.py</div>
<div class="content">
<div class="listingblock data-line-603">
<div class="content">
<pre># Installer le gestionnaire de packages Python PIP
$ sudo apt-get install python-pip
# Installer la bibliothèque Python ECDSA
$ sudo pip install ecdsa
# Exécuter le script
$ python ec-math.py
Secret:  38090835015954358862481132628887443905906204995912378278060168703580660294000
EC point: (70048853531867179489857750497606966272382583471322935454624595540007269312627, 105262206478686743191060800263479589329920209527285803935736021686045542353380)
BTC public key: 029ade3effb0a67d5c8609850d797366af428f4a0d5194cb221d807770a1522873</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-616">
<h3 id="_clés_et_adresses_avancées">Clés et adresses avancées</h3>
<div class="paragraph data-line-618">
<p>Dans les sections suivantes, nous examinerons les formes avancées de clés et d&#8217;adresses, telles que les clés privées cryptées, les adresses de script et des multisignatures, les adresses personnalisées, et les portefeuilles en papier.</p>
</div>
<div class="sect3 data-line-621">
<h4 id="p2sh_addresses">Pay-to-Script Hash (P2SH) et adresses multisig</h4>
<div class="paragraph data-line-623">
<p>("Pay-to-Script-Hash (P2SH)", "adresses multisig et")Comme nous le savons, les adresses Bitcoin traditionnelles commencent par le chiffre "1" et sont dérivées de la clé publique, qui est dérivé de la clé privée. Bien que n&#8217;importe qui puisse envoyer des bitcoins à une adresse "1", ce bitcoin ne peut être dépensé qu&#8217;en présentant la signature de la clé privée et la clé publique correspondantes.</p>
</div>
<div class="paragraph data-line-625">
<p>Les adresses Bitcoin qui commencent par le chiffre "3" sont des adresses Pay-to-Script Hash (P2SH ou hachage de paiement-à-script), parfois appelées à tort adresses multisig ou adresses multisignatures. Ils désignent le bénéficiaire d&#8217;une transaction bitcoin comme le hachage d&#8217;un script, au lieu du propriétaire d&#8217;une clé publique. La fonctionnalité a été introduite en janvier 2012 avec BIP-16 (voir <a href="#appdxbitcoinimpproposals">Bitcoin Improvement Proposals (ou Propositions d&#8217;amélioration du Bitcoin)</a>), et est largement adopté car il offre la possibilité d&#8217;ajouter des fonctionnalités à l&#8217;adresse elle-même. Contrairement aux transactions qui "envoient" des fonds aux adresses Bitcoin traditionnelles "1", également connues sous le nom de hachage de clé publique (P2PKH), les fonds envoyés aux adresses "3" nécessitent quelque chose de plus que la présentation d&#8217;une clé publique et une signature de clé privée comme preuve de propriété. Les exigences sont désignées au moment de la création de l&#8217;adresse, dans le script, et toutes les entrées de cette adresse seront encombrées des mêmes exigences.</p>
</div>
<div class="paragraph data-line-627">
<p>Une adresse P2SH est créée à partir d&#8217;un script de transaction, qui définit qui peut dépenser une sortie de transaction (pour plus de détails, voir <a href="#p2sh">Pay-to-Script-Hash (P2SH)</a>). L&#8217;encodage d&#8217;une adresse P2SH consiste à utiliser la même fonction de double hachage que celle utilisée lors de la création d&#8217;une adresse Bitcoin, appliquée uniquement sur le script à la place de la clé publique :</p>
</div>
<div class="listingblock data-line-629">
<div class="content">
<pre>hachage de script = RIPEMD160(SHA256(script))</pre>
</div>
</div>
<div class="paragraph data-line-633">
<p>Le "hachage de script" résultant est encodé avec Base58Check avec un préfixe de version de 5, ce qui donne une adresse encodée commençant par un 3. Un exemple d&#8217;adresse P2SH est 3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM, qui peut être dérivée à l&#8217;aide des commandes Bitcoin Explorer script-encode, sha256, <code>ripemd160</code> et <code>base58check-encode</code> (voir <a href="#appdx_bx">Commandes de l&#8217;explorateur Bitcoin (bx)</a>) comme suit :</p>
</div>
<div class="listingblock data-line-635">
<div class="content">
<pre>$ echo \
'DUP HASH160 [89abcdefabbaabbaabbaabbaabbaabbaabbaabba] EQUALVERIFY CHECKSIG' &gt; script
$ bx script-encode &lt; script | bx sha256 | bx ripemd160 \
| bx base58check-encode --version 5
3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM</pre>
</div>
</div>
<div class="admonitionblock tip data-line-644">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-645">
<p>P2SH n&#8217;est pas nécessairement la même chose qu&#8217;une transaction standard multisignature. Une adresse P2SH représente <em>le plus souvent</em> un script multi-signatures, mais elle peut également représenter un script codant d&#8217;autres types de transactions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-648">
<h5 id="_adresses_multisignatures_et_p2sh">Adresses multisignatures et P2SH</h5>
<div class="paragraph data-line-650">
<p>Actuellement, l&#8217;implémentation la plus courante de la fonction P2SH est le script d&#8217;adresse multisignature. Comme son nom l&#8217;indique, le script sous-jacent nécessite un nombre minimum de signatures pour prouver la propriété et donc dépenser des fonds. La fonctionnalité de multisignature bitcoin est conçue pour exiger M signatures (également appelées «seuil») à partir d&#8217;un total de N clés, appelées multisig M-de-N, où M est égal ou inférieur à N. Par exemple , Bob le propriétaire du café de <a href="#ch01_intro_what_is_bitcoin">Présentation</a> pourrait utiliser une adresse multisignature nécessitant 1 sur 2 signatures d&#8217;une clé lui appartenant et d&#8217;une clé appartenant à son ou sa conjointe, garantissant que l&#8217;un ou l&#8217;autre pourrait signer pour passer une sortie de transaction verrouillée à cette adresse. Cela ressemblerait à un «compte conjoint» tel qu&#8217;il est mis en œuvre dans les banques traditionnelles où l&#8217;un ou l&#8217;autre des conjoints peut dépenser avec une seule signature. Gopesh, le concepteur Web payé par Bob pour créer un site Web, pourrait avoir une adresse multisignature 2 sur 3 pour son entreprise qui garantit qu&#8217;aucun fonds ne peut être dépensé à moins qu&#8217;au moins deux des partenaires commerciaux ne signent une transaction.</p>
</div>
<div class="paragraph data-line-652">
<p>Nous explorerons comment créer des transactions qui dépensent des fonds à partir d&#8217;adresses P2SH (et multisignatures) dans <a href="#transactions">Opérations</a>.</p>
</div>
</div>
</div>
<div class="sect3 data-line-654">
<h4 id="_adresses_personnalisées">Adresses personnalisées</h4>
<div class="paragraph data-line-656">
<p>Les adresses personnalisées sont des adresses Bitcoin valides qui contiennent des messages lisibles par l&#8217;homme. Par exemple, <code>1LoveBPzzD72PUXLzCkYAtGFYmK5vYNR33</code> est une adresse valide qui contient les lettres formant le mot "Love" comme les quatre premières lettres Base58. Les adresses personnalisées nécessitent de générer et de tester des milliards de clés privées candidates, jusqu&#8217;à ce qu&#8217;une adresse Bitcoin avec le modèle souhaité soit trouvée. Bien qu&#8217;il y ait quelques optimisations dans l&#8217;algorithme de génération de vanité, le processus consiste essentiellement à choisir une clé privée au hasard, à dériver la clé publique, à dériver l&#8217;adresse Bitcoin et à vérifier si elle correspond au modèle de vanité souhaité, en répétant des milliards de fois jusqu&#8217;à ce qu&#8217;un correspondance est trouvée.</p>
</div>
<div class="paragraph data-line-658">
<p>Une fois qu&#8217;une adresse personnalisée correspondant au modèle souhaité est trouvée, la clé privée dont elle est dérivée peut être utilisée par le propriétaire pour dépenser des bitcoins exactement de la même manière que n&#8217;importe quelle autre adresse. Les adresses personnalisées ne sont ni moins ni plus sécurisées que toute autre adresse. Ils dépendent de la même cryptographie à courbe elliptique (ECC) et SHA que toute autre adresse. Vous ne pouvez pas plus facilement trouver la clé privée d&#8217;une adresse commençant par un modèle de vanité que vous ne le pouvez de n&#8217;importe quelle autre adresse.</p>
</div>
<div class="paragraph data-line-660">
<p>Dans <a href="#ch01_intro_what_is_bitcoin">Présentation</a>, nous avons présenté Eugenia, directrice d&#8217;une association caritative pour enfants opérant aux Philippines. Disons qu&#8217;Eugenia organise une collecte de fonds en bitcoins et souhaite utiliser une adresse personnalisée Bitcoin pour faire connaître la collecte de fonds. Eugenia créera une adresse de vanité qui commence par "1Kids" pour promouvoir la collecte de fonds caritative pour les enfants. Voyons comment cette adresse personnalisée sera créée et ce que cela signifie pour la sécurité de l&#8217;association caritative d&#8217;Eugenia.</p>
</div>
<div class="sect4 data-line-662">
<h5 id="_génération_dadresses_personnalisées">Génération d&#8217;adresses personnalisées</h5>
<div class="paragraph data-line-664">
<p>Il est important de réaliser qu&#8217;une adresse Bitcoin est simplement un nombre représenté par des symboles dans l&#8217;alphabet Base58. La recherche d&#8217;un modèle comme "1Kids" peut être considérée comme la recherche d&#8217;une adresse comprise entre <code>1Kids1111111111111111111111111111</code> et 1Kidszzzzzzzzzzzzzzzzzzzzzzzzzz. Il y a environ 58 ^ 29 ^ (environ 1,4 * 10 ^ 51 ^) adresses dans cette plage, toutes commençant par "1Kids". <a href="#table_4-11">La plage d&#8217;adresses personnalisées (ou de vanités) commençant par "1Kids"</a> affiche la plage d&#8217;adresses qui ont le préfixe 1Kids.</p>
</div>
<table id="table_4-11" class="tableblock frame-all grid-all stretch data-line-668">
<caption class="title">Table 5. La plage d&#8217;adresses personnalisées (ou de vanités) commençant par "1Kids"</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>De</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111111</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111113</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">...</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>À</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-676">
<p>Regardons le modèle "1Kids" comme un nombre et voyons à quelle fréquence nous pourrions trouver ce modèle dans une adresse Bitcoin (voir <a href="#table_4-12">La fréquence d&#8217;un modèle de vanité (1KidsCharity) et le temps de recherche moyen sur un PC de bureau</a>). Un ordinateur de bureau moyen, sans aucun matériel spécialisé, peut rechercher environ 100 000 clés par seconde.</p>
</div>
<table id="table_4-12" class="tableblock frame-all grid-all stretch data-line-681">
<caption class="title">Table 6. La fréquence d&#8217;un modèle de vanité (1KidsCharity) et le temps de recherche moyen sur un PC de bureau</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Longueur</th>
<th class="tableblock halign-left valign-top">Motif</th>
<th class="tableblock halign-left valign-top">Fréquence</th>
<th class="tableblock halign-left valign-top">Temps de recherche moyen</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 58 touches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 1 millisecondes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Ki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 3 364</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 millisecondes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 195 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 2 secondes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 11 millions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 minute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 656 millions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 heure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 38 milliards</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 jours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 2,2 trillions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3–4 mois</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 128 billions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13–18 ans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 7 quadrillions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800 ans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 400 quadrillions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46 000 ans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 sur 23 quintillions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,5 millions d&#8217;années</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-697">
<p>Comme vous pouvez le voir, Eugenia ne créera pas de sitôt l&#8217;adresse personnalisée "1KidsCharity", même si elle avait accès à plusieurs milliers d&#8217;ordinateurs. Chaque caractère supplémentaire augmente la difficulté d&#8217;un facteur de 58. Les modèles de plus de sept caractères sont généralement trouvés par du matériel spécialisé, tel que des ordinateurs de bureau personnalisés avec plusieurs GPU. Ce sont souvent des "plates-formes" de minage de bitcoin réutilisées qui ne sont plus rentables pour le minage de bitcoin mais peuvent être utilisées pour trouver des adresses personnalisées. Les recherches d&#8217;adresse personnalisées (ou de vanités) sur les systèmes GPU sont de plusieurs ordres de grandeur plus rapides que sur un processeur à usage général.</p>
</div>
<div class="paragraph data-line-699">
<p>Une autre façon de trouver une adresse de vanité consiste à sous-traiter le travail à un groupe ou bassin de mineurs de vanité, comme le groupe sur <a href="https://vanitypool.appspot.com" data-href="https://vanitypool.appspot.com">Vanity Pool</a>. Un groupe ou bassin de ce type est un service qui permet à ceux qui disposent de matériel GPU de gagner des bitcoins en recherchant des adresses personnalisées pour les autres. Pour un petit paiement (0,01 bitcoin ou environ 5 $ au moment d&#8217;écrire ces lignes), Eugenia peut externaliser la recherche d&#8217;une adresse personnalisée à sept caractères et obtenir des résultats en quelques heures au lieu d&#8217;avoir à exécuter une recherche de CPU pendant des mois.</p>
</div>
<div class="paragraph data-line-701">
<p>Générer une adresse personnalisée est un exercice de force brute : essayez une clé aléatoire, vérifiez l&#8217;adresse résultante pour voir si elle correspond au modèle souhaité, et répétez jusqu&#8217;à ce que vous réussissiez. <a href="#vanity_miner_code">Mineur d&#8217;adresse personnalisées (ou de vanité)</a> montre un exemple de "mineur de vanité", un programme conçu pour trouver des adresses personnalisées, écrit en C++. L&#8217;exemple utilise la bibliothèque libbitcoin, que nous avons introduite dans <a href="#alt_libraries">Clients, bibliothèques et boîtes à outils alternatifs</a>.</p>
</div>
<div id="vanity_miner_code" class="exampleblock data-line-705">
<div class="title">Example 16. Mineur d&#8217;adresse personnalisées (ou de vanité)</div>
<div class="content">
<div class="listingblock data-line-707">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;random&gt;
#include &lt;bitcoin/bitcoin.hpp&gt;

// La chaîne que nous recherchons
const std::string search = "1kid";

// Générer une clé secrète aléatoire. Un 32 octets aléatoires.
bc::ec_secret random_secret(std::default_random_engine&amp; engine);
// Extraire l'adresse Bitcoin d'un secret EC.
std::string bitcoin_address(const bc::ec_secret&amp; secret);
// Comparaison insensible à la casse avec la chaîne de recherche.
bool match_found(const std::string&amp; address);

int main()
{
    // random_device sous Linux utilise "/dev/urandom"
    // ATTENTION : selon la mise en œuvre, ce RNG peut ne pas être suffisamment sécurisé !
    // Ne pas utiliser les clés personnalisées générées par cet exemple en production
    std::random_device random;
    std::default_random_engine engine(random());

    // Boucle en continu...
    while (true)
    {
        // Générer un secret aléatoire.
        bc::ec_secret secret = random_secret(engine);
        // Obtenez l'adresse.
        std::string address = bitcoin_address(secret);
        // Correspond-il à votre chaîne de recherche ? (1kid)
        if (match_found(address))
        {
            // Succès!
            std::cout &lt;&lt; "Found vanity address! " &lt;&lt; address &lt;&lt; std::endl;
            std::cout &lt;&lt; "Secret: " &lt;&lt; bc::encode_base16(secret) &lt;&lt; std::endl;
            return 0;
        }
    }
    // Ne devrait jamais arriver ici !
    return 0;
}

bc::ec_secret random_secret(std::default_random_engine&amp; engine)
{
    // Créer un nouveau secret...
    bc::ec_secret secret;
    // Itérer sur chaque octet en définissant une valeur aléatoire...
    for (uint8_t&amp; byte: secret)
        byte = engine() % std::numeric_limits&lt;uint8_t&gt;::max();
    // Renvoyer le résultat.
    return secret;
}

std::string bitcoin_address(const bc::ec_secret&amp; secret)
{
    // Convertir le secret en adresse de paiement
    bc::wallet::ec_private private_key(secret);
    bc::wallet::payment_address payaddr(private_key);
    // Retourner le formulaire encodé.
    return payaddr.encoded();
}

bool match_found(const std::string&amp; address)
{
    auto addr_it = address.begin();
    // Parcourez la chaîne de recherche en la comparant au caractère minuscule de l'adresse fournie.
    for (auto it = search.begin(); it != search.end(); ++it, ++addr_it)
        if (*it != std::tolower(*addr_it))
            return false;
    // Fin de la chaîne de recherche atteinte, donc l'adresse correspond.
    return true;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-713">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-714">
<p><a href="#vanity_miner_code">Mineur d&#8217;adresse personnalisées (ou de vanité)</a> utilise std::random_device. Selon l&#8217;implémentation, cela peut refléter un CSRNG fourni par le système d&#8217;exploitation sous-jacent. Dans le cas d&#8217;un système d&#8217;exploitation de type Unix tel que Linux, il tire de /dev/urandom. Le générateur de nombres aléatoires utilisé ici est à des fins de démonstration n&#8217;est <em>pas</em> approprié pour générer des clés bitcoin de qualité production car il n&#8217;est pas implémenté avec une sécurité suffisante.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-717">
<p>L&#8217;exemple de code doit être compilé à l&#8217;aide d&#8217;un compilateur C++ et lié à la bibliothèque libbitcoin (qui doit d&#8217;abord être installée sur ce système). Pour exécuter l&#8217;exemple, lancez l&#8217;exécutable vanity-miner sans paramètres (voir <a href="#vanity_miner_run">Compilation et exécution de l&#8217;exemple vanity-miner</a>) et il tentera de trouver une adresse personnalisée commençant par "1kid".</p>
</div>
<div id="vanity_miner_run" class="exampleblock data-line-721">
<div class="title">Example 17. Compilation et exécution de l&#8217;exemple vanity-miner</div>
<div class="content">
<div class="listingblock data-line-723">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compiler le code avec g++
$ g++ -o vanity-miner vanity-miner.cpp $(pkg-config --cflags --libs libbitcoin)
# Exécutez l'exemple
$ ./vanity-miner
Found vanity address! 1KiDzkG4MxmovZryZRj8tK81oQRhbZ46YT
Secret: 57cc268a05f83a23ac9d930bc8565bac4e277055f4794cbd1a39e5e71c038f3f
# Exécutez-le à nouveau pour un résultat différent
$ ./vanity-miner
Found vanity address! 1Kidxr3wsmMzzouwXibKfwTYs5Pau8TUFn
Secret: 7f65bbbbe6d8caae74a0c6a0d2d7b5c6663d71b60337299a1a2cf34c04b2a623
# Utilisez "time" pour voir combien de temps il faut pour trouver un résultat
$ time ./vanity-miner
Found vanity address! 1KidPWhKgGRQWD5PP5TAnGfDyfWp5yceXM
Secret: 2a802e7a53d8aa237cd059377b616d2bfcfa4b0140bc85fa008f2d3d4b225349

real	0m8.868s
user	0m8.828s
sys	0m0.035s</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-745">
<p>L&#8217;exemple de code prendra quelques secondes pour trouver une correspondance pour le modèle à trois caractères "kid", comme nous pouvons le voir lorsque nous utilisons la commande Unix <code>time</code> pour mesurer le temps d&#8217;exécution. Modifiez le modèle <code>search</code> dans le code source et voyez combien de temps cela prend pour les modèles à quatre ou cinq caractères !</p>
</div>
</div>
<div class="sect4 data-line-747">
<h5 id="_sécurité_de_ladresse_personnalisée">Sécurité de l&#8217;adresse personnalisée</h5>
<div class="paragraph data-line-749">
<p>Les adresses personnalisées peuvent être utilisées pour améliorer <em>et</em> pour contourner les mesures de sécurité ; ils sont vraiment une épée à double tranchant. Utilisée pour améliorer la sécurité, une adresse distinctive rend plus difficile pour les adversaires de substituer leur propre adresse et de tromper vos clients en les payant à votre place. Malheureusement, les adresses personnalisées permettent également à quiconque de créer une adresse qui <em>ressemble</em> à n&#8217;importe quelle adresse aléatoire, ou même à une autre adresse personnalisée, trompant ainsi vos clients.</p>
</div>
<div class="paragraph data-line-751">
<p>Eugenia pourrait annoncer une adresse générée aléatoirement (par exemple, 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy) à laquelle les gens peuvent envoyer leurs dons. Ou, elle pourrait générer une adresse de vanité qui commence par 1Kids, pour la rendre plus distinctive.</p>
</div>
<div class="paragraph data-line-753">
<p>Dans les deux cas, l&#8217;un des risques d&#8217;utiliser une seule adresse fixe (plutôt qu&#8217;une adresse dynamique distincte par donateur) est qu&#8217;un voleur puisse s&#8217;infiltrer dans votre site Web et le remplacer par sa propre adresse, détournant ainsi les dons vers lui. Si vous avez annoncé votre adresse de don à plusieurs endroits différents, vos utilisateurs peuvent inspecter visuellement l&#8217;adresse avant d&#8217;effectuer un paiement pour s&#8217;assurer qu&#8217;il s&#8217;agit de la même adresse qu&#8217;ils ont vue sur votre site Web, sur votre e-mail et sur votre dépliant. Dans le cas d&#8217;une adresse aléatoire comme 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy, l&#8217;utilisateur moyen inspectera peut-être les premiers caractères "1J7mdg" et sera satisfait que l&#8217;adresse corresponde. À l&#8217;aide d&#8217;un générateur d&#8217;adresses personnalisées, une personne ayant l&#8217;intention de voler en substituant une adresse d&#8217;apparence similaire peut rapidement générer des adresses qui correspondent aux premiers caractères, comme indiqué dans <a href="#table_4-13">Génération d&#8217;adresses personnalisées pour correspondre à une adresse aléatoire</a>.</p>
</div>
<table id="table_4-13" class="tableblock frame-all grid-all stretch data-line-757">
<caption class="title">Table 7. Génération d&#8217;adresses personnalisées pour correspondre à une adresse aléatoire</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Adresse aléatoire originale</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vanité (correspondance à 4 caractères)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7md1QqU4LpctBetHS2ZoyLV5d6dShhEy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vanité (correspondance à 5 caractères)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdgYqyNd4ya3UEcq31Q7sqRMXw2XZ6n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vanité (correspondance à 6 caractères)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5WxGENmwyJP9xuGhG5KRzu99BBCX</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-764">
<p>Alors, une adresse personnalisée augmente-t-elle la sécurité ? Si Eugenia génère l&#8217;adresse personnalisée 1Kids33q44erFfpeXrmDSz7zEqG2FesZEN, les utilisateurs sont susceptibles de regarder le mot de modèle personnalisé <em>et quelques caractères au-delà</em>, par exemple en remarquant la partie "1Kids33" de l&#8217;adresse. Cela obligerait un attaquant à générer une adresse de vanité correspondant à au moins six caractères (deux de plus), en déployant un effort 3 364 fois (58 × 58) supérieur à l&#8217;effort qu&#8217;Eugenia a dépensé pour sa vanité à 4 caractères. Essentiellement, l&#8217;effort qu&#8217;Eugenia déploie (ou paie une vanité pour) "pousse" l&#8217;attaquant à devoir produire une vanité de modèle plus longue. Si Eugenia paie un pool pour générer une adresse de vanité à 8 caractères, l&#8217;attaquant serait poussé dans le domaine de 10 caractères, ce qui est irréalisable sur un ordinateur personnel et coûteux même avec une plate-forme d&#8217;extraction de vanité personnalisée ou un pool de vanité. Ce qui est abordable pour Eugenia devient inabordable pour l&#8217;attaquant, surtout si la récompense potentielle de la fraude n&#8217;est pas assez élevée pour couvrir le coût de la génération d&#8217;adresse personnalisée.</p>
</div>
</div>
</div>
<div class="sect3 data-line-767">
<h4 id="paper_wallets">Portefeuilles en papier</h4>
<div class="paragraph data-line-769">
<p> Les paper wallets, ou les portefeuilles en papier, sont des clés privées bitcoin imprimées sur papier. Souvent, le portefeuille papier comprend également l&#8217;adresse Bitcoin correspondante pour plus de commodité, mais ce n&#8217;est pas nécessaire car elle peut être dérivée de la clé privée.</p>
</div>
<div class="admonitionblock warning data-line-772">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-773">
<p>Les portefeuilles en papier sont une technologie OBSOLÈTE et sont dangereux pour la plupart des utilisateurs. Il existe de nombreux pièges subtils impliqués dans leur génération, notamment la possibilité que le code de génération soit compromis par une "porte dérobée". Des centaines de bitcoins ont été volés de cette façon. Les portefeuilles en papier sont présentés ici à titre informatif uniquement et ne doivent pas être utilisés pour stocker des bitcoins. Utilisez une phrase mnémonique BIP-39 pour sauvegarder vos clés. Utilisez un portefeuille matériel pour stocker des clés et signer des transactions. N&#8217;UTILISEZ PAS DE PORTEFEUILLES EN PAPIER.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-776">
<p>Les portefeuilles en papier se présentent sous de nombreuses formes, tailles et conceptions, mais à un niveau très basique, il ne s&#8217;agit que d&#8217;une clé et d&#8217;une adresse imprimées sur papier. <a href="#table_4-14">La forme la plus simple d&#8217;un portefeuille papier - une impression de l&#8217;adresse Bitcoin et de la clé privée</a> montre la forme la plus simple d&#8217;un portefeuille en papier.</p>
</div>
<table id="table_4-14" class="tableblock frame-all grid-all stretch data-line-781">
<caption class="title">Table 8. La forme la plus simple d&#8217;un portefeuille papier - une impression de l&#8217;adresse Bitcoin et de la clé privée</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Adresse publique</th>
<th class="tableblock halign-left valign-top">Clé privée (WIF)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1424C2F4bC9JidNjjTUZCbUxv6Sa1Mt62x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-786">
<p>Les portefeuilles en papier sont disponibles dans de nombreux modèles et tailles, avec de nombreuses fonctionnalités différentes. <a href="#paper_wallet_simple">Un exemple de portefeuille en papier simple</a> montre un exemple de portefeuille en papier.</p>
</div>
<div id="paper_wallet_simple" class="imageblock data-line-790">
<div class="content">
<img src="images/mbc2_0408.png" alt="mbc2 0408">
</div>
<div class="title">Figure 21. Un exemple de portefeuille en papier simple</div>
</div>
<div class="paragraph data-line-793">
<p>Certains sont destinés à être offerts en cadeau et ont des thèmes saisonniers, tels que les thèmes de Noël et du Nouvel An. D&#8217;autres sont conçus pour être stockés dans un coffre-fort de banque ou un coffre-fort avec la clé privée cachée d&#8217;une manière ou d&#8217;une autre, soit avec des autocollants opaques à gratter, soit pliés et scellés avec une feuille adhésive inviolable.</p>
</div>
<div class="paragraph data-line-795">
<p>D&#8217;autres conceptions comportent des copies supplémentaires de la clé et de l&#8217;adresse, sous la forme de talons détachables similaires aux talons de ticket, vous permettant de stocker plusieurs copies pour vous protéger contre les incendies, les inondations ou d&#8217;autres catastrophes naturelles.</p>
</div>
<div id="paper_wallet_spw" class="imageblock data-line-15">
<div class="content">
<img src="images/mbc2_0412.png" alt="mbc2 0412">
</div>
<div class="title">Figure 22. Un exemple de portefeuille papier avec des copies supplémentaires des clés sur un "talon" de sauvegarde</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ch05_wallets">Portefeuilles</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-4">
<p>Le mot "portefeuille" est utilisé pour décrire différentes choses dans le bitcoin.</p>
</div>
<div class="paragraph data-line-6">
<p>À un niveau élevé, un portefeuille est une application qui sert d&#8217;interface utilisateur principale. Le portefeuille contrôle l&#8217;accès à l&#8217;argent d&#8217;un utilisateur, gère les clés et les adresses, le solde et crée et signe des transactions.</p>
</div>
<div class="paragraph data-line-8">
<p>Plus précisément, du point de vue d&#8217;un programmeur, le mot "portefeuille" fait référence à la structure de données utilisée pour stocker et gérer les clés d&#8217;un utilisateur.</p>
</div>
<div class="paragraph data-line-10">
<p>Dans ce chapitre, nous examinerons la deuxième signification, où les portefeuilles sont des conteneurs de clés privées, généralement implémentés sous forme de fichiers structurés ou de simples bases de données.</p>
</div>
<div class="sect2 data-line-12">
<h3 id="_présentation_de_la_technologie_de_portefeuille">Présentation de la technologie de portefeuille</h3>
<div class="paragraph data-line-14">
<p>Dans cette section, nous résumons les différentes technologies utilisées pour construire des portefeuilles Bitcoin conviviaux, sécurisés et flexibles.</p>
</div>
<div class="paragraph data-line-16">
<p> Une idée faussement courante à propos du bitcoin est que les portefeuilles bitcoin contiennent du bitcoin. En fait, le portefeuille ne contient que des clés. Les "monnaies ou coins" sont enregistrés dans la chaîne de blocs sur le réseau Bitcoin. Les utilisateurs contrôlent les pièces sur le réseau en signant des transactions avec les clés de leur portefeuille. Dans un sens, un portefeuille bitcoin est un <em>porte-clés</em>.</p>
</div>
<div class="admonitionblock tip data-line-19">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-20">
<p>Les portefeuilles Bitcoin contiennent des clés, pas des pièces (ou coins). Chaque utilisateur dispose d&#8217;un portefeuille contenant des clés. Les portefeuilles sont en réalité des porte-clés contenant des paires de clés privées/publiques (voir <a href="#private_public_keys">Clés privées et publiques</a>). Les utilisateurs signent des transactions avec les clés, prouvant ainsi qu&#8217;ils sont propriétaires des sorties de transaction (leurs pièces ou monnaies). Les pièces sont stockées sur la chaîne de blocs sous la forme de sorties de transaction (souvent notées vout ou txout).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-23">
<p>Il existe deux principaux types de portefeuilles, qui se distinguent par le fait que les clés qu&#8217;ils contiennent sont liées les unes aux autres ou non.</p>
</div>
<div class="paragraph data-line-25">
<p>Le premier type est un <em>portefeuille non déterministe</em>, où chaque clé est générée indépendamment à partir d&#8217;un nombre aléatoire. Les clés ne sont pas liées les unes aux autres. Ce type de portefeuille est également connu sous le nom de portefeuille JBOK à partir de l&#8217;expression "Just a Bunch Of Keys" (juste une poignées de clés).</p>
</div>
<div class="paragraph data-line-27">
<p>Le deuxième type de portefeuille est un <em>portefeuille déterministe</em>, où toutes les clés sont dérivées d&#8217;une seule clé principale, connue sous le nom de <em>seed</em> (ou valeur d&#8217;amorçage). Toutes les clés de ce type de portefeuille sont liées les unes aux autres et peuvent être générées à nouveau si l&#8217;on dispose de la valeur d&#8217;amorçage d&#8217;origine.  Il existe un certain nombre de méthodes différentes de <em>dérivation de clé</em> utilisées dans les portefeuilles déterministes. La méthode de dérivation la plus couramment utilisée utilise une structure arborescente et est connue sous le nom de portefeuille <em>déterministe hiérarchique</em> ou <em>HD</em>.</p>
</div>
<div class="paragraph data-line-29">
<p>Les portefeuilles déterministes sont initialisés à partir d&#8217;une séquence aléatoire (une entropie). Pour faciliter leur utilisation, les séquences aléatoires sont encodées sous forme de mots anglais, également appelés <em>mots de code mnémoniques</em>.</p>
</div>
<div class="paragraph data-line-31">
<p>Les prochaines sections présentent chacune de ces technologies à un niveau élevé.</p>
</div>
<div class="sect3 data-line-34">
<h4 id="random_wallet">Portefeuilles non déterministes (aléatoires)</h4>
<div class="paragraph data-line-36">
<p>Dans le premier portefeuille bitcoin (maintenant appelé Bitcoin Core), les portefeuilles étaient des collections de clés privées générées aléatoirement. Par exemple, le client Bitcoin Core d&#8217;origine prégénère 100 clés privées aléatoires lors du premier démarrage et génère plus de clés si nécessaire, en utilisant chaque clé une seule fois. Ces portefeuilles sont remplacés par des portefeuilles déterministes car ils sont lourds à gérer, à sauvegarder et à importer. L&#8217;inconvénient des clés aléatoires est que si vous en générez beaucoup, vous devez conserver des copies de toutes, ce qui signifie que le portefeuille doit être sauvegardé fréquemment. Chaque clé doit être sauvegardée, sinon les fonds qu&#8217;elle contrôle sont irrévocablement perdus si le portefeuille devient inaccessible. Cela entre directement en conflit avec le principe d&#8217;éviter la réutilisation des adresses, en utilisant chaque adresse Bitcoin pour une seule transaction. La réutilisation des adresses réduit la confidentialité en associant plusieurs transactions et adresses les unes aux autres. Un portefeuille non déterministe de type-0 est un mauvais choix de portefeuille, surtout si vous voulez éviter la réutilisation des adresses car cela implique de gérer de nombreuses clés, ce qui crée le besoin de sauvegardes fréquentes. Bien que le client Bitcoin Core inclue un portefeuille de type 0, l&#8217;utilisation de ce portefeuille est déconseillée par les développeurs de Bitcoin Core. <a href="#Type0_wallet">Portefeuille non déterministe (aléatoire) de type-0 : une collection de clés générées aléatoirement</a> montre un portefeuille non déterministe, contenant une collection lâche de clés aléatoires.</p>
</div>
<div class="admonitionblock tip data-line-39">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-40">
<p>L&#8217;utilisation de portefeuilles non déterministes est déconseillée pour autre chose que de simples tests. Ils sont tout simplement trop lourds à sauvegarder et à utiliser. À la place, utilisez un <em>portefeuille HD</em> standard de l&#8217;industrie avec une séquence aléatoire <em>mnémonique</em> (entropie, ou "valeur d&#8217;amorçage") pour la sauvegarde.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Type0_wallet" class="imageblock smallersixty data-line-46">
<div class="content">
<img src="images/mbc2_0501.png" alt="Portefeuille non déterministe">
</div>
<div class="title">Figure 23. Portefeuille non déterministe (aléatoire) de type-0 : une collection de clés générées aléatoirement</div>
</div>
</div>
<div class="sect3 data-line-48">
<h4 id="_portefeuilles_déterministes_ensemencés">Portefeuilles déterministes (ensemencés)</h4>
<div class="paragraph data-line-50">
<p>Les portefeuilles déterministes ou "ensemencés" sont des portefeuilles qui contiennent des clés privées qui sont toutes dérivées d&#8217;une valeur d&#8217;amorçage commune, grâce à l&#8217;utilisation d&#8217;un fonction de hachage à sens unique. La valeur d&#8217;amorçage est un nombre généré aléatoirement qui est combiné avec d&#8217;autres données, telles qu&#8217;un numéro d&#8217;index ou un "code de chaîne" (voir <a href="#hd_wallets">Portefeuilles HD (BIP-32/BIP-44)</a>) pour dériver les clés privées. Dans un portefeuille déterministe, la valeur d&#8217;amorçage est suffisante pour récupérer toutes les clés dérivées, et donc une seule sauvegarde au moment de la création est suffisante. La valeur d&#8217;amorçage est également suffisante pour une exportation ou une importation de portefeuille, permettant une migration facile de toutes les clés de l&#8217;utilisateur entre différentes implémentations de portefeuille. <a href="#Type1_wallet">Portefeuille déterministe (ensemencé) de type-1 : une séquence déterministe de clés dérivée d&#8217;une valeur d&#8217;amorçage</a> montre un diagramme logique d&#8217;un portefeuille déterministe.</p>
</div>
<div id="Type1_wallet" class="imageblock smallersixty data-line-55">
<div class="content">
<img src="images/mbc2_0502.png" alt="Portefeuille déterministe">
</div>
<div class="title">Figure 24. Portefeuille déterministe (ensemencé) de type-1 : une séquence déterministe de clés dérivée d&#8217;une valeur d&#8217;amorçage</div>
</div>
</div>
<div class="sect3 data-line-58">
<h4 id="hd_wallets">Portefeuilles HD (BIP-32/BIP-44)</h4>
<div class="paragraph data-line-60">
<p>Des portefeuilles déterministes ont été développés pour faciliter la dérivation de nombreuses clés à partir d&#8217;une seule "valeur d&#8217;amorçage". La forme la plus avancée de portefeuilles déterministes est le portefeuille HD défini par la norme BIP-32. Les portefeuilles HD contiennent des clés dérivées dans une structure arborescente, de sorte qu&#8217;une clé parent peut dériver une séquence de clés enfants, chacune pouvant dériver une séquence de clés petits-enfants, et ainsi de suite, jusqu&#8217;à une profondeur infinie. Cette arborescence est illustrée dans <a href="#Type2_wallet">Portefeuille HD de type-2 : un arbre de clés généré à partir d&#8217;une seule valeur d&#8217;amorçage</a>.</p>
</div>
<div id="Type2_wallet" class="imageblock data-line-64">
<div class="content">
<img src="images/mbc2_0503.png" alt="portefeuille HD">
</div>
<div class="title">Figure 25. Portefeuille HD de type-2 : un arbre de clés généré à partir d&#8217;une seule valeur d&#8217;amorçage</div>
</div>
<div class="paragraph data-line-66">
<p>Les portefeuilles HD offrent deux avantages majeurs par rapport aux clés aléatoires (non déterministes). Tout d&#8217;abord, la structure arborescente peut être utilisée pour exprimer une signification organisationnelle supplémentaire, par exemple lorsqu&#8217;une branche spécifique de sous-clés est utilisée pour recevoir des paiements entrants et qu&#8217;une branche différente est utilisée pour recevoir la monnaie des paiements sortants. Les branches de clés peuvent également être utilisées dans les paramètres de l&#8217;entreprise, en attribuant différentes branches à des départements, des filiales, des fonctions spécifiques ou des catégories comptables.</p>
</div>
<div class="paragraph data-line-68">
<p>Le deuxième avantage des portefeuilles HD est que les utilisateurs peuvent créer une séquence de clés publiques sans avoir accès aux clés privées correspondantes. Cela permet aux portefeuilles HD d&#8217;être utilisés sur un serveur non sécurisé ou dans une capacité de réception uniquement, en émettant une clé publique différente pour chaque transaction. Les clés publiques n&#8217;ont pas besoin d&#8217;être préchargées ou dérivées à l&#8217;avance, mais le serveur ne dispose pas des clés privées qui peuvent dépenser les fonds.</p>
</div>
</div>
<div class="sect3 data-line-70">
<h4 id="_valeurs_damorçages_ou_graines_et_codes_mnémoniques_bip_39">Valeurs d&#8217;amorçages (ou graines) et codes mnémoniques (BIP-39)</h4>
<div class="paragraph data-line-72">
<p>Les portefeuilles HD sont un mécanisme très puissant pour gérer de nombreuses clés et adresses. Ils sont encore plus utiles s&#8217;ils sont combinés à une manière standardisée de créer des valeurs d&#8217;amorçage à partir d&#8217;une séquence de mots anglais faciles à transcrire, exporter et importer sur plusieurs portefeuilles. C&#8217;est ce qu&#8217;on appelle un <em>mnémonique</em> et la norme est définie par BIP-39. Aujourd&#8217;hui, la plupart des portefeuilles Bitcoin (ainsi que des portefeuilles pour d&#8217;autres cryptomonnaies) utilisent cette norme et peuvent importer et exporter des valeurs d&#8217;amorçage pour la sauvegarde et la récupération à l&#8217;aide de mnémoniques interopérables.</p>
</div>
<div class="paragraph data-line-74">
<p>Regardons cela d&#8217;un point de vue pratique. Laquelle des valeurs d&#8217;amorçage suivantes est la plus facile à transcrire, à enregistrer sur papier, à lire sans erreur ou à exporter et à importer dans un autre portefeuille ?</p>
</div>
<div class="listingblock data-line-77">
<div class="title">Une valeur d&#8217;amorçage pour un portefeuille déterministe, en hexadécimal</div>
<div class="content">
<pre>0C1E24E5917779D297E14D45F14E1A1A</pre>
</div>
</div>
<div class="listingblock data-line-82">
<div class="title">Une valeur d&#8217;amorçage pour un portefeuille déterministe, à partir d&#8217;un mnémonique de 12 mots</div>
<div class="content">
<pre>army van defense carry jealous true
garbage claim echo media make crunch</pre>
</div>
</div>
</div>
<div class="sect3 data-line-87">
<h4 id="_meilleures_procédures_de_portefeuille">Meilleures procédures de portefeuille</h4>
<div class="paragraph data-line-89">
<p>Au fur et à mesure que les portefeuilles de Bitcoin ont atteint un degré de maturité, certaines normes industrielles mis en commun ont émergé, rendant de nos jours des portefeuilles Bitcoin largement interopérables, faciles à utiliser, sécurisés et flexibles. Ces normes communes sont :</p>
</div>
<div class="ulist data-line-91">
<ul>
<li class="data-line-91">
<p>Mots de code mnémonique, basés sur BIP-39</p>
</li>
<li class="data-line-92">
<p>Portefeuilles HD, basés sur BIP-32</p>
</li>
<li class="data-line-93">
<p>Structure de portefeuille HD polyvalente, basée sur BIP-43</p>
</li>
<li class="data-line-94">
<p>Portefeuilles multidevises et multicomptes, basés sur BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-96">
<p>Ces normes peuvent changer ou devenir obsolètes en raison de développements futurs, mais pour l&#8217;instant, elles forment un ensemble de technologies imbriquées qui sont devenues de facto la norme de portefeuille pour le bitcoin.</p>
</div>
<div class="paragraph data-line-98">
<p>Les normes ont été adoptées par une large gamme de portefeuilles bitcoin logiciels et matériels, rendant tous ces portefeuilles interopérables. Un utilisateur peut exporter un mnémonique généré sur l&#8217;un de ces portefeuilles et l&#8217;importer dans un autre portefeuille, récupérant toutes les transactions, clés et adresses.</p>
</div>
<div class="paragraph data-line-100">
<p> Quelques exemples de portefeuilles logiciels prenant en charge ces normes incluent (par ordre alphabétique) Bluewallet, Breadwallet, Copay et Multibit HD. Des exemples de portefeuilles matériels prenant en charge ces normes incluent (par ordre alphabétique) KeepKey, Ledger et Trezor.</p>
</div>
<div class="paragraph data-line-102">
<p>Les sections suivantes examinent chacune de ces technologies en détail.</p>
</div>
<div class="admonitionblock tip data-line-105">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-106">
<p>Si vous implémentez un portefeuille bitcoin, il doit être construit comme un portefeuille HD, avec une valeur d&#8217;amorçage dérivée et codée comme un code mnémonique pour la sauvegarde, suivant les normes BIP-32, BIP-39, BIP-43 et BIP-44, comme décrit dans les sections suivantes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-109">
<h4 id="_utiliser_un_portefeuille_bitcoin">Utiliser un portefeuille Bitcoin</h4>
<div class="paragraph data-line-111">
<p>Dans <a href="#user-stories">Utilisations, utilisateurs et histoires de Bitcoin</a> nous avons présenté Gabriel, un jeune adolescent entreprenant à Rio de Janeiro, qui gère une simple boutique en ligne qui vend des t-shirts de marque bitcoin, des tasses à café et des autocollants.</p>
</div>
<div class="paragraph data-line-113">
<p>Gabriel utilise un portefeuille matériel bitcoin Trezor (<a href="#a_trezor_device">Un appareil Trezor : un portefeuille bitcoin HD en matériel</a>) pour gérer en toute sécurité son bitcoin. Le Trezor est un simple périphérique USB à deux boutons qui stocke les clés (sous la forme d&#8217;un portefeuille HD) et signe les transactions. Les portefeuilles Trezor mettent en œuvre toutes les normes de l&#8217;industrie abordées dans ce chapitre, de sorte que Gabriel ne dépend d&#8217;aucune technologie propriétaire ou d&#8217;une solution de fournisseur unique.</p>
</div>
<div id="a_trezor_device" class="imageblock data-line-117">
<div class="content">
<img src="images/mbc2_0504.png" alt="alt">
</div>
<div class="title">Figure 26. Un appareil Trezor : un portefeuille bitcoin HD en matériel</div>
</div>
<div class="paragraph data-line-119">
<p>Lorsque Gabriel a utilisé le Trezor pour la première fois, l&#8217;appareil a généré une séquence aléatoire (entropie), le mnémonique associé et a dérivé une valeur d&#8217;amorçage à partir d&#8217;un générateur de nombres aléatoires matériel intégré. Lors de cette phase d&#8217;initialisation, le portefeuille affichait à l&#8217;écran une séquence de mots numérotés, un par un (voir <a href="#trezor_mnemonic_display">Trezor affichant un des mots mnémoniques</a>).</p>
</div>
<div id="trezor_mnemonic_display" class="imageblock data-line-123">
<div class="content">
<img src="images/mbc2_0505.png" alt="Vue des mots mnémoniques du portefeuille Trezor">
</div>
<div class="title">Figure 27. Trezor affichant un des mots mnémoniques</div>
</div>
<div class="paragraph data-line-125">
<p>En écrivant ce mnémonique, Gabriel a créé une sauvegarde (voir <a href="#mnemonic_paper_backup">La sauvegarde papier de Gabriel du mnémonique</a>) qui peut être utilisé pour la récupération en cas de perte ou d&#8217;endommagement de l&#8217;appareil Trezor. Ce mnémonique peut être utilisé pour la récupération dans un nouveau Trezor ou dans l&#8217;un des nombreux portefeuilles logiciels ou matériels compatibles. Notez que la séquence des mots est importante, donc les sauvegardes papier mnémotechniques ont des espaces numérotés pour chaque mot. Gabriel a dû enregistrer soigneusement chaque mot dans l&#8217;espace numéroté pour préserver la séquence correcte.</p>
</div>
<table id="mnemonic_paper_backup" class="tableblock frame-all grid-all data-line-130" style="width: 80%;">
<caption class="title">Table 9. La sauvegarde papier de Gabriel du mnémonique</caption>
<colgroup>
<col style="width: 0.9803%;">
<col style="width: 49.0196%;">
<col style="width: 0.9803%;">
<col style="width: 49.0198%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>army</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>garbage</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>van</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>claim</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>defense</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>echo</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>carry</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>media</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>jealous</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>11.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>make</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>crunch</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-140">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-141">
<p>Un mnémonique de 12 mots est affiché dans <a href="#mnemonic_paper_backup">La sauvegarde papier de Gabriel du mnémonique</a>, pour plus de simplicité. En fait, la plupart des portefeuilles matériels génèrent un mnémonique de 24 mots plus sécurisé. Le mnémonique est utilisé exactement de la même manière, quelle que soit sa longueur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-144">
<p>Pour la première implémentation de sa boutique en ligne, Gabriel utilise une seule adresse Bitcoin, générée sur son appareil Trezor. Cette adresse unique est utilisée par tous les clients pour toutes les commandes. Comme nous le verrons, cette approche présente quelques inconvénients et peut être améliorée avec un portefeuille HD.</p>
</div>
</div>
</div>
<div class="sect2 data-line-146">
<h3 id="_détails_de_la_technologie_de_portefeuille">Détails de la technologie de portefeuille</h3>
<div class="paragraph data-line-148">
<p>Examinons maintenant en détail chacune des normes importantes de l&#8217;industrie utilisées par de nombreux portefeuilles Bitcoin.</p>
</div>
<div class="sect3 data-line-151">
<h4 id="mnemonic_code_words">Mots de code mnémonique (BIP-39)</h4>
<div class="paragraph data-line-153">
<p>Les mots de code mnémonique sont des séquences de mots qui représentent (encodent) un nombre aléatoire utilisé comme valeur d&#8217;amorçage pour dériver un portefeuille déterministe. La séquence de mots est suffisante pour recréer la valeur d&#8217;amorçage et à partir de là recréer le portefeuille et toutes les clés dérivées. Une application de portefeuille qui implémente des portefeuilles déterministes avec des mots mnémoniques montrera à l&#8217;utilisateur une séquence de 12 à 24 mots lors de la première création d&#8217;un portefeuille. Cette séquence de mots est à sauvegarder et est la valeur d&#8217;amorçage du portefeuille. Elle peut être utilisée pour récupérer et recréer toutes les clés dans la même application de portefeuille ou dans n&#8217;importe quelle application de portefeuille compatible. Les mots mnémotechniques facilitent la sauvegarde des portefeuilles par les utilisateurs, car ils sont faciles à lire et à transcrire correctement, par rapport à une séquence aléatoire de chiffres.</p>
</div>
<div class="admonitionblock tip data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p>Les mots mnémoniques sont souvent confondus avec les "brainwallets". Ils ne sont pas les mêmes. La principale différence est qu&#8217;un brainwallet se compose de mots choisis par l&#8217;utilisateur, tandis que les mots mnémoniques sont créés de manière aléatoire par le portefeuille et présentés à l&#8217;utilisateur. Cette différence importante rend les mots mnémoniques beaucoup plus sûrs, car les humains sont de très mauvaises sources d&#8217;aléatoire.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Les codes mnémoniques sont définis dans le BIP-39 (voir <a href="#appdxbitcoinimpproposals">Bitcoin Improvement Proposals (ou Propositions d&#8217;amélioration du Bitcoin)</a>). Notez que BIP-39 est une implémentation d&#8217;une norme de code mnémonique. Il existe une norme différente, avec un ensemble de mots différent, utilisée par le portefeuille Electrum et antérieure à BIP-39. BIP-39 a été proposé par la société à l&#8217;origine du portefeuille matériel Trezor et est incompatible avec la mise en œuvre d&#8217;Electrum. Cependant, BIP-39 a maintenant obtenu un large soutien de l&#8217;industrie à travers des dizaines d&#8217;implémentations interopérables et devrait être considéré comme la norme de facto de l&#8217;industrie.</p>
</div>
<div class="paragraph data-line-162">
<p>La BIP-39 définit la création d&#8217;un code mnémonique et d&#8217;une valeur d&#8217;amorçage, que nous décrivons ici en neuf étapes. Pour plus de clarté, le processus est divisé en deux parties : les étapes 1 à 6 sont présentées dans <a href="#generating_mnemonic_words">Génération de mots mnémoniques</a> et les étapes 7 à 9 sont illustrées dans <a href="#mnemonic_to_seed">Du mnémonique à la valeur d&#8217;amorçage</a>.</p>
</div>
<div class="sect4 data-line-165">
<h5 id="generating_mnemonic_words">Génération de mots mnémoniques</h5>
<div class="paragraph data-line-167">
<p>Les mots mnémoniques sont générés automatiquement par le portefeuille en utilisant le processus standardisé défini dans BIP-39. Le portefeuille part d&#8217;une source d&#8217;entropie, ajoute une somme de contrôle, puis mappe l&#8217;entropie sur une liste de mots :</p>
</div>
<div class="olist arabic data-line-169">
<ol class="arabic">
<li class="data-line-169">
<p>Créez une séquence aléatoire (entropie) de 128 à 256 bits.</p>
</li>
<li class="data-line-170">
<p>Créez une somme de contrôle de la séquence aléatoire en prenant les premiers bits (longueur d&#8217;entropie/32) de son hachage SHA256.</p>
</li>
<li class="data-line-171">
<p>Ajoutez la somme de contrôle à la fin de la séquence aléatoire.</p>
</li>
<li class="data-line-172">
<p>Divisez le résultat en segments de 11 bits.</p>
</li>
<li class="data-line-173">
<p>Associez chaque valeur 11 bits à un mot du dictionnaire prédéfini de 2048 mots.</p>
</li>
<li class="data-line-174">
<p>Le code mnémonique est la séquence de mots.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-176">
<p><a href="#generating_entropy_and_encoding">Génération d&#8217;entropie et encodage sous forme de mots mnémoniques</a> montre comment l&#8217;entropie est utilisée pour générer des mots mnémoniques.</p>
</div>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-181">
<div class="content">
<img src="images/mbc2_0506.png" alt="Génération d&#8217;entropie et encodage sous forme de mots mnémoniques">
</div>
<div class="title">Figure 28. Génération d&#8217;entropie et encodage sous forme de mots mnémoniques</div>
</div>
<div class="paragraph data-line-183">
<p><a href="#table_4-5">Codes mnémoniques : entropie et longueur des mots</a> montre la relation entre la taille des données d&#8217;entropie et la longueur des codes mnémoniques en mots.</p>
</div>
<table id="table_4-5" class="tableblock frame-all grid-all stretch data-line-188">
<caption class="title">Table 10. Codes mnémoniques : entropie et longueur des mots</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropie (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contrôle (bits)</th>
<th class="tableblock halign-left valign-top">Somme de contrôle d&#8217;entropie <strong>+</strong> (bits)</th>
<th class="tableblock halign-left valign-top">Longueur mnémonique (mots)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-198">
<h5 id="mnemonic_to_seed">Du mnémonique à la valeur d&#8217;amorçage</h5>
<div class="paragraph data-line-200">
<p>Les mots mnémoniques représentent l&#8217;entropie d&#8217;une longueur de 128 à 256 bits. L&#8217;entropie est ensuite utilisée pour dériver une valeur d&#8217;amorçage plus longue (512 bits) grâce à l&#8217;utilisation de la fonction d&#8217;étirement de clé PBKDF2. La valeur d&#8217;amorçage produite est ensuite utilisée pour construire un portefeuille déterministe et en dériver ses clés.</p>
</div>
<div class="paragraph data-line-202">
<p>La fonction d&#8217;étirement de clé prend deux paramètres : le mnémonique et un <em>sel</em>. Le but d&#8217;un sel dans une fonction d&#8217;étirement de clé est de rendre difficile la construction d&#8217;une table de recherche permettant une attaque par force brute. Dans la norme BIP-39, le sel a un autre objectif : il permet l&#8217;introduction d&#8217;une phrase secrète qui sert de facteur de sécurité supplémentaire protégeant la valeur d&#8217;amorçage, comme nous le décrirons plus en détail dans <a href="#mnemonic_passphrase">Phrase secrète facultative dans BIP-39</a>.</p>
</div>
<div class="paragraph data-line-204">
<p>Le processus décrit aux étapes 7 à 9 continue à partir du processus décrit précédemment dans <a href="#generating_mnemonic_words">Génération de mots mnémoniques</a> :</p>
</div>
<ol start="7">
	<li>Le premier paramètre de la fonction d'étirement de clé PBKDF2 est le <em>mnémonique</em> produit à partir de l'étape 6.</li>
	<li>Le deuxième paramètre de la fonction d'étirement de clé PBKDF2 est un <em>sel</em> . Le sel est composé de la constante de chaîne "<code>mnemonique</code>" concaténée avec une phrase secrète facultative fournie par l'utilisateur.</li>
	<li>PBKDF2 étend les paramètres mnémoniques et le sel en utilisant 2048 cycles de hachage avec l'algorithme HMAC-SHA512, produisant une valeur de 512 bits comme sortie finale. Cette valeur de 512 bits est la valeur d'amorçage.</li>
</ol>
<div class="paragraph data-line-214">
<p><a href="#fig_5_7">Du mnémonique à la valeur d&#8217;amorçage</a> montre comment un mnémonique est utilisé pour générer une valeur d&#8217;amorçage.</p>
</div>
<div id="fig_5_7" class="imageblock data-line-218">
<div class="content">
<img src="images/mbc2_0507.png" alt="Du mnémonique à la valeur d&#8217;amorçage">
</div>
<div class="title">Figure 29. Du mnémonique à la valeur d&#8217;amorçage</div>
</div>
<div class="admonitionblock tip data-line-221">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-222">
<p>La fonction d&#8217;étirement de clé, avec ses 2048 tours de hachage, est une protection très efficace contre les attaques par force brute contre le mnémonique ou la phrase secrète. Cela rend extrêmement coûteux (en calcul) d&#8217;essayer plus de quelques milliers de combinaisons de mots de passe et de mnémoniques, alors que le nombre de valeurs d&#8217;amorçage dérivées possibles est vaste (2<sup>512</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-225">
<p>Les tableaux <a data-type="xref" href="#mnemonic_128_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_no_pass</a>, <a data-type="xref" href="#mnemonic_128_w_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_w_pass</a> et <a data-type="xref" href="#mnemonic_256_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_256_no_pass</a> montrent quelques exemples de codes mnémoniques et les valeurs d&#8217;amorçage qu&#8217;ils produisent (avec ou sans phrase secrète).</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-230">
<caption class="title">Table 11. Code mnémonique d&#8217;entropie 128 bits, sans phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#8217;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-241">
<caption class="title">Table 12. Code mnémonique d&#8217;entropie 128 bits, avec phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#8217;entropie (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (12 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçage (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch data-line-253">
<caption class="title">Table 13. Code mnémonique d&#8217;entropie 256 bits, sans phrase secrète, valeur d&#8217;amorçage résultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entrée d&#8217;entropie (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnémonique (24 mots)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Phrase secrète</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(rien)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur d&#8217;amorçge (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip data-line-263">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-264">
<p>De nombreux portefeuilles ne permettent pas la création de portefeuilles avec plus d&#8217;une phrase mnémonique de 12 mots. Vous remarquerez dans les tableaux ci-dessus que malgré les longueurs uniques d&#8217;entrée d&#8217;entropie, la taille de la valeur d&#8217;amorçage reste la même (512 bits). Du point de vue de la sécurité, la quantité d&#8217;entropie réellement utilisée pour la production de portefeuilles HD est d&#8217;environ 128 bits, ce qui équivaut à 12 mots. Fournir plus de 12 mots produit une entropie supplémentaire qui n&#8217;est pas nécessaire, et cette entropie est <em>inutilisée</em>  pour la dérivation de la valeur d&#8217;amorçage de la manière que l&#8217;on pourrait initialement soupçonner. Du point de vue de la convivialité, 12 mots sont également plus faciles à écrire, à sauvegarder et à stocker.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-268">
<h5 id="mnemonic_passphrase">Phrase secrète facultative dans BIP-39</h5>
<div class="paragraph data-line-270">
<p>La norme BIP-39 permet l&#8217;utilisation d&#8217;une phrase secrète facultative dans la dérivation de la valeur d&#8217;amorçage. Si aucune phrase secrète n&#8217;est utilisée, le mnémonique est étiré avec un sel constitué de la chaîne constante "mnémonique", produisant une valeur d&#8217;amorçage spécifique de 512 bits à partir de n&#8217;importe quel mnémonique donné. Si une phrase secrète est utilisée, la fonction d&#8217;étirement produit une valeur d&#8217;amorçage <em>différente</em> à partir de ce même mnémonique. En fait, étant donné un seul mnémonique, chaque phrases secrètes possible conduit à une valeurs d&#8217;amorçage différente. Essentiellement, il n&#8217;y a pas de "mauvaise" phrase secrète. Toutes les phrases secrètes sont valides et mènent toutes à des valeurs d&#8217;amorçage différentes, formant un vaste ensemble de portefeuilles non initialisés possibles. L&#8217;ensemble des portefeuilles possibles est si grand (2<sup>512</sup>) qu&#8217;il n&#8217;y a aucune possibilité pratique de forcer brutalement ou de deviner accidentellement celui qui est utilisé.</p>
</div>
<div class="admonitionblock tip data-line-273">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-274">
<p>Il n&#8217;y a pas de "mauvaises" phrases secrètes dans BIP-39. Chaque phrase secrète mène à un portefeuille qui, à moins qu&#8217;il n&#8217;ait été utilisé auparavant, sera vide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-277">
<p>La phrase secrète facultative crée deux fonctionnalités importantes :</p>
</div>
<div class="ulist data-line-279">
<ul>
<li class="data-line-279">
<p>Un deuxième facteur (quelque chose de mémorisé) qui rend un mnémonique inutile par lui-même, protégeant les sauvegardes mnémoniques de la compromission par un voleur.</p>
</li>
<li class="data-line-281">
<p>Une forme de déni plausible ou "portefeuille sous contrainte", où une phrase secrète choisie mène à un portefeuille avec une petite quantité de fonds utilisée pour distraire un attaquant du "vrai" portefeuille qui contient la majorité des fonds.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-283">
<p>Cependant, il est important de noter que l&#8217;utilisation d&#8217;une phrase secrète introduit également un risque de perte :</p>
</div>
<div class="ulist data-line-285">
<ul>
<li class="data-line-285">
<p>Si le propriétaire du portefeuille est incapacité ou décédé et que personne d&#8217;autre ne connaît la phrase secrète, le code mnémonique est inutile et tous les fonds stockés dans le portefeuille sont perdus à jamais.</p>
</li>
<li class="data-line-287">
<p>À l&#8217;inverse, si le propriétaire sauvegarde la phrase secrète au même endroit que le code mnémonique, cela va à l&#8217;encontre de l&#8217;objectif d&#8217;un deuxième facteur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-289">
<p>Bien que les phrases secrètes soient très utiles, elles ne doivent être utilisées qu&#8217;en combinaison avec un processus soigneusement planifié de sauvegarde et de récupération, compte tenu de la possibilité de survivre au propriétaire et de permettre à sa famille de récupérer le patrimoine de la cryptomonnaie.</p>
</div>
</div>
<div class="sect4 data-line-291">
<h5 id="_travailler_avec_des_codes_mnémoniques">Travailler avec des codes mnémoniques</h5>
<div class="paragraph data-line-293">
<p>BIP-39 est implémenté en tant que bibliothèque dans de nombreux langages de programmation différents :</p>
</div>
<div class="dlist data-line-295">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>L&#8217;implémentation de référence de la norme par l&#8217;équipe SatoshiLabs qui a proposé BIP-39, en Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoinjs/bip39" data-href="https://github.com/bitcoinjs/bip39">bitcoinjs/bip39</a></dt>
<dd>
<p>Une implémentation de BIP-39, dans le cadre du populaire framework bitcoinJS, en JavaScript</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp" data-href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp">libbitcoin/mnemonic</a></dt>
<dd>
<p>Une implémentation de BIP-39, dans le cadre du populaire framework Libbitcoin, en <span class="keep-together">C++</span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-301">
<h4 id="_créer_un_portefeuille_hd_à_partir_de_la_valeur_damorçage">Créer un portefeuille HD à partir de la valeur d&#8217;amorçage</h4>
<div class="paragraph data-line-303">
<p>Les portefeuilles HD sont créé à partir d&#8217;une seule <em>valeur d&#8217;amorçage racine</em>, qui est un nombre aléatoire de 128, 256 ou 512 bits. Le plus souvent, cette valeur d&#8217;amorçage est générée à partir d&#8217;un <em>mnemonique</em> comme détaillé dans la section précédente.</p>
</div>
<div class="paragraph data-line-305">
<p>Chaque clé du portefeuille HD est dérivée de manière déterministe de cette valeur d&#8217;amorçage racine, ce qui permet de recréer l&#8217;intégralité du portefeuille HD à partir de cette valeur d&#8217;amorçage dans n&#8217;importe quel portefeuille HD compatible. Cela facilite la sauvegarde, la restauration, l&#8217;exportation et l&#8217;importation de portefeuilles HD contenant des milliers, voire des millions de clés en transférant simplement uniquement le mnémonique dont la valeur d&#8217;amorçage racine est dérivée.</p>
</div>
<div class="paragraph data-line-307">
<p>Le processus de création des clés principales et du code de chaîne principal pour un portefeuille HD est illustré dans <a href="#HDWalletFromSeed">Création de clés principales et de code de chaîne à partir d&#8217;une valeur d&#8217;amorçage racine</a>.</p>
</div>
<div id="HDWalletFromSeed" class="imageblock data-line-311">
<div class="content">
<img src="images/mbc2_0509.png" alt="Valeur d&#8217;amorçage racine du portefeuille HD">
</div>
<div class="title">Figure 30. Création de clés principales et de code de chaîne à partir d&#8217;une valeur d&#8217;amorçage racine</div>
</div>
<div class="paragraph data-line-313">
<p>La valeur d&#8217;amorçage racine est entrée dans l&#8217;algorithme HMAC-SHA512 et le hachage résultant est utilisé pour créer une <em>clé privée principale</em> (m) et un <em>code de chaîne principal</em> (c).</p>
</div>
<div class="paragraph data-line-315">
<p>La clé privée principale (m) génère ensuite une clé publique principale correspondante (M) en utilisant le processus normal de multiplication de courbe elliptique <code>m * G</code> que nous avons vu dans <a href="#pubkey">Clés publiques</a>.</p>
</div>
<div class="paragraph data-line-317">
<p>Le code de chaîne (c) est utilisé pour introduire de l&#8217;entropie dans la fonction qui crée des clés enfants à partir des clés parents, comme nous le verrons dans la section suivante.</p>
</div>
<div class="sect4 data-line-319">
<h5 id="_dérivation_de_clé_enfant_privée">Dérivation de clé enfant privée</h5>
<div class="paragraph data-line-321">
<p>Les portefeuilles HD utilisent une fonction <em>dérivation de la clé enfant</em> (CKD) pour dériver les clés enfants à partir des clés parents.</p>
</div>
<div class="paragraph data-line-323">
<p>Les fonctions de dérivation de la clé enfant sont basées sur une fonction de hachage unidirectionnelle qui combine :</p>
</div>
<div class="ulist data-line-325">
<ul>
<li class="data-line-325">
<p>Une clé privée ou publique parent (clé compressée ECDSA)</p>
</li>
<li class="data-line-326">
<p>Une valeur d&#8217;amorçage appelée code de chaîne (256 bits)</p>
</li>
<li class="data-line-327">
<p>Un numéro d&#8217;index (32 bits)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-329">
<p>Le code de chaîne est utilisé pour introduire des données aléatoires déterministes dans le processus, de sorte que la connaissance de l&#8217;index et d&#8217;une clé enfant ne suffit pas pour dériver d&#8217;autres clés enfants. Connaître une clé enfant ne permet pas de retrouver ses frères et sœurs, sauf si vous disposez également du code chaîne. La valeur d&#8217;amorçage de code de chaîne initiale (à la racine de l&#8217;arborescence) est créée à partir de la valeur d&#8217;amorçage, tandis que les codes de chaîne enfants suivants sont dérivés de chaque code de chaîne parent.</p>
</div>
<div class="paragraph data-line-331">
<p>Ces trois éléments (clé parent, code de chaîne et index) sont combinés et hachés pour générer des clés enfants, comme suit.</p>
</div>
<div class="paragraph data-line-333">
<p>La clé publique parent, le code de chaîne et le numéro d&#8217;index sont combinés et hachés avec l&#8217;algorithme HMAC-SHA512 pour produire un hachage de 512 bits. Ce hachage de 512 bits est divisé en deux moitiés de 256 bits. Les 256 bits de la moitié droite de la sortie de hachage deviennent le code de chaîne pour l&#8217;enfant. Les 256 bits de la moitié gauche du hachage sont ajoutés à la clé parent pour produire la clé privée enfant. Dans <a href="#CKDpriv">Étendre une clé privée parent pour créer une clé privée enfant</a>, nous voyons cela illustré avec l&#8217;index mis à 0 pour produire l&#8217;enfant "zéro" (premier par index) du parent.</p>
</div>
<div id="CKDpriv" class="imageblock data-line-337">
<div class="content">
<img src="images/mbc2_0510.png" alt="Dérivation enfant privée">
</div>
<div class="title">Figure 31. Étendre une clé privée parent pour créer une clé privée enfant</div>
</div>
<div class="paragraph data-line-339">
<p>Changer l&#8217;index nous permet d&#8217;étendre le parent et de créer les autres enfants dans la séquence, par exemple, Enfant 0, Enfant 1, Enfant 2, etc. Chaque clé parent peut avoir 2 147 483 647 (2<sup>31</sup>) enfants (2<sup>31</sup> est moitié de la plage entière 2<sup>32</sup> disponible car l&#8217;autre moitié est réservée à un type spécial de dérivation dont nous parlerons plus loin dans ce chapitre).</p>
</div>
<div class="paragraph data-line-341">
<p>En répétant le processus un niveau plus bas dans l&#8217;arbre, chaque enfant peut à son tour devenir parent et créer ses propres enfants, dans un nombre infini de générations.</p>
</div>
</div>
<div class="sect4 data-line-343">
<h5 id="_utilisation_de_clés_enfants_dérivées">Utilisation de clés enfants dérivées</h5>
<div class="paragraph data-line-345">
<p>Les clés privées enfants ne peuvent pas être distinguées des clés non déterministes (aléatoires). Comme la fonction de dérivation est une fonction à sens unique, la clé enfant ne peut pas être utilisée pour trouver la clé parent. La clé enfant ne peut pas non plus être utilisée pour trouver des frères et sœurs. Si vous avez le n<sub>ième</sub> enfant, vous ne pouvez pas trouver ses frères et sœurs, tels que l&#8217;enfant n–1 ou l&#8217;enfant n+1, ou tout autre enfant faisant partie de la séquence. Seuls la clé parent et le code de chaîne peuvent dériver tous les enfants. Sans le code de chaîne enfant, la clé enfant ne peut pas non plus être utilisée pour dériver des petits-enfants. Vous avez besoin à la fois de la clé privée enfant et du code de chaîne enfant pour démarrer une nouvelle branche et dériver des petits-enfants.</p>
</div>
<div class="paragraph data-line-347">
<p>Alors, à quoi peut servir la clé privée enfant seule ? Il peut être utilisé pour créer une clé publique et une adresse Bitcoin. Ensuite, il peut être utilisé pour signer des transactions afin de dépenser tout ce qui est payé à cette adresse.</p>
</div>
<div class="admonitionblock tip data-line-350">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-351">
<p>Une clé privée enfant, la clé publique correspondante et l&#8217;adresse Bitcoin sont toutes indiscernables des clés et des adresses créées au hasard. Le fait qu&#8217;ils fassent partie d&#8217;une séquence n&#8217;est pas visible en dehors de la fonction de portefeuille HD qui les a créés. Une fois créées, elles fonctionnent exactement comme des clés "normales".</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-354">
<h5 id="_touches_étendues">Touches étendues</h5>
<div class="paragraph data-line-356">
<p>Comme nous l&#8217;avons vu précédemment, la fonction de dérivation de clé peut être utilisée pour créer des enfants à n&#8217;importe quel niveau de l&#8217;arborescence, en fonction sur les trois entrées : une clé, un code chaîne et l&#8217;index de l&#8217;enfant souhaité. Les deux ingrédients essentiels sont la clé et le code de chaîne, et combinés, ils s&#8217;appellent une <em>clé étendue</em>. Le terme "clé étendue" pourrait également être considéré comme une "clé extensible" car une telle clé peut être utilisée pour dériver des enfants.</p>
</div>
<div class="paragraph data-line-358">
<p>Les clés étendues sont stockées et représentées simplement comme la concaténation de la clé de 256 bits et du code de chaîne de 256 bits dans une séquence de 512 bits. Il existe deux types de clés étendues. Une clé privée étendue est la combinaison d&#8217;une clé privée et d&#8217;un code de chaîne et peut être utilisée pour dériver des clés privées enfants (et à partir de celles-ci, des clés publiques enfants). Une clé publique étendue est une clé publique et un code de chaîne, qui peuvent être utilisés pour créer des clés publiques enfants (<em>public uniquement</em>), comme décrit dans <a href="#public_key_derivation">Génération d&#8217;une clé publique</a>.</p>
</div>
<div class="paragraph data-line-360">
<p>Considérez une clé étendue comme la racine d&#8217;une branche dans l&#8217;arborescence du portefeuille HD. Avec la racine de la branche, vous pouvez dériver le reste de la branche. La clé privée étendue peut créer une branche complète, tandis que la clé publique étendue peut créer <em>uniquement</em> une branche de clés publiques.</p>
</div>
<div class="admonitionblock tip data-line-363">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-364">
<p>Une clé étendue se compose d&#8217;une clé privée ou publique et d&#8217;un code de chaîne. Une clé étendue peut créer des enfants, générant sa propre branche dans l&#8217;arborescence. Le partage d&#8217;une clé étendue donne accès à l&#8217;ensemble de la branche.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-367">
<p>Les clés étendues sont encodées à l&#8217;aide de Base58Check, pour exporter et importer facilement entre différents portefeuilles compatibles BIP-32. Le codage Base58Check pour les clés étendues utilise une somme de contrôle qui se traduit par le préfixe "xprv" et "xpub" lorsqu&#8217;il est codé en caractères Base58 pour les rendre facilement reconnaissables. Étant donné que la clé étendue est de 512 ou 513 bits, elle est également beaucoup plus longue que les autres chaînes codées en Base58Check que nous avons vues précédemment.</p>
</div>
<div class="paragraph data-line-369">
<p>Voici un exemple de clé <em>privée</em> étendue, codée en Base58Check :</p>
</div>
<div class="listingblock data-line-371">
<div class="content">
<pre>xprv9tyUQV64JT5qs3RSTJkXCWKMyUgoQp7F3hA1xzG6ZGu6u6Q9VMNjGr67Lctvy5P8oyaYAL9CAWrUE9i6GoNMKUga5biW6Hx4tws2six3b9c</pre>
</div>
</div>
<div class="paragraph data-line-375">
<p>Voici la clé <em>publique</em> étendue correspondante, codée en Base58Check :</p>
</div>
<div class="listingblock data-line-377">
<div class="content">
<pre>xpub67xpozcx8pe95XVuZLHXZeG6XWXHpGq6Qv5cmNfi7cS5mtjJ2tgypeQbBs2UAR6KECeeMVKZBPLrtJunSDMstweyLXhRgPxdp14sk9tJPW9</pre>
</div>
</div>
</div>
<div class="sect4 data-line-382">
<h5 id="public__child_key_derivation">Dérivation de la clé enfant publique</h5>
<div class="paragraph data-line-384">
<p>Comme mentionné précédemment, une caractéristique très utile des portefeuilles HD est la possibilité de dériver des clés publiques enfant à partir de clés publiques parent, <em>sans</em> avoir les clés privées. Cela nous donne deux façons de dériver une clé publique enfant : soit à partir de la clé privée enfant, soit directement à partir de la clé publique parent.</p>
</div>
<div class="paragraph data-line-386">
<p>Une clé publique étendue peut donc être utilisée pour dériver toutes les clés <em>publiques</em> (et uniquement les clés publiques) dans cette branche de la structure du portefeuille HD.</p>
</div>
<div class="paragraph data-line-388">
<p>Ce raccourci peut être utilisé pour créer des déploiements très sécurisés à clé publique uniquement dans lesquels un serveur ou une application possède une copie d&#8217;une clé publique étendue et aucune clé privée. Ce type de déploiement peut produire un nombre infini de clés publiques et d&#8217;adresses Bitcoin, mais ce type de déploiement ne permet pas dépenser l&#8217;argent envoyé à ces adresses. Pendant ce temps, sur un autre serveur plus sécurisé, la clé privée étendue peut dériver toutes les clés privées correspondantes pour signer des transactions et dépenser de l&#8217;argent.</p>
</div>
<div class="paragraph data-line-390">
<p>Une application courante de cette solution consiste à installer une clé publique étendue sur un serveur Web qui sert une application de commerce électronique. Le serveur Web peut utiliser la fonction de dérivation de clé publique pour créer une nouvelle adresse Bitcoin pour chaque transaction (par exemple, pour le panier d&#8217;un client). Le serveur Web n&#8217;aura aucune clé privée qui serait vulnérable au vol. Sans les portefeuilles HD, la seule façon d&#8217;y parvenir est de générer des milliers d&#8217;adresses Bitcoin sur un serveur sécurisé séparé, puis de les précharger sur le serveur de commerce électronique. Cette approche est lourde et nécessite une maintenance constante pour s&#8217;assurer que le serveur de commerce électronique ne "manque" pas d&#8217;adresses.</p>
</div>
<div class="paragraph data-line-392">
<p>Une autre application courante de cette solution est le stockage à froid ou les portefeuilles matériels. Dans ce scénario, la clé privée étendue peut être stockée sur un portefeuille papier ou un périphérique matériel (tel qu&#8217;un portefeuille matériel Trezor), tandis que la clé publique étendue peut être conservée en ligne. L&#8217;utilisateur peut créer des adresses "de réception" à volonté, tandis que les clés privées sont stockées en toute sécurité hors ligne. Pour dépenser les fonds, l&#8217;utilisateur peut utiliser la clé privée étendue sur un client Bitcoin de signature hors ligne ou signer des transactions sur le périphérique de portefeuille matériel (par exemple, Trezor). <a href="#CKDpub">Étendre une clé publique parent pour créer une clé publique enfant</a> illustre le mécanisme d&#8217;extension d&#8217;une clé publique parent pour dériver des clés publiques enfants.</p>
</div>
<div id="CKDpub" class="imageblock data-line-396">
<div class="content">
<img src="images/mbc2_0511.png" alt="Dérivation enfant publique">
</div>
<div class="title">Figure 32. Étendre une clé publique parent pour créer une clé publique enfant</div>
</div>
</div>
<div class="sect4 data-line-398">
<h5 id="_dérivation_de_clé_enfant_renforcée">Dérivation de clé enfant renforcée</h5>
<div class="paragraph data-line-400">
<p>La possibilité de dériver une branche de clés publiques à partir d&#8217;un xpub est très utile, mais elle est potentiellement risquée. L&#8217;accès à une xpub ne donne pas accès aux clés privées enfants. Cependant, étant donné que xpub contient le code de chaîne, si une clé privée enfant est connue ou divulguée d&#8217;une manière ou d&#8217;une autre, elle peut être utilisée avec le code de chaîne pour dériver toutes les autres clés privées enfants. Une seule clé privée enfant divulguée, associée à un code de chaîne parent, révèle toutes les clés privées de tous les enfants. Pire encore, la clé privée enfant associée à un code de chaîne parent peut être utilisée pour déduire la clé privée parent.</p>
</div>
<div class="paragraph data-line-402">
<p>Pour contrer ce risque, les portefeuilles HD utilisent une fonction de dérivation alternative appelée <em>dérivation renforcée</em>, qui "casse" la relation entre la clé publique parent et le code de chaîne enfant. La fonction de dérivation renforcée utilise la clé privée parent pour dériver le code de chaîne enfant, au lieu de la clé publique parent. Cela crée un "pare-feu" dans la séquence parent/enfant, avec un code de chaîne qui ne peut pas être utilisé pour compromettre une clé privée parent ou sœur. La fonction de dérivation renforcée semble presque identique à la dérivation de clé privée enfant normale, sauf que la clé privée parent est utilisée comme entrée de la fonction de hachage, au lieu de la clé publique parent, comme indiqué dans le diagramme de <a href="#CKDprime">Dérivation renforcée d&#8217;une clé enfant ; omet la clé publique parent</a>.</p>
</div>
<div id="CKDprime" class="imageblock data-line-406">
<div class="content">
<img src="images/mbc2_0513.png" alt="Dérivation enfant stricte privée">
</div>
<div class="title">Figure 33. Dérivation renforcée d&#8217;une clé enfant ; omet la clé publique parent</div>
</div>
<div class="paragraph pagebreak-before data-line-409">
<p>Lorsque la fonction de dérivation privée renforcée est utilisée, la clé privée enfant et le code de chaîne résultants sont complètement différents de ce qui résulterait de la fonction de dérivation normale. La "branche" de clés résultante peut être utilisée pour produire des clés publiques étendues qui ne sont pas vulnérables, car le code de chaîne qu&#8217;elles contiennent ne peut pas être exploité pour révéler des clés privées. La dérivation renforcée est donc utilisée pour créer un "trou" dans l&#8217;arborescence au-dessus du niveau où les clés publiques étendues sont utilisées.</p>
</div>
<div class="paragraph data-line-411">
<p>En termes simples, si vous souhaitez utiliser la commodité d&#8217;un xpub pour dériver des branches de clés publiques, sans vous exposer au risque d&#8217;une fuite de code de chaîne, vous devez le dériver d&#8217;une clé parent renforcée, plutôt que d&#8217;une clé normale (non-renforcée) clé parent. En tant que meilleure pratique, les enfants de niveau 1 des clés principales sont toujours dérivés via la dérivation renforcée, pour éviter la compromission des clés principales.</p>
</div>
</div>
<div class="sect4 data-line-413">
<h5 id="_numéros_dindex_pour_dérivation_normale_et_durcie">Numéros d&#8217;index pour dérivation normale et durcie</h5>
<div class="paragraph data-line-415">
<p>Le numéro d&#8217;index utilisé dans la fonction de dérivation est un entier de 32 bits. Pour distinguer facilement les clés dérivées par la fonction de dérivation normale des clés dérivées par dérivation renforcée, ce numéro d&#8217;index est divisé en deux plages. Les numéros d&#8217;index entre 0 et 2<sup>31</sup>–1 (0x0 à 0x7FFFFFFF) sont utilisés <em>uniquement</em> pour la dérivation normale. Les numéros d&#8217;index entre 2<sup>31</sup> et 2<sup>32</sup>–1 (0x80000000 à 0xFFFFFFFF) sont utilisés <em>uniquement</em> pour la dérivation renforcée. Donc, si l&#8217;indice est inférieur à 2<sup>31</sup>, l&#8217;enfant est normal, alors que si l&#8217;indice est égal ou supérieur à 2<sup>31</sup>, l&#8217;enfant est renforcé.</p>
</div>
<div class="paragraph data-line-417">
<p>Pour faciliter la lecture et l&#8217;affichage du numéro d&#8217;index, le numéro d&#8217;index pour les enfants renforcés est affiché à partir de zéro, mais avec un symbole prime. La première clé enfant normale s&#8217;affiche donc sous la forme 0, tandis que la première clé enfant renforcée (index 0x80000000) s&#8217;affiche sous la forme 0 <code><strong>'</strong></code> . Dans l&#8217;ordre, la deuxième clé renforcée aurait l&#8217;index 0x80000001 et serait affichée sous la forme 1 <code><strong>'</strong></code> , et ainsi de suite. Lorsque vous voyez un index de portefeuille HD i <code><strong>'</strong></code> , cela signifie 2<sup>31</sup>+i.</p>
</div>
</div>
<div class="sect4 data-line-419">
<h5 id="_identifiant_de_clé_de_portefeuille_hd_chemin">Identifiant de clé de portefeuille HD (chemin)</h5>
<div class="paragraph data-line-421">
<p>Les clés d&#8217;un portefeuille HD sont identifiées à l&#8217;aide d&#8217;une convention de dénomination "chemin", où chaque niveau de l&#8217;arborescence est séparé par une barre oblique (/) (voir <a href="#table_4-8">Exemples de chemin de portefeuille HD</a>). Les clés privées dérivées de la clé privée principale commencent par "m". Les clés publiques dérivées de la clé publique principale commencent par « M ». Par conséquent, la première clé privée enfant de la clé privée principale est m/0. La première clé publique enfant est M/0. Le deuxième petit-enfant du premier enfant est m/0/1, et ainsi de suite.</p>
</div>
<div class="paragraph data-line-423">
<p>L'"ascendance" d&#8217;une clé se lit de droite à gauche, jusqu&#8217;à atteindre la clé maîtresse dont elle est issue. Par exemple, l&#8217;identifiant m/x/y/z décrit la clé privée qui est le z-ième enfant de la clé privée parent m/x/y, qui est le y-ième enfant de la clé privée parent m/x, qui est le x-ième enfant de la clé privée principale parente m.</p>
</div>
<table id="table_4-8" class="tableblock frame-all grid-all stretch data-line-428">
<caption class="title">Table 14. Exemples de chemin de portefeuille HD</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Clé décrite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La première (0) clé privée enfant de la clé privée maîtresse (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La première (0) clé privée enfant du premier enfant (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0'/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le premier (0) enfant normal du premier enfant <em>renforcé</em> (m/0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La première (0) clé privée enfant du deuxième enfant (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La première (0) clé publique enfant du premier enfant (M/23/17/0) du 18ème enfant (M/23/17) du 24ème enfant (M/23)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-437">
<h5 id="_naviguer_dans_larborescence_du_portefeuille_hd">Naviguer dans l&#8217;arborescence du portefeuille HD</h5>
<div class="paragraph data-line-439">
<p>La structure arborescente du portefeuille HD offre une grande flexibilité. Chaque clé étendue parent peut avoir 4 milliards d&#8217;enfants : 2 milliards d&#8217;enfants normaux et 2 milliards d&#8217;enfants renforcés. Chacun de ces enfants peut avoir 4 milliards d&#8217;enfants supplémentaires, et ainsi de suite. L&#8217;arbre peut être aussi profond que vous le souhaitez, avec un nombre infini de générations. Avec toute cette flexibilité, cependant, il devient assez difficile de naviguer dans cet arbre infini. Il est particulièrement difficile de transférer des portefeuilles HD entre les implémentations, car les possibilités d&#8217;organisation interne en succursales et sous-succursales sont infinies.</p>
</div>
<div class="paragraph data-line-441">
<p>Deux BIP offrent une solution à cette complexité en créant des propositions de normes pour la structure des arborescences de portefeuille HD. BIP-43 propose l&#8217;utilisation du premier index enfant renforcé comme identifiant spécial qui signifie le "but" de la structure arborescente. Basé sur BIP-43, un portefeuille HD ne devrait utiliser qu&#8217;une seule branche de niveau 1 de l&#8217;arborescence, le numéro d&#8217;index identifiant la structure et l&#8217;espace de noms du reste de l&#8217;arborescence en définissant son objectif. Par exemple, un portefeuille HD utilisant uniquement la branche m/i <code><strong>'</strong></code> / est destiné à signifier un objectif spécifique et cet objectif est identifié par le numéro d&#8217;index "i".</p>
</div>
<div class="paragraph data-line-443">
<p>En étendant cette spécification, BIP-44 propose une structure multicompte en tant que numéro "d&#8217;objet" <code>44'</code> sous BIP-43. Tous les portefeuilles HD suivant la structure BIP-44 sont identifiés par le fait qu&#8217;ils n&#8217;utilisent qu&#8217;une seule branche de l&#8217;arborescence : m/44'/.</p>
</div>
<div class="paragraph data-line-445">
<p>BIP-44 spécifie la structure comme étant composée de cinq niveaux d&#8217;arborescence prédéfinis :</p>
</div>
<div class="listingblock data-line-447">
<div class="content">
<pre>m / but' / type_monnaie' / compte' / change / index_adresse</pre>
</div>
</div>
<div class="paragraph data-line-451">
<p>Le "but" de premier niveau est toujours réglé sur 44'. Le "type_monnaie" de deuxième niveau spécifie le type de pièce de cryptomonnaie, permettant des portefeuilles HD multidevises où chaque devise a son propre sous-arbre sous le deuxième niveau. Il y a trois devises définies pour l&#8217;instant : Bitcoin est m/44'/0', Bitcoin Testnet est m/44 <code><strong>'</strong></code> /1 <code><strong>'</strong></code> , et Litecoin est m/44 <code><strong>'</strong></code> /2 <code><strong>'</strong></code> .</p>
</div>
<div class="paragraph data-line-453">
<p>Le troisième niveau de l&#8217;arborescence est "compte", qui permet aux utilisateurs de subdiviser leurs portefeuilles en sous-comptes logiques distincts, à des fins comptables ou organisationnelles. Par exemple, un portefeuille HD peut contenir deux "comptes" bitcoin : m/44 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0 <code><strong>'</strong></code>  et m/44 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /1 <code><strong>'</strong></code> . Chaque compte est la racine de sa propre sous-arborescence.</p>
</div>
<div class="paragraph data-line-455">
<p>Au quatrième niveau, "change", un portefeuille HD a deux sous-arborescences, une pour créer des adresses de réception et une pour créer des adresses de modification. Notez qu&#8217;alors que les niveaux précédents utilisaient une dérivation renforcée, ce niveau utilise une dérivation normale. Cela permet à ce niveau de l&#8217;arborescence d&#8217;exporter des clés publiques étendues pour une utilisation dans un environnement non sécurisé. Les adresses utilisables sont dérivées par le portefeuille HD en tant qu&#8217;enfants du quatrième niveau, faisant du cinquième niveau de l&#8217;arborescence l'"index_adresse". Par exemple, la troisième adresse de réception pour les paiements en bitcoins dans le compte principal serait M/44 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0/2. <a href="#table_4-9">Exemples de structure de portefeuille HD BIP-44</a> montre quelques exemples supplémentaires.</p>
</div>
<table id="table_4-9" class="tableblock frame-all grid-all stretch data-line-460">
<caption class="title">Table 15. Exemples de structure de portefeuille HD BIP-44</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Chemin HD</th>
<th class="tableblock halign-left valign-top">Clé décrite</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La troisième clé publique de réception pour le compte bitcoin principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /3 <code><strong>'</strong></code> /1/14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La quinzième clé publique de changement d&#8217;adresse pour le quatrième compte bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44 <code><strong>'</strong></code> /2 <code><strong>'</strong></code> /0 <code><strong>'</strong></code> /0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La deuxième clé privée du compte principal Litecoin, pour la signature des transactions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3 data-line-467">
<h4 id="_utilisation_dune_clé_publique_étendue_sur_une_boutique_en_ligne">Utilisation d&#8217;une clé publique étendue sur une boutique en ligne</h4>
<div class="paragraph data-line-469">
<p>Voyons comment les portefeuilles HD sont utilisés en poursuivant notre histoire avec la boutique en ligne de Gabriel.</p>
</div>
<div class="paragraph data-line-471">
<p>Gabriel a d&#8217;abord créé sa boutique en ligne comme passe-temps, basé sur une simple page Wordpress hébergée. Son magasin était assez simple avec seulement quelques pages et un bon de commande avec une seule adresse Bitcoin.</p>
</div>
<div class="paragraph data-line-473">
<p>Gabriel a utilisé la première adresse Bitcoin générée par son appareil Trezor comme adresse Bitcoin principale pour son magasin. De cette façon, tous les paiements entrants seraient versés à une adresse contrôlée par son portefeuille matériel Trezor.</p>
</div>
<div class="paragraph data-line-475">
<p>Les clients soumettraient une commande en utilisant le formulaire et enverraient le paiement à l&#8217;adresse Bitcoin publiée de Gabriel, déclenchant un e-mail avec les détails de la commande à traiter par Gabriel. Avec seulement quelques commandes par semaine, ce système fonctionnait assez bien.</p>
</div>
<div class="paragraph data-line-477">
<p>Cependant, la petite boutique en ligne a connu un certain succès et a attiré de nombreuses commandes de la communauté locale. Bientôt, Gabriel a été submergé. Avec toutes les commandes payées à la même adresse, il devenait difficile de faire correspondre correctement les commandes et les transactions, en particulier lorsque plusieurs commandes pour le même montant arrivaient à proximité.</p>
</div>
<div class="paragraph data-line-479">
<p>Le portefeuille HD de Gabriel offre une bien meilleure solution grâce à la possibilité de dériver des clés enfants publiques sans connaître les clés privées. Gabriel peut charger une clé publique étendue (xpub) sur son site Web, qui peut être utilisée pour dériver une adresse unique pour chaque commande client. Gabriel peut dépenser les fonds de son Trezor, mais le xpub chargé sur le site Web ne peut que générer des adresses et recevoir des fonds. Cette fonctionnalité des portefeuilles HD est une excellente fonctionnalité de sécurité. Le site Web de Gabriel ne contient aucune clé privée et n&#8217;a donc pas besoin de niveaux de sécurité élevés.</p>
</div>
<div class="paragraph data-line-481">
<p>Pour exporter le xpub, Gabriel utilise l&#8217;application de bureau Trezor Suite en conjonction avec le portefeuille matériel Trezor. L&#8217;appareil Trezor doit être branché pour que les clés publiques soient exportées. Notez que les portefeuilles matériels n&#8217;exporteront jamais de clés privées, celles-ci restant toujours sur l&#8217;appareil. <a href="#export_xpub">Exportation d&#8217;un xpub à partir d&#8217;un portefeuille matériel Trezor</a> montre ce que Gabriel voit dans Trezor Suite lors de l&#8217;exportation du xpub.</p>
</div>
<div id="export_xpub" class="imageblock data-line-485">
<div class="content">
<img src="images/mbc2_0512.png" alt="Exporter le xpub du Trezor">
</div>
<div class="title">Figure 34. Exportation d&#8217;un xpub à partir d&#8217;un portefeuille matériel Trezor</div>
</div>
<div class="paragraph data-line-487">
<p>Gabriel copie le xpub dans le logiciel de boutique bitcoin de sa boutique en ligne. Il utilise <em>BTCPay Server</em>, qui est une boutique en ligne open source pour une variété de plates-formes d&#8217;hébergement Web et de contenu. BTCPay Server utilise le xpub pour générer une adresse unique pour chaque achat. </p>
</div>
<div class="sect4 data-line-489">
<h5 id="_découverte_et_gestion_de_compte">Découverte et gestion de compte</h5>
<div class="paragraph data-line-491">
<p>L&#8217;entreprise de Gabriel est florissante. Il a fourni sa clé publique étendue (xpub) à <em>BTCPay Server</em>, qui génère des adresses uniques pour les clients de son site Web. Chaque fois qu&#8217;un client du site Web de Gabriel clique sur le bouton "Commander" avec une modalité de paiement spécifiée (dans ce cas, bitcoin), <em>BTCPay Server</em> génère une nouvelle adresse pour ce client. Plus précisément, <em>BTCPay Server</em> itère sur l&#8217;arborescence <em>address_index</em> pour créer une nouvelle adresse à afficher au client, comme défini par BIP-44. Si le client décide de changer de méthode de paiement ou d&#8217;abandonner complètement la transaction, cette adresse Bitcoin n&#8217;est pas utilisée et ne sera pas utilisée pour un autre client tout de suite.</p>
</div>
<div class="paragraph data-line-493">
<p>À un moment donné, le site Web de Gabriel peut avoir un grand nombre d&#8217;adresses en attente pour les clients effectuant des achats, dont certaines peuvent rester inutilisées et éventuellement expirer. Une fois ces adresses expirées, <em>BTCPay Server</em> réutilisera ces adresses pour combler le vide dans l'<em>index_adresse</em>, mais il devient clair qu&#8217;il peut y avoir des vides entre les feuilles d'<em>index_adresse</em> de l&#8217;arbre déterministe hiérarchique où se trouve réellement l&#8217;argent.</p>
</div>
<div class="paragraph data-line-495">
<p>Disons que Gabriel est intéressé à voir son montant total de bitcoin gagné sur un portefeuille de surveillance uniquement (celui qui vous permet de voir l&#8217;historique des transactions, mais pas de dépenser des fonds) qui est distinct du serveur BTCPay mais également conforme à la norme BIP-44 . Comment ce portefeuille séparé devrait-il rechercher des fonds dans ce vaste arbre hiérarchique, et quand devrait-il cesser de chercher ? La plupart des portefeuilles suivent généralement un processus itératif qui utilise une limite prédéfinie, connue sous le nom de <em>gap limit</em>. Si, lors de la recherche d&#8217;adresses utilisées, le portefeuille ne trouve pas d&#8217;adresses utilisées d&#8217;affilée au-delà de ce nombre limite, il arrête de rechercher la chaîne d&#8217;adresses. La limite d&#8217;écart par défaut est généralement fixée à 20. Ceci est détaillé dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a>.</p>
</div>
<div class="admonitionblock tip data-line-498">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-499">
<p>Les limites d&#8217;écart expliquent le phénomène selon lequel l&#8217;importation d&#8217;un portefeuille peut afficher un solde incorrect ou nul. Les fonds ne sont pas perdus, mais plutôt, la fonction d&#8217;importation de portefeuille n&#8217;a pas traversé suffisamment de feuilles pour détecter pleinement les fonds. De nombreux portefeuilles permettent de modifier cette limite d&#8217;écart par défaut, et Gabriel peut avoir besoin d&#8217;augmenter cette limite pour permettre à son portefeuille d&#8217;importer entièrement son historique de transactions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-5">
<h2 id="transactions">Opérations</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-8">
<h3 id="ch06_intro">Présentation</h3>
<div class="paragraph data-line-10">
<p>Les transactions sont la partie la plus importante du système Bitcoin. Tout le reste dans le bitcoin est conçu pour garantir que les transactions peuvent être créées, propagées sur le réseau, validées et finalement ajoutées au grand livre mondial des transactions (la chaîne de blocs). Les transactions sont des structures de données qui encodent le transfert de valeur entre les participants au système Bitcoin. Chaque transaction est une entrée publique dans la chaîne de blocs de bitcoin, le grand livre comptable mondial en partie double.</p>
</div>
<div class="paragraph data-line-12">
<p>Dans ce chapitre, nous examinerons toutes les différentes formes de transactions, ce qu&#8217;elles contiennent, comment les créer, comment elles sont vérifiées et comment elles deviennent partie intégrante de l&#8217;enregistrement permanent de toutes les transactions. Lorsque nous utilisons le terme "portefeuille" dans ce chapitre, nous faisons référence au logiciel qui construit les transactions, et pas seulement à la base de données des clés.</p>
</div>
</div>
<div class="sect2 data-line-15">
<h3 id="tx_structure">Transactions en détail</h3>
<div class="paragraph data-line-17">
<p>Dans <a href="#ch02_bitcoin_overview">Comment fonctionne Bitcoin</a>, nous avons examiné la transaction utilisée par Alice pour payer un café au Bob&#8217;s Café à l&#8217;aide d&#8217;un explorateur de blocs (<a href="#alices_transactions_to_bobs_cafe">Transaction d&#8217;Alice au Bob&#8217;s Café</a>).</p>
</div>
<div class="paragraph data-line-19">
<p>L&#8217;application de l&#8217;explorateur de blocs montre une transaction de "l&#8217;adresse" d&#8217;Alice à "l&#8217;adresse" de Bob. Il s&#8217;agit d&#8217;une vue très simplifiée de ce qui est contenu dans une transaction. En fait, comme nous le verrons dans ce chapitre, une grande partie des informations affichées sont construites par l&#8217;explorateur de blocs et ne se trouvent pas réellement dans la transaction.</p>
</div>
<div id="alices_transactions_to_bobs_cafe" class="imageblock data-line-23">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 35. Transaction d&#8217;Alice au Bob&#8217;s Café</div>
</div>
<div class="sect3 data-line-26">
<h4 id="transactions_behind_the_scenes">Transactions : Dans les coulisses</h4>
<div class="paragraph data-line-28">
<p> Dans les coulisses, une transaction réelle est très différente d&#8217;une transaction fournie par un explorateur de blocs typique. En fait, la plupart des constructions de haut niveau que nous voyons dans les différentes interfaces utilisateur des applications bitcoin <em>n&#8217;existent pas réellement</em> dans le système Bitcoin.</p>
</div>
<div class="paragraph data-line-30">
<p>Nous pouvons utiliser l&#8217;interface de ligne de commande de Bitcoin Core (<code>getrawtransaction</code> et <code>decoderawtransaction</code>) pour récupérer la transaction "brute" d&#8217;Alice, la décoder et voir ce qu&#8217;elle contient. Le résultat ressemble à ceci :</p>
</div>
<div id="alice_tx" class="listingblock data-line-35">
<div class="title">La transaction d&#8217;Alice décodée</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
    },
    {
      "value": 0.08450000,
      "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-60">
<p>Vous remarquerez peut-être certaines choses à propos de cette transaction, principalement les choses qui manquent ! Où est l&#8217;adresse d&#8217;Alice ? Où est l&#8217;adresse de Bob ? Où est l&#8217;entrée 0.1 "envoyée" par Alice ? En bitcoin, il n&#8217;y a pas de pièces, pas d&#8217;expéditeurs, pas de destinataires, pas de soldes, pas de comptes et pas d&#8217;adresses. Toutes ces choses sont construites à un niveau supérieur pour le bénéfice de l&#8217;utilisateur, pour rendre les choses plus faciles à comprendre.</p>
</div>
<div class="paragraph data-line-62">
<p>Vous pouvez également remarquer de nombreux champs étranges et indéchiffrables et des chaînes hexadécimales. Ne vous inquiétez pas, nous expliquerons en détail chaque champ affiché ici dans ce chapitre.</p>
</div>
</div>
</div>
<div class="sect2 data-line-65">
<h3 id="tx_inputs_outputs">Sorties et entrées de transaction</h3>
<div class="paragraph data-line-67">
<p>La base fondamentale d&#8217;une transaction bitcoin est une <em>sortie de transaction</em>. Les sorties de transaction sont des morceaux indivisibles de monnaie bitcoin, enregistrés sur la chaîne de blocs et reconnus comme valides par l&#8217;ensemble du réseau. Les nœuds complets Bitcoin suivent toutes les sorties disponibles et utilisables, appelées <em>sorties de transaction non dépensées</em>, ou <em>UTXO</em>. La collection de tous les UTXO est connue sous le nom d'<em>ensemble UTXO</em> et compte actuellement des millions d&#8217;UTXO. L&#8217;ensemble UTXO augmente à mesure que de nouveaux UTXO sont créés et diminue lorsque UTXO est consommé. Chaque transaction représente un changement (transition d&#8217;état) dans l&#8217;ensemble UTXO.</p>
</div>
<div class="paragraph data-line-69">
<p>Lorsque nous disons que le portefeuille d&#8217;un utilisateur a "reçu" du bitcoin, nous voulons dire que le portefeuille a détecté sur la chaîne de blocs un UTXO pouvant être dépensé avec l&#8217;une des clés contrôlées par ce portefeuille. Ainsi, le "solde" de bitcoins d&#8217;un utilisateur est la somme de tous les UTXO que le portefeuille de l&#8217;utilisateur peut dépenser et qui peuvent être dispersés parmi des centaines de transactions et des centaines de blocs. Le concept de solde est créé par l&#8217;application de portefeuille. Le portefeuille calcule le solde de l&#8217;utilisateur en scannant la chaîne de blocs et en agrégeant la valeur de tout UTXO que le portefeuille peut dépenser avec les clés qu&#8217;il contrôle. La plupart des portefeuilles maintiennent une base de données ou utilisent un service de base de données pour stocker un ensemble de référence rapide de tous les UTXO qu&#8217;ils peuvent dépenser avec les clés qu&#8217;ils contrôlent.</p>
</div>
<div class="paragraph data-line-71">
<p><a href="#utxo-stxo">Chaîne de transaction de Joe à Gopesh en cours de construction sur la chaîne de blocs</a> affiche la chaîne de blocs à trois moments différents, alors que la chaîne de transaction de Joe à Gopesh est en cours de construction. Remarquez comment chaque transaction dépense un UTXO qui a été créé dans une transaction précédente, le transformant en une <em>sortie de transaction dépensée</em>, ou <em>STXO</em>. Puisque la transaction #1 (de Joe à Alice) dépense un seul UTXO (de Joe) et crée un seul UTXO (à Alice), elle ne modifie pas la taille de l&#8217;ensemble UTXO. D&#8217;autre part, les transactions #2 et #3 créent toutes deux des sorties de change à l&#8217;expéditeur, dépensant un seul UTXO et créant deux UTXO (le paiement et la sortie de change). Par conséquent, chacun d&#8217;eux augmente la taille de l&#8217;ensemble UTXO de 1.</p>
</div>
<div id="utxo-stxo" class="imageblock data-line-75">
<div class="content">
<img src="images/mbc2_0609.png" alt="Chaîne de transaction de Joe à Gopesh en cours de construction sur la chaîne de blocs">
</div>
<div class="title">Figure 36. Chaîne de transaction de Joe à Gopesh en cours de construction sur la chaîne de blocs</div>
</div>
<div class="paragraph data-line-77">
<p>Une sortie de transaction peut avoir une valeur arbitraire (entière) libellée comme un multiple de satoshis. Tout comme les dollars peuvent être divisés jusqu&#8217;à deux décimales sous forme de cents, le bitcoin peut être divisé jusqu&#8217;à huit décimales sous forme de satoshis. Bien qu&#8217;une sortie puisse avoir n&#8217;importe quelle valeur arbitraire, une fois créée, elle est indivisible. Il s&#8217;agit d&#8217;une caractéristique importante des sorties qui doit être soulignée : les sorties sont des unités de valeur <em>discrètes</em> et <em>indivisibles</em>, libellées en satoshis entiers. Une production non dépensée ne peut être consommée dans son intégralité que par une transaction.</p>
</div>
<div class="paragraph data-line-79">
<p>Si un UTXO est supérieur à la valeur souhaitée d&#8217;une transaction, il doit toujours être consommé dans son intégralité et le changement doit être généré dans la transaction. En d&#8217;autres termes, si vous avez un UTXO d&#8217;une valeur de 20 bitcoins et que vous souhaitez payer seulement 1 bitcoin, votre transaction doit consommer l&#8217;intégralité de l&#8217;UTXO de 20 bitcoins et produire deux sorties : une payant 1 bitcoin au destinataire souhaité et une autre payant 19 bitcoin en échange. retour dans votre portefeuille. En raison de la nature indivisible des sorties de transaction, la plupart des transactions bitcoin devront générer du change.</p>
</div>
<div class="paragraph data-line-81">
<p>Imaginez une cliente qui achète une boisson à 1,50 $, puise dans son portefeuille et essaie de trouver une combinaison de pièces et de billets de banque pour couvrir le coût de 1,50 $. L&#8217;acheteur choisira la monnaie exacte si disponible, par exemple un billet d&#8217;un dollar et deux quarts (un quart vaut 0,25 $), ou une combinaison de coupures plus petites (six quarts), ou si nécessaire, une unité plus grande comme un billet de 5 $. Si elle remet trop d&#8217;argent, disons 5 $, au propriétaire du magasin, elle s&#8217;attendra à 3,50 $ de monnaie, qu&#8217;elle remettra dans son portefeuille et qu&#8217;elle disposera pour de futures transactions.</p>
</div>
<div class="paragraph data-line-83">
<p>De même, une transaction bitcoin doit être créée à partir de l&#8217;UTXO d&#8217;un utilisateur dans toutes les dénominations disponibles pour cet utilisateur. Les utilisateurs ne peuvent pas couper un UTXO en deux, pas plus qu&#8217;ils ne peuvent couper un billet d&#8217;un dollar en deux et l&#8217;utiliser comme monnaie. L&#8217;application de portefeuille de l&#8217;utilisateur sélectionne généralement à partir de l&#8217;UTXO disponible de l&#8217;utilisateur pour composer un montant supérieur ou égal au montant de transaction souhaité.</p>
</div>
<div class="paragraph data-line-85">
<p>Comme dans la vraie vie, l&#8217;application bitcoin peut utiliser plusieurs stratégies pour satisfaire le montant de l&#8217;achat : combiner plusieurs unités plus petites, trouver la monnaie exacte ou utiliser une seule unité supérieure à la valeur de la transaction et rendre la monnaie. Tout cet assemblage complexe d&#8217;UTXO dépensables est effectué automatiquement par le portefeuille de l&#8217;utilisateur et est invisible pour les utilisateurs. Cela n&#8217;est pertinent que si vous construisez par programme des transactions brutes à partir d&#8217;UTXO.</p>
</div>
<div class="paragraph data-line-87">
<p>Une transaction consomme des sorties de transaction non dépensées précédemment enregistrées et crée de nouvelles sorties de transaction qui peuvent être consommées par une transaction future. De cette façon, des morceaux de valeur bitcoin passent d&#8217;un propriétaire à l&#8217;autre dans une chaîne de transactions consommant et créant des UTXO.</p>
</div>
<div class="paragraph data-line-89">
<p>L&#8217;exception à la chaîne de sortie et d&#8217;entrée est une type spécial de transaction appelé transaction <em>coinbase</em>, qui est la première transaction de chaque bloc. Cette transaction y est placée par le mineur "gagnant" et crée un tout nouveau bitcoin payable à ce mineur en récompense de l&#8217;exploitation minière. Cette transaction coinbase spéciale ne consomme pas d&#8217;UTXO ; à la place, il a un type spécial d&#8217;entrée appelé "coinbase". C&#8217;est ainsi que la masse monétaire du bitcoin est créée pendant le processus de minage, comme nous le verrons dans <a href="#mining">Minage et Consensus</a>.</p>
</div>
<div class="admonitionblock tip data-line-92">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-93">
<p>Qu&#8217;est-ce qui vient en premier ? Entrées ou sorties, la poule ou l&#8217;œuf ? Strictement parlant, les sorties viennent en premier parce que les transactions coinbase, qui génèrent de nouveaux bitcoins, n&#8217;ont pas d&#8217;entrées et créent des sorties à partir de rien.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-97">
<h4 id="tx_outs">Sorties des transactions</h4>
<div class="paragraph data-line-99">
<p>Chaque transaction bitcoin crée des sorties, qui sont enregistrées sur le grand livre bitcoin. Presque toutes ces sorties, à une exception près (voir <a href="#op_return">Sortie d&#8217;enregistrement de données (RETURN)</a>) créent des morceaux de bitcoin utilisables appelés UTXO, qui sont ensuite reconnus par l&#8217;ensemble du réseau et disponibles pour que le propriétaire les dépense lors d&#8217;une future transaction.</p>
</div>
<div class="paragraph data-line-101">
<p>Les UTXO sont suivis par chaque client Bitcoin à nœud complet dans l&#8217;ensemble UTXO. Les nouvelles transactions consomment (dépensent) une ou plusieurs de ces sorties de l&#8217;ensemble UTXO.</p>
</div>
<div class="paragraph data-line-103">
<p>Les sorties de transaction se composent de deux parties :</p>
</div>
<div class="ulist data-line-105">
<ul>
<li class="data-line-105">
<p>Un montant de bitcoin, libellé en <em>satoshis</em>, la plus petite unité de bitcoin</p>
</li>
<li class="data-line-106">
<p>Un puzzle cryptographique qui détermine les conditions requises pour passer la sortie</p>
</li>
</ul>
</div>
<div class="paragraph data-line-108">
<p>Le puzzle cryptographique est également connu sous le nom de <em>script de verrouillage</em>, un <em>script de témoin</em> ou un <code>scriptPubKey</code>.</p>
</div>
<div class="paragraph data-line-110">
<p>Le langage de script de transaction, utilisé dans le script de verrouillage mentionné précédemment, est décrit en détail dans <a href="#tx_script">Scripts de transaction et langage de script</a>.</p>
</div>
<div class="paragraph data-line-112">
<p>Maintenant, regardons la transaction d&#8217;Alice (montrée précédemment dans <a href="#transactions_behind_the_scenes">Transactions : Dans les coulisses</a>) et voir si nous pouvons identifier les sorties. Dans l&#8217;encodage JSON, les sorties sont dans un tableau (liste) nommé <code>vout</code> :</p>
</div>
<div class="listingblock data-line-115">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
  {
    "value": 0.01500000,
    "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY
    OP_CHECKSIG"
  },
  {
    "value": 0.08450000,
    "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-129">
<p>Comme vous pouvez le voir, la transaction contient deux sorties. Chaque sortie est définie par une valeur et un puzzle cryptographique. Dans l&#8217;encodage indiqué par Bitcoin Core, la valeur est indiquée en bitcoin, mais dans la transaction elle-même, elle est enregistrée sous la forme d&#8217;un entier libellé en satoshis. La deuxième partie de chaque sortie est le puzzle cryptographique qui fixe les conditions de dépenses. Bitcoin Core le montre comme <code>scriptPubKey</code> et nous montre une représentation lisible par l&#8217;homme du script.</p>
</div>
<div class="paragraph data-line-131">
<p>Le sujet du verrouillage et du déverrouillage de l&#8217;UTXO sera abordé plus tard, dans <a href="#tx_lock_unlock">Construction du script (Verrouiller + Déverrouiller)</a>. Le langage de script utilisé pour le script dans <code>scriptPubKey</code> est décrit dans <a href="#tx_script">Scripts de transaction et langage de script</a>. Mais avant d&#8217;approfondir ces sujets, nous devons comprendre la structure globale des entrées et sorties des transactions.</p>
</div>
<div class="sect4 data-line-133">
<h5 id="_sérialisation_des_transactions_sorties">Sérialisation des transactions : sorties</h5>
<div class="paragraph data-line-135">
<p>Lorsque les transactions sont transmises sur le réseau ou échangées entre applications, elles sont <em>sérialisées</em>. La sérialisation est le processus de conversion de la représentation interne d&#8217;une structure de données dans un format qui peut être transmis un octet à la fois, également appelé flux d&#8217;octets. La sérialisation est le plus souvent utilisée pour coder des structures de données à transmettre sur un réseau ou à stocker dans un fichier. Le format de sérialisation d&#8217;une sortie de transaction est affiché dans <a href="#tx_out_structure">Sérialisation des sorties de transaction</a>.</p>
</div>
<table id="tx_out_structure" class="tableblock frame-all grid-all stretch data-line-140">
<caption class="title">Table 16. Sérialisation des sorties de transaction</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 octets (petit-boutiste)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Montant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valeur du bitcoin en satoshis (10<sup>-8</sup> bitcoin)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de verrouillage en octets, à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script définissant les conditions nécessaires pour dépenser la sortie</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-147">
<p>La plupart des bibliothèques et frameworks bitcoin ne stockent pas les transactions en interne sous forme de flux d&#8217;octets, car cela nécessiterait une analyse complexe chaque fois que vous auriez besoin d&#8217;accéder à un seul champ. Pour plus de commodité et de lisibilité, les bibliothèques bitcoin stockent les transactions en interne dans des structures de données (généralement des structures orientées objet).</p>
</div>
<div class="paragraph data-line-149">
<p>Le processus de conversion de la représentation de flux d&#8217;octets d&#8217;une transaction en données de représentation interne d&#8217;une bibliothèque est appelée <em>désérialisation</em> ou <em>analyse des transactions</em>. Le processus de reconversion en un flux d&#8217;octets pour la transmission sur le réseau, pour le hachage ou pour le stockage sur disque est appelé <em>sérialisation</em>. La plupart des bibliothèques bitcoin ont des fonctions intégrées pour la sérialisation et la désérialisation des transactions.</p>
</div>
<div class="paragraph data-line-151">
<p>Voyez si vous pouvez décoder manuellement la transaction d&#8217;Alice à partir de la forme hexadécimale sérialisée, en trouvant certains des éléments que nous avons vus précédemment. La section contenant les deux sorties est mise en surbrillance dans <a href="#example_6_1">Transaction d&#8217;Alice, sérialisée et présentée en notation hexadécimale</a> pour vous aider :</p>
</div>
<div id="example_6_1" class="exampleblock data-line-155">
<div class="title">Example 18. Transaction d&#8217;Alice, sérialisée et présentée en notation hexadécimale</div>
<div class="content">
<div class="paragraph data-line-156">
<p>0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73
4d2804fe65fa35779000000008b483045022100884d142d86652a3f47
ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039
ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813
01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84
16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1
7b4a10fa336a8d752adfffffffff02<strong>60e31600000000001976a914ab6</strong>
<strong>8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000</strong>
<strong>1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac</strong>
00000000</p>
</div>
</div>
</div>
<div class="paragraph data-line-168">
<p>Voici quelques conseils :</p>
</div>
<div class="ulist data-line-170">
<ul>
<li class="data-line-170">
<p>Il y a deux sorties dans la section en surbrillance, chacune sérialisée comme indiqué dans <a href="#tx_out_structure">Sérialisation des sorties de transaction</a>.</p>
</li>
<li class="data-line-171">
<p>La valeur de 0,015 bitcoin est de 1 500 000 satoshis. C&#8217;est <code>16 e3 60</code> en hexadécimal.</p>
</li>
<li class="data-line-172">
<p>Dans la transaction sérialisée, la valeur <code>16 e3 60</code> est encodée dans l&#8217;ordre d&#8217;octets petit-boutiste (octet le moins significatif en premier), elle ressemble donc à <code>60 e3 16</code>.</p>
</li>
<li class="data-line-173">
<p>La longueur de <code>scriptPubKey</code> est de 25 octets, soit <code>19</code> en hexadécimal.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3 data-line-176">
<h4 id="tx_inputs">Entrées de transactions</h4>
<div class="paragraph data-line-178">
<p> Les entrées de transaction identifient (par référence) quel UTXO sera consommé et fournissent une preuve de propriété via un script de déverrouillage.</p>
</div>
<div class="paragraph data-line-180">
<p>Pour construire une transaction, un portefeuille sélectionne parmi l&#8217;UTXO qu&#8217;il contrôle, l&#8217;UTXO avec une valeur suffisante pour effectuer le paiement demandé. Parfois un UTXO suffit, d&#8217;autres fois plus d&#8217;un est nécessaire. Pour chaque UTXO qui sera consommé pour effectuer ce paiement, le portefeuille crée une entrée pointant vers l&#8217;UTXO et le déverrouille avec un script de déverrouillage.</p>
</div>
<div class="paragraph data-line-182">
<p>Examinons plus en détail les composants d&#8217;une entrée. La première partie d&#8217;une entrée est un pointeur vers un UTXO par référence au hachage de transaction et à un index de sortie, qui identifie l&#8217;UTXO spécifique dans cette transaction. La deuxième partie est un script de déverrouillage, que le portefeuille construit afin de satisfaire aux conditions de dépenses définies dans l&#8217;UTXO. Le plus souvent, le script de déverrouillage est une signature numérique et une clé publique prouvant la propriété du bitcoin. Cependant, ce ne sont pas tous les scripts de déverrouillage qui contiennent une signature. La troisième partie est un numéro de séquence, qui sera discuté plus tard.</p>
</div>
<div class="paragraph data-line-184">
<p>Considérez notre exemple dans <a href="#transactions_behind_the_scenes">Transactions : Dans les coulisses</a>. Les entrées de transaction sont un tableau (liste) appelé <code>vin</code> :</p>
</div>
<div id="vin" class="listingblock data-line-189">
<div class="title">Les entrées de transaction dans la transaction d&#8217;Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-200">
<p>Comme vous pouvez le voir, il n&#8217;y a qu&#8217;une seule entrée dans la liste (car un UTXO contenait une valeur suffisante pour effectuer ce paiement). L&#8217;entrée contient quatre éléments :</p>
</div>
<div class="ulist data-line-202">
<ul>
<li class="data-line-202">
<p>Un ID de transaction, faisant référence à la transaction qui contient l&#8217;UTXO dépensé</p>
</li>
<li class="data-line-203">
<p>Un index de sortie (<code>vout</code>), identifiant quel UTXO de cette transaction est référencé (le premier est zéro)</p>
</li>
<li class="data-line-204">
<p>Un <code>scriptSig</code>, qui satisfait aux conditions imposées à l&#8217;UTXO, le déverrouillant pour les dépenses</p>
</li>
<li class="data-line-205">
<p>Un numéro de séquence (à discuter plus tard)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-207">
<p>Dans la transaction d&#8217;Alice, l&#8217;entrée pointe vers l&#8217;ID de transaction :</p>
</div>
<div class="listingblock data-line-209">
<div class="content">
<pre>7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</pre>
</div>
</div>
<div class="paragraph data-line-213">
<p>et l&#8217;indice de sortie <code>0</code> (c&#8217;est-à-dire le premier UTXO créé par cette transaction). Le script de déverrouillage est construit par le portefeuille d&#8217;Alice en récupérant d&#8217;abord l&#8217;UTXO référencé, en examinant son script de verrouillage, puis en l&#8217;utilisant pour créer le script de déverrouillage nécessaire pour le satisfaire.</p>
</div>
<div class="paragraph data-line-215">
<p>En regardant simplement l&#8217;entrée, vous avez peut-être remarqué que nous ne savons rien de cet UTXO, à part une référence à la transaction parent qui le contient. Nous ne connaissons pas sa valeur (montant en satoshi), et nous ne connaissons pas le script de verrouillage qui fixe les conditions pour le dépenser. Pour retrouver ces informations, il faut récupérer l&#8217;UTXO référencé en récupérant la transaction mère qui le contient. Notez que parce que la valeur de l&#8217;entrée n&#8217;est pas explicitement indiquée, nous devons également utiliser l&#8217;UTXO référencé afin de calculer les frais qui seront payés dans cette transaction (voir <a href="#tx_fees">Frais de transaction</a>).</p>
</div>
<div class="paragraph data-line-217">
<p>Ce n&#8217;est pas seulement le portefeuille d&#8217;Alice qui doit récupérer l&#8217;UTXO référencé dans les entrées. Une fois cette transaction diffusée sur le réseau, chaque nœud de validation devra également récupérer l&#8217;UTXO référencé dans les entrées de transaction afin de valider la transaction.</p>
</div>
<div class="paragraph data-line-219">
<p>Les transactions en elles-mêmes semblent incomplètes car elles manquent de contexte. Elles référencent l&#8217;UTXO dans leurs entrées mais sans récupérer cet UTXO on ne peut pas connaître la valeur des entrées ni leurs conditions de verrouillage. Lors de l&#8217;écriture d&#8217;un logiciel bitcoin, chaque fois que vous décodez une transaction dans le but de la valider ou de compter les frais ou de vérifier le script de déverrouillage, votre code devra d&#8217;abord récupérer l&#8217;UTXO référencé de la chaîne de blocs afin de construire le contexte implicite mais non présent dans les références UTXO des entrées. Par exemple, pour calculer le montant payé en frais, vous devez connaître la somme des valeurs des entrées et des sorties. Mais sans récupérer les UTXO référencés dans les entrées, vous ne connaissez pas leur valeur. Ainsi, une opération apparemment simple comme le comptage des frais dans une seule transaction implique en fait plusieurs étapes et des données provenant de plusieurs transactions.</p>
</div>
<div class="paragraph data-line-221">
<p>Nous pouvons utiliser la même séquence de commandes avec Bitcoin Core que celle que nous avons utilisée lors de la récupération de la transaction d&#8217;Alice (<code>getrawtransaction</code> et <code>decoderawtransaction</code>). Avec cela, nous pouvons obtenir l&#8217;UTXO référencé dans l&#8217;entrée de la transaction d&#8217;Alice et jeter un œil :</p>
</div>
<div id="alice_input_tx" class="listingblock data-line-226">
<div class="title">UTXO de la transaction précédente, référencé dans l&#8217;entrée de la transaction d&#8217;Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
   {
     "value": 0.10000000,
     "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"
   }
 ]</code></pre>
</div>
</div>
<div class="paragraph data-line-235">
<p>On voit que cet UTXO a une valeur de 0.1 BTC et qu&#8217;il a un script de verrouillage (<code>scriptPubKey</code>) qui contient "OP_DUP OP_HASH160&#8230;&#8203;".</p>
</div>
<div class="admonitionblock tip data-line-238">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-239">
<p>Pour bien comprendre la transaction d&#8217;Alice, nous avons dû récupérer la transaction précédente référencée en entrée. Une fonction qui récupère les transactions précédentes et les sorties de transaction non dépensées est très courante et existe dans presque toutes les bibliothèques et API Bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-242">
<h5 id="_sérialisation_des_transactions_entrées">Sérialisation des transactions : entrées</h5>
<div class="paragraph data-line-244">
<p>Lorsque les transactions sont sérialisées pour être transmises sur le réseau, leurs entrées sont codées dans un flux d&#8217;octets comme indiqué dans <a href="#tx_in_structure">Sérialisation des entrées de transaction</a>.</p>
</div>
<table id="tx_in_structure" class="tableblock frame-all grid-all stretch data-line-249">
<caption class="title">Table 17. Sérialisation des entrées de transaction</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointeur vers la transaction contenant l&#8217;UTXO à dépenser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le numéro d&#8217;index de l&#8217;UTXO à dépenser ; le premier est 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de déverrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de déverrouillage en octets à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déverrouillage-Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script remplissant les conditions du script de verrouillage UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numéro de séquence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilisé pour le temps de verrouillage ou désactivé (0xFFFFFFFF)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-258">
<p>Comme pour les sorties, voyons si nous pouvons trouver les entrées de la transaction d&#8217;Alice au format sérialisé. Tout d&#8217;abord, les entrées décodées :</p>
</div>
<div class="listingblock data-line-261">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
],</code></pre>
</div>
</div>
<div class="paragraph data-line-272">
<p>Voyons maintenant si nous pouvons identifier ces champs dans le codage hexadécimal sérialisé dans <a href="#example_6_2">Transaction d&#8217;Alice, sérialisée et présentée en notation hexadécimale</a> :</p>
</div>
<div id="example_6_2" class="exampleblock data-line-276">
<div class="title">Example 19. Transaction d&#8217;Alice, sérialisée et présentée en notation hexadécimale</div>
<div class="content">
<div class="paragraph data-line-277">
<p>0100000001<strong>186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73</strong>
<strong>4d2804fe65fa35779000000008b483045022100884d142d86652a3f47</strong>
<strong>ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039</strong>
<strong>ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</strong>
<strong>01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84</strong>
<strong>16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1</strong>
<strong>7b4a10fa336a8d752adfffffffff</strong>0260e31600000000001976a914ab6
8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000
1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000
000</p>
</div>
</div>
</div>
<div class="paragraph data-line-289">
<p>Astuces:</p>
</div>
<div class="ulist data-line-291">
<ul>
<li class="data-line-291">
<p>L&#8217;ID de transaction est sérialisé dans l&#8217;ordre inverse des octets, il commence donc par (hex) <code>18</code> et se termine par <code>79</code></p>
</li>
<li class="data-line-292">
<p>L&#8217;index de sortie est un groupe de zéros de 4 octets, facile à identifier</p>
</li>
<li class="data-line-293">
<p>La longueur du <code>scriptSig</code> est de 139 octets, soit <code>8b</code> en hexadécimal</p>
</li>
<li class="data-line-294">
<p>Le numéro de séquence est défini sur <code>FFFFFFFF</code>, encore une fois facile à identifier</p>
</li>
</ul>
</div>
<div class="paragraph data-line-296">
<p>ScriptSig est un type spécifique de script de déverrouillage qui, lorsqu&#8217;il est sérialisé pour être transmis sur le réseau, les entrées sont codées dans un flux d&#8217;octets, comme indiqué dans <a href="#scriptsig_in_structure">Sérialisation des entrées ScriptSig</a>. La sérialisation du champ signature est détaillée dans <a href="#seralization_of_signatures_der">Sérialisation des signatures (DER)</a>. Le champ de signature comprend également un type de hachage de signature (SIGHASH), qui est détaillé dans <a href="#sighash_types">Types de hachage de signature (SIGHASH)</a>.</p>
</div>
<table id="scriptsig_in_structure" class="tableblock frame-all grid-all stretch data-line-301">
<caption class="title">Table 18. Sérialisation des entrées ScriptSig</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur de la signature en octets à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une signature produite par le portefeuille de l&#8217;utilisateur à partir de sa clé privée, qui comprend un SIGHASH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille de la clé publique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur de la clé publique en octets à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clé publique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La clé publique, non hachée</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3 data-line-310">
<h4 id="tx_fees">Frais de transaction</h4>
<div class="paragraph data-line-312">
<p>La plupart des transactions incluent des frais de transaction, qui rémunèrent les mineurs de bitcoins pour la sécurisation du réseau. Les frais servent également de mécanisme de sécurité eux-mêmes, en rendant économiquement impossible pour les attaquants d&#8217;inonder le réseau de transactions. L&#8217;exploitation minière et les frais et récompenses perçus par les mineurs sont discutés plus en détail dans <a href="#mining">Minage et Consensus</a>.</p>
</div>
<div class="paragraph data-line-314">
<p>Cette section examine comment les frais de transaction sont inclus dans une transaction typique. La plupart des portefeuilles calculent et incluent automatiquement les frais de transaction. Toutefois, si vous créez des transactions par programmation ou à l&#8217;aide d&#8217;une interface de ligne de commande, vous devez comptabiliser et inclure manuellement ces frais.</p>
</div>
<div class="paragraph data-line-316">
<p>Les frais de transaction servent d&#8217;incitation à inclure (exploiter) une transaction dans le bloc suivant et également de dissuasion contre les abus du système en imposant un petit coût sur chaque transaction. Les frais de transaction sont perçus par le mineur qui exploite le bloc qui enregistre la transaction sur la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-318">
<p>Les frais de transaction sont calculés en fonction de la taille de la transaction en kilo-octets, et non de la valeur de la transaction en bitcoin. Dans l&#8217;ensemble, les frais de transaction sont fixés en fonction des forces du marché au sein du réseau Bitcoin. Les mineurs hiérarchisent les transactions en fonction de nombreux critères différents, y compris les frais, et peuvent même traiter les transactions gratuitement dans certaines circonstances. Les frais de transaction affectent la priorité de traitement, ce qui signifie qu&#8217;une transaction avec des frais suffisants est susceptible d&#8217;être incluse dans le prochain bloc miné, alors qu&#8217;une transaction avec des frais insuffisants ou nuls peut être retardée, traitée au mieux après quelques blocs, ou pas traité du tout. Les frais de transaction ne sont pas obligatoires et les transactions sans frais peuvent éventuellement être traitées ; cependant, l&#8217;inclusion des frais de transaction encourage le traitement prioritaire.</p>
</div>
<div class="paragraph data-line-320">
<p>Au fil du temps, la façon dont les frais de transaction sont calculés et leur effet sur la hiérarchisation des transactions ont évolué. Au départ, les frais de transaction étaient fixes et constants sur l&#8217;ensemble du réseau. Progressivement, la structure tarifaire s&#8217;est assouplie et peut être influencée par les forces du marché, en fonction de la capacité du réseau et du volume des transactions. Depuis au moins le début de 2016, les limites de capacité en bitcoin ont créé une concurrence entre les transactions, entraînant des frais plus élevés et faisant des transactions gratuites une chose du passé. Les transactions sans frais ou à très faibles frais sont rarement minées et parfois ne seront même pas propagées sur le réseau.</p>
</div>
<div class="paragraph data-line-322">
<p>Dans Bitcoin Core, les politiques de relais des frais sont définies par l&#8217;option <code>minrelaytxfee</code>. Le <code>minrelaytxfee</code> par défaut actuel est de 0,00001 bitcoin ou un centième de millibitcoin par kilooctet. Par conséquent, par défaut, les transactions dont les frais sont inférieurs à 0,00001 bitcoin sont traitées comme gratuites et ne sont relayées que s&#8217;il y a de la place dans le mempool ; sinon, ils sont supprimés. Les nœuds Bitcoin peuvent remplacer la politique de relais de frais par défaut en ajustant la valeur de <code>minrelaytxfee</code>.</p>
</div>
<div class="paragraph data-line-324">
<p>Tout service bitcoin qui crée des transactions, y compris les portefeuilles, les échanges, les applications de vente au détail, etc., <em>doit</em> implémenter des frais dynamiques. Les frais dynamiques peuvent être mis en œuvre via un service tiers d&#8217;estimation des frais ou avec un algorithme d&#8217;estimation des frais intégré. Si vous n&#8217;êtes pas sûr, commencez par un service tiers et, à mesure que vous acquérez de l&#8217;expérience, concevez et implémentez votre propre algorithme si vous souhaitez supprimer la dépendance tierce.</p>
</div>
<div class="paragraph data-line-326">
<p>Les algorithmes d&#8217;estimation des frais calculent les frais appropriés, en fonction de la capacité et des frais offerts par les transactions « concurrentes ». Ces algorithmes vont du simple (frais moyens ou médians dans le dernier bloc) au sophistiqué (analyse statistique). Ils estiment les frais nécessaires (en satoshis par octet) qui donneront à une transaction une forte probabilité d&#8217;être sélectionnée et incluse dans un certain nombre de blocs. La plupart des services offrent aux utilisateurs la possibilité de choisir des frais de priorité élevés, moyens ou faibles. Une priorité élevée signifie que les utilisateurs paient des frais plus élevés, mais la transaction est susceptible d&#8217;être incluse dans le bloc suivant. Une priorité moyenne et faible signifie que les utilisateurs paient des frais de transaction moins élevés, mais que la confirmation des transactions peut prendre beaucoup plus de temps.</p>
</div>
<div class="paragraph data-line-328">
<p>De nombreuses applications de portefeuille utilisent des services tiers pour le calcul des frais. Un service populaire est <a href="https://bitcoinfees.earn.com/" data-href="https://bitcoinfees.earn.com/"><em>https://bitcoinfees.earn.com/</em></a>, qui fournit une API et un graphique visuel montrant les frais en satoshi/octet pour différentes priorités.</p>
</div>
<div class="admonitionblock tip data-line-331">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-332">
<p>Les frais statiques ne sont plus viables sur le réseau Bitcoin. Les portefeuilles qui fixent des frais statiques produiront une mauvaise expérience utilisateur car les transactions seront souvent "bloquées" et resteront non confirmées. Les utilisateurs qui ne comprennent pas les transactions et les frais en bitcoins sont consternés par les transactions "bloquées" car ils pensent avoir perdu leur argent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-335">
<p>Le graphique en <a href="#bitcoinfeesearncom">Service d&#8217;estimation des frais bitcoinfees.earn.com</a> affiche l&#8217;estimation en temps réel des frais par incréments de 10 satoshi/octet et le temps de confirmation attendu (en minutes et en nombre de blocs) pour les transactions avec des frais dans chaque plage. Pour chaque fourchette de frais (par exemple, 61 à 70 satoshi/octet), deux barres horizontales indiquent le nombre de transactions non confirmées (1 405) et le nombre total de transactions au cours des dernières 24 heures (102 975), avec des frais compris dans cette fourchette. Sur la base du graphique, les frais de haute priorité recommandés à ce moment étaient de 80 satoshi/octet, des frais susceptibles d&#8217;entraîner l&#8217;inclusion de la transaction dans le bloc suivant (délai de bloc nul). Pour la perspective, la taille médiane des transactions est de 226 octets, donc les frais recommandés pour cette taille de transaction seraient de 18 080 satoshis (0,00018080 BTC).</p>
</div>
<div class="paragraph data-line-337">
<p>Les données d&#8217;estimation des frais peuvent être récupérées via une simple API HTTP REST, à l&#8217;adresse <a href="https://bitcoinfees.earn.com/api/v1/fees/recommended" data-href="https://bitcoinfees.earn.com/api/v1/fees/recommended">https://bitcoinfees.earn.com/api/v1/fees/recommended </a>. Par exemple, sur la ligne de commande en utilisant la commande <code>curl</code> :</p>
</div>
<div class="listingblock data-line-340">
<div class="title">Utilisation de l&#8217;API d&#8217;estimation des frais</div>
<div class="content">
<pre>$ curl https://bitcoinfees.earn.com/api/v1/fees/recommended

{"fastestFee":80,"halfHourFee":80,"hourFee":60}</pre>
</div>
</div>
<div class="paragraph data-line-346">
<p>L&#8217;API renvoie un objet JSON avec l&#8217;estimation actuelle des frais pour la confirmation la plus rapide (<code>fastestFee</code>), la confirmation dans les trois blocs (<code>halfHourFee</code>) et six blocs (<code>hourFee</code>), en satoshi par octet.</p>
</div>
<div id="bitcoinfeesearncom" class="imageblock data-line-350">
<div class="content">
<img src="images/mbc2_0602.png" alt="Service d&#8217;estimation des frais bitcoinfees.earn.com">
</div>
<div class="title">Figure 37. Service d&#8217;estimation des frais bitcoinfees.earn.com</div>
</div>
</div>
<div class="sect3 data-line-352">
<h4 id="_ajout_de_frais_aux_transactions">Ajout de frais aux transactions</h4>
<div class="paragraph data-line-354">
<p>La structure de données des transactions n&#8217;a pas de champ pour les frais. Au lieu de cela, les frais sont implicites comme la différence entre la somme des entrées et la somme des sorties. Tout montant excédentaire qui reste après que toutes les sorties ont été déduites de toutes les entrées est la redevance perçue par les mineurs :</p>
</div>
<div id="tx_fee_equation" class="listingblock data-line-358">
<div class="title">Les frais de transaction sont implicites, comme l&#8217;excédent des intrants moins les extrants :</div>
<div class="content">
<pre>Frais = Somme(intrants) - Somme(extrants)</pre>
</div>
</div>
<div class="paragraph data-line-362">
<p>Il s&#8217;agit d&#8217;un élément quelque peu déroutant des transactions et d&#8217;un point important à comprendre, car si vous construisez vos propres transactions, vous devez vous assurer de ne pas inclure par inadvertance des frais très importants en sous-dépensant les intrants. Cela signifie que vous devez comptabiliser toutes les entrées, si nécessaire en créant du change, ou vous finirez par donner un très gros pourboire aux mineurs !</p>
</div>
<div class="paragraph data-line-364">
<p>Par exemple, si vous consommez un UTXO de 20 bitcoins pour effectuer un paiement de 1 bitcoin, vous devez inclure une sortie de modification de 19 bitcoins dans votre portefeuille. Sinon, le "reste" de 19 bitcoins sera compté comme des frais de transaction et sera collecté par le mineur qui exploite votre transaction dans un bloc. Bien que vous receviez un traitement prioritaire et rendiez un mineur très heureux, ce n&#8217;est probablement pas ce que vous vouliez.</p>
</div>
<div class="admonitionblock warning data-line-367">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-368">
<p> Si vous oubliez d&#8217;ajouter une sortie de modification dans une transaction construite manuellement, vous paierez la modification en tant que frais de transaction. Dire "Gardez la monnaie !" au mineur n&#8217;est peut-être pas ce que vous vouliez vraiment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-371">
<p> Voyons comment cela fonctionne en pratique, en examinant à nouveau l&#8217;achat de café d&#8217;Alice. Alice veut dépenser 0,015 bitcoin pour payer son café. Pour s&#8217;assurer que cette transaction est traitée rapidement, elle voudra inclure des frais de transaction, disons 0,0005. Cela signifie que le coût total de la transaction sera de 0,0155. Son portefeuille doit donc se procurer un ensemble d&#8217;UTXO qui totalise 0,0155 bitcoin ou plus et, si nécessaire, créer de la monnaie. Disons que son portefeuille dispose d&#8217;un UTXO de 0,1 bitcoin. Elle devra donc consommer cet UTXO, créer une sortie pour le Bob&#8217;s Café pour 0,015, et une seconde sortie avec 0,0845 bitcoin en retour vers son propre portefeuille, laissant 0,0005 bitcoin non alloué, comme frais implicites pour la transaction.</p>
</div>
<div class="paragraph data-line-373">
<p>Regardons maintenant un scénario différent. Eugenia, directrice de notre association caritative pour enfants aux Philippines, a organisé une collecte de fonds pour acheter des manuels scolaires pour les enfants. Elle a reçu plusieurs milliers de petits dons de personnes du monde entier, totalisant 50 bitcoins, donc son portefeuille est plein de très petits paiements (UTXO). Maintenant, elle veut acheter des centaines de manuels scolaires auprès d&#8217;un éditeur local, en payant en bitcoins.</p>
</div>
<div class="paragraph data-line-375">
<p>Alors que l&#8217;application de portefeuille d&#8217;Eugenia tente de construire une seule transaction de paiement plus importante, elle doit s&#8217;approvisionner à partir de l&#8217;ensemble UTXO disponible, qui est composé de nombreux montants plus petits. Cela signifie que la transaction résultante proviendra de plus d&#8217;une centaine d&#8217;UTXO de petite valeur en tant qu&#8217;entrées et d&#8217;une seule sortie, payant l&#8217;éditeur du livre. Une transaction avec autant d&#8217;entrées sera supérieure à un kilo-octet, peut-être plusieurs kilo-octets. En conséquence, cela nécessitera des frais beaucoup plus élevés que la transaction de taille médiane.</p>
</div>
<div class="paragraph data-line-377">
<p>L&#8217;application de portefeuille d&#8217;Eugenia calculera les frais appropriés en mesurant la taille de la transaction et en la multipliant par les frais par kilo-octet. De nombreux portefeuilles surpayeront les frais pour les transactions plus importantes afin de s&#8217;assurer que la transaction est traitée rapidement. Les frais plus élevés ne sont pas dus au fait qu&#8217;Eugenia dépense plus d&#8217;argent, mais au fait que sa transaction est plus complexe et plus volumineuse - les frais sont indépendants de la valeur en bitcoins de la transaction.</p>
</div>
</div>
</div>
<div class="sect2 pagebreak-before less_space_h1 data-line-381">
<h3 id="tx_script">Scripts de transaction et langage de script</h3>
<div class="paragraph data-line-383">
<p>Le langage de script de transaction bitcoin, appelé <em>Script</em> , est un langage d&#8217;exécution basé sur une pile de notation polonaise inversée (RPN) de type Forth. Si cela ressemble à du charabia, vous n&#8217;avez probablement pas étudié les langages de programmation des années 1960, mais ce n&#8217;est pas grave, nous vous expliquerons tout dans ce chapitre. Le script de verrouillage placé sur un UTXO et le script de déverrouillage sont écrits dans ce langage de script. Lorsqu&#8217;une transaction est validée, le script de déverrouillage de chaque entrée est exécuté parallèlement au script de verrouillage correspondant pour voir s&#8217;il satisfait à la condition de dépense.</p>
</div>
<div class="paragraph data-line-385">
<p>Script est un langage très simple qui a été conçu pour être limité dans sa portée et être exécutable sur une gamme de matériel et peut être aussi simple qu&#8217;un périphérique intégré. Il nécessite un traitement minimal et ne peut pas faire la plupart des choses fantaisistes que les langages de programmation modernes peuvent faire. Pour son utilisation dans la validation de monnaie programmable, il s&#8217;agit d&#8217;une fonction de sécurité délibérée.</p>
</div>
<div class="paragraph data-line-387">
<p>Aujourd&#8217;hui, la plupart des transactions traitées via le réseau Bitcoin ont la forme "Paiement à l&#8217;adresse Bitcoin de Bob" et sont basées sur un script appelé Pay-to-Script Public-Key-Hash. Cependant, les transactions bitcoin ne se limitent pas au script "Paiement à l&#8217;adresse Bitcoin de Bob". En fait, les scripts de verrouillage peuvent être écrits pour exprimer une grande variété de conditions complexes. Afin de comprendre ces scripts plus complexes, nous devons d&#8217;abord comprendre les bases des scripts de transaction et du langage de script.</p>
</div>
<div class="paragraph data-line-389">
<p>Dans cette section, nous démontrerons les composants de base du langage de script de transaction bitcoin et montrerons comment il peut être utilisé pour exprimer des conditions simples de dépenses et comment ces conditions peuvent être satisfaites en déverrouillant des scripts.</p>
</div>
<div class="admonitionblock tip data-line-392">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-393">
<p>La validation des transactions Bitcoin n&#8217;est pas basée sur un modèle statique, mais est plutôt obtenue grâce à l&#8217;exécution d&#8217;un langage de script. Ce langage permet d&#8217;exprimer une variété presque infinie de conditions. C&#8217;est ainsi que le bitcoin obtient le pouvoir de "l&#8217;argent programmable".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-397">
<h4 id="_incomplétude_de_turing">Incomplétude de Turing</h4>
<div class="paragraph data-line-399">
<p>Le langage de script de transaction bitcoin contient de nombreux opérateurs, mais est délibérément limité d&#8217;une manière importante : il n&#8217;y a pas de boucles ou de capacités de contrôle de flux complexes autres que le contrôle de flux conditionnel. Cela garantit que le langage n&#8217;est pas <em>Turing complet</em>, ce qui signifie que les scripts ont une complexité limitée et des temps d&#8217;exécution prévisibles. Le script n&#8217;est pas un langage universel. Ces limitations garantissent que le langage ne peut pas être utilisé pour créer une boucle infinie ou une autre forme de "bombe logique" qui pourrait être intégrée dans une transaction de manière à provoquer une attaque par déni de service contre le réseau Bitcoin. N&#8217;oubliez pas que chaque transaction est validée par chaque nœud complet du réseau Bitcoin. Un langage limité empêche le mécanisme de validation des transactions d&#8217;être utilisé comme une vulnérabilité.</p>
</div>
</div>
<div class="sect3 data-line-401">
<h4 id="_vérification_sans_état">Vérification sans état</h4>
<div class="paragraph data-line-403">
<p>Le langage de script de transaction bitcoin est sans état, en ce sens qu&#8217;il n&#8217;y a pas d&#8217;état avant l&#8217;exécution du script, ou d&#8217;état enregistré après l&#8217;exécution du script. Par conséquent, toutes les informations nécessaires à l&#8217;exécution d&#8217;un script sont contenues dans le script. Un script s&#8217;exécutera de manière prévisible de la même manière sur n&#8217;importe quel système. Si votre système vérifie un script, vous pouvez être sûr que tous les autres systèmes du réseau Bitcoin vérifieront également le script, ce qui signifie qu&#8217;une transaction valide est valide pour tout le monde et tout le monde le sait. Cette prévisibilité des résultats est un avantage essentiel du système Bitcoin.</p>
</div>
</div>
<div class="sect3 data-line-406">
<h4 id="tx_lock_unlock">Construction du script (Verrouiller + Déverrouiller)</h4>
<div class="paragraph data-line-408">
<p>Le moteur de validation des transactions de Bitcoin s&#8217;appuie sur deux types de scripts pour valider les transactions : un script de verrouillage et un script de déverrouillage.</p>
</div>
<div class="paragraph data-line-410">
<p>Un script de verrouillage est une condition de dépense placée sur une sortie : il spécifie les conditions qui doivent être remplies pour dépenser la production à l&#8217;avenir. Historiquement, le script de verrouillage était appelé <em>scriptPubKey</em>, car il contenait généralement une clé publique ou une adresse Bitcoin (hachage de clé publique). Dans ce livre, nous l&#8217;appelons un "script de verrouillage" pour reconnaître l&#8217;éventail de possibilités beaucoup plus large de cette technologie de script. Dans la plupart des applications bitcoin, ce que nous appelons un script de verrouillage apparaîtra dans le code source sous la forme <code>scriptPubKey</code>. Vous verrez également le script de verrouillage appelé <em>script de témoin</em> (voir <a href="#segwit">Témoin séparé</a>) ou plus généralement comme un <em>casse-tête cryptographique</em>. Ces termes signifient tous la même chose, à différents niveaux d&#8217;abstraction.</p>
</div>
<div class="paragraph data-line-412">
<p>Un script de déverrouillage est un script qui « résout », ou satisfait, les conditions placées sur une sortie par un script de verrouillage et permet à la sortie d&#8217;être dépensée. Les scripts de déverrouillage font partie de chaque entrée de transaction. Ils contiennent la plupart du temps une signature numérique produite par le portefeuille de l&#8217;utilisateur à partir de sa clé privée. Historiquement, le script de déverrouillage s&#8217;appelait <em>scriptSig</em>, car il contenait généralement une signature numérique. Dans la plupart des applications bitcoin, le code source fait référence au script de déverrouillage sous la forme <code>scriptSig</code>. Vous verrez également le script de déverrouillage appelé <em>témoin</em> (voir <a href="#segwit">Témoin séparé</a>). Dans ce livre, nous l&#8217;appelons un "script de déverrouillage" pour reconnaître la gamme beaucoup plus large d&#8217;exigences de script de verrouillage, car ce n&#8217;est pas tous les scripts de déverrouillage qui doivent contenir des signatures.</p>
</div>
<div class="paragraph data-line-414">
<p>Chaque nœud de validation Bitcoin validera les transactions en exécutant les scripts de verrouillage et de déverrouillage ensemble. Chaque entrée contient un script de déverrouillage et fait référence à un UTXO existant précédemment. Le logiciel de validation copiera le script de déverrouillage, récupérera l&#8217;UTXO référencé par l&#8217;entrée et copiera le script de verrouillage à partir de cet UTXO. Les scripts de déverrouillage et de verrouillage sont ensuite exécutés en séquence. L&#8217;entrée est valide si le script de déverrouillage satisfait les conditions du script de verrouillage (voir <a href="#script_exec">Exécution séparée des scripts de déverrouillage et de verrouillage</a>). Toutes les entrées sont validées indépendamment, dans le cadre de la validation globale de la transaction.</p>
</div>
<div class="paragraph data-line-416">
<p>Notez que l&#8217;UTXO est enregistré en permanence dans la chaîne de blocs, et est donc invariable et n&#8217;est pas affecté par les tentatives infructueuses de le dépenser par référence dans une nouvelle transaction. Seule une transaction valide qui satisfait correctement les conditions de la sortie entraîne que la sortie est considérée comme "dépensée" et retirée de l&#8217;ensemble des sorties de transaction non dépensées (ensemble UTXO).</p>
</div>
<div class="paragraph data-line-418">
<p><a href="#scriptSig_and_scriptPubKey">Combiner scriptSig et scriptPubKey pour évaluer un script de transaction</a> est un exemple des scripts de déverrouillage et de verrouillage pour le type de transaction bitcoin le plus courant (un paiement à un hachage de clé publique), montrant le script combiné résultant de la concaténation des scripts de déverrouillage et de verrouillage avant la validation du script.</p>
</div>
<div id="scriptSig_and_scriptPubKey" class="imageblock data-line-422">
<div class="content">
<img src="images/mbc2_0603.png" alt="scriptSig et scriptPubKey">
</div>
<div class="title">Figure 38. Combiner scriptSig et scriptPubKey pour évaluer un script de transaction</div>
</div>
<div class="sect4 data-line-424">
<h5 id="_la_pile_dexécution_de_script">La pile d&#8217;exécution de script</h5>
<div class="paragraph data-line-426">
<p>Le langage de script de Bitcoin est appelé un langage basé sur la pile car il utilise une structure de données appelée <em>pile</em>. Une pile est une structure de données très simple qui peut être visualisée comme une pile de cartes. Une pile permet deux opérations : push et pop. Push ajoute un élément au sommet de la pile. Pop supprime l&#8217;élément du haut de la pile. Les opérations sur une pile ne peuvent agir que sur l&#8217;élément le plus haut de la pile. Une structure de données de pile est également appelée file d&#8217;attente Last-In-First-Out (dernier entré, premier sorti), ou "LIFO".</p>
</div>
<div class="paragraph data-line-428">
<p>Le langage de script exécute le script en traitant chaque élément de gauche à droite. Les nombres (constantes de données) sont poussés sur la pile. Les opérateurs poussent ou sortent un ou plusieurs paramètres de la pile, agissent sur eux et peuvent pousser un résultat sur la pile. Par exemple, <code>OP_ADD</code> fera sortir deux éléments de la pile, les ajoutera et poussera la somme résultante sur la pile.</p>
</div>
<div class="paragraph data-line-430">
<p>Les opérateurs conditionnels évaluent une condition, produisant un résultat booléen TRUE (VRAI) ou FALSE (FAUX). Par exemple, <code>OP_EQUAL</code> dépile deux éléments de la pile et pousse TRUE (TRUE est représenté par le nombre 1) s&#8217;ils sont égaux ou FALSE (représenté par zéro) s&#8217;ils ne sont pas égaux. Les scripts de transaction Bitcoin contiennent généralement un opérateur conditionnel, afin qu&#8217;ils puissent produire le résultat TRUE qui signifie une transaction valide.</p>
</div>
</div>
<div class="sect4 data-line-432">
<h5 id="_un_script_simple">Un script simple</h5>
<div class="paragraph data-line-434">
<p>Appliquons maintenant ce que nous avons appris sur les scripts et les piles à quelques exemples simples.</p>
</div>
<div class="paragraph data-line-436">
<p>Dans <a href="#simplemath_script">La validation du script Bitcoin en calculs simples</a>, le script <code>2 3 OP_ADD 5 OP_EQUAL</code> démontre l&#8217;opérateur d&#8217;addition arithmétique <code>OP_ADD</code>, additionnant deux nombres et mettant le résultat sur la pile, suivi de l&#8217;opérateur conditionnel <code>OP_EQUAL</code>, qui vérifie que la somme résultante est égale à <code>5</code>. Par souci de brièveté, le préfixe <code>OP_</code> est omis dans l&#8217;exemple étape par étape. Pour plus de détails sur les opérateurs de script et les fonctions disponibles, voir <a href="#tx_script_ops">Opérateurs, constantes et symboles du langage de script de transaction</a>.</p>
</div>
<div class="paragraph data-line-438">
<p>Bien que la plupart des scripts de verrouillage se réfèrent à un hachage de clé publique (essentiellement, une adresse Bitcoin), nécessitant ainsi une preuve de propriété pour dépenser les fonds, le script n&#8217;a pas besoin d&#8217;être aussi complexe. Toute combinaison de scripts de verrouillage et de déverrouillage donnant une valeur TRUE est valide. L&#8217;arithmétique simple que nous avons utilisée comme exemple de langage de script est également un script de verrouillage valide qui peut être utilisé pour verrouiller une sortie de transaction.</p>
</div>
<div class="paragraph data-line-440">
<p>Utilisez une partie de l&#8217;exemple de script arithmétique comme script de verrouillage :</p>
</div>
<div class="listingblock data-line-442">
<div class="content">
<pre>3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-446">
<p>qui peut être satisfaite par une transaction contenant une entrée avec le script de déverrouillage :</p>
</div>
<div class="listingblock data-line-448">
<div class="content">
<pre>2</pre>
</div>
</div>
<div class="paragraph data-line-452">
<p>Le logiciel de validation combine les scripts de verrouillage et de déverrouillage et le script résultant est :</p>
</div>
<div class="listingblock data-line-454">
<div class="content">
<pre>2 3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-458">
<p>Comme nous l&#8217;avons vu dans l&#8217;exemple étape par étape dans <a href="#simplemath_script">La validation du script Bitcoin en calculs simples</a>, lorsque ce script est exécuté, le résultat est <code>OP_TRUE</code>, rendant la transaction valide. Non seulement il s&#8217;agit d&#8217;un script de verrouillage de sortie de transaction valide, mais l&#8217;UTXO résultant pourrait être dépensé par toute personne ayant les compétences en arithmétique pour savoir que le nombre 2 satisfait le script.</p>
</div>
<div class="admonitionblock tip data-line-461">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-462">
<p>Les transactions sont valides si le premier résultat de la pile est <code>TRUE</code> (noté <code>{0x01}</code>), toute autre valeur différente de zéro, autre que <code>OP_0</code>, ou si la pile est vide après l&#8217;exécution du script. Les transactions ne sont pas valides si la valeur supérieure de la pile est <code>FALSE</code> (une valeur vide de longueur nulle, notée <code>{}</code>) ou si l&#8217;exécution du script est arrêtée explicitement par un opérateur, tel que <code>OP_VERIFY</code>, <code>OP_RETURN</code> ou un terminateur conditionnel tel que <code>OP_ENDIF</code>. Voir <a href="#tx_script_ops">Opérateurs, constantes et symboles du langage de script de transaction</a> pour plus de détails.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="simplemath_script" class="imageblock data-line-467">
<div class="content">
<img src="images/mbc2_0604.png" alt="Exemple mathématique simple du TxScript">
</div>
<div class="title">Figure 39. La validation du script Bitcoin en calculs simples</div>
</div>
<div class="paragraph pagebreak-before data-line-470">
<p>Ce qui suit est un script légèrement plus complexe, qui calcule <code>2 + 7 - 3 + 1</code>. Notez que lorsque le script contient plusieurs opérateurs à la suite, la pile permet aux résultats d&#8217;un opérateur d&#8217;être appliqués par l&#8217;opérateur suivant :</p>
</div>
<div class="listingblock data-line-472">
<div class="content">
<pre>2 7 OP_ADD 3 OP_SUB 1 OP_ADD 7 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-476">
<p>Essayez de valider vous-même le script précédent à l&#8217;aide d&#8217;un crayon et de papier. Lorsque l&#8217;exécution du script se termine, vous devriez vous retrouver avec la valeur <code>TRUE</code> sur la pile.</p>
</div>
</div>
<div class="sect4 data-line-479">
<h5 id="script_exec">Exécution séparée des scripts de déverrouillage et de verrouillage</h5>
<div class="paragraph data-line-481">
<p>Dans le client Bitcoin d&#8217;origine, les scripts de déverrouillage et de verrouillage étaient concaténés et exécutés en séquence. Pour des raisons de sécurité, cela a été modifié en 2010, en raison d&#8217;une vulnérabilité qui permettait à un script de déverrouillage malformé de pousser des données sur la pile et de corrompre le script de verrouillage. Dans l&#8217;implémentation actuelle, les scripts sont exécutés séparément avec la pile transférée entre les deux exécutions, comme décrit ci-après.</p>
</div>
<div class="paragraph data-line-483">
<p>Tout d&#8217;abord, le script de déverrouillage est exécuté à l&#8217;aide du moteur d&#8217;exécution de la pile. Si le script de déverrouillage est exécuté sans erreur (par exemple, s&#8217;il ne reste plus de pointeurs " pendants"), la pile principale est copiée et le script de verrouillage est exécuté. Si le résultat de l&#8217;exécution du script de verrouillage avec les données de la pile copiées à partir du script de déverrouillage est "TRUE", le script de déverrouillage a réussi à résoudre les conditions imposées par le script de verrouillage et, par conséquent, l&#8217;entrée est une autorisation valide de dépenser l&#8217;UTXO. S&#8217;il reste un résultat autre que "TRUE" après l&#8217;exécution du script combiné, l&#8217;entrée est invalide car elle n&#8217;a pas satisfait aux conditions de dépenses placées sur l&#8217;UTXO.</p>
</div>
</div>
</div>
<div class="sect3 data-line-487">
<h4 id="p2pkh">Pay-to-Public-Key-Hash (P2PKH)</h4>
<div class="paragraph data-line-489">
<p>La grande majorité des transactions traitées sur le réseau Bitcoin dépensent des sorties verrouillées avec un script Pay-to-Public-Key-Hash ou "P2PKH". Ces sorties contiennent un script de verrouillage qui verrouille la sortie sur un hachage de clé publique, plus communément appelé adresse Bitcoin. Une sortie verrouillée par un script P2PKH peut être déverrouillée (passée) en présentant une clé publique et une signature numérique créée par la clé privée correspondante (voir <a href="#digital_sigs">Signatures numériques (ECDSA)</a>).</p>
</div>
<div class="paragraph data-line-491">
<p>Par exemple, regardons à nouveau le paiement d&#8217;Alice au Bob&#8217;s Café. Alice a effectué un paiement de 0,015 bitcoin à l&#8217;adresse Bitcoin du comptoir. Cette sortie de transaction aurait un script de verrouillage de la forme :</p>
</div>
<div class="listingblock data-line-493">
<div class="content">
<pre>OP_DUP OP_HASH160 &lt;Cafe Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-497">
<p>Le <code>Cafe Public Key Hash</code> équivaut à l&#8217;adresse Bitcoin du café, sans l&#8217;encodage Base58Check. La plupart des applications afficheraient le <em>hachage de la clé publique</em> en codage hexadécimal et non le format familier de l&#8217;adresse Bitcoin Base58Check qui commence par un "1".</p>
</div>
<div class="paragraph data-line-499">
<p>Le script de verrouillage précédent peut se contenter d&#8217;un script de déverrouillage de la forme :</p>
</div>
<div class="listingblock data-line-501">
<div class="content">
<pre>&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt;</pre>
</div>
</div>
<div class="paragraph data-line-505">
<p>Les deux scripts ensemble formeraient le script de validation combiné suivant :</p>
</div>
<div class="listingblock data-line-507">
<div class="content">
<pre>&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt; OP_DUP OP_HASH160
&lt;Cafe Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-512">
<p>Lorsqu&#8217;il est exécuté, ce script combiné sera évalué à TRUE si, et seulement si, le script de déverrouillage correspond aux conditions définies par le script de verrouillage. En d&#8217;autres termes, le résultat sera TRUE si le script de déverrouillage a une signature valide de la clé privée du comptoir qui correspond au hachage de la clé publique défini comme encombrement.</p>
</div>
<div class="paragraph data-line-514">
<p>Les figures <a data-type="xref" href="#P2PubKHash1" data-xrefstyle="select: labelnumber">#P2PubKHash1</a> et <a data-type="xref" href="#P2PubKHash2" data-xrefstyle="select: labelnumber">#P2PubKHash2</a> montrent (en deux parties) une exécution pas à pas du script combiné, qui prouvera qu&#8217;il s&#8217;agit d&#8217;une transaction valide.</p>
</div>
<div id="P2PubKHash1" class="imageblock data-line-518">
<div class="content">
<img src="images/mbc2_0605.png" alt="Tx_Script_P2PubKeyHash_1">
</div>
<div class="title">Figure 40. Évaluer un script pour une transaction P2PKH (partie 1 sur 2)</div>
</div>
<div id="P2PubKHash2" class="imageblock data-line-522">
<div class="content">
<img src="images/mbc2_0606.png" alt="Tx_Script_P2PubKeyHash_2">
</div>
<div class="title">Figure 41. Évaluer un script pour une transaction P2PKH (partie 2 sur 2)</div>
</div>
</div>
</div>
<div class="sect2 data-line-525">
<h3 id="digital_sigs">Signatures numériques (ECDSA)</h3>
<div class="paragraph data-line-527">
<p>Jusqu&#8217;à présent, nous n&#8217;avons approfondi aucun détail sur les "signatures numériques". Dans cette section, nous examinons le fonctionnement des signatures numériques et comment elles peuvent présenter la preuve de la propriété d&#8217;une clé privée sans révéler cette clé privée.</p>
</div>
<div class="paragraph data-line-529">
<p>L&#8217;algorithme de signature numérique utilisé dans le bitcoin est l'<em>Elliptic Curve Digital Signature Algorithm</em>, ou <em>ECDSA</em>. ECDSA est l&#8217;algorithme utilisé pour les signatures numériques basées sur des paires de clés privées/publiques à courbe elliptique, comme décrit dans <a href="#elliptic_curve">La cryptographie à courbe elliptique expliquée</a>. ECDSA est utilisé par les fonctions de script <code>OP_CHECKSIG</code>, <code>OP_CHECKSIGVERIFY</code>, <code>OP_CHECKMULTISIG</code> et <code>OP_CHECKMULTISIGVERIFY</code>. Chaque fois que vous les voyez dans un script de verrouillage, le script de déverrouillage doit contenir une signature ECDSA.</p>
</div>
<div class="paragraph data-line-531">
<p> Une signature numérique a trois objectifs en bitcoin. Premièrement, la signature prouve que le propriétaire de la clé privée, qui est implicitement le propriétaire des fonds, a <em>autorisé</em> la dépense de ces fonds. Deuxièmement, la preuve de l&#8217;autorisation est <em>indéniable</em> (non-répudiable). Troisièmement, la signature prouve que la transaction (ou des parties spécifiques de la transaction) n&#8217;a pas et <em>ne peut pas être modifiée</em> par qui que ce soit après avoir été signée.</p>
</div>
<div class="paragraph data-line-533">
<p>Notez que chaque entrée de transaction est signée indépendamment. Ceci est essentiel, car ni les signatures ni les entrées ne doivent appartenir ou être appliquées par les mêmes "propriétaires". En fait, un schéma de transaction spécifique appelé "CoinJoin" utilise ce fait pour créer des transactions multipartites pour la confidentialité.</p>
</div>
<div class="admonitionblock note data-line-536">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-537">
<p>Chaque entrée de transaction et toute signature qu&#8217;elle peut contenir est <em>complètement</em> indépendante de toute autre entrée ou signature. Plusieurs parties peuvent collaborer pour construire des transactions et signer une seule entrée chacune.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="digital_signature_definition" class="sidebarblock data-line-542">
<div class="content">
<div class="title">Définition de Wikipedia d&#8217;une "signature numérique"</div>
<div class="paragraph data-line-543">
<p>Une signature numérique est un schéma mathématique permettant de démontrer l&#8217;authenticité d&#8217;un message ou de documents numériques. Une signature numérique valide donne au destinataire des raisons de croire que le message a été créé par un expéditeur connu (authentification), que l&#8217;expéditeur ne peut pas nier avoir envoyé le message (non-répudiable) et que le message n&#8217;a pas été altéré en transit (intégrité).</p>
</div>
<div class="paragraph data-line-545">
<p><em>Source : <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
</div>
</div>
<div class="sect3 data-line-548">
<h4 id="_comment_fonctionnent_les_signatures_numériques">Comment fonctionnent les signatures numériques</h4>
<div class="paragraph data-line-550">
<p>Une signature numérique est un <em>schéma mathématique</em> qui se compose de deux parties. La première partie est un algorithme de création d&#8217;une signature, à l&#8217;aide d&#8217;une clé privée (la clé de signature), à partir d&#8217;un message (la transaction). La deuxième partie est un algorithme qui permet à quiconque de vérifier la signature, étant donné également le message et une clé publique.</p>
</div>
<div class="sect4 data-line-552">
<h5 id="_création_dune_signature_numérique">Création d&#8217;une signature numérique</h5>
<div class="paragraph data-line-554">
<p>Dans l&#8217;implémentation de l&#8217;algorithme ECDSA par bitcoin, le "message" signé est la transaction, ou plus précisément un hachage d&#8217;un sous-ensemble spécifique des données de la transaction (voir <a href="#sighash_types">Types de hachage de signature (SIGHASH)</a>). La clé de signature est la clé privée de l&#8217;utilisateur. Le résultat est la signature :</p>
</div>
<div class="paragraph data-line-556">
<p>\(Sig = F_{sig}(F_{hash}(m), dA)\)</p>
</div>
<div class="paragraph data-line-558">
<p>où:</p>
</div>
<div class="ulist data-line-560">
<ul>
<li class="data-line-560">
<p><em>dA</em> est la clé privée de signature</p>
</li>
<li class="data-line-561">
<p><em>m</em> est la transaction (ou une partie de celle-ci)</p>
</li>
<li class="data-line-562">
<p><em>F</em><sub><em>hash</em></sub> est la fonction de hachage</p>
</li>
<li class="data-line-563">
<p><em>F</em><sub><em>sig</em></sub> est l&#8217;algorithme de signature</p>
</li>
<li class="data-line-564">
<p><em>Sig</em> est la signature résultante</p>
</li>
</ul>
</div>
<div class="paragraph data-line-566">
<p>Plus de détails sur les mathématiques d&#8217;ECDSA peuvent être trouvés dans <a href="#ecdsa_math">Mathématiques ECDSA</a>.</p>
</div>
<div class="paragraph data-line-568">
<p>La fonction <em>F</em><sub><em>sig</em></sub> produit une signature <code>Sig</code> composée de deux valeurs, communément appelées <code>R</code> et <code>S</code> :</p>
</div>
<div class="listingblock data-line-570">
<div class="content">
<pre>Sig = (R, S)</pre>
</div>
</div>
<div class="paragraph data-line-574">
<p>Maintenant que les deux valeurs <code>R</code> et <code>S</code> ont été calculées, elles sont sérialisées en un flux d&#8217;octets à l&#8217;aide d&#8217;un schéma de codage standard international appelé <em>Distinguished Encoding Rules</em>, ou <em>DER</em> (ou règles d&#8217;encodage distingués).</p>
</div>
</div>
<div class="sect4 data-line-577">
<h5 id="seralization_of_signatures_der">Sérialisation des signatures (DER)</h5>
<div class="paragraph data-line-579">
<p>Regardons la transaction Alice créée à nouveau. Dans l&#8217;entrée de transaction, il y a un script de déverrouillage qui contient la signature encodée DER suivante du portefeuille d&#8217;Alice :</p>
</div>
<div class="listingblock data-line-581">
<div class="content">
<pre>3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e38133</pre>
</div>
</div>
<div class="paragraph data-line-585">
<p>Cette signature est un flux d&#8217;octets sérialisé des valeurs <code>R</code> et <code>S</code> produites par le portefeuille d&#8217;Alice pour prouver qu&#8217;elle possède la clé privée autorisée à dépenser cette sortie. Le format de sérialisation se compose de neuf éléments comme suit :</p>
</div>
<div class="ulist data-line-587">
<ul>
<li class="data-line-587">
<p><code>0x30</code>—indiquant le début d&#8217;une séquence DER</p>
</li>
<li class="data-line-588">
<p><code>0x45</code>—la longueur de la séquence (69 octets)</p>
</li>
<li class="data-line-589">
<p><code>0x02</code>—une valeur entière suit</p>
</li>
<li class="data-line-590">
<p><code>0x21</code>—la longueur de l&#8217;entier (33 octets)</p>
</li>
<li class="data-line-591">
<p><code>R</code>—<code>00884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb</code></p>
</li>
<li class="data-line-592">
<p><code>0x02</code>—un autre entier suit</p>
</li>
<li class="data-line-593">
<p><code>0x20</code>—la longueur de l&#8217;entier (32 octets)</p>
</li>
<li class="data-line-594">
<p><code>S</code>—<code>4b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</code></p>
</li>
<li class="data-line-595">
<p>Un suffixe (<code>0x01</code>) indiquant le type de hachage utilisé (<code>SIGHASH_ALL</code>)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-597">
<p>Voyez si vous pouvez décoder la signature sérialisée (encodée en DER) d&#8217;Alice en utilisant cette liste. Les nombres importants sont <code>R</code> et <code>S</code> ; le reste des données fait partie du schéma de codage DER.</p>
</div>
</div>
</div>
<div class="sect3 data-line-599">
<h4 id="_vérification_de_la_signature">Vérification de la signature</h4>
<div class="paragraph data-line-601">
<p>Pour vérifier la signature, il faut avoir la signature (<code>R</code> et <code>S</code>), la transaction sérialisée, et la clé publique (qui correspond à la clé privée utilisée pour créer la signature). Essentiellement, la vérification d&#8217;une signature signifie "Seul le propriétaire de la clé privée qui a généré cette clé publique pourrait avoir produit cette signature sur cette transaction."</p>
</div>
<div class="paragraph data-line-603">
<p>L&#8217;algorithme de vérification de signature prend le message (un hachage de la transaction ou de parties de celui-ci), la clé publique du signataire et la signature (<code>valeurs R</code> et <code>S</code>), et renvoie TRUE si la signature est valide pour ce message et cette clé publique.</p>
</div>
</div>
<div class="sect3 data-line-606">
<h4 id="sighash_types">Types de hachage de signature (SIGHASH)</h4>
<div class="paragraph data-line-608">
<p>Les signatures numériques sont appliquées aux messages, qui dans le cas du bitcoin, sont les transactions elles-mêmes. La signature implique un <em>engagement</em> du signataire sur des données de transaction spécifiques. Dans sa forme la plus simple, la signature s&#8217;applique à l&#8217;ensemble de la transaction, engageant ainsi toutes les entrées, sorties et autres champs de transaction. Cependant, une signature ne peut s&#8217;engager que sur un sous-ensemble des données d&#8217;une transaction, ce qui est utile pour un certain nombre de scénarios, comme nous le verrons dans cette section.</p>
</div>
<div class="paragraph data-line-610">
<p>Les signatures Bitcoin ont un moyen d&#8217;indiquer quelle partie des données d&#8217;une transaction est incluse dans le hachage signé par la clé privée à l&#8217;aide d&#8217;un drapeau <code>SIGHASH</code>. Le drapeau <code>SIGHASH</code> est un octet unique ajouté à la signature. Chaque signature a un drapeau <code>SIGHASH</code> et le drapeau peut être différent d&#8217;une entrée à l&#8217;autre. Une transaction avec trois entrées signées peut avoir trois signatures avec des drapeaux <code>SIGHASH</code> différents, chaque signature signant (committant) différentes parties de la transaction.</p>
</div>
<div class="paragraph data-line-612">
<p>N&#8217;oubliez pas que chaque entrée peut contenir une signature dans son script de déverrouillage. Par conséquent, une transaction qui contient plusieurs entrées peut avoir des signatures avec différents indicateurs <code>SIGHASH</code> qui valident différentes parties de la transaction dans chacune des entrées. Notez également que les transactions bitcoin peuvent contenir des entrées de différents "propriétaires", qui ne peuvent signer qu&#8217;une seule entrée dans une transaction partiellement construite (et invalide), collaborant avec d&#8217;autres pour rassembler toutes les signatures nécessaires pour effectuer une transaction valide. De nombreux types d&#8217;indicateurs <code>SIGHASH</code> n&#8217;ont de sens que si vous pensez à plusieurs participants collaborant en dehors du réseau Bitcoin et mettant à jour une transaction partiellement signée.</p>
</div>
<div class="paragraph pagebreak-before data-line-615">
<p>Il existe trois indicateurs <code>SIGHASH</code> : <code>ALL</code>, <code>NONE</code> et <code>SINGLE</code>, comme indiqué dans <a href="#sighash_types_and_their">Types SIGHASH et leurs significations</a>.</p>
</div>
<table id="sighash_types_and_their" class="tableblock frame-all grid-all stretch data-line-620">
<caption class="title">Table 19. Types SIGHASH et leurs significations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Drapeau <code>SIGHASH</code></th>
<th class="tableblock halign-left valign-top">Valeur</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à toutes les entrées et sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à toutes les entrées, aucune des sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SINGLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à toutes les entrées mais uniquement à la sortie avec le même numéro d&#8217;index que l&#8217;entrée signée</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-627">
<p>De plus, il existe un drapeau modificateur <code>SIGHASH_ANYONECANPAY</code>, qui peut être combiné avec chacun des drapeaux précédents. Lorsque <code>ANYONECANPAY</code> est défini, une seule entrée est signée, laissant le reste (et leurs numéros de séquence) ouverts pour modification. Le <code>ANYONECANPAY</code> a la valeur <code>0x80</code> et est appliqué par OR au niveau du bit, ce qui donne les drapeaux combinés comme indiqué dans <a href="#sighash_types_with_modifiers">Types SIGHASH avec modificateurs et leurs significations</a>.</p>
</div>
<table id="sighash_types_with_modifiers" class="tableblock frame-all grid-all stretch data-line-632">
<caption class="title">Table 20. Types SIGHASH avec modificateurs et leurs significations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Drapeau SIGHASH</th>
<th class="tableblock halign-left valign-top">Valeur</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à une entrée et à toutes les sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à une entrée, aucune des sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique à une entrée et à la sortie avec le même numéro d&#8217;index</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-639">
<p>Ces combinaisons de drapeaux sont résumées dans <a href="#sighash_combinations">Résumé des différentes combinaisons de sighash</a>.</p>
</div>
<div id="sighash_combinations" class="imageblock data-line-643">
<div class="content">
<img src="images/sighash_combinations.png" alt="Résumé des différentes combinaisons de drapeaux SIGHASH">
</div>
<div class="title">Figure 42. Résumé des différentes combinaisons de sighash</div>
</div>
<div class="paragraph data-line-645">
<p>La façon dont les drapeaux <code>SIGHASH</code> sont appliqués lors de la signature et de la vérification est qu&#8217;une copie de la transaction est faite et que certains champs à l&#8217;intérieur sont tronqués (mis à zéro et vidés). La transaction résultante est sérialisée. Le drapeau <code>SIGHASH</code> est ajouté à la fin de la transaction sérialisée et le résultat est haché. Le hachage lui-même est le "message" qui est signé. Selon l&#8217;indicateur <code>SIGHASH</code> utilisé, différentes parties de la transaction sont tronquées. Le hachage résultant dépend de différents sous-ensembles de données dans la transaction. En incluant le <code>SIGHASH</code> comme dernière étape avant le hachage, la signature valide également le type <code>SIGHASH</code>, de sorte qu&#8217;il ne peut pas être modifié (par exemple, par un mineur).</p>
</div>
<div class="admonitionblock note data-line-648">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-649">
<p>Tous les types <code>SIGHASH</code> signent le champ <code>nLocktime</code> de la transaction (voir <a href="#transaction_locktime_nlocktime">Temps de verrouillage des transactions (nLocktime)</a>). De plus, le type <code>SIGHASH</code> lui-même est ajouté à la transaction avant sa signature, de sorte qu&#8217;il ne peut pas être modifié une fois signé.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-652">
<p>Dans l&#8217;exemple de la transaction d&#8217;Alice (voir la liste dans <a href="#seralization_of_signatures_der">Sérialisation des signatures (DER)</a>), nous avons vu que la dernière partie de la signature codée en DER était <code>01</code>, qui est le drapeau <code>SIGHASH_ALL</code>. Cela verrouille les données de transaction, de sorte que la signature d&#8217;Alice valide l&#8217;état de toutes les entrées et sorties. C&#8217;est la forme de signature la plus courante.</p>
</div>
<div class="paragraph data-line-654">
<p>Examinons quelques-uns des autres types de <code>SIGHASH</code> et comment ils peuvent être utilisés dans la pratique :</p>
</div>
<div class="dlist data-line-656">
<dl>
<dt class="hdlist1"><code>ALL|ANYONECANPAY</code> </dt>
<dd>
<p>Cette construction peut être utilisée pour effectuer une transaction de type "financement participatif". les fonds peuvent construire une transaction avec une seule sortie. La sortie unique paie le montant "objectif" à la collecte de fonds. Une telle transaction n&#8217;est évidemment pas valide, car elle n&#8217;a pas d&#8217;entrées. Cependant, d&#8217;autres peuvent maintenant la modifier en ajoutant une entrée de leur propre, en tant que don. Ils signent leur propre entrée avec <code>ALL|ANYONECANPAY</code>. À moins que suffisamment d&#8217;entrées ne soient rassemblées pour atteindre la valeur de la sortie, la transaction n&#8217;est pas valide. Chaque don est un "engagement", qui ne peut pas être collecté par le collecteur de fonds jusqu&#8217;à ce que le montant total de l&#8217;objectif soit atteint.</p>
</dd>
<dt class="hdlist1"><code>NONE</code> </dt>
<dd>
<p>Cette construction peut être utilisée pour créer un "chèque au porteur" ou un "chèque en blanc" d&#8217;un montant spécifique. Il s&#8217;engage sur l&#8217;entrée, mais permet de modifier le script de verrouillage de sortie. N&#8217;importe qui peut écrire sa propre adresse Bitcoin dans le script de verrouillage de sortie et racheter la transaction. Cependant, la valeur de sortie elle-même est verrouillée par la signature.</p>
</dd>
<dt class="hdlist1"><code>NONE|ANYONECANPAY</code> </dt>
<dd>
<p>Cette construction peut être utilisée pour construire un "collecteur de poussière". Les utilisateurs qui ont de minuscules UTXO dans leur portefeuille ne peuvent pas les dépenser car le coût des frais dépasse la valeur de la poussière. Avec ce type de signature, la poussière UTXO peut être donnée à quiconque pour l&#8217;agréger et la dépenser quand il le souhaite.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-662">
<p>Il y a quelques propositions pour modifier ou étendre le système <code>SIGHASH</code>. L&#8217;une de ces propositions est <em>Bitmask Sighash Modes</em> de Glenn Willen de Blockstream, dans le cadre du projet Elements. Cela vise à créer un remplacement flexible pour les types <code>SIGHASH</code> qui permet "des masques de bits arbitraires et réinscriptibles par des mineurs d&#8217;entrées et de sorties" qui peuvent exprimer "des schémas de pré-engagement contractuels plus complexes, tels que des offres signées avec changement dans un échange d&#8217;actifs distribué".</p>
</div>
<div class="admonitionblock note data-line-665">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-666">
<p>Vous ne verrez pas les drapeaux <code>SIGHASH</code> présentés comme une option dans l&#8217;application de portefeuille d&#8217;un utilisateur. À quelques exceptions près, les portefeuilles construisent des scripts P2PKH et signent avec les drapeaux <code>SIGHASH_ALL</code>. Pour utiliser un indicateur <code>SIGHASH</code> différent, vous devrez écrire un logiciel pour construire et signer des transactions. Plus important encore, les drapeaux <code>SIGHASH</code> peuvent être utilisés par des applications bitcoin à usage spécial qui permettent de nouvelles utilisations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-670">
<h4 id="ecdsa_math">Mathématiques ECDSA</h4>
<div class="paragraph data-line-672">
<p>Comme mentionné précédemment, les signatures sont créées par une fonction mathématique <em>F</em><sub><em>sig</em></sub> qui produit une signature composée de deux valeurs <em>R</em> et <em>S</em>. Dans cette section, nous examinons la fonction <em>F</em><sub><em>sig</em></sub> plus en détail.</p>
</div>
<div class="paragraph data-line-674">
<p>L&#8217;algorithme de signature génère d&#8217;abord une paire de clés publiques privées <em>éphémères</em> (temporaires). Cette paire de clés temporaire est utilisée dans le calcul des valeurs <em>R</em> et <em>S</em>, après une transformation impliquant la clé privée de signature et le hachage de la transaction.</p>
</div>
<div class="paragraph data-line-676">
<p>La paire de clés temporaire est basée sur un nombre aléatoire <em>k</em>, qui est utilisé comme clé privée temporaire. À partir de <em>k</em>, nous générons la clé publique temporaire correspondante <em>P</em> (calculée comme <em>P = k*G</em>, de la même manière que les clés publiques bitcoin sont dérivées ; voir <a href="#pubkey">Clés publiques</a>). La valeur <em>R</em> de la signature numérique est alors la coordonnée x de la clé publique éphémère <em>P</em>.</p>
</div>
<div class="paragraph data-line-678">
<p>A partir de là, l&#8217;algorithme calcule la valeur <em>S</em> de la signature, telle que :</p>
</div>
<div class="paragraph data-line-680">
<p><em>S</em> = <em>k</em><sup>-1</sup> (<em>Hash</em>(<em>m</em>) + <em>dA</em> * <em>R</em>) <em>mod n</em></p>
</div>
<div class="paragraph data-line-682">
<p>où:</p>
</div>
<div class="ulist data-line-684">
<ul>
<li class="data-line-684">
<p><em>k</em> est la clé privée éphémère</p>
</li>
<li class="data-line-685">
<p><em>R</em> est la coordonnée x de la clé publique éphémère</p>
</li>
<li class="data-line-686">
<p><em>dA</em> est la clé privée de signature</p>
</li>
<li class="data-line-687">
<p><em>m</em> est les données de transaction</p>
</li>
<li class="data-line-688">
<p><em>n</em> est l&#8217;ordre premier de la courbe elliptique</p>
</li>
</ul>
</div>
<div class="paragraph data-line-690">
<p>La vérification est l&#8217;inverse de la fonction de génération de signature, utilisant les valeurs <em>R</em>, <em>S</em> et la clé publique pour calculer une valeur <em>P</em>, qui est un point sur la courbe elliptique (la clé publique éphémère utilisée dans la création de signature) :</p>
</div>
<div class="paragraph data-line-692">
<p><em>P</em> = <em>S</em><sup>-1</sup> * <em>Hash</em>(<em>m</em>) * <em>G</em> + <em>S</em><sup>-1</sup> * <em>R</em> * <em>Qa</em></p>
</div>
<div class="paragraph data-line-694">
<p>où:</p>
</div>
<div class="ulist data-line-696">
<ul>
<li class="data-line-696">
<p><em>R</em> et <em>S</em> sont les valeurs de signature</p>
</li>
<li class="data-line-697">
<p><em>Qa</em> est la clé publique d&#8217;Alice</p>
</li>
<li class="data-line-698">
<p><em>m</em> est les données de transaction qui ont été signées</p>
</li>
<li class="data-line-699">
<p><em>G</em> est le point générateur de la courbe elliptique</p>
</li>
</ul>
</div>
<div class="paragraph data-line-701">
<p>Si la coordonnée x du point calculé <em>P</em> est égale à <em>R</em>, alors le vérificateur peut conclure que la signature est valide.</p>
</div>
<div class="paragraph data-line-703">
<p>Notez qu&#8217;en vérifiant la signature, la clé privée n&#8217;est ni connue ni révélée.</p>
</div>
<div class="admonitionblock tip data-line-706">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-707">
<p>ECDSA est nécessairement un calcul assez compliqué; une explication complète est au-delà de la portée de ce livre. Un certain nombre d&#8217;excellents guides en ligne vous guident étape par étape : recherchez "ECDSA expliqué" ou essayez celui-ci : <a href="https://bit.ly/2r0HhGB" class="undefined" data-href="https://bit.ly/2r0HhGB">https://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-710">
<h4 id="_limportance_du_caractère_aléatoire_dans_les_signatures">L&#8217;importance du caractère aléatoire dans les signatures</h4>
<div class="paragraph data-line-712">
<p>Comme nous l&#8217;avons vu dans <a href="#ecdsa_math">Mathématiques ECDSA</a>, l&#8217;algorithme de génération de signature utilise une clé aléatoire <em>k</em>, comme base d&#8217;un couple clé privée/publique éphémère. La valeur de <em>k</em> n&#8217;est pas importante, <em>tant qu&#8217;elle est aléatoire</em>. Si la même valeur <em>k</em> est utilisée pour produire deux signatures sur différents messages (transactions), alors la signature <em>clé privée</em> peut être calculée par n&#8217;importe qui. La réutilisation de la même valeur pour <em>k</em> dans un algorithme de signature conduit à l&#8217;exposition de la clé privée !</p>
</div>
<div class="admonitionblock warning data-line-715">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-716">
<p>Si la même valeur <em>k</em> est utilisée dans l&#8217;algorithme de signature sur deux transactions différentes, la clé privée peut être calculée et exposée au monde !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-719">
<p>Ce n&#8217;est pas seulement une possibilité théorique. Nous avons vu ce problème conduire à l&#8217;exposition de clés privées dans quelques implémentations différentes d&#8217;algorithmes de signature de transaction en bitcoin. Des personnes se sont fait voler des fonds en raison de la réutilisation par inadvertance d&#8217;une valeur <em>k</em>. La raison la plus courante de réutilisation d&#8217;une valeur <em>k</em> est un générateur de nombres aléatoires mal initialisé.</p>
</div>
<div class="paragraph data-line-721">
<p>Pour éviter cette vulnérabilité, la meilleure pratique de l&#8217;industrie est de ne pas générer <em>k</em> avec un générateur de nombres aléatoires semé d&#8217;entropie, mais plutôt d&#8217;utiliser un processus déterministe-aléatoire semé avec les données de transaction elles-mêmes. Cela garantit que chaque transaction produit un <em>k</em> différent. L&#8217;algorithme standard de l&#8217;industrie pour l&#8217;initialisation déterministe de <em>k</em> est défini dans <a href="https://tools.ietf.org/html/rfc6979" data-href="https://tools.ietf.org/html/rfc6979">RFC 6979</a>, publié par l&#8217;Internet Engineering Task Force.</p>
</div>
<div class="paragraph data-line-723">
<p>Si vous implémentez un algorithme pour signer des transactions en bitcoin, vous <em>devez</em> utiliser la RFC 6979 ou un algorithme déterministe-aléatoire similaire pour vous assurer de générer un <em>k</em> différent pour chaque transaction.</p>
</div>
</div>
</div>
<div class="sect2 data-line-725">
<h3 id="_adresses_bitcoin_soldes_et_autres_abstractions">Adresses Bitcoin, soldes et autres abstractions</h3>
<div class="paragraph data-line-727">
<p>Nous avons commencé ce chapitre avec la découverte que les transactions sont très différentes "dans les coulisses" de la façon dont elles sont présentées dans les portefeuilles, les explorateurs de chaîne de blocs, et d&#8217;autres applications destinées aux utilisateurs. De nombreux concepts simplistes et familiers des chapitres précédents, tels que les adresses et les soldes Bitcoin, semblent être absents de la structure de transaction. Nous avons vu que les transactions ne contiennent pas d&#8217;adresses Bitcoin en soi, mais fonctionnent plutôt via des scripts qui verrouillent et déverrouillent des valeurs discrètes de bitcoin. Les soldes ne sont présents nulle part dans ce système et pourtant, chaque application de portefeuille affiche bien en évidence le solde du portefeuille de l&#8217;utilisateur.</p>
</div>
<div class="paragraph data-line-729">
<p>Maintenant que nous avons exploré ce qui est réellement inclus dans une transaction bitcoin, nous pouvons examiner comment les abstractions de niveau supérieur sont dérivées des composants apparemment primitifs de la transaction.</p>
</div>
<div class="paragraph data-line-731">
<p>Regardons à nouveau comment la transaction d&#8217;Alice a été présentée sur un explorateur de blocs populaire (<a href="#alice_transaction_to_bobs_cafe">Transaction d&#8217;Alice au Bob&#8217;s Café</a>).</p>
</div>
<div id="alice_transaction_to_bobs_cafe" class="imageblock data-line-735">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 43. Transaction d&#8217;Alice au Bob&#8217;s Café</div>
</div>
<div class="paragraph data-line-737">
<p>Sur le côté gauche de la transaction, l&#8217;explorateur de explorateur de chaîne de blocs affiche l&#8217;adresse Bitcoin d&#8217;Alice comme "expéditeur". En fait, cette information n&#8217;est pas dans la transaction elle-même. Lorsque l&#8217;explorateur de chaîne de blocs fait référence à la transaction, il fait également référence à la transaction précédente associée à l&#8217;entrée et extrait la première sortie de cette transaction plus ancienne. Dans cette sortie se trouve un script de verrouillage qui verrouille l&#8217;UTXO sur le hachage de la clé publique d&#8217;Alice (un script P2PKH). L&#8217;explorateur de chaîne de blocs a extrait le hachage de la clé publique et l&#8217;a encodé à l&#8217;aide de l&#8217;encodage Base58Check pour produire et afficher l&#8217;adresse Bitcoin qui représente cette clé publique.</p>
</div>
<div class="paragraph data-line-739">
<p>De même, sur le côté droit, l&#8217;explorateur de chaîne de blocs affiche les deux sorties ; le premier à l&#8217;adresse Bitcoin de Bob et le second à l&#8217;adresse Bitcoin d&#8217;Alice (comme change). Encore une fois, pour créer ces adresses Bitcoin, l&#8217;explorateur de chaîne de blocs a extrait le script de verrouillage de chaque sortie, l&#8217;a reconnu comme un script P2PKH et a extrait le hachage de clé publique de l&#8217;intérieur. Enfin, l&#8217;explorateur de chaîne de blocs a réencodé chaque hachage de clé publique avec Base58Check pour produire et afficher les adresses Bitcoin.</p>
</div>
<div class="paragraph data-line-741">
<p>Si vous deviez cliquer sur l&#8217;adresse Bitcoin de Bob, l&#8217;explorateur de explorateur de chaîne de blocs vous montrerait la vue dans <a href="#the_balance_of_bobs_bitcoin_address">Le solde de l&#8217;adresse Bitcoin de Bob</a>.</p>
</div>
<div id="the_balance_of_bobs_bitcoin_address" class="imageblock data-line-745">
<div class="content">
<img src="images/mbc2_0608.png" alt="Le solde de l&#8217;adresse Bitcoin de Bob">
</div>
<div class="title">Figure 44. Le solde de l&#8217;adresse Bitcoin de Bob</div>
</div>
<div class="paragraph data-line-747">
<p>L&#8217;explorateur de la chaîne de blocs affiche le solde de l&#8217;adresse Bitcoin de Bob. Mais nulle part dans le système Bitcoin il n&#8217;y a un concept de "solde". Au lieu de cela, les valeurs affichées ici sont construites par l&#8217;explorateur de explorateur de chaîne de blocs comme suit.</p>
</div>
<div class="paragraph data-line-749">
<p>Pour construire le montant "Total reçu", l&#8217;explorateur de explorateur de la chaîne de blocs décodera d&#8217;abord l&#8217;encodage Base58Check de l&#8217;adresse Bitcoin pour récupérer le hachage 160 bits de la clé publique de Bob qui est encodé dans l&#8217;adresse. Ensuite, l&#8217;explorateur de chaîne de blocs recherchera dans la base de données des transactions, à la recherche de sorties avec des scripts de verrouillage P2PKH contenant le hachage de la clé publique de Bob. En additionnant la valeur de toutes les sorties, l&#8217;explorateur de la chaîne de blocs peut produire la valeur totale reçue.</p>
</div>
<div class="paragraph data-line-751">
<p>Construire le solde actuel (affiché comme "Solde final") nécessite un peu plus de travail. L&#8217;explorateur de la chaîne de blocs conserve une base de données distincte des sorties actuellement non dépensées, l&#8217;ensemble UTXO. Pour maintenir cette base de données, l&#8217;explorateur de la chaîne de blocs doit surveiller le réseau Bitcoin, ajouter les UTXO nouvellement créés et supprimer les UTXO dépensés, en temps réel, tels qu&#8217;ils apparaissent dans les transactions non confirmées. Il s&#8217;agit d&#8217;un processus compliqué qui dépend du suivi des transactions au fur et à mesure qu&#8217;elles se propagent, ainsi que du maintien d&#8217;un consensus avec le réseau Bitcoin pour s&#8217;assurer que la chaîne correcte est suivie. Parfois, l&#8217;explorateur de la chaîne de blocs est désynchronisé et sa perspective de l&#8217;ensemble UTXO est incomplète ou incorrecte.</p>
</div>
<div class="paragraph data-line-753">
<p>À partir de l&#8217;ensemble UTXO, l&#8217;explorateur de la chaîne de blocs résume la valeur de toutes les sorties non dépensées faisant référence au hachage de la clé publique de Bob et produit le numéro "Solde final" affiché à l&#8217;utilisateur.</p>
</div>
<div class="paragraph data-line-755">
<p>Afin de produire cette image unique, avec ces deux "soldes", l&#8217;explorateur de la chaîne de blocs doit indexer et rechercher parmi des dizaines, des centaines, voire des centaines de milliers de transactions.</p>
</div>
<div class="paragraph data-line-757">
<p>En résumé, les informations présentées aux utilisateurs via les applications de portefeuille, les explorateurs de chaînes de blocs et d&#8217;autres interfaces utilisateur Bitcoin sont souvent composées d&#8217;abstractions de niveau supérieur qui sont dérivées en recherchant de nombreuses transactions différentes, en inspectant leur contenu et en manipulant les données qu&#8217;elles contiennent. En présentant cette vision simpliste des transactions bitcoin qui ressemblent à des chèques bancaires d&#8217;un expéditeur à un destinataire, ces applications doivent extraire de nombreux détails sous-jacents. Ils se concentrent principalement sur les types de transactions courants : P2PKH avec des signatures SIGHASH_ALL sur chaque entrée. Ainsi, alors que les applications bitcoin peuvent présenter plus de 80 % de toutes les transactions de manière facile à lire, elles sont parfois bloquées par des transactions qui s&#8217;écartent de la norme. Les transactions qui contiennent des scripts de verrouillage plus complexes, ou différents indicateurs SIGHASH, ou de nombreuses entrées et sorties, démontrent la simplicité et la faiblesse de ces abstractions.</p>
</div>
<div class="paragraph data-line-759">
<p>Chaque jour, des centaines de transactions qui ne contiennent pas de sorties P2PKH sont confirmées sur la chaîne de blocs. Les explorateurs de chaîne de blocs les présentent souvent avec des messages d&#8217;avertissement rouges indiquant qu&#8217;ils ne peuvent pas décoder une adresse.</p>
</div>
<div class="paragraph data-line-19">
<p>Comme nous le verrons au chapitre suivant, il ne s&#8217;agit pas nécessairement de transactions étranges. Ce sont des transactions qui contiennent des scripts de verrouillage plus complexes que le P2PKH commun. Nous apprendrons ensuite à décoder et à comprendre des scripts plus complexes et les applications qu&#8217;ils prennent en charge.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="adv_transactions">Transactions et scripts avancés</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-6">
<h3 id="ch07_intro">Présentation</h3>
<div class="paragraph data-line-8">
<p>Dans le chapitre précédent, nous avons présenté les éléments de base des transactions bitcoin et examiné le type de script de transaction le plus courant, le script P2PKH. Dans ce chapitre, nous examinerons des scripts plus avancés et comment nous pouvons les utiliser pour créer des transactions avec des conditions complexes.</p>
</div>
<div class="paragraph data-line-10">
<p>Tout d&#8217;abord, nous examinerons les scripts <em>multisignature</em>. Ensuite, nous examinerons le deuxième script de transaction le plus courant, <em>Pay-to-Script-Hash</em>, qui ouvre tout un monde de scripts complexes. Ensuite, nous examinerons de nouveaux opérateurs de script qui ajoutent une dimension temporelle au bitcoin, via les <em>timelocks</em> (verrouillage temporel). Enfin, nous examinerons les <em>Segregated Witness</em> (témoins séparés), une modification architecturale de la structure des transactions.</p>
</div>
</div>
<div class="sect2 data-line-13">
<h3 id="multisig">Multisignature</h3>
<div class="paragraph data-line-15">
<p>Les scripts multisignatures définissent une condition dans laquelle N clés publiques sont enregistrées dans le script et au moins M d&#8217;entre elles doivent fournir des signatures pour débloquer les fonds. Ceci est également connu sous le nom de schéma M-sur-N, où N est le nombre total de clés et M est le seuil de signatures requises pour la validation. Par exemple, une multisignature 2 sur 3 est celle où trois clés publiques sont répertoriées comme signataires potentiels et au moins deux d&#8217;entre elles doivent être utilisées pour créer des signatures pour une transaction valide afin de dépenser les fonds.</p>
</div>
<div class="paragraph data-line-17">
<p>À l&#8217;heure actuelle, les scripts multisignatures <em>standard</em> sont limités à un maximum de 3 clés publiques répertoriées, ce qui signifie que vous pouvez faire n&#8217;importe quoi d&#8217;une multisignature 1 sur 1 jusqu&#8217;à 3 sur 3 ou toute combinaison dans cette plage. La limitation à 3 clés répertoriées pourrait être levée au moment de la publication de ce livre, alors vérifiez la fonction <code>IsStandard()</code> pour voir ce qui est actuellement accepté par le réseau. Notez que la limite de 3 clés s&#8217;applique uniquement aux scripts multisignatures standard (également appelés "nus (bare en anglais)"), et non aux scripts multisignatures enveloppés dans un script Pay-to-Script-Hash (P2SH). Les scripts multisignatures P2SH sont limités à 15 clés, permettant jusqu&#8217;à 15 multisignatures sur 15. Cette limitation est également imposée par la fonction <code>IsStandard()</code>. Nous en apprendrons davantage sur P2SH dans <a href="#p2sh">Pay-to-Script-Hash (P2SH)</a>.</p>
</div>
<div class="paragraph data-line-19">
<p>La forme générale d&#8217;un script de verrouillage définissant une condition multisignature M-de-N est :</p>
</div>
<div class="listingblock data-line-21">
<div class="content">
<pre>M &lt;Public Key 1&gt; &lt;Public Key 2&gt; ... &lt;Public Key N&gt; N CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-25">
<p>où N est le nombre total de clés publiques répertoriées et M est le seuil de signatures requises pour dépenser la sortie.</p>
</div>
<div class="paragraph data-line-27">
<p>Un script de verrouillage définissant une condition multisignature 2 sur 3 ressemble à ceci :</p>
</div>
<div class="listingblock data-line-29">
<div class="content">
<pre>2 &lt;Public Key A&gt; &lt;Public Key B&gt; &lt;Public Key C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-33">
<p>Le script de verrouillage précédent peut se contenter d&#8217;un script de déverrouillage contenant n&#8217;importe quelle combinaison de deux signatures issues des clés privées correspondant aux trois clés publiques listées :</p>
</div>
<div class="listingblock data-line-35">
<div class="content">
<pre>&lt;Signature B&gt; &lt;Signature C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-39">
<p>Les deux scripts ensemble formeraient le script de validation combiné :</p>
</div>
<div class="listingblock data-line-41">
<div class="content">
<pre>&lt;Signature B&gt; &lt;Signature C&gt; 2 &lt;Public Key A&gt; &lt;Public Key B&gt; &lt;Public Key C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-45">
<p>Lorsqu&#8217;il est exécuté, ce script combiné sera évalué à TRUE si, et seulement si, le script de déverrouillage correspond aux conditions définies par le script de verrouillage. Dans ce cas, la condition est de savoir si le script de déverrouillage possède une signature valide à partir des deux clés privées qui correspondent à deux des trois clés publiques définies comme une charge.</p>
</div>
<div class="sect3 data-line-48">
<h4 id="multisig_bug">Un bogue dans l&#8217;exécution de CHECKMULTISIG</h4>
<div class="paragraph data-line-50">
<p>Il y a un bug dans l&#8217;exécution de <code>CHECKMULTISIG</code> qui nécessite une légère solution de contournement. Lorsque <code>CHECKMULTISIG</code> s&#8217;exécute, il doit consommer M`N`2 éléments sur la pile en tant que paramètres. Cependant, en raison du bogue, <code>CHECKMULTISIG</code> affichera une valeur supplémentaire ou une valeur de plus que prévu.</p>
</div>
<div class="paragraph data-line-52">
<p>Examinons cela plus en détail à l&#8217;aide de l&#8217;exemple de validation précédent :</p>
</div>
<div class="listingblock data-line-54">
<div class="content">
<pre>&lt;Signature B&gt; &lt;Signature C&gt; 2 &lt;Public Key A&gt; &lt;Public Key B&gt; &lt;Public Key C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-58">
<p>Tout d&#8217;abord, <code>CHECKMULTISIG</code> affiche l&#8217;élément supérieur, qui est <code>N</code> (dans cet exemple "3"). Ensuite, il affiche <code>N</code> éléments, qui sont les clés publiques pouvant signer. Dans cet exemple, les clés publiques A, B et C. Ensuite, un élément apparaît, qui est <code>M</code>, le quorum (combien de signatures sont nécessaires). Ici M = 2. À ce stade, <code>CHECKMULTISIG</code> devrait faire apparaître les éléments finaux <code>M</code>, qui sont les signatures, et voir s&#8217;ils sont valides. Cependant, malheureusement, un bogue dans l&#8217;implémentation fait que <code>CHECKMULTISIG</code> affiche un élément de plus (M+1 total) qu&#8217;il ne le devrait. L&#8217;élément supplémentaire n&#8217;est pas pris en compte lors de la vérification des signatures, il n&#8217;a donc aucun effet direct sur <code>CHECKMULTISIG</code> lui-même. Cependant, une valeur supplémentaire doit être présente car si elle n&#8217;est pas présente, lorsque <code>CHECKMULTISIG</code> tente d&#8217;apparaître sur une pile vide, cela provoquera une erreur de pile et un échec du script (marquant la transaction comme invalide). Comme l&#8217;élément supplémentaire n&#8217;est pas pris en compte, il peut s&#8217;agir de n&#8217;importe quoi, mais habituellement <code>0</code> est utilisé.</p>
</div>
<div class="paragraph data-line-60">
<p>Parce que ce bogue est devenu une partie des règles de consensus, il doit maintenant être répliqué pour toujours. Par conséquent, la validation correcte du script ressemblerait à ceci :</p>
</div>
<div class="listingblock data-line-62">
<div class="content">
<pre>0 &lt;Signature B&gt; &lt;Signature C&gt; 2 &lt;Public Key A&gt; &lt;Public Key B&gt; &lt;Public Key C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-66">
<p>Ainsi le script de déverrouillage réellement utilisé en multisig n&#8217;est pas :</p>
</div>
<div class="listingblock data-line-68">
<div class="content">
<pre>&lt;Signature B&gt; &lt;Signature C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-72">
<p>mais à la place c&#8217;est :</p>
</div>
<div class="listingblock data-line-74">
<div class="content">
<pre>0 &lt;Signature B&gt; &lt;Signature C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-78">
<p>À partir de maintenant, si vous voyez un script de déverrouillage multisig, vous devriez vous attendre à voir un <code>0</code> supplémentaire au début, dont le seul but est de contourner un bogue qui est accidentellement devenu une règle de consensus.</p>
</div>
</div>
</div>
<div class="sect2 data-line-81">
<h3 id="p2sh">Pay-to-Script-Hash (P2SH)</h3>
<div class="paragraph data-line-83">
<p>Pay- to-Script-Hash (P2SH) a été introduit en 2012 en tant que nouveau type de transaction puissant qui simplifie grandement l&#8217;utilisation de scripts de transaction complexes. Pour expliquer le besoin de P2SH, regardons un exemple pratique.</p>
</div>
<div class="paragraph data-line-85">
<p>("Pay-to-Script-Hash (P2SH)", "exemple d&#8217;import/export")Dans <a href="#ch01_intro_what_is_bitcoin">Présentation</a> nous avons présenté Mohammed, un importateur d&#8217;électronique basé à Dubaï. La société de Mohammed utilise largement la fonction multisignature de Bitcoin pour ses comptes d&#8217;entreprise. Les scripts multisignatures sont l&#8217;une des utilisations les plus courantes des capacités de script avancées de Bitcoin et constituent une fonctionnalité très puissante. La société de Mohammed utilise un script multisignature pour tous les paiements des clients, connu en termes comptables sous le nom de "comptes débiteurs ou recevables". Avec le schéma multisignature, tous les paiements effectués par les clients sont verrouillés de telle manière qu&#8217;ils nécessitent au moins deux signatures pour être libérés, de Mohammed et de l&#8217;un de ses partenaires ou de son avocat qui dispose d&#8217;une clé de secours. Un système multisignature comme celui-ci offre des contrôles de gouvernance d&#8217;entreprise et protège contre le vol, le détournement de fonds ou la perte.</p>
</div>
<div class="paragraph data-line-87">
<p>Le script résultant est assez long et ressemble à ceci :</p>
</div>
<div class="listingblock data-line-89">
<div class="content">
<pre>2 &lt;Mohammed's Public Key&gt; &lt;Partner1 Public Key&gt; &lt;Partner2 Public Key&gt; &lt;Partner3 Public Key&gt; &lt;Attorney Public Key&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-93">
<p>Bien que les scripts multisignatures soient une fonctionnalité puissante, ils sont lourds à utiliser. Compte tenu du script précédent, Mohammed devrait communiquer ce script à chaque client avant le paiement. Chaque client devrait utiliser un logiciel spécial de portefeuille bitcoin avec la possibilité de créer des scripts de transaction personnalisés, et chaque client devrait comprendre comment créer une transaction à l&#8217;aide de scripts personnalisés. De plus, la transaction résultante serait environ cinq fois plus importante qu&#8217;une simple transaction de paiement, car ce script contient des clés publiques très longues. Le fardeau de cette transaction extra-large serait supporté par le client sous la forme de frais. Enfin, un gros script de transaction comme celui-ci serait transporté dans l&#8217;UTXO défini dans la RAM de chaque nœud complet, jusqu&#8217;à ce qu&#8217;il soit dépensé. Tous ces problèmes rendent difficile l&#8217;utilisation de scripts de verrouillage complexes dans la pratique.</p>
</div>
<div class="paragraph data-line-95">
<p>P2SH a été développé pour résoudre ces difficultés pratiques et rendre l&#8217;utilisation de scripts complexes aussi simple qu&#8217;un paiement à une adresse Bitcoin. Avec les paiements P2SH, le script de verrouillage complexe est remplacé par son empreinte numérique, un hachage cryptographique. Lorsqu&#8217;une transaction tentant de dépenser l&#8217;UTXO est présentée ultérieurement, elle doit contenir le script correspondant au hachage, en plus du script de déverrouillage. En termes simples, P2SH signifie "payer à un script correspondant à ce hachage, un script qui sera présenté plus tard lorsque cette sortie sera dépensée".</p>
</div>
<div class="paragraph data-line-97">
<p>Dans les transactions P2SH, le script de verrouillage qui est remplacé par un hachage est appelé <em>redeem script</em> ou <em>script de rachat</em> car il est présenté au système au moment du rachat plutôt que comme un script de verrouillage. <a href="#without_p2sh">Script complexe sans P2SH</a> affiche le script sans P2SH et <a href="#with_p2sh">Script complexe comme P2SH</a> montre le même script encodé avec P2SH.</p>
</div>
<table id="without_p2sh" class="tableblock frame-all grid-all stretch data-line-101">
<caption class="title">Table 21. Script complexe sans P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 PubKey1 PubKey2 PubKey3 PubKey4 PubKey5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de déverrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Sig1 Sig2</p></td>
</tr>
</tbody>
</table>
<table id="with_p2sh" class="tableblock frame-all grid-all stretch data-line-108">
<caption class="title">Table 22. Script complexe comme P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de rachat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 PubKey1 PubKey2 PubKey3 PubKey4 PubKey5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HASH160 &lt;20-byte hash of redeem script&gt; EQUAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de déverrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Sig1 Sig2 &lt;redeem script&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-114">
<p>Comme vous pouvez le voir dans les tableaux, avec P2SH, le script complexe qui détaille les conditions de dépense de la sortie (script de rachat) n&#8217;est pas présenté dans le script de verrouillage. Au lieu de cela, seul un hachage de celui-ci se trouve dans le script de verrouillage et le script de rachat lui-même est présenté plus tard, dans le cadre du script de déverrouillage lorsque la sortie est dépensée. Cela déplace le fardeau des frais et de la complexité de l&#8217;expéditeur (qui crée la transaction) vers le destinataire (qui déverrouille et dépense la transaction).</p>
</div>
<div class="paragraph data-line-116">
<p>Examinons la société de Mohammed, le script multisignature complexe et les scripts P2SH qui en résultent.</p>
</div>
<div class="paragraph data-line-118">
<p>Tout d&#8217;abord, le script multisignature que la société de Mohammed utilise pour tous les paiements entrants des clients :</p>
</div>
<div class="listingblock data-line-120">
<div class="content">
<pre>2 &lt;Mohammed's Public Key&gt; &lt;Partner1 Public Key&gt; &lt;Partner2 Public Key&gt; &lt;Partner3 Public Key&gt; &lt;Attorney Public Key&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-124">
<p>Si les espaces réservés sont remplacés par des clés publiques réelles (affichées ici sous forme de nombres de 520 bits commençant par 04), vous pouvez voir que ce script devient très long :</p>
</div>
<div class="listingblock data-line-126">
<div class="content">
<pre>2
04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C58704A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D99779650421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-131">
<p>Ce script entier peut à la place être représenté par un hachage cryptographique de 20 octets, en appliquant d&#8217;abord l&#8217;algorithme de hachage SHA256, puis en appliquant l&#8217;algorithme RIPEMD160 sur le résultat.</p>
</div>
<div class="paragraph data-line-133">
<p>Nous utilisons <code>libbitcoin-explorer</code> (bx) sur la ligne de commande pour produire le hachage du script, comme suit :</p>
</div>
<div class="listingblock data-line-135">
<div class="content">
<pre>echo \
2 \
[04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256 | bx ripemd160
54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-148">
<p>La série de commandes ci-dessus encode d&#8217;abord le script de rachat multisig de Mohammed en tant que script bitcoin sérialisé encodé en hexadécimal. La commande <code>bx</code> suivante calcule le hachage SHA256 de cela. La prochaine commande <code>bx</code> hache à nouveau avec RIPEMD160, produisant le hachage de script final :</p>
</div>
<div class="paragraph data-line-150">
<p>Le hachage de 20 octets du script de rachat de Mohammed est :</p>
</div>
<div class="listingblock data-line-152">
<div class="content">
<pre>54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-156">
<p>Une transaction P2SH verrouille la sortie sur ce hachage au lieu du script de rachat plus long, en utilisant le script de verrouillage :</p>
</div>
<div class="listingblock data-line-158">
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-162">
<p>qui, comme vous pouvez le voir, est beaucoup plus courte. Au lieu de "payer à ce script multisignature à 5 clés", la transaction équivalente à P2SH est "payer à un script avec ce hachage". Un client effectuant un paiement à la société de Mohammed n&#8217;a qu&#8217;à inclure ce script de verrouillage beaucoup plus court dans son paiement. Lorsque Mohammed et ses partenaires veulent dépenser cet UTXO, ils doivent présenter le script de rachat original (celui dont le hachage a verrouillé l&#8217;UTXO) et les signatures nécessaires pour le déverrouiller, comme ceci :</p>
</div>
<div class="listingblock data-line-164">
<div class="content">
<pre>&lt;Sig1&gt; &lt;Sig2&gt; &lt;2 PK1 PK2 PK3 PK4 PK5 5 CHECKMULTISIG&gt;</pre>
</div>
</div>
<div class="paragraph data-line-168">
<p>Les deux scripts sont combinés en deux étapes. Tout d&#8217;abord, le script de rachat est vérifié par rapport au script de verrouillage pour s&#8217;assurer que le hachage correspond :</p>
</div>
<div class="listingblock data-line-170">
<div class="content">
<pre>&lt;2 PK1 PK2 PK3 PK4 PK5 5 CHECKMULTISIG&gt; HASH160 &lt;redeem scriptHash&gt; EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-173">
<p>Si le hachage du script de rachat correspond, le script de déverrouillage est exécuté de lui-même pour déverrouiller le script de rachat :</p>
</div>
<div class="listingblock data-line-175">
<div class="content">
<pre>&lt;Sig1&gt; &lt;Sig2&gt; 2 PK1 PK2 PK3 PK4 PK5 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-179">
<p>Presque tous les scripts décrits dans ce chapitre ne peuvent être implémentés qu&#8217;en tant que scripts P2SH. Par exemple, un script de verrouillage multisignature standard 2 sur 5 ne peut pas être utilisé directement dans le script de verrouillage d&#8217;un UTXO, car <code>IsStandard()</code> invaliderait la transaction. Pour se conformer, un script de verrouillage P2SH peut être utilisé à la place, comme vu ci-dessus. Une transaction qui comprend alors un script de déverrouillage P2SH peut être utilisée pour racheter cet UTXO et sera valide tant qu&#8217;elle ne contient pas plus de 15 clés publiques. </p>
</div>
<div class="admonitionblock tip data-line-182">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-183">
<p>N&#8217;oubliez pas qu&#8217;en raison de la politique définie par la fonction <code>IsStandard()</code> au moment de la rédaction de cet article, les scripts multisignatures standard sont limités à 3 clés publiques répertoriées au maximum, tandis que les scripts P2SH sont limités à 15 clés publiques répertoriées au maximum. Les scripts multisignatures standard peuvent invalider les transactions au moyen de leur script de verrouillage <em>ou</em> de déverrouillage, tandis que les scripts P2SH peuvent invalider les transactions au moyen de leur script de déverrouillage <em>uniquement</em>. En effet, <code>IsStandard()</code> n&#8217;a aucun moyen de savoir si un hachage d&#8217;un script de rachat dans un script de verrouillage inclut plus de signatures que la limite de taille actuellement imposée, il ne peut donc observer que les scripts de déverrouillage dans les entrées de transaction.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-186">
<h4 id="_adresses_p2sh">Adresses P2SH</h4>
<div class="paragraph data-line-188">
<p>Une autre partie importante de la fonctionnalité P2SH est la possibilité d&#8217;encoder un hachage de script en tant qu&#8217;adresse, comme défini dans BIP-13. Les adresses P2SH sont des encodages Base58Check du hachage de 20 octets d&#8217;un script, tout comme les adresses Bitcoin sont des encodages Base58Check du hachage de 20 octets d&#8217;une clé publique. Les adresses P2SH utilisent le préfixe de version "5", ce qui donne des adresses encodées en Base58Check qui commencent par un "3".</p>
</div>
<div class="paragraph data-line-190">
<p>Par exemple, le script complexe de Mohammed, haché et encodé en Base58Check comme une adresse P2SH, devient 39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw. Nous pouvons le confirmer avec la commande bx :</p>
</div>
<div class="listingblock data-line-192">
<div class="content">
<pre>echo \
'54c557e07dde5bb6cb791c7a540e0a4796f5e97e'\
 | bx address-encode -v 5
39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw</pre>
</div>
</div>
<div class="paragraph data-line-200">
<p>Maintenant, Mohammed peut donner cette "adresse" à ses clients et ils peuvent utiliser presque n&#8217;importe quel portefeuille bitcoin pour effectuer un paiement simple, comme s&#8217;il s&#8217;agissait d&#8217;une adresse Bitcoin. Le préfixe 3 leur donne un indice qu&#8217;il s&#8217;agit d&#8217;un type d&#8217;adresse spécial, celui correspondant à un script au lieu d&#8217;une clé publique, mais sinon cela fonctionne exactement de la même manière qu&#8217;un paiement à une adresse Bitcoin.</p>
</div>
<div class="paragraph data-line-202">
<p>Les adresses P2SH cachent toute la complexité, de sorte que la personne effectuant un paiement ne voit pas le script.</p>
</div>
</div>
<div class="sect3 data-line-204">
<h4 id="_avantages_du_p2sh">Avantages du P2SH</h4>
<div class="paragraph data-line-206">
<p>La fonction P2SH offre les avantages suivants par rapport à l&#8217;utilisation directe de scripts complexes dans le verrouillage des sorties :</p>
</div>
<div class="ulist data-line-208">
<ul>
<li class="data-line-208">
<p>Les scripts complexes sont remplacés par des empreintes digitales plus courtes dans la sortie de la transaction, ce qui réduit la taille de la transaction.</p>
</li>
<li class="data-line-209">
<p>Les scripts peuvent être codés comme une adresse, de sorte que l&#8217;expéditeur et le portefeuille de l&#8217;expéditeur n&#8217;ont pas besoin d&#8217;ingénierie complexe pour implémenter P2SH.</p>
</li>
<li class="data-line-210">
<p>P2SH transfère le fardeau de la construction du script au destinataire, pas à l&#8217;expéditeur.</p>
</li>
<li class="data-line-211">
<p>P2SH déplace la charge de stockage des données pour le script long de la sortie (qui en plus d&#8217;être stockée sur la chaîne de blocs est dans l&#8217;ensemble UTXO) vers l&#8217;entrée (uniquement stockée sur la chaîne de blocs).</p>
</li>
<li class="data-line-212">
<p>P2SH déplace la charge de stockage des données pour le script long du moment présent (paiement) à un moment futur (lorsqu&#8217;il est dépensé).</p>
</li>
<li class="data-line-213">
<p>P2SH transfère les frais de transaction plus élevés d&#8217;un long script de l&#8217;expéditeur au destinataire, qui doit inclure le long script d&#8217;échange pour le dépenser.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-215">
<h4 id="_utiliser_le_script_et_la_validation">Utiliser le script et la validation</h4>
<div class="paragraph data-line-217">
<p>Avant la version 0.9.2 du client Bitcoin Core, Pay-to-Script-Hash était limité aux types standard de scripts de transaction bitcoin, par la fonction IsStandard(). Cela signifie que le script d&#8217;échange présenté dans la transaction de dépenses ne peut être que l&#8217;un des types standard : P2PK, P2PKH ou multisig.</p>
</div>
<div class="paragraph data-line-219">
<p>Depuis la version 0.9.2 du client Bitcoin Core, les transactions P2SH peuvent contenir n&#8217;importe quel script valide, ce qui rend la norme P2SH beaucoup plus flexible et permet d&#8217;expérimenter de nombreux types de transactions nouveaux et complexes.</p>
</div>
<div class="paragraph data-line-221">
<p>Vous ne pouvez pas mettre un P2SH dans un script de rachat P2SH, car la spécification P2SH n&#8217;est pas récursive. Aussi, bien qu&#8217;il soit techniquement possible d&#8217;inclure <code>RETURN</code> (voir <a href="#op_return">Sortie d&#8217;enregistrement de données (RETURN)</a>) dans un script de rachat, comme rien dans les règles ne vous empêche de le faire, cela n&#8217;a aucune utilité pratique car l&#8217;exécution de <code>RETURN</code> lors de la validation entraînera le marquage de la transaction comme invalide.</p>
</div>
<div class="paragraph data-line-223">
<p>Notez que, comme le script de rachat n&#8217;est pas présenté au réseau tant que vous n&#8217;essayez pas de dépenser une sortie P2SH, si vous verrouillez une sortie avec le hachage d&#8217;un script de rachat invalide, elle sera traitée malgré tout. L&#8217;UTXO sera verrouillé avec succès. Cependant, vous ne pourrez pas le dépenser car la transaction de dépense, qui inclut le script d&#8217;échange, ne sera pas acceptée car il s&#8217;agit d&#8217;un script invalide. Cela crée un risque, car vous pouvez verrouiller des bitcoins dans un P2SH qui ne pourra pas être dépensé plus tard. Le réseau acceptera le script de verrouillage P2SH même s&#8217;il correspond à un script de rachat invalide, car le hachage du script ne donne aucune indication sur le script qu&#8217;il représente.</p>
</div>
<div class="admonitionblock warning data-line-226">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-227">
<p>Les scripts de verrouillage P2SH contiennent le hachage d&#8217;un script de rachat, qui ne donne aucun indice quant au contenu du script de rachat lui-même. La transaction P2SH sera considérée comme valide et acceptée même si le script de rachat est invalide. Vous pourriez accidentellement verrouiller le bitcoin de telle sorte qu&#8217;il ne puisse plus être dépensé.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-233">
<h3 id="op_return">Sortie d&#8217;enregistrement de données (RETURN)</h3>
<div class="paragraph data-line-235">
<p>Les bitcoins sont distribués et Le grand livre horodaté, la chaîne de blocs, a des utilisations potentielles bien au-delà des paiements. De nombreux développeurs ont essayé d&#8217;utiliser le langage de script de transaction pour tirer parti de la sécurité et de la résilience du système pour des applications telles que les services de notaire numérique, les certificats d&#8217;actions et les contrats intelligents. Les premières tentatives d&#8217;utilisation du langage de script de bitcoin à ces fins impliquaient la création de sorties de transaction qui enregistraient des données sur la chaîne de blocs; par exemple, pour enregistrer une empreinte digitale d&#8217;un fichier de manière à ce que n&#8217;importe qui puisse établir la preuve de l&#8217;existence de ce fichier à une date précise par référence à cette transaction.</p>
</div>
<div class="paragraph data-line-237">
<p>L&#8217;utilisation de la chaîne de blocs de Bitcoin pour stocker les données non liées aux paiements en bitcoins sont un sujet controversé. De nombreux développeurs considèrent cette utilisation abusive et veulent la décourager. D&#8217;autres y voient une démonstration des puissantes capacités de la technologie chaîne de blocs et souhaitent encourager une telle expérimentation. Ceux qui s&#8217;opposent à l&#8217;inclusion de données de non-paiement soutiennent que cela provoque un "gonflement de la chaîne de blocs", ce qui impose à ceux qui exécutent des nœuds Bitcoin complets de supporter le coût du stockage sur disque pour les données que la chaîne de blocs n&#8217;était pas destinée à transporter. De plus, de telles transactions créent des UTXO qui ne peuvent pas être dépensés, en utilisant l&#8217;adresse Bitcoin de destination comme un champ libre de 20 octets. Parce que l&#8217;adresse est utilisée pour les données, elle ne correspond pas à une clé privée et l&#8217;UTXO résultant ne peut <em>jamais</em> être dépensé ; c&#8217;est un faux paiement. Ces transactions qui ne peuvent jamais être dépensées ne sont donc jamais supprimées de l&#8217;ensemble UTXO et entraînent une augmentation permanente de la taille de la base de données UTXO, ou un "gonflement".</p>
</div>
<div class="paragraph data-line-239">
<p>Dans la version 0.9 du client Bitcoin Core, un compromis a été trouvé avec l&#8217;introduction de l&#8217;opérateur RETURN. <code>RETURN</code> permet aux développeurs d&#8217;ajouter 80 octets de données de non-paiement à une sortie de transaction. Cependant, contrairement à l&#8217;utilisation de "faux" UTXO, l&#8217;opérateur <code>RETURN</code> crée une sortie explicitement et <em>manifestement indépensable</em>, qui n&#8217;a pas besoin d&#8217;être stockée dans l&#8217;ensemble UTXO. Les sorties <code>RETURN</code> sont enregistrées sur la chaîne de blocs, elles consomment donc de l&#8217;espace disque et contribuent à l&#8217;augmentation de la taille de la chaîne de blocs, mais elles ne sont pas stockées dans l&#8217;ensemble UTXO et ne gonflent donc pas le bassin de mémoire UTXO et ne surchargent pas les nœuds complets avec plus de dépenses en RAM.</p>
</div>
<div class="paragraph data-line-241">
<p>Les scripts <code>RETURN</code> ressemblent à ceci :</p>
</div>
<div class="listingblock data-line-243">
<div class="content">
<pre>RETURN &lt;data&gt;</pre>
</div>
</div>
<div class="paragraph data-line-247">
<p>La portion de données est limitée à 80 octets et représente le plus souvent un hachage, comme la sortie de l&#8217;algorithme SHA256 (32 octets). De nombreuses applications mettent un préfixe devant les données pour aider à identifier l&#8217;application. Par exemple, le service de notarisation numérique <a href="https://proofofexistence.com" data-href="https://proofofexistence.com">Preuve d&#8217;existence</a> utilise le préfixe de 8 octets DOCPROOF, qui est encodé en ASCII sous la forme <code>44 4f 43 50 52 4f 4f 46</code> en hexadécimal.</p>
</div>
<div class="paragraph data-line-249">
<p>Gardez à l&#8217;esprit qu&#8217;il n&#8217;y a pas de "script de déverrouillage" correspondant à <code>RETURN</code> qui pourrait éventuellement être utilisé pour "passer" une sortie RETURN. L&#8217;intérêt de <code>RETURN</code> est que vous ne pouvez pas dépenser l&#8217;argent bloqué dans cette sortie, et donc il n&#8217;a pas besoin d&#8217;être conservé dans l&#8217;ensemble UTXO comme potentiellement dépensable - <code>RETURN</code> est <em>manifestement indépensable</em>. <code>RETURN</code> est généralement une sortie avec un montant de zéro bitcoin, car tout bitcoin attribué à une telle sortie est effectivement perdu à jamais. Si un <code>RETURN</code> est référencé comme entrée dans une transaction, le moteur de validation de script arrêtera l&#8217;exécution du script de validation et marquera la transaction comme invalide. L&#8217;exécution de <code>RETURN</code> provoque essentiellement le script "RETURN" avec un <code>FALSE</code> et s&#8217;arrête. Ainsi, si vous référencez accidentellement une sortie <code>RETURN</code> comme entrée dans une transaction, cette transaction n&#8217;est pas valide.</p>
</div>
<div class="paragraph data-line-251">
<p>Une transaction standard (c&#8217;est-à-dire conforme aux vérifications IsStandard()) ne peut avoir qu&#8217;une seule sortie RETURN. Cependant, une seule sortie <code>RETURN</code> peut être combinée dans une transaction avec des sorties de tout autre type.</p>
</div>
<div class="paragraph data-line-253">
<p>Deux nouvelles options de ligne de commande ont été ajoutées dans Bitcoin Core à partir de la version 0.10. L&#8217;option <code>datacarrier</code> contrôle le relais et l&#8217;exploration des transactions RETURN, avec la valeur par défaut définie à "1" pour les autoriser. L&#8217;option <code>datacarriersize</code> prend un argument numérique spécifiant la taille maximale en octets du script RETURN, 83 octets par défaut, ce qui permet un maximum de 80 octets de données <code>RETURN</code> plus un octet d&#8217;opcode <code>RETURN</code> et deux octets de Opcode PUSHDATA.</p>
</div>
<div class="admonitionblock note data-line-256">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-257">
<p>RETURN a été initialement proposé avec une limite de 80 octets, mais la limite a été réduite à 40 octets lorsque la fonctionnalité a été publiée. En février 2015, dans la version 0.10 de Bitcoin Core, la limite a été relevée à 80 octets. Les nœuds peuvent choisir de ne pas relayer ou exploiter RETURN, ou uniquement de relayer et d&#8217;exploiter <code>RETURN</code> contenant moins de 80 octets de données.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-260">
<h3 id="_verrous_temporels">Verrous temporels</h3>
<div class="paragraph data-line-262">
<p>Les verrous temporels (ou timelocks) sont des restrictions sur les transactions ou les sorties qui ne permettent de dépenser qu&#8217;après un certain temps. Bitcoin a eu une fonction de verrouillage du temps au niveau de la transaction depuis le début. Il est implémenté par le champ <code>nLocktime</code> dans une transaction. Deux nouvelles fonctionnalités de verrou temporel ont été introduites fin 2015 et mi-2016 qui offrent des verrous temporels de niveau UTXO. Ce sont <code>CHECKLOCKTIMEVERIFY</code> et CHECKSEQUENCEVERIFY.</p>
</div>
<div class="paragraph data-line-264">
<p>Les verrous temporels sont utiles pour postdater les transactions et verrouiller les fonds à une date future. Plus important encore, les verrous temporels étendent les scripts bitcoin dans la dimension du temps, ouvrant la porte à des contrats intelligents complexes en plusieurs étapes.</p>
</div>
<div class="sect3 data-line-267">
<h4 id="transaction_locktime_nlocktime">Temps de verrouillage des transactions (nLocktime)</h4>
<div class="paragraph data-line-269">
<p>Depuis le début, Bitcoin a eu une fonction de timelock au niveau de la transaction. L&#8217;heure de verrouillage de la transaction est un paramètre au niveau de la transaction (un champ dans la structure des données de la transaction) qui définit la première heure à laquelle une transaction est valide et peut être relayée sur le réseau ou ajoutée à la chaîne de blocs. Le verrou temporel est également connu sous le nom de <code>nLocktime</code> à partir du nom de variable utilisé dans la base de code Bitcoin Core. Il est défini sur zéro dans la plupart des transactions pour indiquer une propagation et une exécution immédiates. Si <code>nLocktime</code> est différent de zéro et inférieur à 500 millions, il est interprété comme une hauteur de bloc, ce qui signifie que la transaction n&#8217;est pas valide et n&#8217;est pas relayée ou incluse dans la chaîne de blocs avant la hauteur de bloc spécifiée. S&#8217;il est supérieur ou égal à 500 millions, il est interprété comme un horodatage Unix Epoch (secondes depuis le 1er janvier 1970) et la transaction n&#8217;est pas valide avant l&#8217;heure spécifiée. Les transactions avec <code>nLocktime</code> spécifiant un bloc ou une heure future doivent être conservées par le système d&#8217;origine et transmises au réseau Bitcoin uniquement après leur validité. Si une transaction est transmise au réseau avant le <code>nLocktime</code> spécifié, la transaction sera rejetée par le premier nœud comme invalide et ne sera pas relayée vers les autres nœuds. L&#8217;utilisation de <code>nLocktime</code> équivaut à postdater un chèque papier.</p>
</div>
<div class="sect4 data-line-272">
<h5 id="locktime_limitations">Limitations du temps de verrouillage des transactions</h5>
<div class="paragraph data-line-274">
<p>nLocktime a la limitation que s&#8217;il permet de dépenser certaines sorties dans le futur, il ne rend pas impossible de les dépenser jusqu&#8217;à ce moment-là. Expliquons cela avec l&#8217;exemple suivant.</p>
</div>
<div class="paragraph data-line-276">
<p>Alice signe une transaction en dépensant l&#8217;une de ses sorties à l&#8217;adresse de Bob, et fixe la transaction <code>nLocktime</code> à 3 mois dans le futur. Alice envoie cette transaction à Bob pour la conserver. Avec cette transaction, Alice et Bob savent que :</p>
</div>
<div class="ulist data-line-278">
<ul>
<li class="data-line-278">
<p>Bob ne peut pas transmettre la transaction pour racheter les fonds avant que 3 mois ne se soient écoulés.</p>
</li>
<li class="data-line-279">
<p>Bob peut transmettre la transaction après 3 mois.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-281">
<p>Toutefois:</p>
</div>
<div class="ulist data-line-283">
<ul>
<li class="data-line-283">
<p>Alice peut créer une autre transaction, en dépensant deux fois les mêmes entrées sans temps de verrouillage. Ainsi, Alice peut passer le même UTXO avant que les 3 mois ne se soient écoulés.</p>
</li>
<li class="data-line-284">
<p>Bob n&#8217;a aucune garantie qu&#8217;Alice ne le fera pas.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-286">
<p>Il est important de comprendre les limites de la transaction nLocktime. La seule garantie est que Bob ne pourra pas l&#8217;échanger avant que 3 mois ne se soient écoulés. Il n&#8217;y a aucune garantie que Bob obtiendra les fonds. Pour obtenir une telle garantie, la restriction de verrouillage temporel doit être placée sur l&#8217;UTXO lui-même et faire partie du script de verrouillage, plutôt que sur la transaction. Ceci est réalisé par la forme suivante de timelock, appelée Check Lock Time Verify.</p>
</div>
</div>
</div>
<div class="sect3 data-line-288">
<h4 id="_vérifier_lheure_de_verrouillage_cltv">Vérifier l&#8217;heure de verrouillage (CLTV)</h4>
<div class="paragraph data-line-290">
<p>En décembre 2015, une nouvelle forme de verrou temporel a été introduite dans le bitcoin en tant qu&#8217;embranchement convergent (soft fork) amélioré. Basé sur une spécification dans BIP-65, le nouvel opérateur de script appelé <em>CHECKLOCKTIMEVERIFY</em> (<em>CLTV</em>) a été ajouté au langage de script. <code>CLTV</code> et est un verrou temporel par sortie, plutôt qu&#8217;un verrou temporel par transaction comme c&#8217;est le cas avec nLocktime. Cela permet une plus grande flexibilité dans la manière dont les verrous temporels sont appliqués.</p>
</div>
<div class="paragraph data-line-292">
<p>En termes simples, en ajoutant l&#8217;opcode <code>CLTV</code> dans le script de rachat d&#8217;une sortie, cela restreint la sortie, de sorte qu&#8217;elle ne peut être dépensée qu&#8217;une fois le temps spécifié écoulé.</p>
</div>
<div class="admonitionblock tip data-line-295">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-296">
<p>Alors que <code>nLocktime</code> est un timelock au niveau de la transaction, <code>CLTV</code> est un timelock basé sur la sortie.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-299">
<p>CLTV ne remplace pas nLocktime, mais restreint plutôt des UTXO spécifiques de sorte qu&#8217;ils ne peuvent être dépensés que dans une future transaction avec <code>nLocktime</code> défini sur une valeur supérieure ou égale.</p>
</div>
<div class="paragraph data-line-301">
<p>L&#8217;opcode <code>CLTV</code> prend un paramètre en entrée, exprimé sous la forme d&#8217;un nombre au même format que <code>nLocktime</code> (soit une hauteur de bloc, soit un temps d&#8217;époque Unix). Comme indiqué par le suffixe VERIFY, <code>CLTV</code> est le type d&#8217;opcode qui arrête l&#8217;exécution du script si le résultat est FALSE. Si le résultat est TRUE, l&#8217;exécution continue.</p>
</div>
<div class="paragraph data-line-303">
<p>Pour verrouiller une sortie avec CLTV, vous l&#8217;insérez dans le script de rachat de la sortie dans la transaction qui crée la sortie. Par exemple, si Alice paie l&#8217;adresse de Bob, la sortie contiendra normalement un script P2PKH comme celui-ci :</p>
</div>
<div class="listingblock data-line-305">
<div class="content">
<pre>DUP HASH160 &lt;Hachage clé publique de Bob&gt; EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-309">
<p>Pour le verrouiller à un moment, disons dans 3 mois, la transaction serait une transaction P2SH avec un script de rachat comme celui-ci :</p>
</div>
<div class="listingblock data-line-311">
<div class="content">
<pre>&lt;now + 3 months&gt; CHECKLOCKTIMEVERIFY DROP DUP HASH160&lt;Bob's Public Key Hash&gt; EQUALVERIFIER CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-315">
<p>où <code>&lt;now &#43; 3 months&gt;</code> est une hauteur de bloc ou une valeur temporelle estimée à 3 mois à partir du moment où la transaction est extraite : hauteur de bloc actuelle &#43; 12 960 (blocs) ou heure d&#8217;époque Unix actuelle &#43; 7 760 000 (secondes). Pour l&#8217;instant, ne vous inquiétez pas de l&#8217;opcode <code>DROP</code> qui suit CHECKLOCKTIMEVERIFY ; cela sera expliqué sous peu.</p>
</div>
<div class="paragraph data-line-317">
<p>Lorsque Bob essaie de dépenser cet UTXO, il construit une transaction qui fait référence à l&#8217;UTXO comme entrée. Il utilise sa signature et sa clé publique dans le script de déverrouillage de cette entrée et définit la transaction <code>nLocktime</code> pour qu&#8217;elle soit égale ou supérieure au verrouillage temporel dans l&#8217;ensemble <code>CHECKLOCKTIMEVERIFY</code> Alice. Bob diffuse ensuite la transaction sur le réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-319">
<p>La transaction de Bob est évaluée comme suit. Si le paramètre <code>CHECKLOCKTIMEVERIFY</code> défini par Alice est inférieur ou égal au <code>nLocktime</code> de la transaction dépensière, l&#8217;exécution du script continue (agit comme si un opcode "no operation" ou NOP était exécuté). Sinon, l&#8217;exécution du script s&#8217;arrête et la transaction est considérée comme invalide.</p>
</div>
<div class="paragraph data-line-321">
<p>Plus précisément, <code>CHECKLOCKTIMEVERIFY</code> échoue et arrête l&#8217;exécution, marquant la transaction invalide si (source : BIP-65) :</p>
</div>
<div class="olist arabic data-line-323">
<ol class="arabic">
<li class="data-line-323">
<p>la pile est vide ; ou</p>
</li>
<li class="data-line-324">
<p>l&#8217;élément du haut de la pile est inférieur à 0 ; ou</p>
</li>
<li class="data-line-325">
<p>le type de verrou temporel (hauteur versus horodatage) de l&#8217;élément de la pile supérieure et le champ <code>nLocktime</code> ne sont pas les mêmes ; ou</p>
</li>
<li class="data-line-326">
<p>l&#8217;élément supérieur de la pile est supérieur au champ <code>nLocktime</code> de la transaction ; ou</p>
</li>
<li class="data-line-327">
<p>le champ <code>nSequence</code> de l&#8217;entrée est 0xffffffff.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-330">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-331">
<p>CLTV et <code>nLocktime</code> utilisent le même format pour décrire les verrous temporels, soit une hauteur de bloc, soit le temps écoulé en secondes depuis l&#8217;époque Unix. De manière critique, lorsqu&#8217;ils sont utilisés ensemble, le format de <code>nLocktime</code> doit correspondre à celui de <code>CLTV</code> dans les sorties - ils doivent tous deux référencer soit la hauteur de bloc, soit le temps en secondes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-334">
<p>Après l&#8217;exécution, si <code>CLTV</code> est satisfait, le paramètre de temps qui l&#8217;a précédé reste l&#8217;élément supérieur de la pile et peut devoir être supprimé, avec DROP, pour une exécution correcte des opcodes de script suivants. Vous verrez souvent <code>CHECKLOCKTIMEVERIFY</code> suivi de <code>DROP</code> dans les scripts pour cette raison.</p>
</div>
<div class="paragraph data-line-336">
<p>En utilisant <code>nLocktime</code> conjointement avec CLTV, le scénario décrit dans <a href="#locktime_limitations">Limitations du temps de verrouillage des transactions</a> changements. Alice ne peut plus dépenser l&#8217;argent (car il est verrouillé avec la clé de Bob) et Bob ne peut pas le dépenser avant l&#8217;expiration du temps de verrouillage de 3 mois.</p>
</div>
<div class="paragraph data-line-338">
<p>En introduisant la fonctionnalité timelock directement dans le langage de script, <code>CLTV</code> nous permet de développer des scripts complexes très intéressants.</p>
</div>
<div class="paragraph data-line-340">
<p>La norme est définie dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65 (CHECKLOCKTIMEVERIFY)</a>.</p>
</div>
</div>
<div class="sect3 data-line-342">
<h4 id="_verrous_temporels_relatifs">Verrous temporels relatifs</h4>
<div class="paragraph data-line-344">
<p>nLocktime et <code>CLTV</code> sont les deux <em>verrous temporels absolus</em> en ce sens qu&#8217;ils spécifient un point absolu dans le temps. Les deux prochaines fonctionnalités de verrou temporel que nous examinerons sont des <em>verrous temporels relatifs</em> en ce sens qu&#8217;elles spécifient, comme condition de dépense d&#8217;une sortie, un temps écoulé depuis la confirmation de la sortie dans la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-346">
<p>Les verrous temporels relatifs sont utiles car ils permettent de bloquer une chaîne de deux transactions interdépendantes ou plus, tout en imposant une contrainte de temps sur une transaction qui dépend du temps écoulé depuis la confirmation d&#8217;une transaction précédente. En d&#8217;autres termes, l&#8217;horloge ne commence pas à compter tant que l&#8217;UTXO n&#8217;est pas enregistré sur la chaîne de blocs. Cette fonctionnalité est particulièrement utile dans les canaux d&#8217;état bidirectionnels et les réseaux Lightning, comme nous le verrons dans <a href="#state_channels">Canaux de paiement et canaux d&#8217;état</a>.</p>
</div>
<div class="paragraph data-line-348">
<p>Les verrous temporels relatifs, comme les verrous temporels absolus, sont implémentés à la fois avec une fonctionnalité au niveau de la transaction et un opcode au niveau du script. Le verrouillage temporel relatif au niveau de la transaction est implémenté comme une règle de consensus sur la valeur de nSequence, un champ de transaction qui est défini dans chaque entrée de transaction. Les verrous temporels relatifs au niveau du script sont implémentés avec l&#8217;opcode <code>CHECKSEQUENCEVERIFY</code> (CSV).</p>
</div>
<div class="paragraph data-line-350">
<p>Les verrous temporels relatifs sont implémentés conformément aux spécifications de <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Relative lock-time using consensus-enforced sequence numbers</a> et <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
<div class="paragraph data-line-352">
<p>BIP-68 et BIP-112 ont été activés en mai 2016 en tant que mise à niveau soft fork des règles de consensus.</p>
</div>
</div>
<div class="sect3 data-line-354">
<h4 id="_verrous_temporels_relatifs_avec_nsequence">Verrous temporels relatifs avec nSequence</h4>
<div class="paragraph data-line-356">
<p>Des verrous temporels relatifs peuvent être définis sur chaque entrée d&#8217;une transaction, en définissant le champ <code>nSequence</code> dans chaque contribution.</p>
</div>
<div class="sect4 data-line-358">
<h5 id="_signification_originale_de_nsequence">Signification originale de nSequence</h5>
<div class="paragraph data-line-360">
<p>Le champ <code>nSequence</code> était à l&#8217;origine destiné (mais jamais correctement implémenté) à permettre la modification des transactions dans le mempool. Dans cette utilisation, une transaction contenant des entrées avec une valeur <code>nSequence</code> inférieure à 2<sup>32</sup> - 1 (0xFFFFFFFF) indiquait une transaction qui n&#8217;était pas encore "finalisée". Une telle transaction serait conservée dans le mempool jusqu&#8217;à ce qu&#8217;elle soit remplacée par une autre transaction dépensant les mêmes entrées avec une valeur <code>nSequence</code> plus élevée. Une fois qu&#8217;une transaction a été reçue dont les entrées avaient une valeur <code>nSequence</code> de 0xFFFFFFFF, elle serait considérée comme "finalisée" et minée.</p>
</div>
<div class="paragraph data-line-362">
<p>La signification originale de <code>nSequence</code> n&#8217;a jamais été correctement implémentée et la valeur de <code>nSequence</code> est habituellement définie sur 0xFFFFFFFF dans les transactions qui n&#8217;utilisent pas de verrous temporels. Pour les transactions avec <code>nLocktime</code> ou CHECKLOCKTIMEVERIFY, la valeur <code>nSequence</code> doit être inférieure à 2<sup>31</sup> pour que les gardes de verrou temporel aient un effet, comme expliqué ci-dessous.</p>
</div>
</div>
<div class="sect4 data-line-364">
<h5 id="_nsequence_comme_un_verrou_temporel_relatif_imposé_par_consensus">nSequence comme un verrou temporel relatif imposé par consensus</h5>
<div class="paragraph data-line-366">
<p>Depuis l&#8217;activation de BIP-68, de nouvelles règles de consensus s&#8217;appliquent pour toute transaction contenant une entrée dont la valeur <code>nSequence</code> est inférieure à 2<sup>31</sup> (le bit 1&lt;&lt;31 n&#8217;est pas défini). Par programmation, cela signifie que si le bit le plus significatif (bit 1&lt;&lt;31) n&#8217;est pas défini, c&#8217;est un indicateur qui signifie "temps de verrouillage relatif". Sinon (bit 1&lt;&lt;31 défini), la valeur <code>nSequence</code> est réservée à d&#8217;autres utilisations telles que l&#8217;activation de CHECKLOCKTIMEVERIFY, nLocktime, Opt-In-Replace-By-Fee et d&#8217;autres développements futurs.</p>
</div>
<div class="paragraph data-line-368">
<p>Les entrées de transaction avec des valeurs <code>nSequence</code> inférieures à 2<sup>31</sup> sont interprétées comme ayant un verrou temporel relatif. Une telle transaction n&#8217;est valide qu&#8217;une fois que l&#8217;entrée a vieilli du montant relatif du verrou temporel. Par exemple, une transaction avec une entrée et un verrou temporel relatif <code>nSequence</code> de 30 blocs n&#8217;est valide que lorsqu&#8217;au moins 30 blocs se sont écoulés depuis le moment où l&#8217;UTXO référencé dans l&#8217;entrée a été extrait. Étant donné que <code>nSequence</code> est un champ par entrée, une transaction peut contenir n&#8217;importe quel nombre d&#8217;entrées verrouillées dans le temps, qui doivent toutes avoir suffisamment vieilli pour que la transaction soit valide. Une transaction peut inclure à la fois des entrées à verrouillage temporel (nSequence &lt; 2<sup>31</sup>) et des entrées sans verrouillage temporel relatif (nSequence &gt;= 2<sup>31</sup>).</p>
</div>
<div class="paragraph data-line-370">
<p>La valeur <code>nSequence</code> est spécifiée en blocs ou en secondes, mais dans un format légèrement différent de celui que nous avons vu utilisé dans nLocktime. Un indicateur de type est utilisé pour différencier les valeurs comptant les blocs et les valeurs comptant le temps en secondes. Le drapeau de type est défini dans le 23e bit le moins significatif (c&#8217;est-à-dire la valeur 1&lt;&lt;22). Si le type-flag est défini, alors la valeur <code>nSequence</code> est interprétée comme un multiple de 512 secondes. Si le drapeau de type n&#8217;est pas défini, la valeur <code>nSequence</code> est interprétée comme un nombre de blocs.</p>
</div>
<div class="paragraph data-line-372">
<p>Lors de l&#8217;interprétation de <code>nSequence</code> comme un timelock relatif, seuls les 16 bits les moins significatifs sont pris en compte. Une fois que les drapeaux (bits 32 et 23) sont évalués, la valeur <code>nSequence</code> est généralement "masquée" avec un masque de 16 bits (par exemple, <code>nSequence</code> &amp; 0x0000FFFF).</p>
</div>
<div class="paragraph data-line-374">
<p><a href="#bip_68_def_of_nseq">Définition BIP-68 du codage nSequence (Source : BIP-68)</a> montre la disposition binaire de la valeur nSequence, telle que définie par BIP-68.</p>
</div>
<div id="bip_68_def_of_nseq" class="imageblock data-line-378">
<div class="content">
<img src="images/mbc2_0701.png" alt="Définition BIP-68 du codage nSequence">
</div>
<div class="title">Figure 45. Définition BIP-68 du codage nSequence (Source : BIP-68)</div>
</div>
<div class="paragraph data-line-381">
<p>Les verrous temporels relatifs basés sur l&#8217;application consensuelle de la valeur <code>nSequence</code> sont définis dans BIP-68.</p>
</div>
<div class="paragraph data-line-383">
<p>La norme est définie dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Relative lock-time using consensus-enforced sequence numbers</a>.</p>
</div>
</div>
</div>
<div class="sect3 data-line-385">
<h4 id="_verrous_temporels_relatifs_avec_csv">Verrous temporels relatifs avec CSV</h4>
<div class="paragraph data-line-387">
<p>Tout comme CLTV et nLocktime, il existe un opcode de script pour les verrous temporels relatifs qui exploite le Valeur <code>nSequence</code> dans les scripts. Cet opcode est CHECKSEQUENCEVERIFY, communément appelé <code>CSV</code> en abrégé.</p>
</div>
<div class="paragraph data-line-389">
<p>L&#8217;opcode CSV, lorsqu&#8217;il est évalué dans le script de remboursement d&#8217;un UTXO, permet de dépenser uniquement dans une transaction dont la valeur d&#8217;entrée <code>nSequence</code> est supérieure ou égale au paramètre CSV. Essentiellement, cela limite la dépense de l&#8217;UTXO jusqu&#8217;à ce qu&#8217;un certain nombre de blocs ou de secondes se soient écoulés par rapport au moment où l&#8217;UTXO a été miné.</p>
</div>
<div class="paragraph data-line-391">
<p>Comme pour CLTV, la valeur dans <code>CSV</code> doit correspondre au format de la valeur <code>nSequence</code> correspondante. Si <code>CSV</code> est spécifié en termes de blocs, il doit en être de même pour nSequence. Si <code>CSV</code> est spécifié en termes de secondes, alors <code>nSequence</code> doit également l&#8217;être.</p>
</div>
<div class="paragraph data-line-393">
<p>Les timelocks relatifs avec <code>CSV</code> sont particulièrement utiles lorsque plusieurs transactions (chaînées) sont créées et signées, mais non propagées, lorsqu&#8217;elles sont conservées "hors chaîne". Une transaction enfant ne peut pas être utilisée tant que la transaction parent n&#8217;a pas été propagée, extraite et vieillie au moment spécifié dans le timelock relatif. Une application de ce cas d&#8217;utilisation peut être vue dans <a href="#state_channels">Canaux de paiement et canaux d&#8217;état</a> et <a href="#lightning_network">Canaux de paiement routés (Lightning Network)</a>.</p>
</div>
<div class="paragraph data-line-395">
<p>CSV est défini en détail dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
</div>
<div class="sect3 data-line-398">
<h4 id="_temps_médian_passé">Temps médian passé</h4>
<div class="paragraph data-line-400">
<p>Dans le cadre de l&#8217;activation des verrous temporels relatifs, il y a également eu un changement dans la façon dont le "temps" est calculé pour les verrous temporels (à la fois absolus et relatifs). Dans le bitcoin, il existe une différence subtile, mais très significative, entre le temps du mur et le temps du consensus. Bitcoin est un réseau décentralisé, ce qui signifie que chaque participant a sa propre vision du temps. Les événements sur le réseau ne se produisent pas instantanément partout. La latence du réseau doit être prise en compte dans la perspective de chaque nœud. Finalement, tout est synchronisé pour créer un grand livre commun. Bitcoin atteint un consensus toutes les 10 minutes sur l&#8217;état du grand livre tel qu&#8217;il existait dans le passé.</p>
</div>
<div class="paragraph data-line-402">
<p>Les horodatages définis dans les en-têtes de bloc sont définis par les mineurs. Il existe un certain degré de latitude autorisé par les règles de consensus pour tenir compte des différences de précision d&#8217;horloge entre les nœuds décentralisés. Cependant, cela crée une incitation malheureuse pour les mineurs à mentir sur le temps passé dans un bloc afin de gagner des frais supplémentaires en incluant des transactions verrouillées dans le temps qui ne sont pas encore matures. Voir la section suivante pour plus d&#8217;informations.</p>
</div>
<div class="paragraph data-line-404">
<p>Pour supprimer l&#8217;incitation au mensonge et renforcer la sécurité des verrous temporels, un BIP a été proposé et activé en même temps que les BIP des verrous temporels relatifs. Il s&#8217;agit de BIP-113, qui définit une nouvelle mesure consensuelle du temps appelée <em>Median-Time-Past</em> (temps-médian-passé).</p>
</div>
<div class="paragraph data-line-406">
<p>Le Median-Time-Past est calculé en prenant les horodatages des 11 derniers blocs et en trouvant la médiane. Ce temps médian devient alors le temps de consensus et est utilisé pour tous les calculs de verrou temporel. En prenant le point médian d&#8217;environ deux heures dans le passé, l&#8217;influence de l&#8217;horodatage de n&#8217;importe quel bloc est réduite. En incorporant 11 blocs, aucun mineur ne peut influencer les horodatages afin de gagner des frais sur les transactions avec un verrou temporel qui n&#8217;est pas encore arrivé à échéance.</p>
</div>
<div class="paragraph data-line-408">
<p>Median-Time-Past modifie l&#8217;implémentation des calculs de temps pour nLocktime, CLTV, <code>nSequence</code> et CSV. L&#8217;heure de consensus calculée par Median-Time-Past est toujours d&#8217;environ une heure en retard sur l&#8217;heure de l&#8217;horloge murale. Si vous créez des transactions avec verrou temporel, vous devez en tenir compte lors de l&#8217;estimation de la valeur souhaitée à encoder dans nLocktime, nSequence, <code>CLTV</code> et CSV.</p>
</div>
<div class="paragraph data-line-410">
<p>Median-Time-Past est spécifié dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a>.</p>
</div>
</div>
<div class="sect3 data-line-413">
<h4 id="fee_sniping">Défense contre le "sniping" avec un verrou temporel</h4>
<div class="paragraph data-line-415">
<p>Le "sniping" ou le "ciblage" est un scénario d&#8217;attaque théorique, où les mineurs tentant de réécrire des blocs passés "snipe" ou "en ciblant" des frais plus élevés transactions des futurs blocs pour maximiser leur rentabilité.</p>
</div>
<div class="paragraph data-line-417">
<p>Par exemple, disons que le bloc le plus élevé existant est le bloc #100 000. Si au lieu d&#8217;essayer d&#8217;exploiter le bloc #100 001 pour étendre la chaîne, certains mineurs tentent de réexploiter #100 000. Ces mineurs peuvent choisir d&#8217;inclure toute transaction valide (qui n&#8217;a pas encore été exploitée) dans leur bloc candidat #100 000. Ils n&#8217;ont pas à reminer le bloc avec les mêmes transactions. En fait, ils sont incités à sélectionner les transactions les plus rentables (frais les plus élevés par Ko) à inclure dans leur bloc. Ils peuvent inclure toutes les transactions qui se trouvaient dans "l&#8217;ancien" bloc #100 000, ainsi que toutes les transactions du mempool actuel. Essentiellement, ils ont la possibilité d&#8217;extraire des transactions du "présent" vers le "passé" réécrit lorsqu&#8217;ils recréent le bloc #100 000.</p>
</div>
<div class="paragraph data-line-419">
<p>Aujourd&#8217;hui, cette attaque n&#8217;est pas très lucrative, car la récompense de bloc est bien supérieure au total des frais par bloc. Mais à un moment donné dans le futur, les frais de transaction représenteront la majorité de la récompense minière (ou même l&#8217;intégralité de la récompense minière). A ce moment-là, ce scénario devient inévitable.</p>
</div>
<div class="paragraph data-line-421">
<p>Pour éviter le "ciblage de frais", lorsque Bitcoin Core crée des transactions, il utilise <code>nLocktime</code> pour les limiter au "bloc suivant", par défaut. Dans notre scénario, Bitcoin Core définirait <code>nLocktime</code> sur 100 001 sur toute transaction créée. Dans des circonstances normales, ce <code>nLocktime</code> n&#8217;a aucun effet - les transactions ne peuvent être incluses que dans le bloc #100 001 de toute façon ; c&#8217;est le bloc suivant.</p>
</div>
<div class="paragraph data-line-423">
<p>Mais dans le cadre d&#8217;une attaque enfourchement de la chaîne de blocs/double dépense, les mineurs ne seraient pas en mesure d&#8217;extraire des transactions à frais élevés du mempool, car toutes ces transactions seraient bloquées dans le temps pour bloquer #100 001. Ils ne peuvent reminer que #100 000 avec les transactions valides à ce moment-là, ne gagnant essentiellement aucun nouveau frais.</p>
</div>
<div class="paragraph data-line-425">
<p>Pour ce faire, Bitcoin Core définit le <code>nLocktime</code> sur toutes les nouvelles transactions à &lt;current block # + 1&gt; et définit la <code>nSequence</code> sur toutes les entrées à 0xFFFFFFFE pour activer nLocktime.</p>
</div>
</div>
</div>
<div class="sect2 data-line-427">
<h3 id="_scripts_avec_contrôle_de_flux_clauses_conditionnelles">Scripts avec contrôle de flux (clauses conditionnelles)</h3>
<div class="paragraph data-line-429">
<p>L&#8217;une des fonctionnalités les plus puissantes de Bitcoin Script est le contrôle de flux, également connu sous le nom de clauses conditionnelles. Vous êtes probablement familiarisé avec le contrôle de flux dans divers langages de programmation qui utilisent la construction IF...THEN...ELSE. Les clauses conditionnelles Bitcoin semblent un peu différentes, mais sont essentiellement la même construction.</p>
</div>
<div class="paragraph data-line-431">
<p>À un niveau de base, les opcodes conditionnels bitcoin nous permettent de construire un script de rachat qui a deux façons d&#8217;être déverrouillé, en fonction d&#8217;un résultat TRUE/FALSE d&#8217;évaluation d&#8217;une condition logique. Par exemple, si x est TRUE, le script de rachat est A et le script de rachat ELSE est B.</p>
</div>
<div class="paragraph data-line-433">
<p>De plus, les expressions conditionnelles Bitcoin peuvent être "imbriquées" indéfiniment, ce qui signifie qu&#8217;une clause conditionnelle peut en contenir une autre, qui en contient une autre, etc. Le contrôle de flux Bitcoin Script peut être utilisé pour construire des scripts très complexes avec des centaines voire des milliers de chemins d&#8217;exécution possibles. Il n&#8217;y a pas de limite à l&#8217;imbrication, mais les règles de consensus imposent une limite à la taille maximale, en octets, d&#8217;un script.</p>
</div>
<div class="paragraph data-line-435">
<p>Bitcoin implémente le contrôle de flux à l&#8217;aide des opcodes IF, ELSE, <code>ENDIF</code> et NOTIF. De plus, les expressions conditionnelles peuvent contenir des opérateurs booléens tels que BOOLAND, <code>BOOLOR</code> et NOT.</p>
</div>
<div class="paragraph data-line-437">
<p>À première vue, vous pouvez trouver les scripts de contrôle de flux du bitcoin déroutants. En effet, Bitcoin Script est un langage de pile. De la même manière que <code>1 &#43; 1</code> semble "renversé" lorsqu&#8217;il est exprimé comme 1 1 ADD, les clauses de contrôle de flux dans bitcoin semblent également "renversés".</p>
</div>
<div class="paragraph data-line-439">
<p>Dans la plupart des langages de programmation traditionnels (procéduraux), le contrôle de flux ressemble à ceci :</p>
</div>
<div class="listingblock data-line-442">
<div class="title">Pseudocode de contrôle de flux dans la plupart des langages de programmation</div>
<div class="content">
<pre>si (condition):
  code à exécuter lorsque la condition est vraie
autre:
  code à exécuter lorsque la condition est fausse
code à exécuter dans les deux cas</pre>
</div>
</div>
<div class="paragraph data-line-450">
<p>Dans un langage basé sur la pile comme Bitcoin Script, la condition logique vient avant le IF, ce qui le fait apparaître "en arrière", comme ceci :</p>
</div>
<div class="listingblock data-line-453">
<div class="title">Contrôle de flux Bitcoin Script</div>
<div class="content">
<pre>condition
IF
  code à exécuter lorsque la condition est vraie
ELSE
  code à exécuter lorsque la condition est fausse
ENDIF
code à exécuter dans les deux cas</pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>Lors de la lecture du script Bitcoin, rappelez-vous que la condition évaluée vient <em>avant</em> l&#8217;opcode IF.</p>
</div>
<div class="sect3 data-line-465">
<h4 id="_clauses_conditionnelles_avec_les_opcodes_verify">Clauses conditionnelles avec les opcodes VERIFY</h4>
<div class="paragraph data-line-467">
<p>Une autre forme de conditionnel dans Bitcoin Script est tout opcode qui se termine par VERIFY. Le suffixe <code>VERIFY</code> signifie que si la condition évaluée n&#8217;est pas TRUE, l&#8217;exécution du script se termine immédiatement et la transaction est considérée comme invalide.</p>
</div>
<div class="paragraph data-line-469">
<p>Contrairement à une clause IF, qui offre des chemins d&#8217;exécution alternatifs, le suffixe <code>VERIFY</code> agit comme une <em>clause de garde</em>, ne continuant que si une condition préalable est remplie.</p>
</div>
<div class="paragraph data-line-471">
<p>Par exemple, le script suivant nécessite la signature de Bob et une pré-image (secret) qui produit un hachage spécifique. Les deux conditions doivent être remplies pour le déverrouiller :</p>
</div>
<div class="listingblock data-line-474">
<div class="title">Un script de rachat avec une clause de garde EQUALVERIFY.</div>
<div class="content">
<pre>HASH160 &lt;expected hash&gt; EQUALVERIFY &lt;Bob's Pubkey&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-478">
<p>Pour racheter cela, Bob doit construire un script de déverrouillage qui présente une pré-image valide et une signature :</p>
</div>
<div class="listingblock data-line-481">
<div class="title">Un script de déverrouillage pour satisfaire le script de rachat ci-dessus</div>
<div class="content">
<pre>&lt;Bob's Sig&gt; &lt;hash pre-image&gt;</pre>
</div>
</div>
<div class="paragraph data-line-485">
<p>Sans présenter la pré-image, Bob ne peut pas accéder à la partie du script qui vérifie sa signature.</p>
</div>
<div class="paragraph pagebreak-after data-line-488">
<p>Ce script peut être écrit avec un <code>IF</code> à la place :</p>
</div>
<div class="listingblock data-line-491">
<div class="title">Un script de rachat avec une clause de garde IF</div>
<div class="content">
<pre>HASH160 &lt;expected hash&gt; EQUAL
IF
   &lt;Bob's Pubkey&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-498">
<p>Le script de déverrouillage de Bob est identique :</p>
</div>
<div class="listingblock data-line-501">
<div class="title">Un script de déverrouillage pour satisfaire le script de rachat ci-dessus</div>
<div class="content">
<pre>&lt;Bob's Sig&gt; &lt;hash pre-image&gt;</pre>
</div>
</div>
<div class="paragraph data-line-505">
<p>Le script avec <code>IF</code> fait la même chose que d&#8217;utiliser un opcode avec un suffixe <code>VERIFY</code> ; elles fonctionnent toutes deux comme des clauses de garde. Cependant, la construction <code>VERIFY</code> est plus efficace, utilisant deux opcodes de moins.</p>
</div>
<div class="paragraph data-line-507">
<p>Alors, quand utilisons-nous <code>VERIFY</code> et quand utilisons-nous IF ? Si tout ce que nous essayons de faire est d&#8217;attacher une condition préalable (clause de garde), alors <code>VERIFY</code> est préférable. Si, toutefois, nous voulons avoir plus d&#8217;un chemin d&#8217;exécution (contrôle de flux), nous avons besoin d&#8217;une clause de contrôle de flux IF...ELSE.</p>
</div>
<div class="admonitionblock tip data-line-510">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-511">
<p>Un opcode tel que <code>EQUAL</code> poussera le résultat (TRUE/FALSE) sur la pile, le laissant là pour évaluation par les opcodes suivants. En revanche, le suffixe de l&#8217;opcode <code>EQUALVERIFY</code> ne laisse rien sur la pile. Les opcodes qui se terminent par <code>VERIFY</code> ne laissent pas le résultat sur la pile.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-514">
<h4 id="_utilisation_du_contrôle_de_flux_dans_les_scripts">Utilisation du contrôle de flux dans les scripts</h4>
<div class="paragraph data-line-516">
<p>Une utilisation très courante du contrôle de flux dans Bitcoin Script consiste à construire un script de rachat qui offre plusieurs chemins d&#8217;exécution, chacun une manière différente de racheter l&#8217;UTXO.</p>
</div>
<div class="paragraph data-line-518">
<p>Regardons un exemple simple, où nous avons deux signataires, Alice et Bob, et l&#8217;un ou l&#8217;autre est en mesure de racheter. Avec multisig, cela serait exprimé sous la forme d&#8217;un script multisig 1 sur 2. Pour des raisons de démonstration, nous ferons la même chose avec une clause IF :</p>
</div>
<div class="listingblock data-line-520">
<div class="content">
<pre>IF
 &lt;Alice's Pubkey&gt; CHECKSIG
ELSE
 &lt;Bob's Pubkey&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-528">
<p>En regardant ce script de rachat, vous vous demandez peut-être : "Où est la condition ? Il n&#8217;y a rien qui précède la clause <code>IF</code> !"</p>
</div>
<div class="paragraph data-line-530">
<p>La condition ne fait pas partie du script de rachat. Au lieu de cela, la condition sera proposée dans le script de déverrouillage, permettant à Alice et Bob de "choisir" le chemin d&#8217;exécution qu&#8217;ils souhaitent.</p>
</div>
<div class="paragraph data-line-532">
<p>Alice rachète cela avec le script de déverrouillage :</p>
</div>
<div class="listingblock data-line-533">
<div class="content">
<pre>&lt;Alice's Sig&gt; 1</pre>
</div>
</div>
<div class="paragraph data-line-537">
<p>Le <code>1</code> à la fin sert de condition (TRUE) qui fera que la clause <code>IF</code> exécutera le premier chemin de rachat pour lequel Alice a une signature.</p>
</div>
<div class="paragraph data-line-539">
<p>Pour que Bob puisse racheter cela, il devrait choisir le deuxième chemin d&#8217;exécution en donnant une valeur <code>FALSE</code> à la clause IF :</p>
</div>
<div class="listingblock data-line-541">
<div class="content">
<pre>&lt;Bob's Sig&gt; 0</pre>
</div>
</div>
<div class="paragraph data-line-545">
<p>Le script de déverrouillage de Bob place un <code>0</code> sur la pile, ce qui oblige la clause <code>IF</code> à exécuter le deuxième script (ELSE), qui nécessite la signature de Bob.</p>
</div>
<div class="paragraph data-line-547">
<p>Puisque les clauses <code>IF</code> peuvent être imbriquées, nous pouvons créer un "labyrinthe" de chemins d&#8217;exécution. Le script de déverrouillage peut fournir une "carte" sélectionnant le chemin d&#8217;exécution réellement exécuté :</p>
</div>
<div class="listingblock data-line-549">
<div class="content">
<pre>IF
  script A
ELSE
  IF
    script B
  ELSE
    script C
  ENDIF
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-561">
<p>Dans ce scénario, il existe trois chemins d&#8217;exécution (script A, <code>script B</code> et script C). Le script de déverrouillage fournit un chemin sous la forme d&#8217;une séquence de valeurs <code>TRUE</code> ou FALSE. Pour sélectionner le chemin script B, par exemple, le script de déverrouillage doit se terminer par <code>1 0</code> (TRUE, FALSE). Ces valeurs seront poussées sur la pile, de sorte que la deuxième valeur (FALSE) se retrouve en haut de la pile. La clause <code>IF</code> externe extrait la valeur <code>FALSE</code> et exécute la première clause ELSE. Ensuite, la valeur <code>TRUE</code> se déplace vers le haut de la pile et est évaluée par le <code>IF</code> interne (imbriqué), en sélectionnant le chemin d&#8217;exécution B.</p>
</div>
<div class="paragraph data-line-563">
<p>En utilisant cette construction, nous pouvons créer des scripts de rachat avec des dizaines ou des centaines de chemins d&#8217;exécution, chacun offrant une manière différente de racheter l&#8217;UTXO. Pour dépenser, nous construisons un script de déverrouillage qui navigue dans le chemin d&#8217;exécution en plaçant les valeurs <code>TRUE</code> et <code>FALSE</code> appropriées sur la pile à chaque point de contrôle de flux.</p>
</div>
</div>
</div>
<div class="sect2 data-line-565">
<h3 id="_exemple_de_script_complexe">Exemple de script complexe</h3>
<div class="paragraph data-line-567">
<p>Dans cette section, nous combinons de nombreux concepts de ce chapitre en un seul exemple.</p>
</div>
<div class="paragraph data-line-569">
<p>Notre exemple utilise l&#8217;histoire de Mohammed, le propriétaire d&#8217;une entreprise à Dubaï qui exploite une entreprise d&#8217;import/export.</p>
</div>
<div class="paragraph data-line-571">
<p>Dans cet exemple, Mohammed souhaite construire un compte de capital d&#8217;entreprise avec des règles flexibles. Le schéma qu&#8217;il crée nécessite différents niveaux d&#8217;autorisation en fonction des verrous temporels. Les participants au programme multisig sont Mohammed, ses deux partenaires Saeed et Zaira, et leur avocat Abdul. Les trois partenaires prennent des décisions basées sur une règle de majorité, donc deux des trois doivent être d&#8217;accord. Cependant, en cas de problème avec leurs clés, ils souhaitent que leur avocat puisse récupérer les fonds avec l&#8217;une des trois signatures d&#8217;associés. Enfin, si tous les associés sont indisponibles ou inaptes pendant un certain temps, ils souhaitent que l&#8217;avocat puisse gérer directement le compte.</p>
</div>
<div class="paragraph data-line-573">
<p>Voici le script de rachat que Mohammed conçoit pour y parvenir (préfixe de numéro de ligne en tant que XX) :</p>
</div>
<div class="listingblock data-line-576">
<div class="title">Variable Multi-Signature avec verrou temporel</div>
<div class="content">
<pre>01  IF
02    IF
03      2
04    ELSE
05      &lt;30 days&gt; CHECKSEQUENCEVERIFY DROP
06      &lt;Abdul the Lawyer's Pubkey&gt; CHECKSIGVERIFY
07      1
08    ENDIF
09    &lt;Mohammed's Pubkey&gt; &lt;Saeed's Pubkey&gt; &lt;Zaira's Pubkey&gt; 3 CHECKMULTISIG
10  ELSE
11    &lt;90 days&gt; CHECKSEQUENCEVERIFY DROP
12    &lt;Abdul the Lawyer's Pubkey&gt; CHECKSIG
13  ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-592">
<p>Le script de Mohammed implémente trois chemins d&#8217;exécution à l&#8217;aide de clauses de contrôle de flux imbriquées IF...ELSE.</p>
</div>
<div class="paragraph data-line-594">
<p>Dans le premier chemin d&#8217;exécution, ce script fonctionne comme un simple multisig 2 sur 3 avec les trois partenaires. Ce chemin d&#8217;exécution se compose des lignes 3 et 9. La ligne 3 définit le quorum du multisig à <code>2</code> (2-de-3). Ce chemin d&#8217;exécution peut être sélectionné en mettant <code>TRUE TRUE</code> à la fin du script de déverrouillage :</p>
</div>
<div class="listingblock data-line-597">
<div class="title">Script de déverrouillage pour le premier chemin d&#8217;exécution (2-de-3 multisig)</div>
<div class="content">
<pre>0 &lt;Mohammed's Sig&gt; &lt;Zaira's Sig&gt; TRUE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-603">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-604">
<p>Le <code>0</code> au début de ce script de déverrouillage est dû à un bogue dans <code>CHECKMULTISIG</code> qui extrait une valeur supplémentaire de la pile. La valeur supplémentaire est ignorée par le CHECKMULTISIG, mais elle doit être présente ou le script échoue. Pousser <code>0</code> (habituellement) est une solution de contournement au bogue, comme décrit dans <a href="#multisig_bug">Un bogue dans l&#8217;exécution de CHECKMULTISIG</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-607">
<p>Le deuxième chemin d&#8217;exécution ne peut être utilisé qu&#8217;après 30 jours à compter de la création de l&#8217;UTXO. À ce moment-là, il faut la signature d&#8217;Abdul l&#8217;avocat et de l&#8217;un des trois partenaires (un multisig 1 sur 3). Ceci est réalisé par la ligne 7, qui fixe le quorum pour le multisig à 1. Pour sélectionner ce chemin d&#8217;exécution, le script de déverrouillage se terminerait par FALSE TRUE :</p>
</div>
<div class="listingblock data-line-610">
<div class="title">Script de déverrouillage pour le deuxième chemin d&#8217;exécution (Avocat + 1 sur 3)</div>
<div class="content">
<pre>0 &lt;Abdul the Lawyer's Sig&gt; &lt;Saeed's Sig&gt; FALSE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-615">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-616">
<p>Pourquoi FAUX VRAI ? N&#8217;est-ce pas à l&#8217;envers ? Parce que les deux valeurs sont poussées sur la pile, avec <code>FALSE</code> poussé en premier, puis <code>TRUE</code> poussé en second. <code>TRUE</code> est donc dépilé <em>premier</em> par le premier opcode IF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-619">
<p>Enfin, la troisième voie d&#8217;exécution permet à Abdul l&#8217;avocat de dépenser les fonds seul, mais seulement après 90 jours. Pour sélectionner ce chemin d&#8217;exécution, le script de déverrouillage doit se terminer par FALSE :</p>
</div>
<div class="listingblock data-line-622">
<div class="title">Script de déverrouillage pour le troisième chemin d&#8217;exécution (avocat uniquement)</div>
<div class="content">
<pre>&lt;Abdul the Lawyer's Sig&gt; FALSE</pre>
</div>
</div>
<div class="paragraph data-line-626">
<p>Essayez d&#8217;exécuter le script sur papier pour voir comment il se comporte sur la pile.</p>
</div>
<div class="paragraph data-line-628">
<p>Quelques éléments supplémentaires à prendre en compte lors de la lecture de cet exemple. Voyez si vous pouvez trouver les réponses :</p>
</div>
<div class="ulist data-line-630">
<ul>
<li class="data-line-630">
<p>Pourquoi l&#8217;avocat ne peut-il pas racheter le troisième chemin d&#8217;exécution à tout moment en le sélectionnant avec <code>FALSE</code> sur le script de déverrouillage ?</p>
</li>
<li class="data-line-632">
<p>Combien de chemins d&#8217;exécution peuvent être utilisés 5, 35 et 105 jours, respectivement, après le minage de l&#8217;UTXO ?</p>
</li>
<li class="data-line-634">
<p>Les fonds sont-ils perdus si l&#8217;avocat perd sa clé ? Votre réponse change-t-elle si 91 jours se sont écoulés ?</p>
</li>
<li class="data-line-636">
<p>Comment les associés « remettent-ils à zéro » l&#8217;horloge tous les 29 ou 89 jours pour empêcher l&#8217;avocat d&#8217;accéder aux fonds ?</p>
</li>
<li class="data-line-638">
<p>Pourquoi certains opcodes <code>CHECKSIG</code> dans ce script ont-ils le suffixe <code>VERIFY</code> alors que d&#8217;autres non ?</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-641">
<h3 id="segwit">Témoin séparé</h3>
<div class="paragraph data-line-643">
<p>Le Segregated Witness (segwit) ou le "témoin séparé" est une mise à niveau des règles de consensus bitcoin et du protocole réseau, proposée et mise en œuvre en tant que embranchement convergent BIP-9 qui a été activé sur le réseau principal de bitcoin le 1er août 2017.</p>
</div>
<div class="paragraph data-line-645">
<p>En cryptographie, le terme « témoin » est utilisé pour décrire une solution à un puzzle cryptographique. En termes de bitcoin, le témoin satisfait une condition cryptographique placée sur une sortie de transaction non dépensée (UTXO).</p>
</div>
<div class="paragraph data-line-647">
<p>Dans le contexte du bitcoin, une signature numérique est <em>un type de témoin</em>, mais un témoin est plus largement toute solution qui peut satisfaire les conditions imposées à un UTXO et débloquer cet UTXO pour les dépenses. Le terme "témoin" est un terme plus général pour un "script de déverrouillage" ou "scriptSig".</p>
</div>
<div class="paragraph data-line-649">
<p>Avant l&#8217;introduction de segwit, chaque entrée d&#8217;une transaction était suivie des données témoins qui la déverrouillaient. Les données témoins ont été intégrées à la transaction dans le cadre de chaque entrée. Le terme <em>témoin séparé</em>, ou <em>segwit</em> en abrégé, signifie simplement séparer la signature ou le script de déverrouillage d&#8217;une sortie spécifique. Pensez "scriptSig séparé" ou "signature séparée" dans sa forme la plus simple.</p>
</div>
<div class="paragraph data-line-651">
<p>Le témoin séparé (Segregated Witness) est donc une modification architecturale du bitcoin qui vise à déplacer les données témoins du champ <code>scriptSig</code> (script de déverrouillage) d&#8217;une transaction vers une structure de données <em>témoin</em> distincte qui accompagne une transaction. Les clients peuvent demander des données de transaction avec ou sans les données de témoin qui les accompagnent.</p>
</div>
<div class="paragraph data-line-653">
<p>Dans cette section, nous examinerons certains des avantages du témoin séparé, décrirons le mécanisme utilisé pour déployer et mettre en œuvre ce changement d&#8217;architecture et démontrerons l&#8217;utilisation du témoin séparé dans les transactions et les adresses.</p>
</div>
<div class="paragraph data-line-655">
<p>Le témoin séparé est défini par les BIP suivants :</p>
</div>
<div class="dlist data-line-657">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a> </dt>
<dd>
<p>La principale définition du témoin séparé.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a> </dt>
<dd>
<p>Vérification de la signature des transactions pour le programme témoin de la version 0</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a> </dt>
<dd>
<p>Services à pair; Nouveaux messages réseau et formats de sérialisation</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a> </dt>
<dd>
<p>Mises à jour de getblocktemplate pour le témoin séparé Segregated Witness (pour minage)</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a> </dt>
<dd>
<p>Format d&#8217;adresse Base32 pour les sorties témoins natives v0-16</p>
</dd>
</dl>
</div>
<div class="sect3 data-line-668">
<h4 id="_pourquoi_un_témoin_séparé">Pourquoi un témoin séparé ?</h4>
<div class="paragraph data-line-670">
<p>Le témoin séparé est un changement architectural qui a plusieurs effets sur l&#8217;évolutivité, la sécurité, les incitations économiques et les performances du bitcoin :</p>
</div>
<div class="dlist data-line-672">
<dl>
<dt class="hdlist1">Malléabilité de transaction </dt>
<dd>
<p>En déplaçant le témoin en dehors des données de transaction, le hachage de transaction utilisé comme identifiant n&#8217;inclut plus les données de témoin. Étant donné que les données témoins sont la seule partie de la transaction qui peut être modifiée par un tiers (voir <a href="#segwit_txid">Identifiants de transaction</a>), sa suppression supprime également la possibilité d&#8217;attaques de malléabilité des transactions. Avec le témoin séparé, les hachages de transaction deviennent immuables par toute personne autre que le créateur de la transaction, ce qui améliore considérablement la mise en œuvre de nombreux autres protocoles qui reposent sur la construction avancée de transactions bitcoin, tels que les canaux de paiement, les transactions chaînées et les réseaux Lightning.</p>
</dd>
<dt class="hdlist1">Gestion des versions de script </dt>
<dd>
<p>Avec l&#8217;introduction des scripts Segregated Witness (témoin séparé), chaque script de verrouillage est précédé d&#8217;un numéro de <em>version de script</em>, similaire à la façon dont les transactions et les blocs ont des numéros de version. L&#8217;ajout d&#8217;un numéro de version de script permet au langage de script d&#8217;être mis à niveau de manière rétrocompatible (c&#8217;est-à-dire en utilisant des mises à niveau d&#8217;embranchement convergent) pour introduire de nouvelles opérandes de script, syntaxe ou sémantique. La possibilité de mettre à niveau le langage de script de manière non perturbatrice accélérera considérablement le taux d&#8217;innovation dans le bitcoin.</p>
</dd>
<dt class="hdlist1">Mise à l&#8217;échelle du réseau et du stockage </dt>
<dd>
<p>Les données témoins contribuent souvent de manière importante à la taille totale d&#8217;une transaction. Les scripts plus complexes tels que ceux utilisés pour les canaux multisig ou de paiement sont très volumineux. Dans certains cas, ces scripts représentent la majorité (plus de 75 %) des données d&#8217;une transaction. En déplaçant les données témoins en dehors des données de transaction, le témoin séparé améliore l&#8217;évolutivité de Bitcoin. Les nœuds peuvent élaguer les données témoins après avoir validé les signatures, ou les ignorer complètement lors de la vérification simplifiée des paiements. Les données témoins n&#8217;ont pas besoin d&#8217;être transmises à tous les nœuds et n&#8217;ont pas besoin d&#8217;être stockées sur disque par tous les nœuds.</p>
</dd>
<dt class="hdlist1">Optimisation de la vérification de signature </dt>
<dd>
<p>Le témoin séparé met à niveau les fonctions de signature (CHECKSIG, CHECKMULTISIG, etc.) pour réduire la complexité de calcul de l&#8217;algorithme. Avant segwit, l&#8217;algorithme utilisé pour produire une signature nécessitait un nombre d&#8217;opérations de hachage proportionnel à la taille de la transaction. Les calculs de hachage de données ont augmenté en O(n<sup>2</sup>) par rapport au nombre d&#8217;opérations de signature, introduisant une charge de calcul substantielle sur tous les nœuds vérifiant la signature. Avec segwit, l&#8217;algorithme est modifié pour réduire la complexité à O(n).</p>
</dd>
<dt class="hdlist1">Amélioration de la signature hors ligne </dt>
<dd>
<p>Les signatures des témoins séparés incorporent la valeur (montant) référencée par chaque entrée dans le hachage qui est signé. Auparavant, un dispositif de signature hors ligne, tel qu&#8217;un portefeuille matériel, devait vérifier le montant de chaque entrée avant de signer une transaction. Cela était généralement accompli en diffusant une grande quantité de données sur les transactions précédentes référencées en tant qu&#8217;entrées. Étant donné que le montant fait désormais partie du hachage d&#8217;engagement qui est signé, un appareil hors ligne n&#8217;a pas besoin des transactions précédentes. Si les montants ne correspondent pas (sont mal représentés par un système en ligne compromis), la signature sera invalide.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 data-line-682">
<h4 id="_comment_fonctionne_le_témoignage_séparé">Comment fonctionne le témoignage séparé</h4>
<div class="paragraph data-line-684">
<p>À première vue, le témoignage séparé semble être un changement dans la façon dont les transactions sont construites et donc une fonctionnalité au niveau de la transaction, mais ce n&#8217;est pas le cas. Au lieu de cela, le témoin séparé est un changement dans la façon dont les UTXO individuels sont dépensés et est donc une fonctionnalité par sortie.</p>
</div>
<div class="paragraph data-line-686">
<p>Une transaction peut dépenser des sorties de témoin séparé ou des sorties traditionnelles (témoin en ligne) ou les deux. Par conséquent, cela n&#8217;a pas beaucoup de sens de se référer à une transaction comme une "transaction de témoin séparé". Nous devrions plutôt faire référence à des sorties de transaction spécifiques en tant que "sorties de témoins séparés".</p>
</div>
<div class="paragraph data-line-688">
<p>Lorsqu&#8217;une transaction passe un UTXO, elle doit fournir un témoin. Dans un UTXO traditionnel, le script de verrouillage nécessite que les données témoins soient fournies <em>en ligne</em> dans la partie d&#8217;entrée de la transaction qui dépense l&#8217;UTXO. Un UTXO de témoin séparé, cependant, spécifie un script de verrouillage qui peut être satisfait avec des données de témoin en dehors de l&#8217;entrée (séparées).</p>
</div>
</div>
<div class="sect3 data-line-690">
<h4 id="_embranchement_convergent_rétrocompatibilité">Embranchement convergent (rétrocompatibilité)</h4>
<div class="paragraph data-line-692">
<p>Le témoin séparé est un changement significatif dans la manière dont les sorties et les transactions sont architecturées. Un tel changement nécessiterait normalement un changement simultané de chaque nœud et portefeuille Bitcoin pour modifier les règles de consensus, ce que l&#8217;on appelle une fourche dure. Au lieu de cela, un témoin séparé est introduit avec un changement beaucoup moins perturbateur, qui est rétrocompatible, connu sous le nom d&#8217;embranchement convergent. Ce type de mise à niveau permet aux logiciels non mis à niveau d&#8217;ignorer les modifications et de continuer à fonctionner sans aucune interruption.</p>
</div>
<div class="paragraph data-line-694">
<p>Les sorties de témoins séparés sont construites de manière à ce que les systèmes plus anciens qui ne sont pas sensibles au segwit puissent toujours les valider. Pour un ancien portefeuille ou nœud, une sortie de témoin séparé ressemble à une sortie que <em>n&#8217;importe qui peut dépenser</em>. De telles sorties peuvent être dépensées avec une signature vide, donc le fait qu&#8217;il n&#8217;y ait pas de signature à l&#8217;intérieur de la transaction (elle est séparée) n&#8217;invalide pas la transaction. Cependant, les portefeuilles et les nœuds de minage plus récents voient la sortie du témoin séparé et s&#8217;attendent à trouver un témoin valide pour celle-ci dans les données de témoin de la transaction.</p>
</div>
</div>
<div class="sect3 data-line-696">
<h4 id="_exemples_de_témoins_séparés_et_exemples_de_transactions">Exemples de témoins séparés et exemples de transactions</h4>
<div class="paragraph data-line-698">
<p>Examinons quelques-uns de nos exemples de transactions et voyons comment ils changeraient avec le témoin séparé. Nous verrons d&#8217;abord comment un paiement Pay-to-Public-Key-Hash (P2PKH) est transformé avec le programme de témoignage séparé. Ensuite, nous examinerons l&#8217;équivalent des témoins séparés pour les scripts Pay-to-Script-Hash (P2SH). Enfin, nous verrons comment les deux programmes de témoignage séparé précédents peuvent être intégrés dans un script P2SH.</p>
</div>
<div class="sect4 data-line-701">
<h5 id="p2wpkh">Pay-to-Witness-Public-Key-Hash (P2WPKH)</h5>
<div class="paragraph data-line-703">
<p>Dans <a href="#cup_of_coffee">Acheter une tasse de café</a>, Alice a créé une transaction pour payer Bob pour une tasse de café. Cette transaction a créé une sortie P2PKH d&#8217;une valeur de 0,015 BTC pouvant être dépensée par Bob. Le script de sortie ressemble à ceci :</p>
</div>
<div class="listingblock data-line-706">
<div class="title">Exemple de script de sortie P2PKH</div>
<div class="content">
<pre>DUP HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-710">
<p>Avec le témoin séparé, Alice créerait un script Pay-to-Witness-Public-Key-Hash (P2WPKH), qui ressemble à ceci :</p>
</div>
<div class="listingblock data-line-713">
<div class="title">Exemple de script de sortie P2WPKH</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-717">
<p>Comme vous pouvez le voir, le script de verrouillage d&#8217;une sortie de témoin séparé est beaucoup plus simple qu&#8217;une sortie traditionnelle. Il se compose de deux valeurs qui sont transmises à la pile d&#8217;évaluation du script. Pour un ancien client Bitcoin (non conscient de la technologie), les deux poussées ressembleraient à une sortie que n&#8217;importe qui peut dépenser et ne nécessite pas de signature (ou plutôt, peut être dépensée avec une signature vide). Pour un client segwit plus récent, le premier chiffre (0) est interprété comme un numéro de version (la <em>version témoin</em>) et la seconde partie (20 octets) est l&#8217;équivalent d&#8217;un script de verrouillage connu sous le nom de <em>programme témoin</em>. Le programme témoin de 20 octets est simplement le hachage de la clé publique, comme dans un script P2PKH.</p>
</div>
<div class="paragraph data-line-719">
<p>Examinons maintenant la transaction correspondante que Bob utilise pour dépenser cette sortie. Pour le script d&#8217;origine (nonsegwit), la transaction de Bob devrait inclure une signature dans l&#8217;entrée de transaction :</p>
</div>
<div class="listingblock data-line-722">
<div class="title">Transaction décodée montrant une sortie P2PKH dépensée avec une signature</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": “&lt;Bob’s scriptSig&gt;”,
]
[...]</pre>
</div>
</div>
<div class="paragraph data-line-732">
<p>Cependant, pour passer la sortie du témoin séparé, la transaction n&#8217;a pas de signature dans la partie d&#8217;entrée. Au lieu de cela, la transaction de Bob a un <code>scriptSig</code> vide dans les données de transaction (la première partie d&#8217;une transaction, qui inclut la partie d&#8217;entrée) et inclut sa signature dans les données témoins (la deuxième partie d&#8217;une transaction, qui est séparée des données de transaction ):</p>
</div>
<div class="listingblock data-line-735">
<div class="title">Transaction décodée montrant une sortie P2WPKH dépensée avec des données témoins séparées</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": “”,
]
[...]
“witness”: “&lt;Bob’s witness data&gt;”
[...]</pre>
</div>
</div>
</div>
<div class="sect4 data-line-747">
<h5 id="_construction_de_portefeuille_de_p2wpkh">Construction de portefeuille de P2WPKH</h5>
<div class="paragraph data-line-749">
<p>Il est extrêmement important de noter que P2WPKH ne doit être créé que par le bénéficiaire (destinataire) et non converti par l&#8217;expéditeur à partir d&#8217;une clé publique connue, d&#8217;un script P2PKH ou d&#8217;une adresse. Le destinataire n&#8217;a aucun moyen de savoir si le portefeuille de l&#8217;expéditeur a la capacité de construire des transactions segwit et de dépenser les sorties P2WPKH.</p>
</div>
<div class="paragraph data-line-751">
<p>De plus, les sorties P2WPKH doivent être construites à partir du hachage d&#8217;une clé publique <em>compressée</em>. Les clés publiques non compressées ne sont pas standard dans segwit et peuvent être explicitement désactivées par un futur embranchement convergent. Si le hachage utilisé dans le P2WPKH provient d&#8217;une clé publique non compressée, il peut être inutilisable et vous risquez de perdre des fonds. Les sorties P2WPKH doivent être créées par le portefeuille du bénéficiaire en dérivant une clé publique compressée à partir de sa clé privée.</p>
</div>
<div class="admonitionblock warning data-line-754">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-755">
<p>P2WPKH doit être construit par le bénéficiaire (destinataire) en convertissant une clé publique compressée en un hachage P2WPKH. Vous ne devez jamais transformer un script P2PKH, une adresse Bitcoin ou une clé publique non compressée en un script témoin P2WPKH.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-759">
<h5 id="p2wsh">Pay-to-Witness-Script-Hash (P2WSH)</h5>
<div class="paragraph data-line-761">
<p>Le deuxième type de programme témoin correspond à un script Pay-to-Script-Hash (P2SH). Nous avons vu ce type de script dans <a href="#p2sh">Pay-to-Script-Hash (P2SH)</a>. Dans cet exemple, P2SH a été utilisé par la société de Mohammed pour exprimer un script multisignature. Les paiements à l&#8217;entreprise de Mohammed étaient encodés avec un script de verrouillage comme celui-ci :</p>
</div>
<div class="listingblock data-line-764">
<div class="title">Exemple de script de sortie P2SH</div>
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-768">
<p>Ce script P2SH fait référence au hachage d&#8217;un <em>script d&#8217;échange</em> qui définit une exigence multisignature 2 sur 5 pour dépenser des fonds. Pour dépenser cette sortie, la société de Mohammed présenterait le script de rachat (dont le hachage correspond au hachage du script dans la sortie P2SH) et les signatures nécessaires pour satisfaire ce script de rachat, le tout dans l&#8217;entrée de transaction :</p>
</div>
<div class="listingblock data-line-771">
<div class="title">Transaction décodée montrant qu&#8217;une sortie P2SH est dépensée</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": “&lt;SigA&gt; &lt;SigB&gt; &lt;2 PubA PubB PubC PubD PubE 5 CHECKMULTISIG&gt;”,
]</pre>
</div>
</div>
<div class="paragraph data-line-780">
<p>Maintenant, regardons comment cet exemple entier serait mis à niveau vers segwit. Si les clients de Mohammed utilisaient un portefeuille compatible segwit, ils effectueraient un paiement, créant une sortie Pay-to-Witness-Script-Hash (P2WSH) qui ressemblerait à ceci :</p>
</div>
<div class="listingblock data-line-783">
<div class="title">Exemple de script de sortie P2WSH</div>
<div class="content">
<pre>0 a9b7b38d972cabc7961dbfbcb841ad4508d133c47ba87457b4a0e8aae86dbb89</pre>
</div>
</div>
<div class="paragraph data-line-787">
<p>Encore une fois, comme dans l&#8217;exemple de P2WPKH, vous pouvez voir que le script équivalent Segregated Witness est beaucoup plus simple et omet les différents opérandes de script que vous voyez dans les scripts P2SH. Au lieu de cela, le programme de témoignage séparé se compose de deux valeurs poussées vers la pile : une version témoin (0) et le hachage SHA256 de 32 octets du script de rachat.</p>
</div>
<div class="paragraph data-line-789">
<p>La société de Mohammed peut dépenser la sortie P2WSH en présentant le bon script de rachat et suffisamment de signatures pour le satisfaire. Le script de rachat et les signatures seraient séparés <em>en dehors</em> des données de transaction de dépenses dans le cadre des données de témoin. Dans l&#8217;entrée de transaction, le portefeuille de Mohammed mettrait un <code>scriptSig</code> vide :</p>
</div>
<div class="listingblock data-line-792">
<div class="title">Transaction décodée montrant une sortie P2WSH dépensée avec des données témoins séparées</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": “”,
]
[...]
“witness”: “&lt;SigA&gt; &lt;SigB&gt; &lt;2 PubA PubB PubC PubD PubE 5 CHECKMULTISIG&gt;”
[...]</pre>
</div>
</div>
<div class="admonitionblock tip data-line-805">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-806">
<p>Alors que P2SH utilise le hachage <code>RIPEMD160(SHA256(script))</code> de 20 octets, le programme témoin P2WSH utilise un hachage <code>SHA256(script)</code> de 32 octets. Cette différence dans le choix de l&#8217;algorithme de hachage est délibérée et offre une sécurité renforcée à P2WSH (128 bits de sécurité dans P2WSH contre 80 bits de sécurité dans P2SH). Il est également utilisé pour différencier les deux types de programmes témoins (P2WPKH et P2WSH) en utilisant la longueur du hachage (voir ci-dessous).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-810">
<h5 id="_différenciation_entre_p2wpkh_et_p2wsh">Différenciation entre P2WPKH et P2WSH</h5>
<div class="paragraph data-line-812">
<p>Dans les deux sections précédentes, nous avons présenté deux types de programmes de témoins : <a href="#p2wpkh">Pay-to-Witness-Public-Key-Hash (P2WPKH)</a> et <a href="#p2wsh">Pay-to-Witness-Script-Hash (P2WSH)</a>. Les deux types de programmes témoins se composent d&#8217;un numéro de version à un seul octet suivi d&#8217;un hachage plus long. Ils se ressemblent beaucoup, mais sont interprétés très différemment : l&#8217;un est interprété comme un hachage de clé publique, qui est satisfait par une signature et l&#8217;autre comme un hachage de script, qui est satisfait par un script de rachat. La différence critique entre eux est la longueur du hachage :</p>
</div>
<div class="ulist data-line-814">
<ul>
<li class="data-line-814">
<p>Le hachage de clé publique dans P2WPKH est de 20 octets</p>
</li>
<li class="data-line-815">
<p>Le hachage du script dans P2WSH est de 32 octets</p>
</li>
</ul>
</div>
<div class="paragraph data-line-817">
<p>C&#8217;est la seule différence qui permet à un portefeuille de différencier les deux types de programmes de témoins. En examinant la longueur du hachage, un portefeuille peut déterminer de quel type de programme témoin il s&#8217;agit, P2WPKH ou P2WSH.</p>
</div>
</div>
</div>
<div class="sect3 data-line-819">
<h4 id="_mise_à_niveau_vers_un_témoin_séparé">Mise à niveau vers un témoin séparé</h4>
<div class="paragraph data-line-821">
<p>Comme nous pouvons le voir dans les exemples précédents, la mise à niveau vers les témoins séparés est un processus en deux étapes. Tout d&#8217;abord, les portefeuilles doivent créer des sorties spéciales de type segwit. Ensuite, ces sorties peuvent être dépensées par des portefeuilles qui savent comment construire des transactions de témoin séparé. Dans les exemples, le portefeuille d&#8217;Alice était sensible au segwit et capable de créer des sorties spéciales avec des scripts de témoignage séparés. Le portefeuille de Bob est également sensible au segwit et capable de dépenser ces sorties. Ce qui n&#8217;est peut-être pas évident à partir de l&#8217;exemple, c&#8217;est qu&#8217;en pratique, le portefeuille d&#8217;Alice doit <em>savoir</em> que Bob utilise un portefeuille sensible au segwit et peut dépenser ces sorties. Sinon, si le portefeuille de Bob n&#8217;est pas mis à niveau et qu&#8217;Alice essaie d&#8217;effectuer des paiements en segwit à Bob, le portefeuille de Bob ne pourra pas détecter ces paiements.</p>
</div>
<div class="admonitionblock tip data-line-824">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-825">
<p>Pour les types de paiement P2WPKH et P2WSH, les portefeuilles de l&#8217;expéditeur et du destinataire doivent être mis à niveau pour pouvoir utiliser segwit. De plus, le portefeuille de l&#8217;expéditeur doit savoir que le portefeuille du destinataire est sensible au segwit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-828">
<p>Le témoin séparé ne sera pas mis en œuvre simultanément sur l&#8217;ensemble du réseau. Au lieu de cela, Segregated Witness est implémenté comme une mise à niveau rétrocompatible, où <em>les anciens et les nouveaux clients peuvent coexister</em>. Les développeurs de portefeuille mettront indépendamment à niveau le logiciel de portefeuille pour ajouter des fonctionnalités segwit. Les types de paiement P2WPKH et P2WSH sont utilisés lorsque l&#8217;expéditeur et le destinataire sont conscients de segwit. Les P2PKH et P2SH traditionnels continueront de fonctionner pour les portefeuilles non mis à niveau. Cela laisse deux scénarios importants, qui sont abordés dans la section suivante :</p>
</div>
<div class="ulist data-line-830">
<ul>
<li class="data-line-830">
<p>Capacité du portefeuille d&#8217;un expéditeur qui n&#8217;est pas conscient de segwit à effectuer un paiement sur le portefeuille d&#8217;un destinataire qui peut traiter des transactions segwit</p>
</li>
<li class="data-line-832">
<p>Capacité du portefeuille d&#8217;un expéditeur qui est conscient de segwit à reconnaître et à distinguer les destinataires qui sont conscients de segwit et ceux qui ne le sont pas, par leurs <em>adresses</em>.</p>
</li>
</ul>
</div>
<div class="sect4 data-line-834">
<h5 id="_intégration_dun_témoin_séparé_dans_p2sh">Intégration d&#8217;un témoin séparé dans P2SH</h5>
<div class="paragraph data-line-836">
<p>Supposons, par exemple, que le portefeuille d&#8217;Alice n&#8217;est pas mis à niveau vers segwit, mais que le portefeuille de Bob est mis à niveau et peut gérer les transactions segwit. Alice et Bob peuvent utiliser les "anciennes" transactions non-segwit. Mais Bob voudrait probablement utiliser segwit pour réduire les frais de transaction, en profitant de la remise qui s&#8217;applique aux données des témoins.</p>
</div>
<div class="paragraph data-line-838">
<p>Dans ce cas, le portefeuille de Bob peut construire une adresse P2SH qui contient un script segwit à l&#8217;intérieur. Le portefeuille d&#8217;Alice considère cela comme une adresse P2SH "normale" et peut y effectuer des paiements sans aucune connaissance de segwit. Le portefeuille de Bob peut ensuite dépenser ce paiement avec une transaction segwit, tirant pleinement parti de segwit et réduisant les frais de transaction.</p>
</div>
<div class="paragraph data-line-840">
<p>Les deux formes de scripts témoins, P2WPKH et P2WSH, peuvent être intégrées dans une adresse P2SH. Le premier est noté P2SH(P2WPKH) et le second est noté P2SH(P2WSH).</p>
</div>
</div>
<div class="sect4 data-line-842">
<h5 id="_pay_to_witness_public_key_hash_dans_pay_to_script_hash">Pay-to-Witness-Public-Key-Hash dans Pay-to-Script-Hash</h5>
<div class="paragraph data-line-844">
<p>La première forme de script témoin que nous examinerons est P2SH(P2WPKH). Il s&#8217;agit d&#8217;un programme témoin Pay-to-Witness-Public-Key-Hash, intégré dans un script Pay-to-Script-Hash, afin qu&#8217;il puisse être utilisé par un portefeuille qui n&#8217;est pas conscient de segwit.</p>
</div>
<div class="paragraph data-line-846">
<p>Le portefeuille de Bob construit un programme témoin P2WPKH avec la clé publique de Bob. Ce programme témoin est ensuite haché et le hachage résultant est encodé sous la forme d&#8217;un script P2SH. Le script P2SH est converti en une adresse Bitcoin, celle qui commence par un "3", comme nous l&#8217;avons vu dans le <a href="#p2sh">Pay-to-Script-Hash (P2SH)</a> rubrique.</p>
</div>
<div class="paragraph data-line-848">
<p>Le portefeuille de Bob commence par le programme témoin P2WPKH que nous avons vu plus tôt :</p>
</div>
<div class="listingblock data-line-851">
<div class="title">Programme de témoins P2WPKH de Bob</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-855">
<p>Le programme témoin P2WPKH se compose de la version témoin et du hachage de clé publique de 20 octets de Bob.</p>
</div>
<div class="paragraph data-line-857">
<p>Le portefeuille de Bob hache ensuite le programme témoin précédent, d&#8217;abord avec SHA256, puis avec RIPEMD160, produisant un autre hachage de 20 octets.</p>
</div>
<div class="paragraph data-line-859">
<p>Utilisons <code>bx</code> sur la ligne de commande pour répliquer cela :</p>
</div>
<div class="listingblock data-line-862">
<div class="title">HASH160 du programme témoin P2WPKH</div>
<div class="content">
<pre>echo \
'0 [ab68025513c3dbd2f7b92a94e0581f5d50f654e7]'\
 | bx script-encode | bx sha256 | bx ripemd160
3e0547268b3b19288b3adef9719ec8659f4b2b0b</pre>
</div>
</div>
<div class="paragraph data-line-870">
<p>Ensuite, le hachage du script de rachat est converti en une adresse Bitcoin. Utilisons à nouveau <code>bx</code> sur la ligne de commande :</p>
</div>
<div class="listingblock data-line-873">
<div class="title">Adresse P2SH</div>
<div class="content">
<pre>echo \
'3e0547268b3b19288b3adef9719ec8659f4b2b0b' \
| bx address-encode -v 5
37Lx99uaGn5avKBxiW26HjedQE3LrDCZru</pre>
</div>
</div>
<div class="paragraph data-line-880">
<p>Maintenant, Bob peut afficher cette adresse pour que les clients paient leur café. Le portefeuille d&#8217;Alice peut effectuer un paiement au 37Lx99uaGn5avKBxiW26HjedQE3LrDCZru, comme il le ferait avec n&#8217;importe quelle autre adresse Bitcoin.</p>
</div>
<div class="paragraph data-line-882">
<p>Pour payer Bob, le portefeuille d&#8217;Alice verrouillerait la sortie avec un script P2SH :</p>
</div>
<div class="listingblock data-line-883">
<div class="content">
<pre>HASH160 3e0547268b3b19288b3adef9719ec8659f4b2b0b EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-887">
<p>Même si le portefeuille d&#8217;Alice ne prend pas en charge segwit, le paiement qu&#8217;il crée peut être dépensé par Bob avec une transaction segwit.</p>
</div>
</div>
<div class="sect4 data-line-889">
<h5 id="_pay_to_witness_script_hash_dans_pay_to_script_hash">Pay-to-Witness-Script-Hash dans Pay-to-Script-Hash</h5>
<div class="paragraph data-line-891">
<p>De même, un programme témoin P2WSH pour un script multisig ou un autre script compliqué peut être intégré dans un script et une adresse P2SH, permettant à n&#8217;importe quel portefeuille d&#8217;effectuer des paiements compatibles avec segwit.</p>
</div>
<div class="paragraph data-line-893">
<p>Comme nous l&#8217;avons vu dans <a href="#p2wsh">Pay-to-Witness-Script-Hash (P2WSH)</a>, la société de Mohammed  utilise des paiements de témoins séparés avec des scripts multisignatures. Pour permettre à tout client de payer son entreprise, que ses portefeuilles soient ou non mis à niveau pour segwit, le portefeuille de Mohammed peut intégrer le programme témoin P2WSH dans un script P2SH.</p>
</div>
<div class="paragraph data-line-895">
<p>Tout d&#8217;abord, le portefeuille de Mohammed hache le script de rachat avec SHA256 (une seule fois). Utilisons <code>bx</code> pour faire cela sur la ligne de commande :</p>
</div>
<div class="listingblock data-line-898">
<div class="title">Le portefeuille de Mohammed crée un programme témoin P2WSH</div>
<div class="content">
<pre>echo \
2 \ [04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256
9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-910">
<p>Ensuite, le script de rachat haché est transformé en un programme témoin P2WSH :</p>
</div>
<div class="listingblock data-line-912">
<div class="content">
<pre>0 9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-916">
<p>Ensuite, le programme témoin lui-même est haché avec SHA256 et RIPEMD160, produisant un nouveau hachage de 20 octets, tel qu&#8217;utilisé dans le P2SH traditionnel. Utilisons <code>bx</code> sur la ligne de commande pour faire cela :</p>
</div>
<div class="listingblock data-line-919">
<div class="title">Le HASH160 du programme témoin P2WSH</div>
<div class="content">
<pre> echo \
'0 [9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73]'\
 | bx script-encode | bx sha256 | bx ripemd160
86762607e8fe87c0c37740cddee880988b9455b2</pre>
</div>
</div>
<div class="paragraph data-line-926">
<p>Ensuite, le portefeuille construit une adresse Bitcoin P2SH à partir de ce hachage. Encore une fois, nous utilisons <code>bx</code> pour calculer sur la ligne de commande :</p>
</div>
<div class="listingblock data-line-929">
<div class="title">P2SH Adresse bitcoin</div>
<div class="content">
<pre>echo \
'86762607e8fe87c0c37740cddee880988b9455b2'\
 | bx address-encode -v 5
3Dwz1MXhM6EfFoJChHCxh1jWHb8GQqRenG</pre>
</div>
</div>
<div class="paragraph data-line-936">
<p>Désormais, les clients de Mohammed peuvent effectuer des paiements à cette adresse sans avoir besoin de prendre en charge segwit. Pour envoyer un paiement à Mohammed, un portefeuille verrouillerait la sortie avec le script P2SH suivant :</p>
</div>
<div class="listingblock data-line-939">
<div class="title">Script P2SH utilisé pour verrouiller les paiements sur le multisig de Mohammed</div>
<div class="content">
<pre>HASH160 86762607e8fe87c0c37740cddee880988b9455b2 EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-943">
<p>La société de Mohammed peut alors construire des transactions segwit pour dépenser ces paiements, en tirant parti des fonctionnalités segwit, notamment des frais de transaction moins élevés.</p>
</div>
</div>
<div class="sect4 data-line-945">
<h5 id="_adresses_de_témoins_séparés">Adresses de témoins séparés</h5>
<div class="paragraph data-line-947">
<p>Même après l&#8217;activation de segwit, il faudra un certain temps avant que la plupart des portefeuilles soient mis à niveau. Dans un premier temps, segwit sera intégré à P2SH, comme nous l&#8217;avons vu dans la section précédente, pour faciliter la compatibilité entre les portefeuilles prenant en charge et ignorants de segwit.</p>
</div>
<div class="paragraph data-line-949">
<p>Cependant, une fois que les portefeuilles prennent largement en charge segwit, il est logique d&#8217;encoder les scripts témoins directement dans un format d&#8217;adresse natif conçu pour segwit, plutôt que de l&#8217;intégrer dans P2SH.</p>
</div>
<div class="paragraph data-line-951">
<p>Le format d&#8217;adresse segwit natif est défini dans BIP-173 :</p>
</div>
<div class="dlist data-line-953">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a> </dt>
<dd>
<p>Format d&#8217;adresse Base32 pour les sorties témoins natives v0-16</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-955">
<p>BIP-173 encode uniquement les scripts témoins (P2WPKH et P2WSH). Il n&#8217;est pas compatible avec les scripts P2PKH ou P2SH non-segwit. BIP-173 est un encodage Base32 à somme de contrôle, par rapport à l&#8217;encodage Base58 d&#8217;une adresse Bitcoin "traditionnelle". Les adresses BIP-173 sont également appelées adresses <em>bech32</em>, prononcées "beh-ch trente-deux", faisant allusion à l&#8217;utilisation d&#8217;un algorithme de détection d&#8217;erreur "BCH" et d&#8217;un ensemble de codage à 32 caractères.</p>
</div>
<div class="paragraph data-line-957">
<p>Les adresses BIP-173 utilisent un jeu de 32 caractères alphanumériques en minuscules uniquement, soigneusement sélectionnés pour réduire les erreurs de lecture ou de frappe. En choisissant un jeu de caractères en minuscules uniquement, bech32 est plus facile à lire, à parler et 45 % plus efficace pour encoder dans les codes QR.</p>
</div>
<div class="paragraph data-line-959">
<p>L&#8217;algorithme de détection d&#8217;erreurs BCH est une grande amélioration par rapport à l&#8217;algorithme de somme de contrôle précédent (de Base58Check), permettant non seulement la détection mais aussi la <em>correction</em> des erreurs. Les interfaces de saisie d&#8217;adresse (telles que les champs de texte dans les formulaires) peuvent détecter et mettre en évidence le caractère le plus susceptible d&#8217;être mal saisi lorsqu&#8217;elles détectent une erreur.</p>
</div>
<div class="paragraph data-line-961">
<p>De la spécification BIP-173, voici quelques exemples d&#8217;adresses bech32 :</p>
</div>
<div class="dlist data-line-963">
<dl>
<dt class="hdlist1">Mainnet P2WPKH</dt>
<dd>
<p>bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4</p>
</dd>
<dt class="hdlist1">Testnet P2WPKH</dt>
<dd>
<p>tb1qw508d6qejxtdg4y5r3zarvary0c5xw7kxpjzsx</p>
</dd>
<dt class="hdlist1">Mainnet P2WSH</dt>
<dd>
<p>bc1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3qccfmv3</p>
</dd>
<dt class="hdlist1">Testnet P2WSH</dt>
<dd>
<p>tb1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3q0sl5k7</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-968">
<p>Comme vous pouvez le voir dans ces exemples, une chaîne segwit bech32 contient jusqu&#8217;à 90 caractères et se compose de trois parties :</p>
</div>
<div class="dlist data-line-970">
<dl>
<dt class="hdlist1">La partie lisible par l&#8217;homme</dt>
<dd>
<p>Ce préfixe "bc" ou "tb" identifiant mainnet ou testnet</p>
</dd>
<dt class="hdlist1">Le séparateur</dt>
<dd>
<p>Le chiffre "1", qui ne fait pas partie du jeu de codage à 32 caractères et ne peut apparaître qu&#8217;à cette position en tant que séparateur</p>
</dd>
<dt class="hdlist1">La partie données</dt>
<dd>
<p>Un minimum de 6 caractères alphanumériques, le script témoin encodé par somme de contrôle</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-976">
<p>À l&#8217;heure actuelle, seuls quelques portefeuilles acceptent ou produisent des adresses segwit bech32 natives, mais à mesure que l&#8217;adoption de segwit augmente, vous les verrez de plus en plus souvent.</p>
</div>
<div class="paragraph data-line-978">
<p><a href="#segwit_addresses">Bitcoin non-segwit (hérité) et adresses segwit</a> affiche les adresses bitcoin non-segwit (héritées) et segwit.</p>
</div>
<table id="segwit_addresses" class="tableblock frame-all grid-all stretch data-line-982">
<caption class="title">Table 23. Bitcoin non-segwit (hérité) et adresses segwit</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encodage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Préfixe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse P2PKH héritée</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ancienne adresse Testnet P2PKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ancienne adresse P2SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ancienne adresse Testnet P2SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse Segwit P2SH(P2WPKH) imbriquée (intégrée)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse Segwit P2SH(P2WSH) imbriquée (intégrée)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse native Segwit P2WPKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse native Segwit Testnet P2WPKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse native Segwit P2WSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adresse native Segwit Testnet P2WSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-997">
<h5 id="segwit_txid">Identifiants de transaction</h5>
<div class="paragraph data-line-999">
<p>L&#8217;un des plus grands avantages des témoin séparés est qu&#8217;il élimine la malléabilité des transactions tierces.</p>
</div>
<div class="paragraph data-line-1001">
<p>Avant segwit, les transactions pouvaient voir leurs signatures subtilement modifiées par des tiers, changeant leur ID de transaction (hachage) sans changer aucune propriété fondamentale (entrées, sorties, montants). Cela a créé des opportunités d&#8217;attaques par déni de service ainsi que des attaques contre des logiciels de portefeuille mal écrits qui supposaient que les hachages de transaction non confirmés étaient immuables.</p>
</div>
<div class="paragraph data-line-1003">
<p>Avec l&#8217;introduction des témoins séparés, les transactions ont deux identifiants, <code>txid</code> et wtxid. L&#8217;identifiant de transaction traditionnel <code>txid</code> est le hachage double SHA256 de la transaction sérialisée, sans les données témoins. Une transaction <code>wtxid</code> est le hachage double SHA256 du nouveau format de sérialisation de la transaction avec des données témoins.</p>
</div>
<div class="paragraph data-line-1005">
<p>Le <code>txid</code> traditionnel est calculé exactement de la même manière qu&#8217;avec une transaction non segwit. Cependant, étant donné qu&#8217;une transaction segwit pure (une transaction qui ne contient que des entrées segwit) a des <code>scriptSig</code> vides dans chaque entrée, aucune partie de la transaction ne peut être modifiée par un tiers. Par conséquent, dans une transaction segwit pure, le <code>txid</code> est immuable par un tiers, même lorsque la transaction n&#8217;est pas confirmée.</p>
</div>
<div class="paragraph data-line-1007">
<p>Le <code>wtxid</code> est comme un identifiant "étendu", en ce que le hachage incorpore également les données du témoin. Si une transaction est transmise sans données témoins, alors le <code>wtxid</code> et le <code>txid</code> sont identiques. Notez que puisque le <code>wtxid</code> inclut des données témoins (signatures) et que les données témoins peuvent être malléables, le <code>wtxid</code> doit être considéré comme malléable jusqu&#8217;à ce que la transaction soit confirmée. Seul le <code>txid</code> d&#8217;une pure transaction segwit peut être considéré comme immuable par des tiers.</p>
</div>
<div class="admonitionblock tip data-line-1010">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1011">
<p>Les transactions de témoin séparé ont deux identifiants : <code>txid</code> et wtxid. Le <code>txid</code> est le hachage de la transaction sans les données témoins et le <code>wtxid</code> est le hachage incluant les données témoins. Seules les transactions segwit pures (transactions qui ne contiennent que des entrées segwit) ont un <code>txid</code> qui n&#8217;est pas sensible à la malléabilité des transactions tierces.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3 data-line-1014">
<h4 id="_nouvel_algorithme_de_signature_des_témoins_séparés">Nouvel algorithme de signature des témoins séparés</h4>
<div class="paragraph data-line-1016">
<p>Le témoin séparé modifie la sémantique des quatre fonctions de vérification de signature (CHECKSIG, CHECKSIGVERIFY, <code>CHECKMULTISIG</code> et CHECKMULTISIGVERIFY), changeant la façon dont un hachage d&#8217;engagement de transaction est calculé.</p>
</div>
<div class="paragraph data-line-1018">
<p>Les signatures dans les transactions bitcoin sont appliquées sur un <em>hachage d&#8217;engagement</em>, qui est calculé à partir des données de transaction, verrouillant des parties spécifiques des données indiquant l&#8217;engagement du signataire envers ces valeurs. Par exemple, dans une signature de type <code>SIGHASH_ALL</code> simple, le hachage d&#8217;engagement inclut toutes les entrées et sorties.</p>
</div>
<div class="paragraph data-line-1020">
<p>Malheureusement, la façon dont le hachage d&#8217;engagement a été calculé a introduit la possibilité qu&#8217;un nœud vérifiant la signature puisse être forcé d&#8217;effectuer un nombre important de calculs de hachage. Plus précisément, les opérations de hachage augmentent en O(n<sup>2</sup>) par rapport au nombre d&#8217;opérations de signature dans la transaction. Un attaquant pourrait donc créer une transaction avec un très grand nombre d&#8217;opérations de signature, obligeant l&#8217;ensemble du réseau Bitcoin à effectuer des centaines ou des milliers d&#8217;opérations de hachage pour vérifier la transaction.</p>
</div>
<div class="paragraph data-line-1022">
<p>Segwit représentait une opportunité de résoudre ce problème en modifiant la façon dont le hachage d&#8217;engagement est calculé. Pour les programmes témoins segwit version 0, la vérification de la signature se produit à l&#8217;aide d&#8217;un algorithme de hachage d&#8217;engagement amélioré, comme spécifié dans BIP-143.</p>
</div>
<div class="paragraph data-line-1024">
<p>Le nouvel algorithme atteint deux objectifs importants. Premièrement, le nombre d&#8217;opérations de hachage augmente d&#8217;un O(n) beaucoup plus graduel au nombre d&#8217;opérations de signature, réduisant la possibilité de créer des attaques par déni de service avec des transactions trop complexes. Deuxièmement, le hachage d&#8217;engagement inclut désormais également la valeur (montants) de chaque entrée dans le cadre de l&#8217;engagement. Cela signifie qu&#8217;un signataire peut s&#8217;engager sur une valeur d&#8217;entrée spécifique sans avoir besoin de "récupérer" et de vérifier la transaction précédente référencée par l&#8217;entrée. Dans le cas d&#8217;appareils hors ligne, tels que les portefeuilles matériels, cela simplifie grandement la communication entre l&#8217;hôte et le portefeuille matériel, supprimant la nécessité de diffuser les transactions précédentes pour validation. Un portefeuille matériel peut accepter la valeur d&#8217;entrée "telle qu&#8217;elle est indiquée" par un hôte non approuvé. Étant donné que la signature n&#8217;est pas valide si cette valeur d&#8217;entrée n&#8217;est pas correcte, le portefeuille matériel n&#8217;a pas besoin de valider la valeur avant de signer l&#8217;entrée.</p>
</div>
</div>
<div class="sect3 data-line-1026">
<h4 id="_incitations_économiques_pour_les_témoins_isolés">Incitations économiques pour les témoins isolés</h4>
<div class="paragraph data-line-1028">
<p>Les nœuds miniers Bitcoin et les nœuds complets entraînent des coûts pour les ressources utilisées pour prendre en charge le réseau Bitcoin et la chaîne de blocs. À mesure que le volume de transactions bitcoin augmente, le coût des ressources (CPU, bande passante réseau, espace disque, mémoire) augmente également. Les mineurs sont indemnisés pour ces coûts par des frais proportionnels à la taille (en octets) de chaque transaction. Les nœuds complets non miniers ne sont pas rémunérés, ils encourent donc ces coûts parce qu&#8217;ils ont besoin d&#8217;exécuter un nœud d&#8217;index complet faisant autorité, peut-être parce qu&#8217;ils utilisent le nœud pour exploiter une entreprise bitcoin.</p>
</div>
<div class="paragraph data-line-1030">
<p>Sans frais de transaction, la croissance des données bitcoin augmenterait sans doute de façon spectaculaire. Les frais sont destinés à aligner les besoins des utilisateurs de bitcoins sur le fardeau que leurs transactions imposent au réseau, grâce à un mécanisme de découverte des prix basé sur le marché.</p>
</div>
<div class="paragraph data-line-1032">
<p>Le calcul des frais en fonction de la taille de la transaction traite toutes les données de la transaction comme ayant un coût égal. Mais du point de vue des nœuds complets et des mineurs, certaines parties d&#8217;une transaction entraînent des coûts beaucoup plus élevés. Chaque transaction ajoutée au réseau Bitcoin affecte la consommation de quatre ressources sur les nœuds :</p>
</div>
<div class="dlist data-line-1034">
<dl>
<dt class="hdlist1">Espace disque </dt>
<dd>
<p>Chaque transaction est stockée dans la chaîne de blocs, ajoutant à la taille totale de la chaîne de blocs. La chaîne de blocs est stockée sur disque, mais le stockage peut être optimisé en « élaguant » (supprimant) les anciennes transactions.</p>
</dd>
<dt class="hdlist1">CPU </dt>
<dd>
<p>Chaque transaction doit être validée, ce qui nécessite du temps CPU.</p>
</dd>
<dt class="hdlist1">Bande passante </dt>
<dd>
<p>Chaque transaction est transmise (par propagation d&#8217;inondation) sur le réseau au moins une fois. Sans aucune optimisation du protocole de propagation de bloc, les transactions sont à nouveau transmises dans le cadre d&#8217;un bloc, ce qui double l&#8217;impact sur la capacité du réseau.</p>
</dd>
<dt class="hdlist1">Mémoire </dt>
<dd>
<p>Les nœuds qui valident les transactions conservent l&#8217;index UTXO ou l&#8217;intégralité de l&#8217;ensemble UTXO en mémoire pour accélérer la validation. Étant donné que la mémoire est au moins un ordre de grandeur plus chère que le disque, la croissance de l&#8217;ensemble UTXO contribue de manière disproportionnée au coût d&#8217;exécution d&#8217;un nœud.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1042">
<p>Comme vous pouvez le voir dans la liste, toutes les parties d&#8217;une transaction n&#8217;ont pas le même impact sur le coût d&#8217;exécution d&#8217;un nœud ou sur la capacité du bitcoin à évoluer pour prendre en charge davantage de transactions. La partie la plus coûteuse d&#8217;une transaction sont les sorties nouvellement créées, car elles sont ajoutées à l&#8217;ensemble UTXO en mémoire. En comparaison, les signatures (c&#8217;est-à-dire les données témoins) ajoutent le moins de charge au réseau et au coût d&#8217;exécution d&#8217;un nœud, car les données témoins ne sont validées qu&#8217;une seule fois et ne sont jamais réutilisées. De plus, immédiatement après avoir reçu une nouvelle transaction et validé les données témoins, les nœuds peuvent supprimer ces données témoins. Si les frais sont calculés en fonction de la taille de la transaction, sans faire de distinction entre ces deux types de données, les incitations du marché en matière de frais ne sont pas alignées sur les coûts réels imposés par une transaction. En fait, la structure tarifaire actuelle encourage en fait le comportement inverse, car les données des témoins constituent la plus grande partie d&#8217;une transaction.</p>
</div>
<div class="paragraph data-line-1044">
<p>Les incitations créées par les frais sont importantes car elles affectent le comportement des portefeuilles. Tous les portefeuilles doivent mettre en œuvre une stratégie pour assembler les transactions qui prend en considération un certain nombre de facteurs, tels que la confidentialité (réduction de la réutilisation des adresses), la fragmentation (faire beaucoup de monnaie) et les frais. Si les frais motivent massivement les portefeuilles à utiliser le moins d&#8217;entrées possible dans les transactions, cela peut conduire à la sélection d&#8217;UTXO et à la modification des stratégies d&#8217;adresse qui gonflent par inadvertance l&#8217;ensemble UTXO.</p>
</div>
<div class="paragraph data-line-1046">
<p>Les transactions consomment les UTXO dans leurs entrées et créent de nouveaux UTXO avec leurs sorties. Par conséquent, une transaction qui a plus d&#8217;entrées que de sorties entraînera une diminution de l&#8217;ensemble UTXO, tandis qu&#8217;une transaction qui a plus de sorties que d&#8217;entrées entraînera une augmentation de l&#8217;ensemble UTXO. Considérons la <em>difference</em> entre les entrées et les sorties et appelons cela le "Net-new-UTXO". Il s&#8217;agit d&#8217;une mesure importante, car elle nous indique l&#8217;impact qu&#8217;une transaction aura sur la ressource la plus chère à l&#8217;échelle du réseau, l&#8217;ensemble UTXO en mémoire. Une transaction avec Net-new-UTXO positif ajoute à ce fardeau. Une transaction avec un Net-new-UTXO négatif réduit la charge. Nous voudrions donc encourager les transactions qui sont soit Net-new-UTXO négatives, soit neutres avec zéro Net-new-UTXO.</p>
</div>
<div class="paragraph data-line-1048">
<p>Examinons un exemple des incitations créées par le calcul des frais de transaction, avec et sans témoin séparé. Nous examinerons deux transactions différentes. La transaction A est une transaction à 3 entrées et 2 sorties, qui a une métrique Net-new-UTXO de -1, ce qui signifie qu&#8217;elle consomme un UTXO de plus qu&#8217;elle n&#8217;en crée, ce qui réduit l&#8217;UTXO défini d&#8217;un. La transaction B est une transaction à 2 entrées et 3 sorties, qui a une métrique Net-new-UTXO de 1, ce qui signifie qu&#8217;elle ajoute un UTXO à l&#8217;ensemble UTXO, imposant un coût supplémentaire à l&#8217;ensemble du réseau Bitcoin. Les deux transactions utilisent des scripts multisignatures (2 sur 3) pour démontrer comment des scripts complexes augmentent l&#8217;impact d&#8217;un témoin séparé sur les frais. Supposons un taux de transaction de 30 satoshi par octet et une remise de 75 % sur les données des témoins :</p>
</div>
<dl>
<dt>Sans témoin séparé</dt>
<dd>
<p>Frais de transaction A : 28 590 satoshi</p>
<p>Frais de transaction B : 20 760 satoshi</p>
</dd>

<dt>Avec témoin séparé</dt>
<dd>
<p>Frais de transaction A : 12 255 satoshi</p>
<p>Frais de transaction B : 10 425 satoshi</p>
</dd>
</dl>
<div class="paragraph data-line-1067">
<p>Les deux transactions sont moins coûteuses lorsque le témoin séparé est mis en œuvre. En comparant les coûts entre les deux transactions, nous voyons qu&#8217;avant le témoin séparé, la transaction avec le Net-new-UTXO positif permet de réaliser d&#8217;importantes économies. Avec le témoin séparé, la différence de coût diminue considérablement en termes absolus et relatifs. Bien qu&#8217;il faudrait que les intrants deviennent moins chers que les extrants pour inciter à la consolidation de l&#8217;ensemble UTXO, cette remise réduit l&#8217;incitation à créer de nouveaux UTXO afin d&#8217;éviter d&#8217;utiliser plus d&#8217;intrants.</p>
</div>
<div class="paragraph data-line-21">
<p>Le témoin séparé a donc deux effets principaux sur les frais payés par les utilisateurs de bitcoin. Premièrement, segwit réduit le coût global des transactions en actualisant les données des témoins et en augmentant la capacité de la chaîne de blocs Bitcoin. Deuxièmement, la remise de segwit sur les données des témoins atténue partiellement un désalignement des incitations qui peut avoir créé par inadvertance plus de ballonnement dans l&#8217;ensemble UTXO.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="bitcoin_network_ch08">Le réseau Bitcoin</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-4">
<h3 id="_architecture_du_réseau_pair_à_pair">Architecture du réseau pair à pair</h3>
<div class="paragraph data-line-6">
<p>Bitcoin est structuré comme une architecture de réseau pair à pair au-dessus de l&#8217;Internet. Le terme pair à pair, ou P2P, signifie que les ordinateurs qui participent au réseau sont des pairs les uns des autres, qu&#8217;ils sont tous égaux, qu&#8217;il n&#8217;y a pas de nœuds "spéciaux" et que tous les nœuds partagent la charge de fournir services réseau. Les nœuds du réseau s&#8217;interconnectent dans un réseau maillé avec une topologie "plate". Il n&#8217;y a pas de serveur, pas de service centralisé et pas de hiérarchie au sein du réseau. Les nœuds d&#8217;un réseau P2P fournissent et consomment des services en même temps, la réciprocité agissant comme une incitation à la participation. Les réseaux P2P sont intrinsèquement résilients, décentralisés et ouverts. Un exemple prééminent d&#8217;une architecture de réseau P2P était le début d&#8217;Internet lui-même, où les nœuds du réseau IP étaient égaux. L&#8217;architecture Internet d&#8217;aujourd&#8217;hui est plus hiérarchique, mais le protocole Internet conserve toujours son essence de topologie plate. Au-delà du bitcoin, l&#8217;application la plus importante et la plus réussie des technologies P2P est le partage de fichiers, avec Napster comme pionnier et BitTorrent comme l&#8217;évolution la plus récente de l&#8217;architecture.</p>
</div>
<div class="paragraph data-line-8">
<p>L&#8217;architecture du réseau P2P de Bitcoin est bien plus qu&#8217;un choix de topologie. Bitcoin est un système de paiement numérique P2P de par sa conception, et l&#8217;architecture du réseau est à la fois le reflet et le fondement de cette caractéristique essentielle. La décentralisation du contrôle est un principe de conception de base qui ne peut être atteint et maintenu que par un réseau consensuel P2P plat et décentralisé.</p>
</div>
<div class="paragraph data-line-10">
<p>Le terme "réseau Bitcoin" fait référence à l&#8217;ensemble de nœuds exécutant le protocole bitcoin P2P. En plus du protocole bitcoin P2P, il existe d&#8217;autres protocoles tels que Stratum qui sont utilisés pour le minage et les portefeuilles légers ou mobiles. Ces protocoles supplémentaires sont fournis par des serveurs de routage de passerelle qui accèdent au réseau Bitcoin à l&#8217;aide du protocole bitcoin P2P, puis étendent ce réseau aux nœuds exécutant d&#8217;autres protocoles. Par exemple, les serveurs Stratum connectent les nœuds de minage Stratum via le protocole Stratum au réseau Bitcoin principal et relient le protocole Stratum au protocole bitcoin P2P. Nous utilisons le terme « réseau Bitcoin étendu » pour désigner le réseau global qui comprend le protocole Bitcoin P2P, les protocoles de minage de groupe, le protocole Stratum et tout autre protocole connexe reliant les composants du système Bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-12">
<h3 id="_types_de_nœuds_et_rôles">Types de nœuds et rôles</h3>
<div class="paragraph data-line-14">
<p>Bien que les nœuds dans le bitcoin Les réseaux P2P sont égaux, ils peuvent jouer différents rôles en fonction de la fonctionnalité qu&#8217;ils prennent en charge. Un nœud Bitcoin est un ensemble de fonctions : le routage, la base de données chaîne de blocs, le minage et les services de portefeuille. Un nœud complet avec ces quatre fonctions est affiché dans <a href="#full_node_reference">Un nœud de réseau Bitcoin avec les quatre fonctions : portefeuille, mineur, base de données chaîne de blocs complète et routage réseau</a>.</p>
</div>
<div id="full_node_reference" class="imageblock smallerfifty data-line-19">
<div class="content">
<img src="images/mbc2_0801.png" alt="Référence de nœud client complet">
</div>
<div class="title">Figure 46. Un nœud de réseau Bitcoin avec les quatre fonctions : portefeuille, mineur, base de données chaîne de blocs complète et routage réseau</div>
</div>
<div class="paragraph data-line-21">
<p>Tous les nœuds incluent la fonction de routage pour participer au réseau et peuvent inclure d&#8217;autres fonctionnalités. Tous les nœuds valident et propagent les transactions et les blocs, et découvrent et maintiennent les connexions aux pairs. Dans l&#8217;exemple de nœud complet dans <a href="#full_node_reference">Un nœud de réseau Bitcoin avec les quatre fonctions : portefeuille, mineur, base de données chaîne de blocs complète et routage réseau</a>, la fonction de routage est indiquée par un cercle nommé "Network Routing Node" ou par la lettre "N".</p>
</div>
<div class="paragraph data-line-23">
<p>Certains nœuds, appelés nœuds complets, conservent également une copie complète et à jour de la chaîne de blocs. Les nœuds complets peuvent vérifier de manière autonome et autoritaire toute transaction sans référence externe. Certains nœuds ne conservent qu&#8217;un sous-ensemble de la chaîne de blocs et vérifient les transactions à l&#8217;aide d&#8217;une méthode appelée <em>simplified-payment-verification</em>, ou SPV. Ces nœuds sont appelés nœuds SPV ou nœuds légers. Dans l&#8217;exemple de nœud complet de la figure, la fonction de base de données chaîne de blocs de nœud complet est indiquée par un cercle appelé "Full Blockchain" ou la lettre "B". Dans <a href="#bitcoin_network">Le réseau Bitcoin étendu montrant divers types de nœuds, passerelles et protocoles</a>, les nœuds SPV sont dessinés sans le cercle "B", montrant qu&#8217;ils n&#8217;ont pas une copie complète de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-25">
<p> Les nœuds de minage se font concurrence pour créer de nouveaux blocs en exécutant du matériel spécialisé pour résoudre l&#8217;algorithme de preuve de travail. Certains nœuds de minage sont également des nœuds complets, conservant une copie complète de la chaîne de blocs, tandis que d&#8217;autres sont des nœuds légers participant au minage de groupe et dépendant d&#8217;un serveur de groupe pour maintenir un nœud complet. La fonction d&#8217;exploration de données est affichée dans le nœud complet sous la forme d&#8217;un cercle appelé "Miner" ou de la lettre "M".</p>
</div>
<div class="paragraph data-line-27">
<p>Les portefeuilles d&#8217;utilisateurs peuvent faire partie d&#8217;un nœud complet, comme c&#8217;est généralement le cas avec les clients Bitcoin de bureau. De plus en plus, de nombreux portefeuilles d&#8217;utilisateurs, en particulier ceux fonctionnant sur des appareils à ressources limitées tels que les smartphones, sont des nœuds SPV. La fonction de portefeuille est affichée dans <a href="#full_node_reference">Un nœud de réseau Bitcoin avec les quatre fonctions : portefeuille, mineur, base de données chaîne de blocs complète et routage réseau</a> comme un cercle appelé "Wallet" ou la lettre "W."</p>
</div>
<div class="paragraph data-line-29">
<p>En plus des principaux types de nœuds sur le protocole bitcoin P2P, il existe des serveurs et des nœuds exécutant d&#8217;autres protocoles, tels que des protocoles de groupe de minage spécialisés et des protocoles d&#8217;accès client légers.</p>
</div>
<div class="paragraph data-line-31">
<p><a href="#node_type_ledgend">Différents types de nœuds sur le réseau Bitcoin étendu</a> montre les types de nœuds les plus courants sur le réseau Bitcoin étendu.</p>
</div>
</div>
<div class="sect2 data-line-33">
<h3 id="_le_réseau_bitcoin_étendu">Le réseau Bitcoin étendu</h3>
<div class="paragraph data-line-35">
<p>Le principal réseau Bitcoin, en cours d&#8217;exécution le protocole bitcoin P2P, se compose de 5 000 à 8 000 nœuds d&#8217;écoute exécutant différentes versions du client de référence bitcoin (Bitcoin Core) et de quelques centaines de nœuds exécutant diverses autres implémentations du protocole bitcoin P2P, telles que Bitcoin Classic, Bitcoin Unlimited, BitcoinJ, Libbitcoin, btcd et bcoin. Un petit pourcentage des nœuds du réseau bitcoin P2P sont également des nœuds de minage, en concurrence dans le processus de minage, en validant les transactions et en créant de nouveaux blocs. Diverses grandes entreprises s&#8217;interfacent avec le réseau Bitcoin en exécutant des clients à nœud complet basés sur le client Bitcoin Core, avec des copies complètes de la chaîne de blocs et un nœud de réseau, mais sans fonctions de minage ou de portefeuille. Ces nœuds agissent comme des routeurs de périphérie de réseau, permettant à divers autres services (échanges, portefeuilles, explorateurs de blocs, traitement des paiements marchands) d&#8217;être construits par-dessus.</p>
</div>
<div class="paragraph data-line-37">
<p>Le réseau Bitcoin étendu comprend le réseau exécutant le protocole bitcoin P2P, décrit précédemment, ainsi que des nœuds exécutant des protocoles spécialisés. Un certain nombre de serveurs de groupe et de passerelles de protocole qui connectent des nœuds exécutant d&#8217;autres protocoles sont attachés au réseau principal bitcoin P2P. Ces autres nœuds de protocole sont principalement des nœuds de minage de groupe (voir <a href="#mining">Minage et Consensus</a>) et les clients de portefeuille légers, qui ne portent pas une copie complète de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-39">
<p><a href="#bitcoin_network">Le réseau Bitcoin étendu montrant divers types de nœuds, passerelles et protocoles</a> montre le réseau Bitcoin étendu avec les différents types de nœuds, serveurs de passerelle, routeurs de périphérie et clients de portefeuille et les différents protocoles qu&#8217;ils utilisent pour se connecter les uns aux autres.</p>
</div>
<div id="node_type_ledgend" class="imageblock data-line-43">
<div class="content">
<img src="images/mbc2_0802.png" alt="Types de nœuds Bitcoin">
</div>
<div class="title">Figure 47. Différents types de nœuds sur le réseau Bitcoin étendu</div>
</div>
<div id="bitcoin_network" class="imageblock data-line-47">
<div class="content">
<img src="images/mbc2_0803.png" alt="Réseau Bitcoin">
</div>
<div class="title">Figure 48. Le réseau Bitcoin étendu montrant divers types de nœuds, passerelles et protocoles</div>
</div>
</div>
<div class="sect2 data-line-49">
<h3 id="_réseaux_relais_bitcoin">Réseaux relais Bitcoin</h3>
<div class="paragraph data-line-51">
<p>Alors que le réseau bitcoin P2P répond aux besoins généraux d&#8217;une grande variété de types de nœuds, il présente une latence de réseau trop élevée pour les besoins spécialisés des nœuds de minage de bitcoins.</p>
</div>
<div class="paragraph data-line-53">
<p>Les mineurs de Bitcoin sont engagés dans une compétition urgente pour résoudre le problème de la preuve de travail et étendre la chaîne de blocs (voir <a href="#mining">Minage et Consensus</a>). Tout en participant à cette compétition, les mineurs de bitcoins doivent minimiser le temps entre la propagation d&#8217;un bloc gagnant et le début du prochain tour de compétition. Dans le secteur minier, la latence du réseau est directement liée aux marges bénéficiaires.</p>
</div>
<div class="paragraph data-line-55">
<p>Un <em>Bitcoin Relay Network</em> ou (réseau de relais Bitcoin) est un réseau qui tente de minimiser la latence dans la transmission des blocs entre les mineurs. Le <a href="https://www.bitcoinrelaynetwork.org" class="undefined" data-href="https://www.bitcoinrelaynetwork.org">https://www.bitcoinrelaynetwork.org</a> [Bitcoin Relay Network] original a été créé par le développeur principal Matt Corallo en 2015 pour permettre une synchronisation rapide des blocs entre les mineurs avec une latence très faible. Le réseau se composait de plusieurs nœuds spécialisés hébergés sur l&#8217;infrastructure Amazon Web Services à travers le monde et servait à connecter la majorité des mineurs et des pools de minage.</p>
</div>
<div class="paragraph data-line-57">
<p>Le réseau de relais Bitcoin d&#8217;origine a été remplacé en 2016 par l&#8217;introduction du <em>Fast Internet Bitcoin Relay Engine</em> ou https:/ /bitcoinfibre.org[<em>FIBRE</em>], également créé par le développeur principal Matt Corallo. FIBRE est un réseau de relais basé sur UDP qui relaie les blocs au sein d&#8217;un réseau de nœuds. FIBRE met en œuvre l&#8217;optimisation <em>bloc compact</em> pour réduire davantage la quantité de données transmises et la latence du réseau.</p>
</div>
<div class="paragraph data-line-59">
<p>Les réseaux de relais ne remplacent pas le réseau P2P de Bitcoin. Au lieu de cela, ce sont des réseaux superposés qui fournissent une connectivité supplémentaire entre les nœuds ayant des besoins spécialisés. Comme les autoroutes ne remplacent pas les routes rurales, mais plutôt des raccourcis entre deux points à fort trafic, vous avez toujours besoin de petites routes pour vous connecter aux autoroutes.</p>
</div>
</div>
<div class="sect2 data-line-61">
<h3 id="_découverte_du_réseau">Découverte du réseau</h3>
<div class="paragraph data-line-63">
<p>Lorsqu&#8217;un nouveau nœud démarre, il doit découvrir d&#8217;autres nœuds Bitcoin sur le réseau afin de participer. Pour démarrer ce processus, un nouveau nœud doit découvrir au moins un nœud existant sur le réseau et s&#8217;y connecter. L&#8217;emplacement géographique des autres nœuds n&#8217;est pas pertinent ; la topologie du réseau Bitcoin n&#8217;est pas définie géographiquement. Par conséquent, tous les nœuds Bitcoin existants peuvent être sélectionnés au hasard.</p>
</div>
<div class="paragraph data-line-65">
<p>Pour se connecter à un pair connu, les nœuds établissent une connexion TCP, généralement au port 8333 (le port généralement connu comme celui utilisé par bitcoin), ou un autre port s&#8217;il en existe un. Lors de l&#8217;établissement d&#8217;une connexion, le nœud commencera une "prise de contact" (voir <a href="#network_handshake">La poignée de main initiale entre pairs</a>) en transmettant un message <code>version</code>, qui contient des informations d&#8217;identification de base, notamment :</p>
</div>
<div class="dlist data-line-67">
<dl>
<dt class="hdlist1"><code>nVersion</code></dt>
<dd>
<p>La version du protocole bitcoin P2P que le client "parle" (par exemple, 70002)</p>
</dd>
<dt class="hdlist1"><code>nLocalServices</code></dt>
<dd>
<p>Une liste des services locaux pris en charge par le nœud, actuellement uniquement <code>NODE_NETWORK</code></p>
</dd>
<dt class="hdlist1"><code>nTime</code></dt>
<dd>
<p>L&#8217;heure actuelle</p>
</dd>
<dt class="hdlist1"><code>addrYou</code></dt>
<dd>
<p>L&#8217;adresse IP du nœud distant vue depuis ce nœud</p>
</dd>
<dt class="hdlist1"><code>addrMe</code></dt>
<dd>
<p>L&#8217;adresse IP du nœud local, telle que découverte par le nœud local</p>
</dd>
<dt class="hdlist1"><code>subver</code></dt>
<dd>
<p>Une sous-version indiquant le type de logiciel exécuté sur ce nœud (par exemple, <span class="keep-together"><code>/Satoshi:0.9.2.1/</code></span>)</p>
</dd>
<dt class="hdlist1"><code>BestHeight</code></dt>
<dd>
<p>La hauteur de bloc de la chaîne de blocs de ce nœud</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-75">
<p>(Voir <a href="https://bit.ly/1qlsC7w" data-href="https://bit.ly/1qlsC7w">GitHub</a> pour un exemple du message de <code>version</code> du réseau.)</p>
</div>
<div class="paragraph data-line-77">
<p>Le message <code>version</code> est toujours le premier message envoyé par un pair à un autre pair. L&#8217;homologue local recevant un message <code>version</code> examinera la <code>nVersion</code> signalée par l&#8217;homologue distant et décidera si l&#8217;homologue distant est compatible. Si le pair distant est compatible, le pair local accusera réception du message <code>version</code> et établira une connexion en envoyant un message <code>verack</code>.</p>
</div>
<div class="paragraph data-line-79">
<p>Comment un nouveau nœud trouve-t-il des pairs ? La première méthode consiste à interroger les DNS à l&#8217;aide d&#8217;un certain nombre de d'"indexes DNS", qui sont des serveurs DNS fournissant une liste d&#8217;adresses IP de nœuds Bitcoin. Certaines de ces indexes DNS fournissent une liste statique d&#8217;adresses IP de nœuds d&#8217;écoute bitcoin stables. Certaines des indexes DNS sont des implémentations personnalisées de BIND (Berkeley Internet Name Daemon) qui renvoient un sous-ensemble aléatoire à partir d&#8217;une liste d&#8217;adresses de nœuds Bitcoin collectées par un robot ou un nœud Bitcoin de longue durée. Le client Bitcoin Core contient les noms de neuf sources DNS différentes. La diversité de propriété et la diversité de mise en œuvre des différentes sources DNS offrent un haut niveau de fiabilité pour le processus d&#8217;amorçage initial. Dans le client Bitcoin Core, l&#8217;option d&#8217;utilisation des indexes DNS est contrôlée par le commutateur d&#8217;option <code>-dnsseed</code> (réglé sur 1 par défaut, pour utiliser la source DNS).</p>
</div>
<div class="paragraph data-line-81">
<p>Alternativement, un nœud d&#8217;amorçage qui ne sait rien du réseau doit recevoir l&#8217;adresse IP d&#8217;au moins un nœud Bitcoin, après quoi il peut établir des connexions via d&#8217;autres introductions. L&#8217;argument de ligne de commande <code>-seednode</code> peut être utilisé pour se connecter à un nœud uniquement pour les introductions en l&#8217;utilisant comme source. Une fois que le nœud de départ initial a été utilisé pour former des présentations, le client s&#8217;en déconnecte et utilise les pairs nouvellement découverts.</p>
</div>
<div id="network_handshake" class="imageblock data-line-85">
<div class="content">
<img src="images/mbc2_0804.png" alt="Prise de contact réseau">
</div>
<div class="title">Figure 49. La poignée de main initiale entre pairs</div>
</div>
<div class="paragraph data-line-87">
<p>Une fois qu&#8217;une ou plusieurs connexions sont établies, le nouveau nœud enverra un message <code>addr</code> contenant sa propre adresse IP à ses voisins. Les voisins transmettront à leur tour le message <code>addr</code> à leurs voisins, garantissant que le nœud nouvellement connecté devient bien connu et mieux connecté. De plus, le nœud nouvellement connecté peut envoyer <code>getaddr</code> aux voisins, leur demandant de renvoyer une liste d&#8217;adresses IP d&#8217;autres pairs. De cette façon, un nœud peut trouver des pairs auxquels se connecter et annoncer son existence sur le réseau pour que d&#8217;autres nœuds le trouvent. <a href="#address_propagation">Propagation et découverte d&#8217;adresses</a>  montre le protocole de découverte d&#8217;adresse.</p>
</div>
<div id="address_propagation" class="imageblock data-line-92">
<div class="content">
<img src="images/mbc2_0805.png" alt="Propagation d&#8217;adresse">
</div>
<div class="title">Figure 50. Propagation et découverte d&#8217;adresses</div>
</div>
<div class="paragraph data-line-94">
<p>Un nœud doit se connecter à quelques pairs différents afin d&#8217;établir divers chemins dans le réseau Bitcoin. Les chemins ne sont pas persistants, les nœuds vont et viennent, et le nœud doit donc continuer à découvrir de nouveaux nœuds à mesure qu&#8217;il perd d&#8217;anciennes connexions et à aider les autres nœuds lors de leur démarrage. Une seule connexion est nécessaire pour démarrer, car le premier nœud peut proposer des introductions à ses nœuds pairs et ces pairs peuvent proposer d&#8217;autres introductions. Il est également inutile et gaspilleur de se connecter à plus d&#8217;une poignée de nœuds. Après le démarrage, un nœud se souviendra de ses dernières connexions homologues réussies, de sorte que s&#8217;il est redémarré, il peut rapidement rétablir les connexions avec son ancien réseau homologue. Si aucun des anciens pairs ne répond à sa demande de connexion, le nœud peut utiliser les nœuds de départ pour redémarrer.</p>
</div>
<div class="paragraph data-line-96">
<p>Sur un nœud exécutant le client Bitcoin Core, vous pouvez lister les connexions homologues avec la commande <code>getpeerinfo</code> :</p>
</div>
<div class="listingblock data-line-99">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getpeerinfo</code></pre>
</div>
</div>
<div class="listingblock data-line-103">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
    {
        "addr" : "85.213.199.39:8333",
        "services" : "00000001",
        "lastsend" : 1405634126,
        "lastrecv" : 1405634127,
        "bytessent" : 23487651,
        "bytesrecv" : 138679099,
        "conntime" : 1405021768,
        "pingtime" : 0.00000000,
        "version" : 70002,
        "subver" : "/Satoshi:0.9.2.1/",
        "inbound" : false,
        "startingheight" : 310131,
        "banscore" : 0,
        "syncnode" : true
    },
    {
        "addr" : "58.23.244.20:8333",
        "services" : "00000001",
        "lastsend" : 1405634127,
        "lastrecv" : 1405634124,
        "bytessent" : 4460918,
        "bytesrecv" : 8903575,
        "conntime" : 1405559628,
        "pingtime" : 0.00000000,
        "version" : 70001,
        "subver" : "/Satoshi:0.8.6/",
        "inbound" : false,
        "startingheight" : 311074,
        "banscore" : 0,
        "syncnode" : false
    }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-140">
<p>Pour outrepasser la gestion automatique des pairs et spécifier une liste d&#8217;adresses IP, les utilisateurs peuvent fournir l&#8217;option <code>-connect=&lt;IPAddress&gt;</code> et spécifiez une ou plusieurs adresses IP. Si cette option est utilisée, le nœud se connectera uniquement aux adresses IP sélectionnées, au lieu de découvrir et de maintenir automatiquement les connexions homologues.</p>
</div>
<div class="paragraph data-line-142">
<p>S&#8217;il n&#8217;y a pas de trafic sur une connexion, les nœuds enverront périodiquement un message pour maintenir la connexion. Si un nœud n&#8217;a pas communiqué sur une connexion pendant plus de 90 minutes, il est supposé être déconnecté et un nouveau pair sera recherché. Ainsi, le réseau s&#8217;adapte dynamiquement aux nœuds transitoires et aux problèmes de réseau, et peut croître et rétrécir de manière organique selon les besoins sans aucun contrôle central.</p>
</div>
</div>
<div class="sect2 data-line-144">
<h3 id="_nœuds_complets">Nœuds complets</h3>
<div class="paragraph data-line-146">
<p>Les nœuds complets sont des nœuds qui maintiennent une chaîne de blocs complète avec toutes les transactions. Plus précisément, ils devraient probablement être appelés "nœuds de chaîne de blocs complets". Dans les premières années de bitcoin, tous les nœuds étaient des nœuds complets et actuellement, le client Bitcoin Core est un nœud de chaîne de blocs complet. Au cours des deux dernières années, cependant, de nouvelles formes de clients Bitcoin ont été introduites qui ne maintiennent pas une chaîne de blocs complète mais fonctionnent comme des clients légers. Nous les examinerons plus en détail dans la section suivante.</p>
</div>
<div class="paragraph data-line-148">
<p>Les nœuds de chaîne de blocs complets maintiennent un copie à jour de la chaîne de blocs Bitcoin avec toutes les transactions, qu&#8217;ils construisent et vérifient indépendamment, en commençant par le tout premier bloc (bloc de genèse) et en remontant jusqu&#8217;au dernier bloc connu du réseau. Un nœud de chaîne de blocs complet peut vérifier de manière indépendante et autoritaire toute transaction sans recours à aucun autre nœud ou source d&#8217;informations. Le nœud de la chaîne de blocs complète s&#8217;appuie sur le réseau pour recevoir des mises à jour sur les nouveaux blocs de transactions, qu&#8217;il vérifie ensuite et intègre dans sa copie locale de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-150">
<p>L&#8217;exécution d&#8217;un nœud de chaîne de blocs complet vous offre l&#8217;expérience bitcoin pure : une vérification indépendante de toutes les transactions sans avoir besoin de s&#8217;appuyer sur, ou de faire confiance, à d&#8217;autres systèmes. Il est facile de savoir si vous exécutez un nœud complet car il nécessite plus de cent gigaoctets de stockage persistant (espace disque) pour stocker la chaîne de blocs complète. Si vous avez besoin de beaucoup de disque et que la synchronisation avec le réseau prend deux à trois jours, vous exécutez un nœud complet. C&#8217;est le prix d&#8217;une indépendance totale et de la liberté vis-à-vis de l&#8217;autorité centrale.</p>
</div>
<div class="paragraph data-line-152">
<p>Il existe quelques implémentations alternatives de clients Bitcoin à chaîne complète, construites à l&#8217;aide de différents langages de programmation et architectures logicielles. Cependant, l&#8217;implémentation la plus courante est le client de référence Bitcoin Core, également connu sous le nom de client Satoshi. Plus de 75 % des nœuds du réseau Bitcoin exécutent différentes versions de Bitcoin Core. Il est identifié comme « Satoshi » dans la chaîne de sous-version envoyée dans le message <code>version</code> et affiché par la commande <code>getpeerinfo</code> comme nous l&#8217;avons vu précédemment ; par exemple, <code>/Satoshi:0.8.6/</code>.</p>
</div>
</div>
<div class="sect2 data-line-154">
<h3 id="_échanger_linventaire">Échanger "l&#8217;inventaire"</h3>
<div class="paragraph data-line-156">
<p>La première chose qu&#8217;un nœud complet fera une fois qu&#8217;il se connecte à des pairs est d&#8217;essayer de construire une chaîne de blocs complète. S&#8217;il s&#8217;agit d&#8217;un tout nouveau nœud et qu&#8217;il n&#8217;a aucune chaîne de blocs, il ne connaît qu&#8217;un seul bloc, le bloc de genèse, qui est intégré de manière statique dans le logiciel client. En commençant par le bloc #0 (le bloc de genèse), le nouveau nœud devra télécharger des centaines de milliers de blocs pour se synchroniser avec le réseau et rétablir la chaîne de blocs complète.</p>
</div>
<div class="paragraph data-line-158">
<p>Le processus de synchronisation de la chaîne de blocs commence par le message <code>version</code>, car il contient <code>BestHeight</code>, l&#8217;hauteur actuelle d&#8217;un nœud (nombre de blocs) de la chaîne de blocs. Un nœud verra les messages <code>version</code> de ses pairs, saura combien de blocs ils ont chacun et pourra comparer avec le nombre de blocs qu&#8217;il a dans sa propre chaîne de blocs. Les nœuds appairés échangeront un message <code>getblocks</code> contenant le hachage (empreinte digitale) du bloc supérieur sur leur chaîne de blocs locale. L&#8217;un des pairs pourra identifier le résultat d&#8217;hachage reçu comme appartenant à un bloc qui n&#8217;est pas au sommet, mais appartient plutôt à un bloc plus ancien, en déduisant ainsi que sa propre chaîne de blocs locale est plus longue que celle de son pair.</p>
</div>
<div class="paragraph data-line-160">
<p>Le pair qui a la chaîne de blocs la plus longue a plus de blocs que l&#8217;autre nœud et peut identifier les blocs dont l&#8217;autre nœud a besoin pour "rattraper son retard". Il identifiera les 500 premiers blocs à partager et transmettra leurs hachages à l&#8217;aide d&#8217;un message <code>inv</code> (inventaire). Le nœud manquant ces blocs les récupérera ensuite, en émettant une série de messages <code>getdata</code> demandant les données complètes du bloc et en identifiant les blocs demandés à l&#8217;aide des hachages du message <code>inv</code>.</p>
</div>
<div class="paragraph data-line-162">
<p>Supposons, par exemple, qu&#8217;un nœud n&#8217;ait que le bloc de genèse. Il recevra alors un message <code>inv</code> de ses pairs contenant les hachages des 500 prochains blocs de la chaîne. Il commencera à demander des blocs à tous ses pairs connectés, répartissant la charge et s&#8217;assurant qu&#8217;il ne submerge aucun pair de demandes. Le nœud garde une trace du nombre de blocs "en transit" par connexion homologue, c&#8217;est-à-dire des blocs qu&#8217;il a demandés mais non reçus, en vérifiant qu&#8217;il ne dépasse pas une limite (<code>MAX_BLOCKS_IN_TRANSIT_PER_PEER</code>). De cette façon, s&#8217;il a besoin de beaucoup de blocs, il n&#8217;en demandera de nouveaux que lorsque les demandes précédentes seront satisfaites, permettant aux pairs de contrôler le rythme des mises à jour et de ne pas submerger le réseau. Au fur et à mesure que chaque bloc est reçu, il est ajouté à la chaîne de blocs, comme nous le verrons dans <a href="#blockchain">La chaîne de blocs (La blockchain)</a>. Au fur et à mesure que la chaîne de blocs locale se construit, davantage de blocs sont demandés et reçus, et le processus se poursuit jusqu&#8217;à ce que le nœud rattrape le reste du réseau.</p>
</div>
<div class="paragraph data-line-164">
<p>Ce processus de comparaison de la chaîne de blocs locale avec les pairs et de récupération des blocs manquants se produit chaque fois qu&#8217;un nœud se déconnecte pendant une période donnée. Qu&#8217;un nœud soit hors ligne depuis quelques minutes et qu&#8217;il manque quelques blocs, ou un mois et qu&#8217;il manque quelques milliers de blocs, il commence par envoyer <code>getblocks</code>, reçoit une réponse <code>inv</code> et commence à télécharger les blocs manquants. <a href="#inventory_synchronization">Nœud synchronisant la chaîne de blocs en récupérant les blocs d&#8217;un pair</a> affiche l&#8217;inventaire et le protocole de propagation des blocs.</p>
</div>
<div id="inventory_synchronization" class="imageblock smallerfifty data-line-169">
<div class="content">
<img src="images/mbc2_0806.png" alt="Synchronisation de l&#8217;inventaire">
</div>
<div class="title">Figure 51. Nœud synchronisant la chaîne de blocs en récupérant les blocs d&#8217;un pair</div>
</div>
</div>
<div class="sect2 data-line-172">
<h3 id="spv_nodes">Nœuds de vérification simplifiée des paiements, ou Simplified Payment Verification (SPV)</h3>
<div class="paragraph data-line-174">
<p>Tous les nœuds n&#8217;ont pas la capacité de stocker la chaîne de blocs complète. De nombreux clients Bitcoin sont conçus pour fonctionner sur des appareils à espace et puissance limités, tels que les smartphones, les tablettes ou les systèmes embarqués. Pour ces appareils, une méthode de <em>vérification de paiement simplifiée</em> (SPV) est utilisée pour leur permettre de fonctionner sans stocker la chaîne de blocs complète. Ces types de clients sont appelés clients SPV ou clients légers. À mesure que l&#8217;adoption du bitcoin augmente, le nœud SPV devient la forme la plus courante de nœud Bitcoin, en particulier pour les portefeuilles bitcoin.</p>
</div>
<div class="paragraph data-line-176">
<p>Les nœuds SPV téléchargent uniquement les en-têtes de bloc et ne téléchargent pas les transactions incluses dans chaque bloc. La chaîne de blocs qui en résulte, sans transactions, est 1 000 fois plus petite que la chaîne de blocs complète. Les nœuds SPV ne peuvent pas construire une image complète de tous les UTXO disponibles pour les dépenses car ils ne connaissent pas toutes les transactions sur le réseau. Les nœuds SPV vérifient les transactions en utilisant une méthode légèrement différente qui s&#8217;appuie sur des pairs pour fournir des vues partielles des parties pertinentes de la chaîne de blocs à la demande.</p>
</div>
<div class="paragraph data-line-178">
<p>Par analogie, un nœud complet est comme un touriste dans une ville étrange, équipé d&#8217;une carte détaillée de chaque rue et de chaque adresse. En comparaison, un nœud SPV est comme un touriste dans une ville étrange demandant à des inconnus au hasard des indications détaillées tout en ne connaissant qu&#8217;une seule avenue principale. Bien que les deux touristes puissent vérifier l&#8217;existence d&#8217;une rue en la visitant, le touriste sans carte ne sait pas ce qui se trouve dans les rues latérales et ne sait pas quelles autres rues existent. Positionné en face du 23 Church Street, le touriste sans carte ne peut pas savoir s&#8217;il existe une dizaine d&#8217;autres adresses « 23 Church Street » dans la ville et si celle-ci est la bonne. La meilleure chance pour le touriste sans carte est de demander à suffisamment de gens et d&#8217;espérer que certains d&#8217;entre eux n&#8217;essaient pas de l&#8217;agresser.</p>
</div>
<div class="paragraph data-line-180">
<p>SPV vérifie les transactions en se référant à leur <em>profondeur</em> dans la chaîne de blocs au lieu de leur <em>hauteur</em>. Alors qu&#8217;un nœud de chaîne de blocs complet construira une chaîne entièrement vérifiée de milliers de blocs et de transactions descendant dans la chaîne de blocs (remontant dans le temps) jusqu&#8217;au bloc de genèse, un nœud SPV vérifiera la chaîne de tous les blocs (mais pas toutes les transactions) et lier cette chaîne à la transaction d&#8217;intérêt.</p>
</div>
<div class="paragraph data-line-182">
<p>Par exemple, lors de l&#8217;examen d&#8217;une transaction dans le bloc 300 000, un nœud complet relie les 300 000 blocs au bloc de genèse et crée une base de données complète d&#8217;UTXO, établissant la validité de la transaction en confirmant que l&#8217;UTXO reste non dépensé. Un nœud SPV ne peut pas valider si l&#8217;UTXO n&#8217;est pas dépensé. Au lieu de cela, le nœud SPV établira un lien entre la transaction et le bloc qui la contient, en utilisant un <em>chemin de Merkle</em> (voir <a href="#merkle_trees">Arbres de Merkle</a>). Ensuite, le nœud SPV attend de voir les six blocs 300 001 à 300 006 empilés au-dessus du bloc contenant la transaction et le vérifie en établissant sa profondeur sous les blocs 300 006 à 300 001. Le fait que d&#8217;autres nœuds du réseau aient accepté le bloc 300 000 et aient ensuite effectué le travail nécessaire pour produire six autres blocs en plus est la preuve, par procuration, que la transaction n&#8217;était pas une double dépense.</p>
</div>
<div class="paragraph data-line-184">
<p>Un nœud SPV ne peut pas être persuadé qu&#8217;une transaction existe dans un bloc alors que la transaction n&#8217;existe pas en fait. Le nœud SPV établit l&#8217;existence d&#8217;une transaction dans un bloc en demandant une preuve de chemin Merkle et en validant la preuve de travail dans la chaîne de blocs. Cependant, l&#8217;existence d&#8217;une transaction peut être "masquée" à un nœud SPV. Un nœud SPV peut certainement prouver qu&#8217;une transaction existe mais ne peut pas vérifier qu&#8217;une transaction, telle qu&#8217;une double dépense du même UTXO, n&#8217;existe pas car il n&#8217;a pas d&#8217;enregistrement de toutes les transactions. Cette vulnérabilité peut être utilisée dans une attaque par déni de service ou pour une attaque à double dépense contre les nœuds SPV. Pour se défendre contre cela, un nœud SPV doit se connecter de manière aléatoire à plusieurs nœuds, pour augmenter la probabilité qu&#8217;il soit en contact avec au moins un nœud honnête. Ce besoin de se connecter de manière aléatoire signifie que les nœuds SPV sont également vulnérables aux attaques de partitionnement de réseau ou aux attaques Sybil, où ils sont connectés à de faux nœuds ou à de faux réseaux et n&#8217;ont pas accès à des nœuds honnêtes ou au vrai réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-186">
<p>Dans la plupart des cas pratiques, les nœuds SPV bien connectés sont suffisamment sécurisés, trouvant un équilibre entre les besoins en ressources, l&#8217;aspect pratique et la sécurité. Pour une sécurité infaillible, cependant, rien ne vaut l&#8217;exécution d&#8217;un nœud de chaîne de blocs complet.</p>
</div>
<div class="admonitionblock tip data-line-189">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-190">
<p>Un nœud de chaîne de blocs complet vérifie une transaction en vérifiant toute la chaîne de milliers de blocs en dessous afin de garantir que l&#8217;UTXO n&#8217;est pas dépensé, tandis qu&#8217;un nœud SPV vérifie à quelle profondeur le bloc est enterré par une poignée de blocs au-dessus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-193">
<p>Pour obtenir les en-têtes de bloc, les nœuds SPV utilisent un message <code>getheaders</code> au lieu de <code>getblocks</code>. L&#8217;homologue qui répond enverra jusqu&#8217;à 2 000 en-têtes de bloc à l&#8217;aide d&#8217;un seul message <code>headers</code>. Le processus est par ailleurs le même que celui utilisé par un nœud complet pour récupérer des blocs complets. Les nœuds SPV définissent également un filtre sur la connexion aux pairs, pour filtrer le flux des futurs blocs et transactions envoyés par les pairs. Toutes les transactions intéressantes sont récupérées à l&#8217;aide d&#8217;une requête <code>getdata</code>. Le pair génère un message <code>tx</code> contenant les transactions, en réponse. <a href="#spv_synchronization">Nœud SPV synchronisant les en-têtes de bloc</a> montre la synchronisation des en-têtes de bloc.</p>
</div>
<div class="paragraph data-line-195">
<p>Étant donné que les nœuds SPV doivent récupérer des transactions spécifiques afin de les vérifier de manière sélective, ils créent également un risque pour la confidentialité. Contrairement aux nœuds de chaîne de blocs complets, qui collectent toutes les transactions au sein de chaque bloc, les demandes de données spécifiques du nœud SPV peuvent révéler par inadvertance les adresses de leur portefeuille. Par exemple, un tiers surveillant un réseau pourrait suivre toutes les transactions demandées par un portefeuille sur un nœud SPV et les utiliser pour associer des adresses Bitcoin à l&#8217;utilisateur de ce portefeuille, détruisant ainsi la vie privée de l&#8217;utilisateur.</p>
</div>
<div id="spv_synchronization" class="imageblock data-line-199">
<div class="content">
<img src="images/mbc2_0807.png" alt="Synchronisation SPV">
</div>
<div class="title">Figure 52. Nœud SPV synchronisant les en-têtes de bloc</div>
</div>
<div class="paragraph data-line-201">
<p>Peu de temps après l&#8217;introduction des nœuds SPV/légers, les développeurs de bitcoins ont ajouté une fonctionnalité appelée <em>filtres de Bloom</em> pour faire face aux risques de confidentialité des nœuds SPV. Les filtres de Bloom permettent aux nœuds SPV de recevoir un sous-ensemble des transactions sans révéler précisément les adresses qui les intéressent, grâce à un mécanisme de filtrage qui utilise des probabilités plutôt que des modèles fixes.</p>
</div>
</div>
<div class="sect2 data-line-204">
<h3 id="bloom_filters">Filtres de Bloom</h3>
<div class="paragraph data-line-206">
<p>Un filtre de Bloom est un filtre de recherche probabiliste qui offre un moyen efficace d&#8217;exprimer un modèle de recherche tout en protégeant la confidentialité. Ils sont utilisés par les nœuds SPV pour demander à leurs pairs des transactions correspondant à un modèle spécifique, sans révéler exactement quelles adresses, clés ou transactions ils recherchent.</p>
</div>
<div class="paragraph data-line-208">
<p>Dans notre analogie précédente, un touriste sans carte demande son chemin vers une adresse spécifique, "23 Church St." Si elle demande à des inconnus son chemin vers cette rue, elle révèle par inadvertance sa destination. Un filtre de Bloom revient à demander : "Y a-t-il des rues dans ce quartier dont le nom se termine par RCH ?" Une question comme celle-là en dit un peu moins sur la destination souhaitée que de demander "23 Church St." En utilisant cette technique, un touriste pourrait spécifier l&#8217;adresse souhaitée plus en détail comme "se terminant par URCH" ou moins en détail comme "se terminant par H". En faisant varier la précision de la recherche, le touriste révèle plus ou moins d&#8217;informations, au détriment d&#8217;obtenir des résultats plus ou moins précis. Si elle demande un modèle moins spécifique, elle obtient beaucoup plus d&#8217;adresses possibles et une meilleure confidentialité, mais de nombreux résultats ne sont pas pertinents. Si elle demande un modèle très spécifique, elle obtient moins de résultats mais perd sa confidentialité.</p>
</div>
<div class="paragraph data-line-210">
<p>Les filtres de Bloom remplissent cette fonction en permettant à un nœud SPV de spécifier un modèle de recherche pour les transactions qui peuvent être réglés vers la précision ou la confidentialité. Un filtre de Bloom plus spécifique produira des résultats précis, mais au détriment de la révélation des modèles qui intéressent le nœud SPV, révélant ainsi les adresses détenues par le portefeuille de l&#8217;utilisateur. Un filtre bloom moins spécifique produira plus de données sur plus de transactions, dont beaucoup ne sont pas pertinentes pour le nœud, mais permettra au nœud de maintenir une meilleure confidentialité.</p>
</div>
<div class="sect3 data-line-212">
<h4 id="_comment_fonctionnent_les_filtres_de_bloom">Comment fonctionnent les filtres de Bloom</h4>
<div class="paragraph data-line-214">
<p>Les filtres de Bloom sont implémentés sous la forme d&#8217;un tableau de taille variable de N chiffres binaires (un champ de bits) et d&#8217;un nombre variable de M fonctions de hachage. Les fonctions de hachage sont conçues pour produire toujours une sortie comprise entre 1 et N, correspondant au tableau de chiffres binaires. Les fonctions de hachage sont générées de manière déterministe, de sorte que tout nœud implémentant un filtre de Bloom utilisera toujours les mêmes fonctions de hachage et obtiendra les mêmes résultats pour une entrée spécifique. En choisissant des filtres de Bloom de différentes longueurs (N) et un nombre différent (M) de fonctions de hachage, le filtres de Bloom peut être réglé, en faisant varier le niveau de précision et donc de confidentialité.</p>
</div>
<div class="paragraph data-line-216">
<p>Dans <a href="#bloom1">Un exemple de filtre de Bloom simpliste, avec un champ 16 bits et trois fonctions de hachage</a>, nous utilisons un très petit tableau de 16 bits et un ensemble de trois fonctions de hachage pour démontrer le fonctionnement des filtres de Bloom.</p>
</div>
<div id="bloom1" class="imageblock data-line-220">
<div class="content">
<img src="images/mbc2_0808.png" alt="Bloom 1">
</div>
<div class="title">Figure 53. Un exemple de filtre de Bloom simpliste, avec un champ 16 bits et trois fonctions de hachage</div>
</div>
<div class="paragraph data-line-222">
<p>Le filtre de Bloom est initialisé de sorte que le tableau de bits ne soit que des zéros. Pour ajouter un motif au filtre de Bloom, le motif est haché tour à tour par chaque fonction de hachage. L&#8217;application de la première fonction de hachage à l&#8217;entrée donne un nombre compris entre 1 et N. Le bit correspondant dans le tableau (indexé de 1 à N) est trouvé et défini sur <code>1</code>, enregistrant ainsi la sortie de la fonction de hachage. Ensuite, la fonction de hachage suivante est utilisée pour définir un autre bit et ainsi de suite. Une fois que toutes les fonctions de hachage M ont été appliquées, le modèle de recherche sera "enregistré" dans le filtre de Bloom sous forme de M bits qui ont été modifiés de <code>0</code> à <code>1</code>.</p>
</div>
<div class="paragraph data-line-224">
<p><a href="#bloom2">Ajout d&#8217;un motif "A" à notre filtre de Bloom simple</a> est un exemple d&#8217;ajout d&#8217;un motif "A" au filtre de Bloom simple illustré dans <a href="#bloom1">Un exemple de filtre de Bloom simpliste, avec un champ 16 bits et trois fonctions de hachage</a>.</p>
</div>
<div class="paragraph data-line-226">
<p>L&#8217;ajout d&#8217;un deuxième motif est aussi simple que de répéter ce processus. Le motif est haché par chaque fonction de hachage tour à tour et le résultat est enregistré en réglant les bits sur <code>1</code>. Notez qu&#8217;à mesure qu&#8217;un filtre bloom est rempli de plusieurs modèles, le résultat d&#8217;une fonction de hachage peut coïncider avec un bit déjà défini sur <code>1</code>, auquel cas le bit n&#8217;est pas modifié. Essentiellement, à mesure que davantage de motifs sont enregistrés sur des bits qui se chevauchent, le filtre de bloom commence à être saturé avec davantage de bits réglés sur <code>1</code> et la précision du filtre diminue. C&#8217;est pourquoi le filtre est une structure de données probabiliste - il devient moins précis à mesure que d&#8217;autres modèles sont ajoutés. La précision dépend du nombre de motifs ajoutés par rapport à la taille du tableau de bits (N) et du nombre de fonctions de hachage (M). Un tableau de bits plus grand et plus de fonctions de hachage peuvent enregistrer plus de modèles avec une plus grande précision. Un tableau de bits plus petit ou moins de fonctions de hachage enregistrera moins de modèles et produira moins de précision.</p>
</div>
<div id="bloom2" class="imageblock data-line-230">
<div class="content">
<img src="images/mbc2_0809.png" alt="Bloom 2">
</div>
<div class="title">Figure 54. Ajout d&#8217;un motif "A" à notre filtre de Bloom simple</div>
</div>
<div class="paragraph data-line-232">
<p><a href="#bloom3">Ajout d&#8217;un deuxième motif "B" à notre filtre de Bloom simple</a> est un exemple d&#8217;ajout d&#8217;un deuxième motif "B" au filtre de Bloom simple.</p>
</div>
<div id="bloom3" class="imageblock smallereighty data-line-237">
<div class="content">
<img src="images/mbc2_0810.png" alt="Bloom 3">
</div>
<div class="title">Figure 55. Ajout d&#8217;un deuxième motif "B" à notre filtre de Bloom simple</div>
</div>
<div class="paragraph data-line-239">
<p>Pour tester si un motif fait partie d&#8217;un filtre de Bloom, le motif est haché par chaque fonction de hachage et le motif de bits résultant est testé par rapport au tableau de bits. Si tous les bits indexés par les fonctions de hachage sont mis à <code>1</code>, alors le motif est <em>probablement</em> enregistré dans le filtre de Bloom. Étant donné que les bits peuvent être définis en raison du chevauchement de plusieurs modèles, la réponse n&#8217;est pas certaine, mais plutôt probabiliste. En termes simples, une correspondance positive du filtre de Bloom est un "Peut-être, Oui".</p>
</div>
<div class="paragraph data-line-241">
<p><a href="#bloom4">Tester l&#8217;existence du motif "X" dans le filtre de Bloom. Le résultat est une correspondance positive probabiliste, ce qui signifie "Peut-être".</a> est un exemple de test de l&#8217;existence du motif "X" dans le filtre de Bloom simple. Les bits correspondants sont définis sur <code>1</code>, donc le motif est probablement une correspondance.</p>
</div>
<div id="bloom4" class="imageblock smallereighty data-line-246">
<div class="content">
<img src="images/mbc2_0811.png" alt="Bloom 4">
</div>
<div class="title">Figure 56. Tester l&#8217;existence du motif "X" dans le filtre de Bloom. Le résultat est une correspondance positive probabiliste, ce qui signifie "Peut-être".</div>
</div>
<div class="paragraph data-line-248">
<p>Au contraire, si un motif est testé par rapport au filtre bloom et que l&#8217;un des bits est mis à <code>0</code>, cela prouve que le motif n&#8217;a pas été enregistré dans le filtre de Bloom. Un résultat négatif n&#8217;est pas une probabilité, c&#8217;est une certitude. En termes simples, une correspondance négative sur un filtre de Bloom est un "Définitivement pas!"</p>
</div>
<div class="paragraph data-line-250">
<p><a href="#bloom5">Tester l&#8217;existence du motif "Y" dans le filtre de Bloom. Le résultat est une correspondance négative définitive, ce qui signifie "Définitivement pas !"</a> est un exemple de test de l&#8217;existence du motif "Y" dans le filtre de Bloom simple. L&#8217;un des bits correspondants est défini sur <code>0</code>, donc le motif n&#8217;est certainement pas une correspondance.</p>
</div>
<div id="bloom5" class="imageblock data-line-254">
<div class="content">
<img src="images/mbc2_0812.png" alt="mbc2 0812">
</div>
<div class="title">Figure 57. Tester l&#8217;existence du motif "Y" dans le filtre de Bloom. Le résultat est une correspondance négative définitive, ce qui signifie "Définitivement pas !"</div>
</div>
</div>
</div>
<div class="sect2 data-line-256">
<h3 id="_comment_les_nœuds_spv_utilisent_les_filtres_de_bloom">Comment les nœuds SPV utilisent les filtres de Bloom</h3>
<div class="paragraph data-line-258">
<p>Les filtres de Bloom sont utilisés pour filtrer les transactions (et les blocs les contenant) qu&#8217;un nœud SPV reçoit de ses pairs, en sélectionnant uniquement les transactions qui intéressent le nœud SPV sans révéler les adresses ou les clés qui l&#8217;intéressent.</p>
</div>
<div class="paragraph data-line-260">
<p>Un nœud SPV initialisera un filtre de Bloom comme "vide" ; dans cet état, le filtre de Bloom ne correspondra à aucun motif. Le nœud SPV établira ensuite une liste de toutes les adresses, clés et hachages qui l&#8217;intéressent. Il le fera en extrayant le hachage de clé publique et le hachage de script et les ID de transaction de tout UTXO contrôlé par son portefeuille. Le nœud SPV ajoute ensuite chacun d&#8217;entre eux au filtre de Bloom, de sorte que le filtre de Bloom "correspondra" si ces modèles sont présents dans une transaction, sans révéler les modèles eux-mêmes.</p>
</div>
<div class="paragraph data-line-262">
<p>Le nœud SPV enverra alors un message <code>filterload</code> au pair, contenant le filtres de Bloom à utiliser sur la connexion. Sur le pair, les filtres de Bloom sont vérifiés par rapport à chaque transaction entrante. Le nœud complet vérifie plusieurs parties de la transaction par rapport au filtre de Bloom, à la recherche d&#8217;une correspondance, notamment :</p>
</div>
<div class="ulist data-line-264">
<ul>
<li class="data-line-264">
<p>L&#8217;identifiant de la transaction</p>
</li>
<li class="data-line-265">
<p>Les composants de données des scripts de verrouillage de chacune des sorties de transaction (chaque clé et hachage du script)</p>
</li>
<li class="data-line-266">
<p>Chacune des entrées de transaction</p>
</li>
<li class="data-line-267">
<p>Chacun des composants de données de signature d&#8217;entrée (ou scripts témoins)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-269">
<p>En comparant tous ces composants, les filtres Bloom peuvent être utilisés pour faire correspondre les hachages de clés publiques, les scripts, les valeurs <code>OP_RETURN</code>, les clés publiques dans les signatures ou tout futur composant d&#8217;un contrat intelligent ou d&#8217;un script complexe.</p>
</div>
<div class="paragraph data-line-271">
<p>Une fois qu&#8217;un filtre est établi, le pair teste ensuite la sortie de chaque transaction par rapport au filtre Bloom. Seules les transactions qui correspondent au filtre sont envoyées au nœud.</p>
</div>
<div class="paragraph data-line-273">
<p>En réponse à un message <code>getdata</code> du nœud, les pairs enverront un message <code>merkleblock</code> qui ne contient que des en-têtes de bloc pour les blocs correspondant au filtre et un chemin Merkle (voir <a href="#merkle_trees">Arbres de Merkle</a>) pour chaque transaction correspondante. Le pair enverra alors également des messages <code>tx</code> contenant les transactions mises en correspondance par le filtre.</p>
</div>
<div class="paragraph data-line-275">
<p>Lorsque le nœud complet envoie des transactions au nœud SPV, le nœud SPV rejette tous les faux positifs et utilise les transactions correctement appariées pour mettre à jour son ensemble UTXO et le solde de son portefeuille. Au fur et à mesure qu&#8217;il met à jour sa propre vue de l&#8217;ensemble UTXO, il modifie également le filtre de Bloom pour correspondre à toutes les transactions futures faisant référence à l&#8217;UTXO qu&#8217;il vient de trouver. Le nœud complet utilise ensuite le nouveau filtre de Bloom pour faire correspondre les nouvelles transactions et l&#8217;ensemble du processus se répète.</p>
</div>
<div class="paragraph data-line-277">
<p>Le nœud définissant le filtre de Bloom peut ajouter de manière interactive des motifs au filtre en envoyant un message <code>filteradd</code>. Pour effacer le filtre de Bloom, le nœud peut envoyer un message <code>filterclear</code>. Puisqu&#8217;il n&#8217;est pas possible de supprimer un modèle d&#8217;un filtre de Bloom, un nœud doit effacer et renvoyer un nouveau filtre de Bloom si un modèle n&#8217;est plus souhaité.</p>
</div>
<div class="paragraph data-line-279">
<p>Le protocole réseau et le mécanisme de filtre de Bloom pour les nœuds SPV sont définis dans <a href="https://bit.ly/1x6qCiO" data-href="https://bit.ly/1x6qCiO">BIP-37 (Peer Services)</a>.</p>
</div>
</div>
<div class="sect2 data-line-282">
<h3 id="_nœuds_spv_et_confidentialité">Nœuds SPV et confidentialité</h3>
<div class="paragraph data-line-284">
<p>Les nœuds qui implémentent SPV ont une confidentialité plus faible qu&#8217;un nœud complet. Un nœud complet reçoit toutes les transactions et ne révèle donc aucune information indiquant s&#8217;il utilise une adresse dans son portefeuille. Un nœud SPV reçoit une liste filtrée des transactions liées aux adresses qui se trouvent dans son portefeuille. En conséquence, cela réduit la vie privée du propriétaire.</p>
</div>
<div class="paragraph data-line-286">
<p>Les filtres de Bloom sont un moyen de réduire la perte de confidentialité. Sans eux, un nœud SPV devrait répertorier explicitement les adresses qui l&#8217;intéressent, créant ainsi une grave violation de la vie privée. Cependant, même avec des filtres de Bloom, un adversaire surveillant le trafic d&#8217;un client SPV ou s&#8217;y connectant directement en tant que nœud du réseau P2P peut collecter suffisamment d&#8217;informations au fil du temps pour apprendre les adresses dans le portefeuille du client SPV.</p>
</div>
</div>
<div class="sect2 data-line-288">
<h3 id="_connexions_cryptées_et_authentifiées">Connexions cryptées et authentifiées</h3>
<div class="paragraph data-line-290">
<p>La plupart des nouveaux utilisateurs de bitcoin supposent que les communications réseau d&#8217;un nœud Bitcoin sont cryptées. En fait, la mise en œuvre originale du bitcoin communique entièrement en clair. Bien que ce ne soit pas un problème majeur de confidentialité pour les nœuds complets, c&#8217;est un gros problème pour les nœuds SPV.</p>
</div>
<div class="paragraph data-line-292">
<p>Afin d&#8217;augmenter la confidentialité et la sécurité du réseau bitcoin P2P, il existe deux solutions qui fournissent le cryptage des communications : <em>Tor Transport</em> et <em>P2P Authentication and Encryption</em> avec BIP-150/151.</p>
</div>
<div class="sect3 data-line-294">
<h4 id="_transport_tor">Transport Tor</h4>
<div class="paragraph data-line-296">
<p>Tor, qui signifie <em>The Onion Routing network</em>, est un projet logiciel et un réseau qui offre le cryptage et l&#8217;encapsulation des données via des chemins de réseau qui offrent l&#8217;anonymat, l&#8217;intraçabilité et la confidentialité.</p>
</div>
<div class="paragraph data-line-298">
<p>Bitcoin Core offre plusieurs options de configuration qui vous permettent d&#8217;exécuter un nœud Bitcoin avec son trafic transporté sur le réseau Tor. De plus, Bitcoin Core peut également offrir un service caché Tor permettant à d&#8217;autres nœuds Tor de se connecter à votre nœud directement via Tor.</p>
</div>
<div class="paragraph data-line-300">
<p>À partir de la version 0.12 de Bitcoin Core, un nœud proposera automatiquement un service Tor caché s&#8217;il est capable de se connecter à un service Tor local. Si vous avez installé Tor et que le processus Bitcoin Core s&#8217;exécute en tant qu&#8217;utilisateur disposant des autorisations adéquates pour accéder au cookie d&#8217;authentification Tor, il devrait fonctionner automatiquement. Utilisez le drapeau <code>debug</code> pour activer le débogage de Bitcoin Core pour le service Tor comme ceci :</p>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>$ bitcoind --daemon --debug=tor</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>Vous devriez voir "tor: ADD_ONION successful" dans les journaux, indiquant que Bitcoin Core a ajouté un service caché au réseau Tor.</p>
</div>
<div class="paragraph data-line-308">
<p>Vous pouvez trouver plus d&#8217;instructions sur l&#8217;exécution de Bitcoin Core en tant que service caché de Tor dans la documentation de Bitcoin Core (<em>docs/tor.md</em>) et divers didacticiels en ligne.</p>
</div>
</div>
<div class="sect3 data-line-310">
<h4 id="_authentification_et_cryptage_pair_à_pair">Authentification et cryptage pair à pair</h4>
<div class="paragraph data-line-312">
<p>Deux propositions d&#8217;amélioration Bitcoin, BIP-150 et BIP-151, ajoutent la prise en charge de l&#8217;authentification et du cryptage P2P dans le réseau bitcoin P2P. Ces deux BIP définissent des services optionnels pouvant être proposés par des nœuds Bitcoin compatibles. BIP-151 active le chiffrement négocié pour toutes les communications entre deux nœuds qui prennent en charge BIP-151. BIP-150 offre une authentification par les pairs en option qui permet aux nœuds de s&#8217;authentifier mutuellement à l&#8217;aide d&#8217;ECDSA et des clés privées. BIP-150 exige qu&#8217;avant l&#8217;authentification, les deux nœuds aient établi des communications cryptées conformément à BIP-151.</p>
</div>
<div class="paragraph data-line-314">
<p>Depuis février 2021, BIP-150 et BIP-151 ne sont pas implémentés dans Bitcoin Core. Cependant, les deux propositions ont été mises en œuvre par au moins un client Bitcoin alternatif nommé bcoin.</p>
</div>
<div class="paragraph data-line-316">
<p>BIP-150 et BIP-151 permettent aux utilisateurs d&#8217;exécuter des clients SPV qui se connectent à un nœud complet de confiance, en utilisant le chiffrement et l&#8217;authentification pour protéger la confidentialité du client SPV.</p>
</div>
<div class="paragraph data-line-318">
<p>De plus, l&#8217;authentification peut être utilisée pour créer des réseaux de nœuds Bitcoin de confiance et empêcher les attaques Man-in-the-Middle (entre-deux). Enfin, le cryptage P2P, s&#8217;il est déployé à grande échelle, renforcerait la résistance du bitcoin à l&#8217;analyse du trafic et à la surveillance portant atteinte à la vie privée, en particulier dans les pays totalitaires où l&#8217;utilisation d&#8217;Internet est fortement contrôlée et surveillée.</p>
</div>
<div class="paragraph data-line-320">
<p>La norme est définie dans https:/ /github.com/bitcoin/bips/blob/master/bip-0150.mediawiki[BIP-150 (authentification par les pairs)] et <a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki"> BIP-151 (chiffrement des communications poste à poste)</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-322">
<h3 id="_groupes_de_transactions">Groupes de transactions</h3>
<div class="paragraph data-line-324">
<p>Presque tous les nœuds du réseau Bitcoin maintiennent une liste temporaire de transactions non confirmées appelées <em>bassin de mémoire</em>, <em>mempool</em> ou <em>bassin de transaction</em>. Les nœuds utilisent ce bassin pour suivre les transactions connues du réseau mais qui ne sont pas encore incluses dans la chaîne de blocs. Par exemple, un nœud de portefeuille utilisera le bassin de transactions pour suivre les paiements entrants dans le portefeuille de l&#8217;utilisateur qui ont été reçus sur le réseau mais qui n&#8217;ont pas encore été confirmés.</p>
</div>
<div class="paragraph data-line-326">
<p>Au fur et à mesure que les transactions sont reçues et vérifiées, elles sont ajoutées au bassin de transactions et relayées aux nœuds voisins pour se propager sur le réseau.</p>
</div>
<div class="paragraph data-line-328">
<p>Certaines implémentations de nœuds maintiennent également un bassin séparé de transactions orphelines. Si les entrées d&#8217;une transaction font référence à une transaction qui n&#8217;est pas encore connue, comme un parent manquant, la transaction orpheline sera stockée temporairement dans le bassin orphelin jusqu&#8217;à ce que la transaction parent arrive.</p>
</div>
<div class="paragraph data-line-330">
<p>Lorsqu&#8217;une transaction est ajoutée au bassin de transactions, le bassin orphelin est vérifié pour tous les orphelins qui référencent les sorties de cette transaction (ses enfants). Tous les orphelins correspondants sont ensuite validés. S&#8217;ils sont valides, ils sont supprimés du bassin orphelin et ajoutés au bassin de transactions, complétant ainsi la chaîne qui a commencé avec la transaction parent. À la lumière de la transaction nouvellement ajoutée, qui n&#8217;est plus orpheline, le processus est répété de manière récursive à la recherche de tout autre descendant, jusqu&#8217;à ce qu&#8217;aucun autre descendant ne soit trouvé. Grâce à ce processus, l&#8217;arrivée d&#8217;une transaction parente déclenche une reconstruction en cascade de toute une chaîne de transactions interdépendantes en réunissant les orphelins avec leurs parents tout au long de la chaîne.</p>
</div>
<div class="paragraph data-line-332">
<p>Le bassin de transactions et le bassin orphelin (le cas échéant) sont stockés dans la mémoire locale et ne sont pas enregistrés sur le stockage persistant ; ils sont plutôt renseignés dynamiquement à partir des messages réseau entrants. Lorsqu&#8217;un nœud démarre, les deux bassins sont vides et se remplissent progressivement avec les nouvelles transactions reçues sur le réseau.</p>
</div>
<div class="paragraph data-line-334">
<p>Certaines implémentations du client Bitcoin maintiennent également une base de données ou un bassin UTXO, qui est l&#8217;ensemble de toutes les sorties non dépensées sur la chaîne de blocs. Les utilisateurs de Bitcoin Core le trouveront dans le dossier <code>chainstate/</code> du répertoire de données de leur client. Bien que le nom "bassin UTXO" ressemble au bassin de transactions, il représente un ensemble de données différent. Contrairement aux bassins de transactions et orphelins, le bassin UTXO n&#8217;est pas initialisé vide mais contient à la place des millions d&#8217;entrées de sorties de transactions non dépensées, tout ce qui n&#8217;est pas dépensé depuis le bloc de genèse. Le bassin UTXO peut être hébergé dans la mémoire locale ou sous la forme d&#8217;une table de base de données indexée sur un stockage persistant.</p>
</div>
<div class="paragraph data-line-23">
<p>Alors que les bassins de transactions et orphelins représentent la perspective locale d&#8217;un seul nœud et peuvent varier considérablement d&#8217;un nœud à l&#8217;autre en fonction du moment où le nœud a été démarré ou redémarré, le bassin UTXO représente le consensus émergent du réseau et variera donc peu entre les nœuds. De plus, les bassins de transactions et orphelins ne contiennent que des transactions non confirmées, tandis que le pool UTXO ne contient que des sorties confirmées.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="blockchain">La chaîne de blocs (La blockchain)</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-4">
<h3 id="_présentation_2">Présentation</h3>
<div class="paragraph data-line-6">
<p>La structure de données de la chaîne de blocs est une liste ordonnée et rétro-liée aux blocs de transactions. La chaîne de blocs peut être stockée sous forme de fichier plat ou dans une simple base de données. Le client Bitcoin Core stocke les métadonnées de la chaîne de blocs à l&#8217;aide de la base de données LevelDB de Google. Les blocs sont "rétro-liés", chacun se référant au bloc précédent dans la chaîne. La chaîne de blocs est souvent visualisée comme une pile verticale, avec des blocs superposés les uns sur les autres et le premier bloc servant de base à la pile. La visualisation de blocs empilés les uns sur les autres entraîne l&#8217;utilisation de termes tels que "hauteur" pour désigner la distance par rapport au premier bloc, et "sommet" ou "pointe" pour désigner le bloc le plus récemment ajouté.</p>
</div>
<div class="paragraph data-line-8">
<p>Chaque bloc de la chaîne de blocs est identifié par un hachage, généré à l&#8217;aide de l&#8217;algorithme de hachage cryptographique SHA256 sur l&#8217;en-tête du bloc. Chaque bloc fait également référence à un bloc précédent, connu sous le nom de bloc <em>parent</em>, via le champ "hachage de bloc précédent" dans l&#8217;en-tête de bloc. En d&#8217;autres termes, chaque bloc contient le hachage de son parent dans sa propre en-tête. La séquence de hachages reliant chaque bloc à son parent crée une chaîne remontant jusqu&#8217;au premier bloc jamais créé, connu sous le nom de <em>bloc de genèse</em>.</p>
</div>
<div class="paragraph data-line-10">
<p>Bien qu&#8217;un bloc n&#8217;ait qu&#8217;un seul parent, il peut temporairement avoir plusieurs enfants. Chacun des enfants fait référence au même bloc que son parent et contient le même hachage (parent) dans le champ "hachage du bloc précédent". Plusieurs enfants apparaissent lors d&#8217;une "fourche" de chaîne de blocs, une situation temporaire qui se produit lorsque différents blocs sont découverts presque simultanément par différents mineurs (voir <a href="#forks">Fourches de chaîne de blocs</a>). Finalement, un seul bloc enfant devient une partie de la chaîne de blocs et la "fourche" est résolu. Même si un bloc peut avoir plusieurs enfants, chaque bloc ne peut avoir qu&#8217;un seul parent. En effet, un bloc a un seul champ "hachage de bloc précédent" faisant référence à son parent unique.</p>
</div>
<div class="paragraph data-line-12">
<p>Le champ "hachage du bloc précédent" se trouve à l&#8217;intérieur de l&#8217;en-tête du bloc et affecte ainsi le hachage du bloc <em>courant</em>. La propre identité de l&#8217;enfant change si l&#8217;identité du parent change. Lorsque le parent est modifié de quelque manière que ce soit, le hachage du parent change. Le hachage modifié du parent nécessite une modification du pointeur "hachage de bloc précédent" de l&#8217;enfant. Cela entraîne à son tour la modification du hachage de l&#8217;enfant, ce qui nécessite une modification du pointeur du petit-enfant, qui à son tour modifie le petit-enfant, et ainsi de suite. Cet effet de cascade garantit qu&#8217;une fois qu&#8217;un bloc est suivi de plusieurs générations, il ne peut pas être modifié sans forcer un recalcul de tous les blocs suivants. Parce qu&#8217;un tel recalcul nécessiterait un calcul énorme (et donc une consommation d&#8217;énergie), l&#8217;existence d&#8217;une longue chaîne de blocs rend immuable l&#8217;historique profond de la chaîne de blocs, ce qui est une caractéristique clé de la sécurité du bitcoin.</p>
</div>
<div class="paragraph data-line-14">
<p>Une façon de penser à la chaîne de blocs est comme des couches dans une formation géologique ou un échantillon de carotte de glacier. Les couches de surface peuvent changer avec les saisons, voire être soufflées avant d&#8217;avoir le temps de s&#8217;installer. Mais dès que l&#8217;on descend à quelques centimètres de profondeur, les couches géologiques deviennent de plus en plus stables. Au moment où vous regardez quelques centaines de mètres plus bas, vous regardez un instantané du passé qui est resté intact pendant des millions d&#8217;années. Dans la chaîne de blocs, les quelques blocs les plus récents peuvent être révisés s&#8217;il y a un recalcul en chaîne dû à une fourche. Les six premiers blocs sont comme quelques centimètres de terre arable. Mais une fois que vous allez plus profondément dans la chaîne de blocs, au-delà de six blocs, les blocs sont de moins en moins susceptibles de changer. Après 100 blocs de retour, il y a tellement de stabilité que la transaction coinbase - la transaction contenant le bitcoin nouvellement extrait - peut être dépensée. Quelques milliers de blocs en arrière (un mois) et la chaîne de blocs est une histoire établie, à toutes fins pratiques. Alors que le protocole permet toujours à une chaîne d&#8217;être annulée par une chaîne plus longue et alors que la possibilité qu&#8217;un bloc soit inversé existe toujours, la probabilité d&#8217;un tel événement diminue au fil du temps jusqu&#8217;à ce qu&#8217;elle devienne infinitésimale.</p>
</div>
</div>
<div class="sect2 data-line-16">
<h3 id="_structure_dun_bloc">Structure d&#8217;un bloc</h3>
<div class="paragraph data-line-18">
<p>Un bloc est une structure de données de conteneur qui agrège les transactions pour les inclure dans le grand livre public, la chaîne de blocs. Le bloc est composé d&#8217;un en-tête, contenant des métadonnées, suivi d&#8217;une longue liste de transactions qui constituent l&#8217;essentiel de sa taille. L&#8217;en-tête de bloc est de 80 octets, alors que la transaction moyenne est d&#8217;au moins 400 octets et que le bloc moyen contient plus de 1900 transactions. Un bloc complet, avec toutes les transactions, est donc 10 000 fois plus grand que l&#8217;en-tête du bloc. <a href="#block_structure1">La structure d&#8217;un bloc</a> décrit la structure d&#8217;un bloc.</p>
</div>
<table id="block_structure1" class="tableblock frame-all grid-all stretch pagebreak-before data-line-24">
<caption class="title">Table 24. La structure d&#8217;un bloc</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille de bloc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La taille du bloc, en octets, suivant ce champ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En-tête de bloc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plusieurs champs forment l&#8217;en-tête du bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compteur de transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combien de transactions suivent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Les transactions enregistrées dans ce bloc</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-33">
<h3 id="block_header">En-tête de bloc</h3>
<div class="paragraph data-line-35">
<p>L&#8217;en-tête de bloc se compose de trois ensembles de métadonnées de bloc. Tout d&#8217;abord, il y a une référence à un hachage de bloc précédent, qui connecte ce bloc au bloc précédent dans la chaîne de blocs. Le deuxième ensemble de métadonnées, à savoir <em>difficulty</em>, <em>timestamp</em> et <em>nonce</em>, concerne la concurrence minière, comme détaillé dans <a href="#mining">Minage et Consensus</a>. La troisième métadonnée est la racine de l&#8217;arbre Merkle, une structure de données utilisée pour résumer efficacement toutes les transactions du bloc. <a href="#block_header_structure_ch09">La structure de l&#8217;entête du bloc</a> décrit la structure d&#8217;un en-tête de bloc.</p>
</div>
<table id="block_header_structure_ch09" class="tableblock frame-all grid-all stretch data-line-41">
<caption class="title">Table 25. La structure de l&#8217;entête du bloc</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un numéro de version pour suivre les mises à niveau du logiciel/protocole</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de bloc précédent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une référence au hachage du bloc précédent (parent) dans la chaîne</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Racine de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un hachage de la racine de l&#8217;arbre Merkle des transactions de ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Horodatage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le temps de création approximatif de ce bloc (en secondes écoulées depuis Unix Epoch)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cible de difficulté</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cible de difficulté de l&#8217;algorithme Proof-of-Work (ou Preuve de travail) pour ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un compteur utilisé pour l&#8217;algorithme de preuve de travail</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-51">
<p>Le nonce, la cible de difficulté et l&#8217;horodatage sont utilisés dans le processus d&#8217;extraction et seront discutés plus en détail dans <a href="#mining">Minage et Consensus</a>.</p>
</div>
</div>
<div class="sect2 data-line-54">
<h3 id="block_hash">Identificateurs de bloc : hachage d&#8217;en-tête de bloc et hauteur de bloc</h3>
<div class="paragraph data-line-56">
<p>L&#8217;identifiant primaire d&#8217;un bloc est son hachage cryptographique, une empreinte digitale, réalisée en hachant deux fois l&#8217;en-tête du bloc via l&#8217;algorithme SHA256. Le hachage de 32 octets résultant est appelé <em>hachage de bloc</em> mais est plus précisément le <em>hachage d&#8217;en-tête de bloc</em>, <span role="keep-together">car seul l'en-tête de bloc est utilisé pour le calculer. Par exemple,</span> <code>000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</code> est le hachage de bloc du premier bloc bitcoin jamais créé. Le hachage de bloc identifie un bloc de manière unique et sans ambiguïté et peut être dérivé indépendamment par n&#8217;importe quel nœud en double hachant simplement l&#8217;en-tête de bloc avec l&#8217;algorithme SHA256.</p>
</div>
<div class="paragraph data-line-58">
<p>Notez que le hachage de bloc n&#8217;est pas réellement inclus dans la structure de données du bloc, ni lorsque le bloc est transmis sur le réseau, ni lorsqu&#8217;il est stocké sur le stockage de persistance d&#8217;un nœud dans le cadre de la chaîne de blocs. Au lieu de cela, le hachage du bloc est calculé par chaque nœud lorsque le bloc est reçu du réseau. Le hachage de bloc peut être stocké dans une table de base de données distincte dans le cadre des métadonnées du bloc, pour faciliter l&#8217;indexation et une récupération plus rapide des blocs à partir du disque.</p>
</div>
<div class="paragraph data-line-60">
<p>Une deuxième façon d&#8217;identifier un bloc est par sa position dans la chaîne de blocs, appelée le <span role="keep-together"><em>hauteur de bloc</em>. Le premier bloc jamais créé est à la hauteur de bloc 0 (zéro) et est le</span> <span role="keep-together">même bloc qui était précédemment référencé par le hachage de bloc suivant</span> <code>000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</code>. Un bloc peut ainsi être identifié de deux manières : en référençant le hachage du bloc ou en référençant la hauteur du bloc. Chaque bloc suivant ajouté "au-dessus" de ce premier bloc est une position "plus élevée" dans la chaîne de blocs, comme des boîtes empilées les unes sur les autres.</p>
</div>
<div class="paragraph data-line-62">
<p>De plus, le terme <em>hauteur de bloc actuelle</em> indique la taille de la chaîne de blocs en blocs à un moment donné. Par exemple, la hauteur actuelle du bloc au 1er mars 2021 était d&#8217;environ 672 722, ce qui signifie qu&#8217;il y avait 672 722 blocs empilés au-dessus du premier bloc créé en janvier 2009.</p>
</div>
<div class="paragraph data-line-64">
<p>Contrairement au hachage de bloc, la hauteur de bloc n&#8217;est pas un identifiant unique. Bien qu&#8217;un seul bloc ait toujours une hauteur de bloc spécifique et invariante, l&#8217;inverse n&#8217;est pas vrai : la hauteur de bloc n&#8217;identifie pas toujours un seul bloc. Deux ou plusieurs blocs peuvent avoir la même hauteur de bloc, en concurrence pour la même position dans la chaîne de blocs. Ce scénario est décrit en détail dans la section <a href="#forks">Fourches de chaîne de blocs</a>. La hauteur de bloc ne fait pas non plus partie de la structure de données du bloc ; il n&#8217;est pas stocké dans le bloc. Chaque nœud identifie dynamiquement la position (hauteur) d&#8217;un bloc dans la chaîne de blocs lorsqu&#8217;il est reçu du réseau Bitcoin. La hauteur de bloc peut également être stockée sous forme de métadonnées dans une table de base de données indexée pour une récupération plus rapide.</p>
</div>
<div class="admonitionblock tip data-line-67">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-68">
<p>Le <em>hachage de bloc</em> d&#8217;un bloc identifie toujours un seul bloc de manière unique. Un bloc a également toujours une <em>hauteur de bloc</em> spécifique. Cependant, il n&#8217;est pas toujours vrai qu&#8217;une hauteur de bloc spécifique puisse identifier un seul bloc. Au contraire, deux blocs ou plus pourraient se disputer une seule position dans la chaîne de blocs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-71">
<h3 id="_le_bloc_dorigine_ou_de_genèse">Le bloc d&#8217;origine (ou de genèse)</h3>
<div class="paragraph data-line-73">
<p> Le premier bloc de la chaîne de blocs est appelé le bloc d&#8217;origine (ou de genèse) et a été créé en 2009. Il est l&#8217;ancêtre commun de tous les blocs de la chaîne de blocs, ce qui signifie que si vous commencez à n&#8217;importe quel bloc et suivez la chaîne en arrière dans le temps, vous finirez par arriver au bloc de genèse.</p>
</div>
<div class="paragraph data-line-75">
<p>Chaque nœud commence toujours par une chaîne de blocs d&#8217;au moins un bloc car le bloc de genèse est encodé de manière statique dans le logiciel client Bitcoin, de sorte qu&#8217;il ne peut pas être modifié. Chaque nœud "connaît" toujours le hachage et la structure du bloc de genèse, l&#8217;heure fixe à laquelle il a été créé et même la transaction unique qu&#8217;il contient. Ainsi, chaque nœud a le point de départ de la chaîne de blocs, une "racine" sécurisée à partir de laquelle construire une chaîne de blocs de confiance.</p>
</div>
<div class="paragraph data-line-77">
<p>Voir le bloc de genèse encodé statiquement à l&#8217;intérieur du client Bitcoin Core, dans <a href="https://bit.ly/1x6rcwP" data-href="https://bit.ly/1x6rcwP"><em>chainparams.cpp</em></a>.</p>
</div>
<div class="paragraph data-line-79">
<p>Le hachage d&#8217;identifiant suivant appartient au bloc genesis :</p>
</div>
<div class="listingblock data-line-81">
<div class="content">
<pre>000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="paragraph data-line-85">
<p>Vous pouvez rechercher ce hachage de bloc sur n&#8217;importe quel site web d&#8217;explorateur de blocs, tel que <em>Blockchain.com</em>, et vous trouverez une page décrivant le contenu de ce bloc, avec une URL contenant ce hachage :</p>
</div>
<div class="paragraph data-line-87">
<p><a href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f" class="undefined" data-href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f">https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</a></p>
</div>
<div class="paragraph data-line-89">
<p>Utilisation du client de référence Bitcoin Core sur la ligne de commande :</p>
</div>
<div class="listingblock data-line-91">
<div class="content">
<pre>$ bitcoin-cli getblock 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="listingblock data-line-95">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
    "confirmations" : 308321,
    "size" : 285,
    "height" : 0,
    "version" : 1,
    "merkleroot" : "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b",
    "tx" : [
        "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"
    ],
    "time" : 1231006505,
    "nonce" : 2083236893,
    "bits" : "1d00ffff",
    "difficulty" : 1.00000000,
    "nextblockhash" : "00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-114">
<p>Le bloc de genèse contient un message caché en son sein. L&#8217;entrée de transaction coinbase contient le texte "The Times 03/Jan/2009 Chancellor on brink of second bailout for banks.". Ce message était destiné à offrir une preuve de la date la plus ancienne de création de ce bloc, en faisant référence au titre du journal britannique <em>The Times</em>. Il sert également de rappel ironique de l&#8217;importance d&#8217;un système monétaire indépendant, le lancement du bitcoin se produisant en même temps qu&#8217;une crise monétaire mondiale sans précédent. Le message a été intégré dans le premier bloc par Satoshi Nakamoto, le créateur de Bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-116">
<h3 id="_relier_les_blocs_dans_la_chaîne_de_blocs">Relier les blocs dans la chaîne de blocs</h3>
<div class="paragraph data-line-118">
<p>Les nœuds complets Bitcoin conservent une copie locale de la chaîne de blocs, à partir du bloc de genèse. La copie locale de la chaîne de blocs est constamment mise à jour au fur et à mesure que de nouveaux blocs sont trouvés et utilisés pour étendre la chaîne. Lorsqu&#8217;un nœud reçoit des blocs entrants du réseau, il validera ces blocs, puis les reliera à la chaîne de blocs existante. Pour établir un lien, un nœud examinera l&#8217;en-tête de bloc entrant et recherchera le "hachage de bloc précédent".</p>
</div>
<div class="paragraph data-line-120">
<p>Supposons, par exemple, qu&#8217;un nœud ait 277 314 blocs dans la copie locale de la chaîne de blocs. Le dernier bloc dont le nœud a connaissance est le bloc 277 314, avec un hachage d&#8217;en-tête de bloc :</p>
</div>
<div class="listingblock data-line-122">
<div class="content">
<pre>00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249</pre>
</div>
</div>
<div class="paragraph data-line-126">
<p>Le nœud Bitcoin reçoit alors un nouveau bloc du réseau, qu&#8217;il analyse comme suit :</p>
</div>
<div class="listingblock data-line-129">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "size" : 43560,
    "version" : 2,
    "previousblockhash" :
        "00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249",
    "merkleroot" :
        "5e049f4030e0ab2debb92378f53c0a6e09548aea083f3ab25e1d94ea1155e29d",
    "time" : 1388185038,
    "difficulty" : 1180923195.25802612,
    "nonce" : 4215469401,
    "tx" : [
        "257e7497fb8bc68421eb2c7b699dbab234831600e7352f0d9e6522c7cf3f6c77",

 #[... beaucoup plus de transactions omises ...]

        "05cfd38f6ae6aa83674cc99e4d75a1458c165b7ab84725eda41d018a09176634"
    ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-150">
<p>En regardant ce nouveau bloc, le nœud trouve le champ <code>previousblockhash</code>, qui contient le hachage de son bloc parent. Il s&#8217;agit d&#8217;un hachage connu du nœud, celui du dernier bloc de la chaîne à la hauteur 277,314. Par conséquent, ce nouveau bloc est un enfant du dernier bloc de la chaîne et étend la chaîne de blocs existante. Le nœud ajoute ce nouveau bloc à la fin de la chaîne, rendant la chaîne de blocs plus longue avec une nouvelle hauteur de 277 315. <a href="#chain_of_blocks">Blocs liés dans une chaîne par référence au hachage d&#8217;en-tête de bloc précédent</a> montre la chaîne de trois blocs, liés par des références dans le champ <code>previousblockhash</code>.</p>
</div>
</div>
<div class="sect2 data-line-154">
<h3 id="merkle_trees">Arbres de Merkle</h3>
<div class="paragraph data-line-156">
<p>Chaque bloc de la chaîne de blocs Bitcoin contient un résumé de tous les transactions dans le bloc à l&#8217;aide d&#8217;un <em>arbre de Merkle</em>.</p>
</div>
<div class="paragraph data-line-158">
<p>Un <em>arbre de Merkle</em>, également appelé <em>arbre de hachage binaire</em>, est une structure de données utilisée pour résumer et vérifier efficacement l&#8217;intégrité de grands ensembles de données. Les arbres de Merkle sont des arbres binaires contenant des hachages cryptographiques. Le terme "arbre" est utilisé en informatique pour décrire une structure de données ramifiée, mais ces arbres sont généralement affichés à l&#8217;envers avec la "racine" en haut et les "feuilles" en bas d&#8217;un diagramme, comme vous le verrez dans les exemples qui suivent.</p>
</div>
<div id="chain_of_blocks" class="imageblock smallerfourtyfive data-line-163">
<div class="content">
<img src="images/mbc2_0901.png" alt="mbc2 0901">
</div>
<div class="title">Figure 58. Blocs liés dans une chaîne par référence au hachage d&#8217;en-tête de bloc précédent</div>
</div>
<div class="paragraph data-line-165">
<p>Les arbres de Merkle sont utilisés dans Bitcoin pour résumer toutes les transactions d&#8217;un bloc, produisant une empreinte numérique globale de l&#8217;ensemble des transactions, fournissant un processus très efficace pour vérifier si une transaction est incluse dans un bloc. Un arbre Merkle est construit en hachant récursivement des paires de nœuds jusqu&#8217;à ce qu&#8217;il n&#8217;y ait qu&#8217;un seul hachage, appelé <em>racine</em>, ou <em>racine de Merkle</em>. L&#8217;algorithme de hachage cryptographique utilisé dans les arbres de Merkle de Bitcoin est SHA256 appliqué deux fois, également connu sous le nom de double-SHA256.</p>
</div>
<div class="paragraph data-line-167">
<p>Lorsque N éléments de données sont hachés et résumés dans un arbre de Merkle, vous pouvez vérifier si un élément de données est inclus dans l&#8217;arbre avec au plus <code>2*log<sub>2</sub>(N)</code> calculs, ce qui en fait une donnée très efficace structure.</p>
</div>
<div class="paragraph data-line-169">
<p>L&#8217;arbre de Merkle est construit de bas en haut. Dans l&#8217;exemple suivant, nous commençons avec quatre transactions, A, B, C et D, qui forment les <em>feuilles</em> de l&#8217;arbre de Merkle, comme indiqué dans <a href="#simple_merkle">Calcul des nœuds dans un arbre de Merkle</a>. Les transactions ne sont pas stockées dans l&#8217;arborescence de Merkle ; à la place, leurs données sont hachées et le hachage résultant est stocké dans chaque nœud feuille sous la forme H<sub>A</sub>, H<sub>B</sub>, H<sub>C</sub> et H<sub>D</sub> :</p>
</div>
<div class="listingblock data-line-171">
<div class="content">
<pre>H&lt;sub&gt;A&lt;/sub&gt; = SHA256(SHA256(Transaction A))</pre>
</div>
</div>
<div class="paragraph data-line-175">
<p>Des paires consécutives de nœuds feuilles sont ensuite résumées dans un nœud parent, en concaténant les deux hachages et en les hachant ensemble. Par exemple, pour construire le nœud parent H<sub>AB</sub>, les deux hachages de 32 octets des enfants sont concaténés pour créer une chaîne de 64 octets. Cette chaîne est ensuite doublement hachée pour produire le hachage du nœud parent :</p>
</div>
<div class="listingblock data-line-177">
<div class="content">
<pre>H&lt;sub&gt;AB&lt;/sub&gt; = SHA256(SHA256(H&lt;sub&gt;A&lt;/sub&gt; + H&lt;sub&gt;B&lt;/sub&gt;))</pre>
</div>
</div>
<div class="paragraph data-line-181">
<p>Le processus se poursuit jusqu&#8217;à ce qu&#8217;il n&#8217;y ait qu&#8217;un seul nœud au sommet, le nœud connu sous le nom de racine de Merkle. Ce hachage de 32 octets est stocké dans l&#8217;en-tête du bloc et résume toutes les données des quatre transactions. <a href="#simple_merkle">Calcul des nœuds dans un arbre de Merkle</a> montre comment la racine est calculée par hachages par paires des nœuds.</p>
</div>
<div id="simple_merkle" class="imageblock data-line-185">
<div class="content">
<img src="images/mbc2_0902.png" alt="Arbre de Merkle">
</div>
<div class="title">Figure 59. Calcul des nœuds dans un arbre de Merkle</div>
</div>
<div class="paragraph data-line-187">
<p>Parce que l&#8217;arbre de Merkle est un arbre binaire, il a besoin d&#8217;un nombre pair de nœuds feuilles. S&#8217;il y a un nombre impair de transactions à résumer, le dernier hachage de transaction sera dupliqué pour créer un nombre pair de nœuds feuilles, également appelés <em>arbre équilibré</em>. Ceci est montré dans <a href="#merkle_tree_odd">La duplication d&#8217;un élément de données permet d&#8217;obtenir un nombre pair d&#8217;éléments de données</a>, où la transaction C est dupliquée.</p>
</div>
<div id="merkle_tree_odd" class="imageblock data-line-191">
<div class="content">
<img src="images/mbc2_0903.png" alt="Arbre de Merkle impair">
</div>
<div class="title">Figure 60. La duplication d&#8217;un élément de données permet d&#8217;obtenir un nombre pair d&#8217;éléments de données</div>
</div>
<div class="paragraph data-line-193">
<p>La même méthode de construction d&#8217;un arbre à partir de quatre transactions peut être généralisée pour construire des arbres de n&#8217;importe quelle taille. Dans le Bitcoin, il est courant d&#8217;avoir plusieurs centaines à plus d&#8217;un millier de transactions dans un seul bloc, qui sont résumées exactement de la même manière, produisant seulement 32 octets de données en tant que racine de Merkle unique. Dans <a href="#merkle_tree_large">Un arbre Merkle résumant de nombreux éléments de données</a>, vous verrez un arbre construit à partir de 16 transactions. Notez que bien que la racine semble plus grande que les nœuds feuilles dans le diagramme, elle a exactement la même taille, seulement 32 octets. Qu&#8217;il y ait une transaction ou cent mille transactions dans le bloc, la racine de Merkle les résume toujours en 32 octets.</p>
</div>
<div class="paragraph data-line-195">
<p>Pour prouver qu&#8217;une transaction spécifique est incluse dans un bloc, un nœud n&#8217;a besoin que de produire <code>log<sub>2</sub>(N)</code> hachages de 32 octets, constituant un <em>chemin d&#8217;authentification</em> ou <em>chemin de Merkle</em> se connectant la transaction spécifique à la racine de l&#8217;arborescence. Ceci est particulièrement important lorsque le nombre de transactions augmente, car le logarithme en base 2 du nombre de transactions augmente beaucoup plus lentement. Cela permet aux nœuds Bitcoin de produire efficacement des chemins de 10 ou 12 hachages (320 à 384 octets), qui peuvent fournir la preuve d&#8217;une seule transaction parmi plus de mille transactions dans un bloc de la taille d&#8217;un mégaoctet.</p>
</div>
<div id="merkle_tree_large" class="imageblock data-line-199">
<div class="content">
<img src="images/mbc2_0904.png" alt="Grand arbre de Merkle">
</div>
<div class="title">Figure 61. Un arbre Merkle résumant de nombreux éléments de données</div>
</div>
<div class="paragraph data-line-201">
<p>Dans <a href="#merkle_tree_path">Un chemin (ou trajet) de Merkle utilisé pour prouver l&#8217;inclusion d&#8217;un élément de données</a>, un nœud peut prouver qu&#8217;une transaction K est incluse dans le bloc en produisant un chemin de Merkle qui ne fait que quatre hachages de 32 octets (128 octets au total). Le chemin se compose des quatre hachages (affichés avec un arrière-plan ombré dans <a href="#merkle_tree_path">Un chemin (ou trajet) de Merkle utilisé pour prouver l&#8217;inclusion d&#8217;un élément de données</a>) H<sub>L</sub>, H<sub>IJ</sub>, H<sub>MNOP</sub> et H<sub>ABCDEFGH</sub>. Avec ces quatre hachages fournis comme chemin d&#8217;authentification, n&#8217;importe quel nœud peut prouver que H<sub>K</sub> (avec un fond noir au bas du diagramme) est inclus dans la racine de Merkle en calculant quatre hachages supplémentaires par paires H<sub>KL</sub>, H<sub>IJKL</sub>, H<sub>IJKLMNOP</sub> et la racine de l&#8217;arbre de Merkle (indiquée par une ligne pointillée dans le diagramme).</p>
</div>
<div id="merkle_tree_path" class="imageblock data-line-205">
<div class="content">
<img src="images/mbc2_0905.png" alt="Chemin d&#8217;arbre de Merkle">
</div>
<div class="title">Figure 62. Un chemin (ou trajet) de Merkle utilisé pour prouver l&#8217;inclusion d&#8217;un élément de données</div>
</div>
<div class="paragraph data-line-208">
<p>Le code dans <a href="#merkle_example">Construire un arbre de Merkle</a> illustre le processus de création d&#8217;un arbre de Merkle depuis les hachages de nœud feuille jusqu&#8217;à la racine, en utilisant la bibliothèque libbitcoin pour certaines fonctions d&#8217;assistance.</p>
</div>
<div id="merkle_example" class="exampleblock pagebreak-before data-line-213">
<div class="title">Example 20. Construire un arbre de Merkle</div>
<div class="content">
<div class="listingblock data-line-215">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;bitcoin/bitcoin.hpp&gt;

bc::hash_digest create_merkle(bc::hash_list&amp; merkle)
{
    // Arrête si la liste de hachage est vide.
    if (merkle.empty())
        return bc::null_hash;
    else if (merkle.size() == 1)
        return merkle[0];

    // Tant qu'il y a plus d'un hachage dans la liste, continuez à boucler...
    while (merkle.size() &gt; 1)
    {
        // Si le nombre de hachages est impair, dupliquez le dernier hachage de la liste.
        if (merkle.size() % 2 != 0)
            merkle.push_back(merkle.back());
        // La taille de la liste est désormais égale.
        assert(merkle.size() % 2 == 0);

        // Nouvelle liste de hachage.
        bc::hash_list new_merkle;
        // Parcourez les hachages 2 à la fois.
        for (auto it = merkle.begin(); it != merkle.end(); it += 2)
        {
            // Joindre les deux hachages actuels ensemble (concaténer).
            bc::data_chunk concat_data(bc::hash_size * 2);
            auto concat = bc::serializer&lt;
                decltype(concat_data.begin())&gt;(concat_data.begin());
            concat.write_hash(*it);
            concat.write_hash(*(it + 1));
            // Hachez les deux hachages.
            bc::hash_digest new_root = bc::bitcoin_hash(concat_data);
            // Ajoutez ceci à la nouvelle liste.
            new_merkle.push_back(new_root);
        }
        // C'est la nouvelle liste.
        merkle = new_merkle;

        // DEBUG output -------------------------------------
        std::cout &lt;&lt; "Current merkle hash list:" &lt;&lt; std::endl;
        for (const auto&amp; hash: merkle)
            std::cout &lt;&lt; "  " &lt;&lt; bc::encode_base16(hash) &lt;&lt; std::endl;
        std::cout &lt;&lt; std::endl;
        // --------------------------------------------------
    }
    // Finalement, nous nous retrouvons avec un seul élément.
    return merkle[0];
}

int main()
{
    // Remplacez ces hachages par ceux d'un bloc pour reproduire la même racine merkle.
    bc::hash_list tx_hashes{{
        bc::hash_literal("0000000000000000000000000000000000000000000000000000000000000000"),
        bc::hash_literal("0000000000000000000000000000000000000000000000000000000000000011"),
        bc::hash_literal("0000000000000000000000000000000000000000000000000000000000000022"),
    }};
    const bc::hash_digest merkle_root = create_merkle(tx_hashes);
    std::cout &lt;&lt; "Result: " &lt;&lt; bc::encode_base16(merkle_root) &lt;&lt; std::endl;
    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-220">
<p><a href="#merkle_example_run">Compilation et exécution de l&#8217;exemple de code de Merkle</a> montre le résultat de la compilation et de l&#8217;exécution du code de Merkle.</p>
</div>
<div id="merkle_example_run" class="exampleblock data-line-224">
<div class="title">Example 21. Compilation et exécution de l&#8217;exemple de code de Merkle</div>
<div class="content">
<div class="listingblock data-line-226">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compiler le code merkle.cpp
$ g++ -o merkle merkle.cpp $(pkg-config --cflags --libs libbitcoin)
# Exécutez l'exécutable merkle
$ ./merkle
Liste de hachage Merkle actuelle :
  32650049a0418e4380db0af81788635d8b65424d397170b8499cdc28c4d27006
  30861db96905c8dc8b99398ca1cd5bd5b84ac3264a4e1b3e65afa1bcee7540c4

Liste de hachage Merkle actuelle :
  d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3

Result: d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-243">
<p>L&#8217;efficacité des arbres de Merkle devient évidente à mesure que l&#8217;échelle augmente. <a href="#block_structure2">Efficacité de l&#8217;arbre de Merkle</a> montre la quantité de données qui doit être échangée sous forme de chemin de Merkle pour prouver qu&#8217;une transaction fait partie d&#8217;un bloc.</p>
</div>
<table id="block_structure2" class="tableblock frame-all grid-all stretch data-line-248">
<caption class="title">Table 26. Efficacité de l&#8217;arbre de Merkle</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nombre de transactions</th>
<th class="tableblock halign-left valign-top">Environ. taille du bloc</th>
<th class="tableblock halign-left valign-top">Taille du chemin (hachages)</th>
<th class="tableblock halign-left valign-top">Taille du chemin (octets)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 opérations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 kilo-octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 hachages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 opérations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 kilo-octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 hachages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048 opérations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 kilo-octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11 hachages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">65 535 opérations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 mégaoctets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 hachages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 octets</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-256">
<p>Comme vous pouvez le voir dans le tableau, alors que la taille de bloc augmente rapidement, de 4 Ko avec 16 transactions à une taille de bloc de 16 Mo pour 65 535 transactions, le chemin de Merkle requis pour prouver l&#8217;inclusion d&#8217;une transaction augmente beaucoup plus lentement, de 128 octets à seulement 512 octets. Avec les arbres de Merkle, un nœud peut télécharger uniquement les en-têtes de bloc (80 octets par bloc) et être toujours en mesure d&#8217;identifier l&#8217;inclusion d&#8217;une transaction dans un bloc en récupérant un petit chemin Merkle à partir d&#8217;un nœud complet, sans stocker ni transmettre la grande majorité des chaînes de blocs, qui peut avoir une taille de plusieurs gigaoctets. Les nœuds qui ne maintiennent pas une chaîne de blocs complète, appelés nœuds de vérification simplifiée des paiements (SPV), utilisent des chemins de Merkle pour vérifier les transactions sans télécharger des blocs complets.</p>
</div>
</div>
<div class="sect2 data-line-258">
<h3 id="_arbres_de_merkle_et_vérification_simplifiée_des_paiements_spv">Arbres de Merkle et vérification simplifiée des paiements (SPV)</h3>
<div class="paragraph data-line-260">
<p>Les arbres Merkle sont largement utilisés par les nœuds SPV. Les nœuds SPV n&#8217;ont pas toutes les transactions et ne téléchargent pas les blocs complets, juste les en-têtes de bloc. Afin de vérifier qu&#8217;une transaction est incluse dans un bloc, sans avoir à télécharger toutes les transactions du bloc, ils utilisent un chemin d&#8217;authentification, ou chemin de Merkle.</p>
</div>
<div class="paragraph data-line-262">
<p>Considérons, par exemple, un nœud SPV qui est intéressé par les paiements entrants à une adresse contenue dans son portefeuille. Le nœud SPV établira un filtre de Bloom (voir <a href="#bloom_filters">Filtres de Bloom</a>) sur ses connexions à des pairs pour limiter les transactions reçues uniquement à celles contenant des adresses d&#8217;intérêt. Lorsqu&#8217;un pair voit une transaction qui correspond au filtre de Bloom, il enverra ce bloc à l&#8217;aide d&#8217;un message <code>merkleblock</code>. Le message <code>merkleblock</code> contient l&#8217;en-tête du bloc ainsi qu&#8217;un chemin de Merkle qui relie la transaction d&#8217;intérêt à la racine de Merkle dans le bloc. Le nœud SPV peut utiliser ce chemin de Merkle pour connecter la transaction au bloc et vérifier que la transaction est incluse dans le bloc. Le nœud SPV utilise également l&#8217;en-tête de bloc pour lier le bloc au reste de la chaîne de blocs. La combinaison de ces deux liens, entre la transaction et le bloc, et entre le bloc et la chaîne de blocs, prouve que la transaction est enregistrée dans la chaîne de blocs. Au total, le nœud SPV aura reçu moins d&#8217;un kilo-octet de données pour l&#8217;en-tête de bloc et le chemin de Merkle, une quantité de données plus de mille fois inférieure à un bloc complet (environ 1 mégaoctet actuellement).</p>
</div>
</div>
<div class="sect2 data-line-264">
<h3 id="_chaînes_de_blocs_de_test_de_bitcoin">Chaînes de blocs de test de Bitcoin</h3>
<div class="paragraph data-line-266">
<p>Vous pourriez être surpris d&#8217;apprendre qu&#8217;il existe plus d&#8217;une chaîne de blocs Bitcoin. La chaîne de blocs Bitcoin "principale", celle créée par Satoshi Nakamoto le 3 janvier 2009, celle avec le bloc de genèse que nous avons étudié dans ce chapitre, s&#8217;appelle <em>mainnet</em>. Il existe d&#8217;autres chaînes de blocs Bitcoin qui sont utilisées à des fins de test : actuellement <em>testnet</em>, <em>segnet</em> et <em>regtest</em>. Regardons chacun à son tour.</p>
</div>
<div class="sect3 data-line-269">
<h4 id="_testnet_le_terrain_de_test_de_bitcoin">Testnet : Le terrain de test de Bitcoin</h4>
<div class="paragraph data-line-271">
<p>Testnet est le nom de la chaîne de blocs, du réseau et de la devise de test utilisés à des fins de test. Le testnet est un réseau P2P en direct complet, avec des portefeuilles, des bitcoins de test (pièces de testnet), l&#8217;exploitation minière et toutes les autres fonctionnalités du réseau principal. Il n&#8217;y a vraiment que deux différences : les pièces testnet sont censées être sans valeur et la difficulté d&#8217;extraction doit être suffisamment faible pour que n&#8217;importe qui puisse extraire des pièces testnet relativement facilement (en les gardant sans valeur).</p>
</div>
<div class="paragraph data-line-273">
<p>Tout développement logiciel destiné à une utilisation en production sur le réseau principal de Bitcoin doit d&#8217;abord être testé sur testnet avec des pièces de test. Cela protège à la fois les développeurs des pertes financières dues aux bogues et le réseau des comportements involontaires dus aux bogues.</p>
</div>
<div class="paragraph data-line-275">
<p>Garder les pièces sans valeur et l&#8217;exploitation minière facile, cependant, n&#8217;est pas facile. Malgré les appels des développeurs, certaines personnes utilisent des équipements de minage avancés (GPU et ASIC) pour miner sur testnet. Cela augmente la difficulté, rend impossible l&#8217;extraction avec un processeur et rend finalement assez difficile l&#8217;obtention de pièces de test pour que les gens commencent à les évaluer, de sorte qu&#8217;elles ne sont pas sans valeur. En conséquence, de temps en temps, le testnet doit être supprimé et redémarré à partir d&#8217;un nouveau bloc de genèse, réinitialisant la difficulté.</p>
</div>
<div class="paragraph data-line-277">
<p>Le testnet actuel s&#8217;appelle <em>testnet3</em>, la troisième itération de testnet, redémarré en février 2011 pour réinitialiser la difficulté du testnet précédent.</p>
</div>
<div class="paragraph data-line-279">
<p>Gardez à l&#8217;esprit que testnet3 est une grande chaîne de blocs, dépassant 25 Go en 2021. Il faudra environ un jour pour se synchroniser complètement et utiliser les ressources de votre ordinateur. Pas autant que le réseau principal, mais pas exactement "léger" non plus. Une bonne façon d&#8217;exécuter un nœud testnet est d&#8217;utiliser une image de machine virtuelle (par exemple, VirtualBox, Docker, Cloud Server, etc.) dédiée à cet effet.</p>
</div>
<div class="sect4 data-line-281">
<h5 id="_utiliser_testnet">Utiliser testnet</h5>
<div class="paragraph data-line-283">
<p>Bitcoin Core, comme presque tous les autres logiciels bitcoin, prend entièrement en charge le fonctionnement sur testnet au lieu du réseau principal. Toutes les fonctions de Bitcoin Core fonctionnent sur testnet, y compris le portefeuille, l&#8217;extraction de pièces testnet et la synchronisation d&#8217;un nœud testnet complet.</p>
</div>
<div class="paragraph data-line-285">
<p>Pour démarrer Bitcoin Core sur testnet au lieu du réseau principal, vous utilisez le commutateur <code>testnet</code> :</p>
</div>
<div class="listingblock data-line-287">
<div class="content">
<pre>$ bitcoind -testnet</pre>
</div>
</div>
<div class="paragraph data-line-291">
<p>Dans les journaux, vous devriez voir que bitcoind construit une nouvelle chaîne de blocs dans le sous-répertoire <code>testnet3</code> du répertoire bitcoind par défaut :</p>
</div>
<div class="listingblock data-line-293">
<div class="content">
<pre>bitcoind : Utilisation du répertoire de données /home/username/.bitcoin/testnet3</pre>
</div>
</div>
<div class="paragraph data-line-297">
<p>Pour vous connecter à bitcoind, vous utilisez l&#8217;outil de ligne de commande <code>bitcoin-cli</code>, mais vous devez également le passer en mode testnet :</p>
</div>
<div class="listingblock data-line-299">
<div class="content">
<pre>$ bitcoin-cli -testnet getblockchaininfo
{
  "chain": "test",
  "blocks": 1088,
  "headers": 139999,
  "bestblockhash": "0000000063d29909d475a1c4ba26da64b368e56cce5d925097bf3a2084370128",
  "difficulty": 1,
  "mediantime": 1337966158,
  "verificationprogress": 0.001644065914099759,
  "chainwork": "0000000000000000000000000000000000000000000000000000044104410441",
  "pruned": false,
  "softforks": [

  [...]</pre>
</div>
</div>
<div class="paragraph data-line-316">
<p>Vous pouvez également exécuter sur testnet3 avec d&#8217;autres implémentations de nœud complet, telles que <code>btcd</code> (écrit en Go) et <code>bcoin</code> (écrit en JavaScript), pour expérimenter et apprendre dans d&#8217;autres langages et environnements de programmation.</p>
</div>
<div class="paragraph data-line-318">
<p>En 2021, testnet3 prend en charge toutes les fonctionnalités du réseau principal, y compris le témoin séparé (voir <a href="#segwit">Témoin séparé</a>). Par conséquent, testnet3 peut également être utilisé pour tester les fonctionnalités de témoin séparé.</p>
</div>
</div>
</div>
<div class="sect3 data-line-320">
<h4 id="_segnet_le_réseau_de_test_des_témoins_séparés">Segnet : Le réseau de test des témoins séparés</h4>
<div class="paragraph data-line-323">
<p>En 2016, un testnet à usage spécial a été lancé pour aider au développement et aux tests de Segregated Witness ou Témoin séparé (alias segwit; voir <a href="#segwit">Témoin séparé</a>). Cette chaîne de blocs de test s&#8217;appelle <code>segnet</code> et peut être rejointe en exécutant une version spéciale (branche) de Bitcoin Core.</p>
</div>
<div class="paragraph data-line-325">
<p>Depuis que segwit a été ajouté à testnet3, il n&#8217;est plus nécessaire d&#8217;utiliser segnet pour tester les fonctionnalités de segwit.</p>
</div>
<div class="paragraph data-line-327">
<p>À l&#8217;avenir, il est probable que nous verrons d&#8217;autres chaînes de blocs testnet spécialement conçues pour tester une seule fonctionnalité ou un changement architectural majeur, comme segnet.</p>
</div>
</div>
<div class="sect3 data-line-329">
<h4 id="_regtest_la_chaîne_de_blocs_locale">Regtest : La chaîne de blocs locale</h4>
<div class="paragraph data-line-331">
<p>Regtest, qui signifie "Regression Testing", (ou tests de régressions) est une fonctionnalité de Bitcoin Core qui vous permet de créer une chaîne de blocs locale à des fins de test. Contrairement à testnet3, qui est une chaîne de blocs de test publique et partagée, les chaînes de blocs regtest sont destinées à être exécutées comme des systèmes fermés pour les tests locaux. Vous lancez une chaîne de blocs regtest à partir de zéro, en créant un bloc de genèse local. Vous pouvez ajouter d&#8217;autres nœuds au réseau ou l&#8217;exécuter avec un seul nœud uniquement pour tester le logiciel Bitcoin Core.</p>
</div>
<div class="paragraph data-line-333">
<p>Pour démarrer Bitcoin Core en mode regtest, vous utilisez le drapeau <code>regtest</code> :</p>
</div>
<div class="listingblock data-line-335">
<div class="content">
<pre>$ bitcoind -regtest</pre>
</div>
</div>
<div class="paragraph data-line-339">
<p>Tout comme avec testnet, Bitcoin Core initialisera une nouvelle chaîne de blocs sous le sous-répertoire <em>regtest</em> de votre répertoire par défaut bitcoind :</p>
</div>
<div class="listingblock data-line-341">
<div class="content">
<pre>bitcoind: Using data directory /home/username/.bitcoin/regtest</pre>
</div>
</div>
<div class="paragraph data-line-345">
<p>Pour utiliser l&#8217;outil de ligne de commande, vous devez également spécifier l&#8217;indicateur <code>regtest</code>. Essayons la commande <code>getblockchaininfo</code> pour inspecter la chaîne de blocs regtest :</p>
</div>
<div class="listingblock data-line-347">
<div class="content">
<pre>$ bitcoin-cli -regtest getblockchaininfo
{
  "chain": "regtest",
  "blocks": 0,
  "headers": 0,
  "bestblockhash": "0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206",
  "difficulty": 4.656542373906925e-10,
  "mediantime": 1296688602,
  "verificationprogress": 1,
  "chainwork": "0000000000000000000000000000000000000000000000000000000000000002",
  "pruned": false,
  [...]</pre>
</div>
</div>
<div class="paragraph data-line-362">
<p>Comme vous pouvez le voir, il n&#8217;y a pas encore de blocs. Exploitons-en quelques-uns (500 blocs) et gagnons la récompense :</p>
</div>
<div class="listingblock data-line-364">
<div class="content">
<pre>$ bitcoin-cli -regtest generate 500
[
  "7afed70259f22c2bf11e406cb12ed5c0657b6e16a6477a9f8b28e2046b5ba1ca",
  "1aca2f154a80a9863a9aac4c72047a6d3f385c4eec5441a4aafa6acaa1dada14",
  "4334ecf6fb022f30fbd764c3ee778fabbd53b4a4d1950eae8a91f1f5158ed2d1",
  "5f951d34065efeaf64e54e91d00b260294fcdfc7f05dbb5599aec84b957a7766",
  "43744b5e77c1dfece9d05ab5f0e6796ebe627303163547e69e27f55d0f2b9353",
   [...]
  "6c31585a48d4fc2b3fd25521f4515b18aefb59d0def82bd9c2185c4ecb754327"
]</pre>
</div>
</div>
<div class="paragraph data-line-377">
<p>Cela ne prendra que quelques secondes pour miner tous ces blocs, ce qui facilite certainement les tests. Si vous vérifiez le solde de votre portefeuille, vous verrez que vous avez gagné une récompense pour les 400 premiers blocs (les récompenses coinbase doivent avoir une profondeur de 100 blocs avant que vous puissiez les dépenser) :</p>
</div>
<div class="listingblock data-line-379">
<div class="content">
<pre>$ bitcoin-cli -regtest getbalance
12462.50000000</pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-384">
<h3 id="_utiliser_des_chaînes_de_blocs_de_test_pour_le_développement">Utiliser des chaînes de blocs de test pour le développement</h3>
<div class="paragraph data-line-386">
<p>Les différentes chaînes de blocs de Bitcoin (<code>regtest</code>, <code>segnet</code>, <code>testnet3</code>, <code>mainnet</code>) offrent une gamme d&#8217;environnements de test pour le développement de bitcoin. Utilisez les chaînes de blocs de test, que vous développiez pour Bitcoin Core ou un autre client de consensus à nœud complet ; une application telle qu&#8217;un portefeuille, un échange, un site de commerce électronique ; ou même développer de nouveaux contrats intelligents et des scripts complexes.</p>
</div>
<div class="paragraph data-line-25">
<p>Vous pouvez utiliser les chaînes de blocs de test pour établir un pipeline de développement. Testez votre code localement sur un <code>regtest</code> au fur et à mesure que vous le développez. Une fois que vous êtes prêt à l&#8217;essayer sur un réseau public, passez à <code>testnet</code> pour exposer votre code à un environnement plus dynamique avec plus de diversité de code et d&#8217;applications. Enfin, une fois que vous êtes sûr que votre code fonctionne comme prévu, passez à <code>mainnet</code> pour le déployer en production. Au fur et à mesure que vous apportez des modifications, des améliorations, des corrections de bogues, etc., redémarrez le pipeline, en déployant d&#8217;abord chaque modification sur <code>regtest</code>, puis sur <code>testnet</code>, et enfin en production.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="mining">Minage et Consensus</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="sect2 data-line-5">
<h3 id="_présentation_3">Présentation</h3>
<div class="paragraph data-line-7">
<p>Le mot "exploitation minière" ou "minage" est quelque peu trompeur. En évoquant l&#8217;extraction de métaux précieux, il focalise notre attention sur la récompense du minage, le nouveau bitcoin créé dans chaque bloc. Bien que l&#8217;exploitation minière soit incitée par cette récompense, l&#8217;objectif principal de l&#8217;exploitation minière n&#8217;est pas la récompense ou la génération de nouvelles pièces. Si vous considérez l&#8217;exploitation minière uniquement comme le processus par lequel les pièces sont créées, vous confondez les moyens (incitations) avec le but du processus. Le minage est le mécanisme qui sous-tend la chambre de compensation décentralisée, par laquelle les transactions sont validées et compensées. Le minage est l&#8217;invention qui rend le bitcoin spécial, un mécanisme de sécurité décentralisé qui est à la base de l&#8217;argent numérique P2P.</p>
</div>
<div class="paragraph data-line-9">
<p>L&#8217;exploitation minière <em>sécurise le système Bitcoin</em> et permet l&#8217;émergence d&#8217;un <em>consensus à l&#8217;échelle du réseau sans autorité centrale</em>. La récompense des pièces nouvellement frappées et des frais de transaction est un système d&#8217;incitation qui aligne les actions des mineurs sur la sécurité du réseau, tout en mettant en œuvre simultanément l&#8217;offre monétaire.</p>
</div>
<div class="admonitionblock tip data-line-12">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-13">
<p>Le but du minage n&#8217;est pas la création de nouveaux bitcoins. C&#8217;est le système d&#8217;incitation. Le minage est le mécanisme par lequel la <em>sécurité</em> du bitcoin est <em>décentralisée</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-16">
<p>Les mineurs valident les nouvelles transactions et les enregistrent dans le grand livre mondial. Un nouveau bloc, contenant les transactions qui se sont produites depuis le dernier bloc, est "miné" toutes les 10 minutes en moyenne, ajoutant ainsi ces transactions à la chaîne de blocs. Les transactions qui font partie d&#8217;un bloc et ajoutées à la chaîne de blocs sont considérées comme "confirmées", ce qui permet aux nouveaux propriétaires de bitcoin de dépenser le bitcoin qu&#8217;ils ont reçu dans ces transactions.</p>
</div>
<div class="paragraph data-line-18">
<p>Les mineurs reçoivent deux types de récompenses en échange de la sécurité fournie par le minage : de nouvelles pièces créées avec chaque nouveau bloc, également appelées <em>récompense de bloc</em> ou <em>récompense de coinbase</em>, et les frais de transaction de toutes les transactions incluses dans le bloc. Pour gagner cette récompense, les mineurs s&#8217;affrontent pour résoudre un problème mathématique difficile basé sur un algorithme de hachage cryptographique. La solution au problème, appelée Proof-of-Work (ou preuve de travail), est incluse dans le nouveau bloc et agit comme preuve que le mineur a déployé des efforts informatiques importants. La compétition pour résoudre l&#8217;algorithme de preuve de travail pour gagner la récompense et le droit d&#8217;enregistrer les transactions sur la chaîne de blocs est la base du modèle de sécurité de Bitcoin.</p>
</div>
<div class="paragraph data-line-20">
<p>Le processus est appelé minage parce que la récompense (nouvelle génération de pièces) est conçue pour simuler des rendements décroissants, tout comme le minage de métaux précieux. La masse monétaire de Bitcoin est créée par l&#8217;exploitation minière, de la même manière qu&#8217;une banque centrale émet de la nouvelle monnaie en imprimant des billets de banque. La quantité maximale de bitcoins nouvellement créés qu&#8217;un mineur peut ajouter à un bloc diminue environ tous les quatre ans (ou précisément tous les 210 000 blocs). Il a commencé à 50 bitcoins par bloc en janvier 2009 et a été réduit de moitié à 25 bitcoins par bloc en novembre 2012. Il a été réduit de moitié à 12,5 bitcoins en juillet 2016 et de nouveau à 6,25 bitcoins en mai 2020. Sur la base de cette formule, les récompenses de minage de bitcoins diminuent de façon exponentielle. jusqu&#8217;à environ l&#8217;an 2140, lorsque tous les bitcoins (20,99999998 millions) auront été émis. Après 2140, aucun nouveau bitcoin ne sera émis.</p>
</div>
<div class="paragraph data-line-22">
<p>Les mineurs de Bitcoin gagnent également des frais sur les transactions. Chaque transaction comprend généralement des frais de transaction, sous la forme d&#8217;un surplus de bitcoin entre les entrées et les sorties de la transaction. Le mineur de bitcoin gagnant peut "garder la monnaie" sur les transactions incluses dans le bloc gagnant. Aujourd&#8217;hui, les frais représentent 0,5 % ou moins des revenus d&#8217;un mineur de bitcoin, la grande majorité provenant du bitcoin nouvellement créé. Cependant, à mesure que la récompense de bloc diminue avec le temps et que le nombre de transactions par bloc augmente, une plus grande proportion des revenus de minage de bitcoins proviendra des frais. Progressivement, la récompense minière sera dominée par les frais de transaction, qui constitueront la principale incitation pour les mineurs. Après 2140, la quantité de nouveaux bitcoins dans chaque bloc tombe à zéro et l&#8217;extraction de bitcoins ne sera encouragée que par les frais de transaction.</p>
</div>
<div class="paragraph data-line-24">
<p>Dans ce chapitre, nous examinerons d&#8217;abord l&#8217;exploitation minière en tant que mécanisme d&#8217;approvisionnement monétaire, puis nous examinerons la fonction la plus importante de l&#8217;exploitation minière : le mécanisme de consensus décentralisé qui sous-tend la sécurité du bitcoin.</p>
</div>
<div class="paragraph data-line-26">
<p>Pour comprendre l&#8217;exploitation minière et le consensus, nous suivrons la transaction d&#8217;Alice telle qu&#8217;elle est reçue et ajoutée à un bloc par l&#8217;équipement minier de Jing. Ensuite, nous suivrons le bloc tel qu&#8217;il est extrait, ajouté à la chaîne de blocs et accepté par le réseau Bitcoin à travers le processus de consensus émergent.</p>
</div>
<div class="sect3 data-line-28">
<h4 id="_économie_bitcoin_et_création_de_devises">Économie Bitcoin et création de devises</h4>
<div class="paragraph data-line-30">
<p>Les Bitcoins sont "frappés" lors de la création de chaque bloc à un taux fixe et décroissant. Chaque bloc, généré en moyenne toutes les 10 minutes, contient des bitcoins entièrement nouveaux, créés à partir de rien. Tous les 210 000 blocs, soit environ tous les quatre ans, le taux d&#8217;émission des devises est diminué de 50 %. Pendant les quatre premières années de fonctionnement du réseau, chaque bloc contenait 50 nouveaux bitcoins.</p>
</div>
<div class="paragraph data-line-32">
<p>En novembre 2012, le nouveau taux d&#8217;émission de bitcoins a été réduit à 25 bitcoins par bloc. En juillet 2016, il a été réduit à 12,5 bitcoins par bloc, et en mai 2020, il a de nouveau été réduit à 6,25 bitcoins par bloc. Le taux de nouvelles pièces diminue ainsi de manière exponentielle sur 32 "halvings" (ou "réductions de moitié") jusqu&#8217;au bloc 6 720 000 (miné environ en 2137), lorsqu&#8217;il atteint l&#8217;unité monétaire minimale de 1 satoshi. Enfin, après 6,93 millions de blocs, en 2140 environ, près de 2 099 999 997 690 000 satoshis, soit près de 21 millions de bitcoins, seront émis. Par la suite, les blocs ne contiendront plus de nouveaux bitcoins et les mineurs seront récompensés uniquement par les frais de transaction. <a href="#bitcoin_money_supply">Offre de monnaie bitcoin au fil du temps basée sur un taux d&#8217;émission géométriquement décroissant</a> montre le bitcoin total en circulation au fil du temps, à mesure que l&#8217;émission de devises diminue.</p>
</div>
<div id="bitcoin_money_supply" class="imageblock data-line-36">
<div class="content">
<img src="images/mbc2_1001.png" alt="Masse monétaire Bitcoin">
</div>
<div class="title">Figure 63. Offre de monnaie bitcoin au fil du temps basée sur un taux d&#8217;émission géométriquement décroissant</div>
</div>
<div class="admonitionblock note data-line-39">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-40">
<p>Le nombre maximum de pièces minées est la <em>limite supérieure</em> des récompenses minières possibles pour le bitcoin. En pratique, un mineur peut intentionnellement exploiter un bloc en prenant moins que la récompense complète. Ces blocs ont déjà été extraits et d&#8217;autres pourraient l&#8217;être à l&#8217;avenir, ce qui entraînerait une émission totale inférieure de la monnaie.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-43">
<p>Dans l&#8217;exemple de code dans <a href="#max_money">Un script pour calculer la quantité totale de bitcoins qui sera émise</a>, nous calculons le montant total de bitcoin qui sera émis.</p>
</div>
<div id="max_money" class="exampleblock data-line-47">
<div class="title">Example 22. Un script pour calculer la quantité totale de bitcoins qui sera émise</div>
<div class="content">
<div class="listingblock data-line-49">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># La récompense de bloc originale pour les mineurs était de 50 BTC
start_block_reward = 50
# 210000 est d'environ tous les 4 ans avec un intervalle de bloc de 10 minutes
reward_interval = 210000

def max_money():
    # 50 BTC = 50 0000 0000 Satoshis
    current_reward = 50 * 10**8
    total = 0
    while current_reward &gt; 0:
        total += reward_interval * current_reward
        current_reward /= 2
    return total

print "Total BTC to ever be created:", max_money(), "Satoshis"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-54">
<p><a href="#max_money_run">Exécuter le script max_money.py</a> affiche la sortie produite en exécutant ce script.</p>
</div>
<div id="max_money_run" class="exampleblock data-line-58">
<div class="title">Example 23. Exécuter le script max_money.py</div>
<div class="content">
<div class="listingblock data-line-60">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python max_money.py
Total BTC to ever be created: 2100000000000000.0 Satoshis</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-66">
<p>L&#8217;émission finie et décroissante crée une masse monétaire fixe qui résiste à l&#8217;inflation. Contrairement à une monnaie fiduciaire, qui peut être imprimée en nombre infini par une banque centrale, le bitcoin ne peut jamais être gonflé par l&#8217;impression.</p>
</div>
<div class="sidebarblock data-line-69">
<div class="content">
<div class="title">Argent déflationniste</div>
<div class="paragraph data-line-70">
<p>La conséquence la plus importante et la plus débattue d&#8217;une émission monétaire fixe et décroissante est que la monnaie a tendance à être intrinsèquement déflationniste. La déflation est le phénomène d&#8217;appréciation de la valeur due à une inadéquation entre l&#8217;offre et la demande qui fait monter la valeur (et le taux de change) d&#8217;une monnaie. Le contraire de l&#8217;inflation, la déflation des prix, signifie que l&#8217;argent a plus de pouvoir d&#8217;achat au fil du temps.</p>
</div>
<div class="paragraph data-line-72">
<p>De nombreux économistes soutiennent qu&#8217;une économie déflationniste est une catastrophe qu&#8217;il faut éviter à tout prix. En effet, en période de déflation rapide, les gens ont tendance à accumuler de l&#8217;argent au lieu de le dépenser, en espérant que les prix chuteront. Un tel phénomène s&#8217;est déroulé au cours de la « décennie perdue » du Japon, lorsqu&#8217;un effondrement complet de la demande a poussé la monnaie dans une spirale déflationniste.</p>
</div>
<div class="paragraph data-line-74">
<p>Les experts du Bitcoin affirment que la déflation n&#8217;est pas mauvaise en soi. La déflation est plutôt associée à un effondrement de la demande car c&#8217;est le seul exemple de déflation que nous ayons à étudier. Dans une monnaie fiduciaire avec possibilité d&#8217;impression illimitée, il est très difficile d&#8217;entrer dans une spirale déflationniste à moins qu&#8217;il n&#8217;y ait un effondrement complet de la demande et une réticence à imprimer de l&#8217;argent. La déflation du bitcoin n&#8217;est pas causée par un effondrement de la demande, mais par une offre limitée de manière prévisible.</p>
</div>
<div class="paragraph data-line-76">
<p>L&#8217;aspect positif de la déflation, bien sûr, c&#8217;est qu&#8217;elle est le contraire de l&#8217;inflation. L&#8217;inflation provoque une dépréciation lente mais inévitable de la monnaie, se traduisant par une forme de taxation cachée qui punit les épargnants afin de renflouer les débiteurs (y compris les plus gros débiteurs, les gouvernements eux-mêmes). Les monnaies sous contrôle gouvernemental souffrent de l&#8217;aléa moral d&#8217;une émission facile de dette qui peut ensuite être effacée par la dépréciation aux dépens des épargnants.</p>
</div>
<div class="paragraph data-line-78">
<p>Il reste à voir si l&#8217;aspect déflationniste de la monnaie est un problème lorsqu&#8217;il n&#8217;est pas entraîné par une rétraction économique rapide, ou un avantage parce que la protection contre l&#8217;inflation et l&#8217;avilissement l&#8217;emporte largement sur les risques de déflation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-81">
<h3 id="_consensus_décentralisé">Consensus décentralisé</h3>
<div class="paragraph data-line-83">
<p>Dans le chapitre précédent, nous avons examiné la chaîne de blocs, le registre public mondial (liste) de tous transactions, que tout le monde dans le réseau Bitcoin accepte comme enregistrement de propriété faisant autorité.</p>
</div>
<div class="paragraph data-line-85">
<p>Mais comment tout le monde dans le réseau peut-il s&#8217;entendre sur une seule « vérité » universelle sur qui possède quoi, sans avoir à faire confiance à personne ? Tous les systèmes de paiement traditionnels dépendent d&#8217;un modèle de confiance qui a une autorité centrale fournissant un service de chambre de compensation, vérifiant et compensant essentiellement toutes les transactions. Bitcoin n&#8217;a pas d&#8217;autorité centrale, mais d&#8217;une manière ou d&#8217;une autre, chaque nœud complet possède une copie complète d&#8217;un grand livre public auquel il peut faire confiance en tant qu&#8217;enregistrement faisant autorité. La chaîne de blocs n&#8217;est pas créée par une autorité centrale, mais est assemblée indépendamment par chaque nœud du réseau. D&#8217;une manière ou d&#8217;une autre, chaque nœud du réseau, agissant sur les informations transmises via des connexions réseau non sécurisées, peut arriver à la même conclusion et assembler une copie du même registre public que tout le monde. Ce chapitre examine le processus par lequel le réseau Bitcoin parvient à un consensus mondial sans autorité centrale.</p>
</div>
<div class="paragraph data-line-87">
<p>La principale invention de Satoshi Nakamoto est le mécanisme décentralisé de <em>consensus émergent</em>. Emergent, parce que le consensus n&#8217;est pas atteint explicitement - il n&#8217;y a pas d&#8217;élection ou de moment fixe où le consensus se produit. Au lieu de cela, le consensus est un artefact émergent de l&#8217;interaction asynchrone de milliers de nœuds indépendants, qui suivent tous des règles simples. Toutes les propriétés du bitcoin, y compris la monnaie, les transactions, les paiements et le modèle de sécurité qui ne dépend pas de l&#8217;autorité centrale ou de la confiance, découlent de cette invention.</p>
</div>
<div class="paragraph data-line-89">
<p>Le consensus décentralisé de Bitcoin émerge de l&#8217;interaction de quatre processus qui se produisent indépendamment sur les nœuds du réseau :</p>
</div>
<div class="ulist pagebreak-before data-line-92">
<ul>
<li class="data-line-92">
<p>Vérification indépendante de chaque transaction, par chaque nœud complet, sur la base d&#8217;une liste complète de critères</p>
</li>
<li class="data-line-93">
<p>Agrégation indépendante de ces transactions dans de nouveaux blocs par des nœuds de minage, associée à un calcul démontré via un algorithme de preuve de travail</p>
</li>
<li class="data-line-94">
<p>Vérification indépendante des nouveaux blocs par chaque nœud et assemblage dans une chaîne</p>
</li>
<li class="data-line-95">
<p>Sélection indépendante, par chaque nœud, de la chaîne avec le calcul le plus cumulatif démontré par la preuve de travail</p>
</li>
</ul>
</div>
<div class="paragraph data-line-97">
<p>Dans les prochaines sections, nous examinerons ces processus et la manière dont ils interagissent pour créer la propriété émergente du consensus à l&#8217;échelle du réseau qui permet à n&#8217;importe quel nœud Bitcoin d&#8217;assembler sa propre copie du grand livre public mondial faisant autorité.</p>
</div>
</div>
<div class="sect2 data-line-100">
<h3 id="tx_verification">Vérification indépendante des transactions</h3>
<div class="paragraph data-line-102">
<p>Dans <a href="#transactions">Opérations</a>, nous avons vu comment un logiciel de portefeuille crée des transactions en collectant des UTXO, en fournissant les scripts de déverrouillage appropriés, puis en construisant de nouvelles sorties attribuées à un nouveau propriétaire. La transaction résultante est ensuite envoyée aux nœuds voisins du réseau Bitcoin afin qu&#8217;elle puisse être propagée sur l&#8217;ensemble du réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-104">
<p>Cependant, avant de transmettre les transactions à ses voisins, chaque nœud Bitcoin qui reçoit une transaction vérifiera d&#8217;abord la transaction. Cela garantit que seules les transactions valides sont propagées sur le réseau, tandis que les transactions non valides sont rejetées au premier nœud qui les rencontre.</p>
</div>
<div class="paragraph data-line-106">
<p>Chaque nœud vérifie chaque transaction par rapport à une longue liste de critères :</p>
</div>
<div class="ulist data-line-108">
<ul>
<li class="data-line-108">
<p>La syntaxe et la structure des données de la transaction doivent être correctes.</p>
</li>
<li class="data-line-109">
<p>Ni les listes d&#8217;entrées ni de sorties ne sont vides.</p>
</li>
<li class="data-line-110">
<p>La taille de la transaction est inférieure à la taille maximale autorisée pour un bloc excluant les données témoins, comme indiqué dans <a href="https://bit.ly/3t623VL" data-href="https://bit.ly/3t623VL"><em>tx_check.cpp</em></a>.</p>
</li>
<li class="data-line-111">
<p>Chaque valeur de sortie, ainsi que le total, doit être dans la plage de valeurs autorisée (moins de 21 millions de pièces, plus que le seuil de <em>poussière</em>).</p>
</li>
<li class="data-line-112">
<p>Aucune des entrées n&#8217;a hash=0, N=–1 (les transactions coinbase ne doivent pas être relayées).</p>
</li>
<li class="data-line-113">
<p><code>nLocktime</code> est égal à <code>INT_MAX</code>, ou les valeurs <code>nLocktime</code> et <code>nSequence</code> sont satisfaites selon <code>MedianTimePast</code>.</p>
</li>
<li class="data-line-114">
<p>La taille de la transaction en octets est supérieure ou égale à 82.</p>
</li>
<li class="data-line-115">
<p>Le nombre d&#8217;opérations de signature (SIGOPS) contenues dans la transaction est inférieur à la limite d&#8217;opérations de signature.</p>
</li>
<li class="data-line-116">
<p>Le script de déverrouillage (<code>scriptSig</code>) ne peut pousser que des nombres sur la pile, et le script de verrouillage (<code>scriptPubkey</code>) doit correspondre aux formes <code>IsStandard</code> (cela rejette les transactions "non standard").</p>
</li>
<li class="data-line-117">
<p>Une transaction correspondante dans le bassin ou dans un bloc de la branche principale doit exister.</p>
</li>
<li class="data-line-118">
<p>Pour chaque entrée, si la sortie référencée existe dans une autre transaction du bassin, la transaction doit être rejetée.</p>
</li>
<li class="data-line-119">
<p>Pour chaque entrée, regardez dans la branche principale et le bassin de transactions pour trouver sa transaction parente. Si la transaction parent est manquante pour une entrée, il s&#8217;agira d&#8217;une transaction orpheline. Ajouter au bassin de transactions orphelines, si une transaction correspondante n&#8217;est pas déjà dans le bassin.</p>
</li>
<li class="data-line-120">
<p>Pour chaque entrée, si sa transaction parente est une transaction coinbase, elle doit avoir au moins <code>COINBASE_MATURITY</code> (100) confirmations.</p>
</li>
<li class="data-line-121">
<p>Pour chaque entrée, la sortie référencée doit exister et ne peut pas déjà être dépensée.</p>
</li>
<li class="data-line-122">
<p>En utilisant les transactions parentes pour obtenir les valeurs d&#8217;entrée, vérifiez que chaque valeur d&#8217;entrée, ainsi que la somme, se situent dans la plage de valeurs autorisée (moins de 21 millions de pièces, plus de 0).</p>
</li>
<li class="data-line-123">
<p>Rejeter si la somme des valeurs d&#8217;entrée est inférieure à la somme des valeurs de sortie.</p>
</li>
<li class="data-line-124">
<p>Rejeter si les frais de transaction seraient trop bas (<code>minRelayTxFee</code>) pour entrer dans un bloc vide.</p>
</li>
<li class="data-line-125">
<p>Les scripts de déverrouillage pour chaque entrée doivent être validés par rapport aux scripts de verrouillage de sortie correspondants.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-127">
<p>Ces conditions peuvent être vues en détail dans les fonctions <code>AcceptToMemoryPool</code>, <code>CheckTransaction</code> et <code>CheckInputs</code> dans Bitcoin Core. Notez que les conditions changent avec le temps, pour faire face à de nouveaux types d&#8217;attaques par déni de service ou parfois pour assouplir les règles afin d&#8217;inclure davantage de types de transactions.</p>
</div>
<div class="paragraph data-line-129">
<p>En vérifiant indépendamment chaque transaction lors de sa réception et avant de la propager, chaque nœud crée un bassin de transactions valides (mais non confirmées) connu sous le nom de <em>bassin de transaction</em>, <em>bassin de mémoire</em> ou <em>mempool</em>.</p>
</div>
</div>
<div class="sect2 data-line-131">
<h3 id="_nœuds_miniers">Nœuds miniers</h3>
<div class="paragraph data-line-133">
<p>Certains des nœuds du réseau Bitcoin sont des nœuds spécialisés appelés <em>mineurs</em>. Dans <a href="#ch01_intro_what_is_bitcoin">Présentation</a> nous avons présenté Jing, un étudiant en génie informatique à Shanghai, en Chine, est un mineur de bitcoin. Jing gagne du bitcoin en exécutant une "plate-forme minière", qui est un système informatique spécialisé conçu pour exploiter le bitcoin. Le matériel minier spécialisé de Jing est connecté à un serveur exécutant un nœud Bitcoin complet. Contrairement à Jing, certains mineurs minent sans nœud complet, comme nous le verrons dans <a href="#mining_pools">Groupes miniers</a>. Comme tous les autres nœuds complets, le nœud de Jing reçoit et propage les transactions non confirmées sur le réseau Bitcoin. Le nœud de Jing, cependant, agrège également ces transactions dans de nouveaux blocs.</p>
</div>
<div class="paragraph data-line-135">
<p>Le nœud de Jing est à l&#8217;écoute de nouveaux blocs, propagés sur le réseau Bitcoin, comme tous les nœuds. Cependant, l&#8217;arrivée d&#8217;un nouveau bloc a une signification particulière pour un nœud minier. La compétition entre mineurs se termine effectivement par la propagation d&#8217;un nouveau bloc qui fait office d&#8217;annonce d&#8217;un gagnant. Pour les mineurs, recevoir un nouveau bloc valide signifie que quelqu&#8217;un d&#8217;autre a gagné la compétition et qu&#8217;il (on) a perdu. Cependant, la fin d&#8217;un tour d&#8217;une compétition est aussi le début du tour suivant. Le nouveau bloc n&#8217;est pas seulement un drapeau à damier, marquant la fin de la course; c&#8217;est aussi le pistolet de départ dans la course pour le bloc suivant.</p>
</div>
</div>
<div class="sect2 data-line-137">
<h3 id="_agréger_les_transactions_en_blocs">Agréger les transactions en blocs</h3>
<div class="paragraph data-line-139">
<p>Après avoir validé les transactions, un nœud Bitcoin les ajoutera au <em>bassin de mémoire</em>, ou <em>bassin de transaction</em>, où les transactions attendent jusqu&#8217;à ce qu&#8217;elles puissent être incluses (exploitées) dans un bloc. Le nœud de Jing collecte, valide et relaie les nouvelles transactions comme n&#8217;importe quel autre nœud. Contrairement aux autres nœuds, cependant, le nœud de Jing regroupera ensuite ces transactions dans un <em>bloc candidat</em>.</p>
</div>
<div class="paragraph data-line-141">
<p>Suivons les blocs qui ont été créés à l&#8217;époque où Alice achetait une tasse de café au Bob&#8217;s Cafe (voir <a href="#cup_of_coffee">Acheter une tasse de café</a>). La transaction d&#8217;Alice a été incluse dans le bloc 277 316. Dans le but de démontrer les concepts de ce chapitre, supposons que ce bloc a été miné par le système de minage de Jing et suivons la transaction d&#8217;Alice au fur et à mesure qu&#8217;elle fait partie de ce nouveau bloc.</p>
</div>
<div class="paragraph data-line-143">
<p>Le nœud minier de Jing maintient une copie locale de la chaîne de blocs. Au moment où Alice achète la tasse de café, le nœud de Jing a assemblé une chaîne jusqu&#8217;au bloc 277 314. Le nœud de Jing écoute les transactions, essaie d&#8217;extraire un nouveau bloc et écoute également les blocs découverts par d&#8217;autres nœuds. Comme le nœud de Jing est en train d&#8217;exploiter, il reçoit le bloc 277 315 via le réseau Bitcoin. L&#8217;arrivée de ce bloc signifie la fin de la compétition pour le bloc 277 315 et le début de la compétition pour créer le bloc 277 316.</p>
</div>
<div class="paragraph data-line-145">
<p>Au cours des 10 minutes précédentes, alors que le nœud de Jing cherchait une solution au bloc 277 315, il collectait également des transactions en vue du bloc suivant. À ce jour, il a collecté quelques centaines de transactions dans le bassin de mémoire. Lors de la réception du bloc 277 315 et de sa validation, le nœud de Jing le comparera également à toutes les transactions du pool de mémoire et supprimera celles qui étaient incluses dans le bloc 277 315. Quelles que soient les transactions restantes dans le bassin de mémoire, elles ne sont pas confirmées et attendent d&#8217;être enregistrées dans un nouveau bloc.</p>
</div>
<div class="paragraph data-line-147">
<p>Le nœud de Jing construit immédiatement un nouveau bloc vide, un candidat pour le bloc 277 316. Ce bloc est appelé <em>bloc candidat</em> car ce n&#8217;est pas encore un bloc valide, car il ne contient pas de preuve de travail valide. Le bloc ne devient valide que si le mineur réussit à trouver une solution à l&#8217;algorithme de preuve de travail.</p>
</div>
<div class="paragraph data-line-149">
<p>Lorsque le nœud de Jing regroupe toutes les transactions du bassin de mémoire, le nouveau bloc candidat contient 418 transactions avec des frais de transaction totaux de 0,09094928 bitcoin. Vous pouvez voir ce bloc dans la chaîne de blocs à l&#8217;aide de l&#8217;interface de ligne de commande du client Bitcoin Core, comme indiqué dans <a href="#block277316">Utiliser la ligne de commande pour récupérer le bloc 277,316</a>.</p>
</div>
<div id="block277316" class="exampleblock data-line-153">
<div class="title">Example 24. Utiliser la ligne de commande pour récupérer le bloc 277,316</div>
<div class="content">
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getblockhash 277316

0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4

$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d9\
44a9b31b2cc7bdc4</code></pre>
</div>
</div>
<div class="listingblock data-line-166">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
    "confirmations" : 35561,
    "size" : 218629,
    "height" : 277316,
    "version" : 2,
    "merkleroot" : "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
    "tx" : [
        "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
        "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",

        ... 417 more transactions ...

       ],
    "time" : 1388185914,
    "nonce" : 924591752,
    "bits" : "1903a30c",
    "difficulty" : 1180923195.25802612,
    "chainwork" : "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
    "previousblockhash" : "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-191">
<h4 id="_la_transaction_coinbase">La transaction Coinbase</h4>
<div class="paragraph data-line-193">
<p>La première transaction d&#8217;un bloc est une transaction spéciale, appelée <em>transaction coinbase</em>. Cette transaction est construite par le nœud de Jing et contient sa <em>récompense</em> pour l&#8217;effort de minage.</p>
</div>
<div class="admonitionblock note data-line-196">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-197">
<p>Lorsque le bloc 277 316 a été miné, la récompense était de 25 bitcoins par bloc. Depuis, deux périodes de "halving" (ou "réduction de moitié") se sont écoulées. La récompense globale est passée à 12,5 bitcoins en juillet 2016 et à 6,25 bitcoins en mai 2020.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-200">
<p>Le nœud de Jing crée la transaction coinbase en tant que paiement sur son propre portefeuille : "Pay Jing&#8217;s address 25.09094928 bitcoin." Le montant total de la récompense que Jing collecte pour l&#8217;extraction d&#8217;un bloc est la somme de la récompense coinbase (25 nouveaux bitcoins) et des frais de transaction (0,09094928) de toutes les transactions incluses dans le bloc, comme indiqué dans <a href="#generation_tx_example">Transaction coinbase</a>.</p>
</div>
<div id="generation_tx_example" class="exampleblock data-line-205">
<div class="title">Example 25. Transaction coinbase</div>
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre>$ bitcoin-cli getrawtransaction d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f 1</pre>
</div>
</div>
<div class="listingblock c_less_space data-line-212">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hex" : "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f03443b0403858402062f503253482fffffffff0110c08d9500000000232102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac00000000",
    "txid" : "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "version" : 1,
    "locktime" : 0,
    "vin" : [
        {
            "coinbase" : "03443b0403858402062f503253482f",
            "sequence" : 4294967295
        }
    ],
    "vout" : [
        {
            "value" : 25.09094928,
            "n" : 0,
            "scriptPubKey" : {
                "asm" : "02aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21OP_CHECKSIG",
                "hex" : "2102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac",
                "reqSigs" : 1,
                "type" : "pubkey",
                "addresses" : [
                    "1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N"
                ]
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-243">
<p>Contrairement aux transactions régulières, la transaction coinbase ne consomme pas (ne dépense pas) d&#8217;UTXO comme entrées. Au lieu de cela, il n&#8217;a qu&#8217;une seule entrée, appelée <em>coinbase</em>, qui crée du bitcoin à partir de rien. La transaction coinbase a une sortie, payable à la propre adresse Bitcoin du mineur. La sortie de la transaction coinbase envoie la valeur de 25,09094928 bitcoin à l&#8217;adresse Bitcoin du mineur ; dans ce cas c&#8217;est <code>1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N</code>.</p>
</div>
</div>
<div class="sect3 data-line-245">
<h4 id="_récompense_et_frais_coinbase">Récompense et frais coinbase</h4>
<div class="paragraph data-line-247">
<p>Pour construire la transaction coinbase, le nœud de Jing calcule d&#8217;abord le montant total des frais de transaction en ajoutant toutes les entrées et sorties des 418 transactions qui ont été ajoutées au bloc. Les frais sont calculés comme suit :</p>
</div>
<div class="listingblock data-line-249">
<div class="content">
<pre>Frais totaux = Somme(entrées) - Somme(sorties)</pre>
</div>
</div>
<div class="paragraph data-line-253">
<p>Dans le bloc 277 316, le total des frais de transaction est de 0,09094928 bitcoin.</p>
</div>
<div class="paragraph data-line-255">
<p>Ensuite, le nœud de Jing calcule la récompense correcte pour le nouveau bloc. La récompense est calculée en fonction de la hauteur du bloc, à partir de 50 bitcoins par bloc et réduite de moitié tous les 210 000 blocs. Parce que ce bloc est à la hauteur 277 316, la récompense correcte est de 25 bitcoins.</p>
</div>
<div class="paragraph data-line-257">
<p>Le calcul peut être vu dans la fonction <code>GetBlockSubsidy</code> dans le client Bitcoin Core, comme indiqué dans <a href="#getblocksubsidy_source">Calcul de la récompense de bloc—Fonction GetBlockSubsidy, Client Bitcoin Core, main.cpp</a>.</p>
</div>
<div id="getblocksubsidy_source" class="exampleblock data-line-261">
<div class="title">Example 26. Calcul de la récompense de bloc—Fonction GetBlockSubsidy, Client Bitcoin Core, main.cpp</div>
<div class="content">
<div class="listingblock c_less_space data-line-264">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">CAmount GetBlockSubsidy(int nHeight, const Consensus::Params&amp; consensusParams)
{
    int halvings = nHeight / consensusParams.nSubsidyHalvingInterval;
    // Force la récompense du bloc à zéro lorsque le décalage vers la droite n'est pas défini.
    if (halvings &gt;= 64)
        return 0;

    CAmount nSubsidy = 50 * COIN;
    // La subvention est réduite de moitié tous les 210 000 blocs, ce qui se produira environ tous les 4 ans.
    nSubsidy &gt;&gt;= halvings;
    return nSubsidy;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-280">
<p>La subvention initiale est calculée en satoshis en multipliant 50 par la constante <code>COIN</code> (100 000 000 satoshis). Cela fixe la récompense initiale (<code>nSubsidy</code>) à 5 milliards de satoshis.</p>
</div>
<div class="paragraph data-line-282">
<p>Ensuite, la fonction calcule le nombre de <code>halvings</code> qui se sont produits en divisant la hauteur actuelle du bloc par l&#8217;intervalle de halving (ou réduction de moitié) (<code>SubsidyHalvingInterval</code>). Dans le cas du bloc 277 316, avec un intervalle de moitié tous les 210 000 blocs, le résultat est 1 moitié.</p>
</div>
<div class="paragraph data-line-284">
<p>Le nombre maximum de moitiés autorisé est de 64, donc le code impose une récompense nulle (ne renvoie que les frais) si les 64 moitiés sont dépassées.</p>
</div>
<div class="paragraph data-line-286">
<p>Ensuite, la fonction utilise l&#8217;opérateur binaire de décalage vers la droite pour diviser la récompense (<code>nSubsidy</code>) par deux pour chaque cycle de réduction de moitié. Dans le cas du bloc 277 316, cela entraînerait un décalage binaire vers la droite de la récompense de 5 milliards de satoshis une fois (une réduction de moitié) et donnerait 2,5 milliards de satoshis, soit 25 bitcoins. L&#8217;opérateur de décalage binaire vers la droite est utilisé car il est plus efficace que plusieurs divisions répétées. Pour éviter un bogue potentiel, l&#8217;opération de décalage est ignorée après 63 moitiés et la subvention est définie sur 0.</p>
</div>
<div class="paragraph data-line-288">
<p>Enfin, la récompense coinbase (<code>nSubsidy</code>) est ajoutée aux frais de transaction (<code>nFees</code>), et la somme est restituée.</p>
</div>
<div class="admonitionblock tip data-line-291">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-292">
<p>Si le nœud minier de Jing écrit la transaction coinbase, qu&#8217;est-ce qui empêche Jing de se "récompenser" lui-même 100 ou 1000 bitcoins ? La réponse est qu&#8217;une récompense incorrecte aurait pour conséquence que le bloc serait considéré comme invalide par tout le monde, gaspillant l&#8217;électricité de Jing utilisée pour la preuve de travail. Jing ne peut dépenser la récompense que si le bloc est accepté par tout le monde.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-295">
<h4 id="_structure_de_la_transaction_coinbase">Structure de la transaction coinbase</h4>
<div class="paragraph data-line-297">
<p>Avec ces calculs, le nœud de Jing construit ensuite la transaction coinbase pour se payer 25,09094928 bitcoins.</p>
</div>
<div class="paragraph data-line-299">
<p>Comme vous pouvez le voir dans <a href="#generation_tx_example">Transaction coinbase</a>, la transaction coinbase a un format spécial. Au lieu d&#8217;une entrée de transaction spécifiant un UTXO précédent à dépenser, il a une entrée "coinbase". Nous avons examiné les entrées de transaction dans <a href="#tx_in_structure">Sérialisation des entrées de transaction</a>. Comparons une entrée de transaction régulière avec une entrée de transaction coinbase. <a href="#table_8-1">La structure d&#8217;une entrée de transaction "normale"</a> montre la structure d&#8217;une entrée de transaction normale, tandis que <a href="#table_8-2">La structure d&#8217;une entrée de transaction coinbase</a> montre la structure de l&#8217;entrée de la transaction coinbase.</p>
</div>
<table id="table_8-1" class="tableblock frame-all grid-all stretch data-line-304">
<caption class="title">Table 27. La structure d&#8217;une entrée de transaction "normale"</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointeur vers la transaction contenant l&#8217;UTXO à dépenser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le numéro d&#8217;index de l&#8217;UTXO à dépenser, le premier est 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de déverrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de déverrouillage en octets, à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déverrouillage-Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script remplissant les conditions du script de verrouillage UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numéro de séquence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Généralement défini sur 0xFFFFFFFF pour désactiver BIP 125 et BIP 68</p></td>
</tr>
</tbody>
</table>
<table id="table_8-2" class="tableblock frame-all grid-all stretch data-line-316">
<caption class="title">Table 28. La structure d&#8217;une entrée de transaction coinbase</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tous les bits sont à zéro : pas une référence de hachage de transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tous les bits sont des uns : 0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille des données coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur des données coinbase, de 2 à 100 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Données coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Données arbitraires utilisées pour les nonce supplémentaires et les balises minières. Dans les blocs v2 ; doit commencer par la hauteur du bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numéro de séquence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Réglé sur 0xFFFFFFFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-325">
<p>Dans une transaction coinbase, les deux premiers champs sont définis sur des valeurs qui ne représentent pas une référence UTXO. Au lieu d&#8217;un "hachage de transaction", le premier champ est rempli de 32 octets tous mis à zéro. "L&#8217;index de sortie" est rempli de 4 octets tous mis à 0xFF (255 décimal). Le "script de déverrouillage" (<code>scriptSig</code>) est remplacé par les données coinbase, un champ de données utilisé par les mineurs, comme nous le verrons ensuite.</p>
</div>
</div>
<div class="sect3 data-line-327">
<h4 id="_données_coinbase">Données coinbase</h4>
<div class="paragraph data-line-329">
<p>Les transactions coinbase n&#8217;ont pas de champ de script de déverrouillage (aka, <code>scriptSig</code>). Au lieu de cela, ce champ est remplacé par des données coinbase, qui doivent être comprises entre 2 et 100 octets. À l&#8217;exception des premiers octets, le reste des données de coinbase peut être utilisé par les mineurs comme ils le souhaitent ; ce sont des données arbitraires.</p>
</div>
<div class="paragraph data-line-331">
<p>Dans le bloc de genèse, par exemple, Satoshi Nakamoto a ajouté le texte "The Times 03/Jan/2009 Chancellor on bound of second bailout for banks" dans les données coinbase, l&#8217;utilisant comme preuve de la date et pour transmettre un message. Actuellement, les mineurs utilisent les données coinbase pour inclure des valeurs nonce supplémentaires et des chaînes identifiant le bassin de minage.</p>
</div>
<div class="paragraph data-line-333">
<p>Les premiers octets de la coinbase étaient auparavant arbitraires, mais ce n&#8217;est plus le cas. Conformément à BIP-34, les blocs de version 2 (blocs avec le champ de version défini sur 2) doivent contenir l&#8217;index de hauteur de bloc en tant qu&#8217;opération "push" (pousser) de script au début du champ coinbase.</p>
</div>
<div class="paragraph data-line-335">
<p>Dans le bloc 277 316, nous voyons que le coinbase (voir <a href="#generation_tx_example">Transaction coinbase</a>), qui se trouve dans le script de déverrouillage ou le champ <code>scriptSig</code> de l&#8217;entrée de transaction, contient la valeur hexadécimale <code>03443b0403858402062f503253482f</code>. Décodons cette valeur.</p>
</div>
<div class="paragraph data-line-337">
<p>Le premier octet, <code>03</code>, indique au moteur d&#8217;exécution de script de pousser les trois octets suivants sur la pile de script (voir <a href="#tx_script_ops_table_pushdata">Pousser la valeur sur la pile</a>). Les trois octets suivants, <code>0x443b04</code>, sont la hauteur de bloc encodée au format little-endian (petit-boutiste, octet le moins significatif en premier). Inversez l&#8217;ordre des octets et le résultat est <code>0x043b44</code>, soit 277 316 en décimal.</p>
</div>
<div class="paragraph data-line-339">
<p>Les quelques chiffres hexadécimaux suivants (<code>0385840206</code>) sont utilisés pour coder un <em>nonce</em> supplémentaire (voir <a href="#extra_nonce">La solution nonce (nombre aléatoire) supplémentaire</a>), ou valeur aléatoire, utilisée pour trouver une solution de preuve de travail appropriée.</p>
</div>
<div class="paragraph data-line-341">
<p>La partie finale de la donnée coinbase (<code>2f503253482f</code>) est une chaîne de caractères ASCII encodées <span class="keep-together"><code>/P2SH/</code></span>, ce qui indique que le nœud de minage qui a miné ce bloc prend en charge l&#8217;amélioration P2SH définie dans BIP-16. L&#8217;introduction de la capacité P2SH a nécessité une signalisation par les mineurs pour approuver le BIP-16 ou le BIP-17. Ceux qui approuvaient la mise en œuvre du BIP-16 devaient inclure la chaîne <code>/P2SH/</code> dans leurs données coinbase. Ceux qui approuvaient l&#8217;implémentation BIP-17 de P2SH devaient inclure la chaîne <code>p2sh/CHV</code> dans leurs données coinbase. Enfin, le BIP-16 a été élu vainqueur, et de nombreux mineurs ont continué à inclure la chaîne <code>/P2SH/</code> dans leur coinbase pour indiquer qu&#8217;ils prennent en charge cette fonctionnalité.</p>
</div>
<div class="paragraph data-line-343">
<p><a href="#satoshi_words">Extraire les données coinbase du bloc genesis</a> utilise la bibliothèque libbitcoin introduite dans <a href="#alt_libraries">Clients, bibliothèques et boîtes à outils alternatifs</a> pour extraire les données coinbase du bloc de genèse, affichant le message de Satoshi. Notez que la bibliothèque libbitcoin contient une copie statique du bloc de genèse, de sorte que l&#8217;exemple de code peut récupérer le bloc de genèse directement à partir de la bibliothèque.</p>
</div>
<div id="satoshi_words" class="exampleblock data-line-347">
<div class="title">Example 27. Extraire les données coinbase du bloc genesis</div>
<div class="content">
<div class="listingblock data-line-349">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">/*
  Affichez le message du bloc de genèse de Satoshi.
*/
#include &lt;iostream&gt;
#include &lt;bitcoin/bitcoin.hpp&gt;

int main()
{
    // Créer un bloc de genèse.
    bc::chain::block block = bc::chain::block::genesis_mainnet();
    // Le bloc de genèse contient une seule transaction coinbase.
    assert(block.transactions().size() == 1);
    // Obtenez la première transaction du bloc (coinbase).
    const bc::chain::transaction&amp; coinbase_tx = block.transactions()[0];
    // Coinbase tx a une seule entrée.
    assert(coinbase_tx.inputs().size() == 1);
    const bc::chain::input&amp; coinbase_input = coinbase_tx.inputs()[0];
    // Convertissez le script d'entrée dans son format brut.
    const auto prefix = false;
    const bc::data_chunk&amp; raw_message = coinbase_input.script().to_data(prefix);
    // Convertissez ceci en std::string.
    std::string message(raw_message.begin(), raw_message.end());
    // Affichez le message du bloc de genèse.
    std::cout &lt;&lt; message &lt;&lt; std::endl;
    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-354">
<p>Nous compilons le code avec le compilateur GNU C++ et exécutons l&#8217;exécutable résultant, comme indiqué dans <a href="#satoshi_words_run">Compilation et exécution de l&#8217;exemple de code satoshi-words</a>.</p>
</div>
<div id="satoshi_words_run" class="exampleblock data-line-358">
<div class="title">Example 28. Compilation et exécution de l&#8217;exemple de code satoshi-words</div>
<div class="content">
<div class="listingblock data-line-360">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compiler le code
$  g++ -o satoshi-words satoshi-words.cpp $(pkg-config --cflags --libs libbitcoin)
# Lancer l'exécutable
$ ./satoshi-words
^D��&lt;GS&gt;^A^DEThe Times 03/Jan/2009 Chancellor on brink of second bailout for banks</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-369">
<h3 id="_construction_de_len_tête_de_bloc">Construction de l&#8217;en-tête de bloc</h3>
<div class="paragraph data-line-371">
<p> Pour construire l&#8217;en-tête de bloc, le nœud d&#8217;exploration de données doit remplir six champs, comme indiqué dans <a href="#block_header_structure_ch10">La structure de l&#8217;entête du bloc</a>.</p>
</div>
<table id="block_header_structure_ch10" class="tableblock frame-all grid-all stretch data-line-376">
<caption class="title">Table 29. La structure de l&#8217;entête du bloc</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un numéro de version pour suivre les mises à niveau du logiciel/protocole</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de bloc précédent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une référence au hachage du bloc précédent (parent) dans la chaîne</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Racine de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un hachage de la racine de l&#8217;arbre de Merkle des transactions de ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Horodatage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le temps de création approximatif de ce bloc (secondes à partir d&#8217;Unix Epoch)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cible de l&#8217;algorithme de preuve de travail pour ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un compteur utilisé pour l&#8217;algorithme de preuve de travail</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-386">
<p>Au moment où le bloc 277 316 a été miné, le numéro de version décrivant la structure du bloc est la version 2, qui est codée au format petit-boutiste sur 4 octets sous la forme <code>0x02000000</code>.</p>
</div>
<div class="paragraph data-line-388">
<p>Ensuite, le nœud de minage doit ajouter le "Previous Block Hash" (hachage de bloc précédent, également appelé <code>prevhash</code>). C&#8217;est le hachage de l&#8217;en-tête de bloc du bloc 277,315, le bloc précédent reçu du réseau, que le nœud de Jing a accepté et sélectionné comme <em>parent</em> du bloc candidat 277,316. Le hachage d&#8217;en-tête de bloc pour le bloc 277 315 est :</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569</pre>
</div>
</div>
<div class="admonitionblock tip data-line-395">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-396">
<p>En sélectionnant le bloc <em>parent</em> spécifique, indiqué par le champ Hash du bloc précédent dans l&#8217;en-tête du bloc candidat, Jing engage sa puissance minière à étendre la chaîne qui se termine dans ce bloc spécifique. En substance, c&#8217;est ainsi que Jing "vote" avec son pouvoir minier pour la chaîne valide la plus longue.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-399">
<p>L&#8217;étape suivante consiste à résumer toutes les transactions avec un arbre de Merkle, afin d&#8217;ajouter la racine de Merkle à la en-tête de bloc. La transaction coinbase est répertoriée comme la première transaction du bloc. Ensuite, 418 transactions supplémentaires sont ajoutées après, pour un total de 419 transactions dans le bloc. Comme nous l&#8217;avons vu dans le <a href="#merkle_trees">Arbres de Merkle</a>, il doit y avoir un nombre pair de nœuds "feuilles" dans l&#8217;arbre, donc la dernière transaction est dupliquée, créant 420 nœuds, chacun contenant le hachage d&#8217;une transaction. Les hachages de transaction sont ensuite combinés, par paires, créant chaque niveau de l&#8217;arbre, jusqu&#8217;à ce que toutes les transactions soient résumées en un nœud à la "racine" de l&#8217;arbre. La racine de l&#8217;arborescence de Merkle résume toutes les transactions en une seule valeur de 32 octets, que vous pouvez voir répertoriée comme "racine de Merkle" dans <a href="#block277316">Utiliser la ligne de commande pour récupérer le bloc 277,316</a>, et ici :</p>
</div>
<div class="listingblock data-line-401">
<div class="content">
<pre>c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e</pre>
</div>
</div>
<div class="paragraph data-line-405">
<p>Le nœud minier de Jing ajoutera alors un horodatage de 4 octets, codé comme un horodatage "d&#8217;époque" Unix, qui est basé sur le nombre de secondes écoulées depuis minuit UTC, le jeudi 1er janvier 1970. L&#8217;heure <code>1388185914</code> est égale à vendredi , 27 décembre 2013, 23:11:54 UTC.</p>
</div>
<div class="paragraph data-line-407">
<p>Le nœud de Jing remplit ensuite la cible, qui définit la preuve de travail requise pour en faire un bloc valide. La cible est stockée dans le bloc en tant que métrique de "bits cibles", qui est un codage d&#8217;exposant de mantisse de la cible. Le codage a un exposant de 1 octet, suivi d&#8217;une mantisse de 3 octets (coefficient). Dans le bloc 277 316, par exemple, la valeur des bits cibles est <code>0x1903a30c</code>. La première partie <code>0x19</code> est un exposant hexadécimal, tandis que la partie suivante, <code>0x03a30c</code>, est le coefficient. Le concept de cible est expliqué dans <a href="#target">Reciblage pour ajuster la difficulté</a> et la représentation des "bits cibles" est expliquée dans <a href="#target_bits">Représentation cible</a>.</p>
</div>
<div class="paragraph data-line-409">
<p>Le dernier champ est le nonce, qui est initialisé à zéro.</p>
</div>
<div class="paragraph data-line-411">
<p>Une fois tous les autres champs remplis, l&#8217;en-tête du bloc est maintenant terminé et le processus d&#8217;extraction peut commencer. L&#8217;objectif est maintenant de trouver une valeur pour le nonce qui se traduit par un hachage d&#8217;en-tête de bloc égal ou inférieur à la cible. Le nœud de minage devra tester des milliards ou des billions de valeurs de nonce avant de trouver un nonce qui réponde à l&#8217;exigence.</p>
</div>
</div>
<div class="sect2 data-line-413">
<h3 id="_miner_le_bloc">Miner le bloc</h3>
<div class="paragraph data-line-415">
<p>Maintenant qu&#8217;un bloc candidat a été construit par le nœud de Jing, il est temps pour la plate-forme de minage matériel de Jing de "miner" le bloc, pour trouver une solution à l&#8217;algorithme de preuve de travail qui rend le bloc valide. Tout au long de ce livre, nous avons étudié les fonctions de hachage cryptographique utilisées dans divers aspects du système Bitcoin. La fonction de hachage SHA256 est la fonction utilisée dans le processus d&#8217;extraction de bitcoin.</p>
</div>
<div class="paragraph data-line-417">
<p> Dans les termes les plus simples, le minage est le processus de hachage répété de l&#8217;en-tête de bloc, en modifiant un paramètre, jusqu&#8217;à ce que le hachage résultant corresponde à une cible spécifique. Le résultat de la fonction de hachage ne peut pas être déterminé à l&#8217;avance, pas plus qu&#8217;un modèle ne peut être créé qui produira une valeur de hachage spécifique. Cette caractéristique des fonctions de hachage signifie que la seule façon de produire un résultat de hachage correspondant à une cible spécifique est d&#8217;essayer encore et encore, en modifiant de manière aléatoire l&#8217;entrée jusqu&#8217;à ce que le résultat de hachage souhaité apparaisse par hasard.</p>
</div>
<div class="sect3 data-line-419">
<h4 id="_algorithme_de_preuve_de_travail">Algorithme de preuve de travail</h4>
<div class="paragraph data-line-421">
<p>Un algorithme de hachage prend une entrée de données de longueur arbitraire et produit un résultat déterministe de longueur fixe, c-à-d une empreinte numérique de l&#8217;entrée. Pour toute entrée spécifique, le hachage résultant sera toujours le même et peut être facilement calculé et vérifié par toute personne mettant en œuvre le même algorithme de hachage. La principale caractéristique d&#8217;un algorithme de hachage cryptographique est qu&#8217;il est impossible de trouver deux entrées différentes qui produisent la même empreinte digitale (appelée <em>collision</em>). En corollaire, il est également pratiquement impossible de sélectionner une entrée de manière à produire une empreinte digitale souhaitée, autrement qu&#8217;en essayant des entrées aléatoires.</p>
</div>
<div class="paragraph data-line-423">
<p>Avec SHA256, la sortie a toujours une longueur de 256 bits, quelle que soit la taille de l&#8217;entrée. Dans <a href="#sha256_example1">Exemple SHA256</a>, nous utiliserons l&#8217;interpréteur Python pour calculer le hachage SHA256 de la phrase "Je suis Satoshi Nakamoto".</p>
</div>
<div id="sha256_example1" class="exampleblock data-line-427">
<div class="title">Example 29. Exemple SHA256</div>
<div class="content">
<div class="listingblock data-line-429">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python</code></pre>
</div>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.7.3
&gt;&gt;&gt; import hashlib
&gt;&gt;&gt; hashlib.sha256(b"I am Satoshi Nakamoto").hexdigest()
'5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-441">
<p><a href="#sha256_example1">Exemple SHA256</a> montre le résultat du calcul du hachage de <code>"Je suis Satoshi Nakamoto"</code> : <code>5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e</code>. Ce nombre de 256 bits est le résultat de <em>hachage</em> ou <em>prétraitement</em> de la phrase et dépend de chaque partie de la phrase. L&#8217;ajout d&#8217;une seule lettre, d&#8217;un signe de ponctuation ou de tout autre caractère produira un hachage différent.</p>
</div>
<div class="paragraph data-line-443">
<p>Maintenant, si nous changeons la phrase, nous devrions nous attendre à voir des hachages complètement différents. Essayons cela en ajoutant un nombre à la fin de notre phrase, en utilisant le script Python simple dans <a href="#sha256_example_generator">Script SHA256 pour générer de nombreux hachages en itérant sur un nonce</a>.</p>
</div>
<div id="sha256_example_generator" class="exampleblock data-line-447">
<div class="title">Example 30. Script SHA256 pour générer de nombreux hachages en itérant sur un nonce</div>
<div class="content">
<div class="listingblock c_less_space data-line-450">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># exemple d'itération d'un nonce dans l'entrée d'un algorithme de hachage

import hashlib

text = "I am Satoshi Nakamoto"

# itérer nonce de 0 à 19
for nonce in xrange(20):

    # ajouter le nonce à la fin du texte
    input = text + str(nonce)

    # calculer le hachage SHA-256 de l'entrée (texte + nonce)
    hash = hashlib.sha256(input).hexdigest()

    # afficher l'entrée et le résultat du hachage
    print input, '=&gt;',  hash </code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-455">
<p>L&#8217;exécution de ceci produira les hachages de plusieurs phrases, rendues différentes en ajoutant un nombre à la fin du texte. En incrémentant le nombre, nous pouvons obtenir différents hachages, comme indiqué dans <a href="#sha256_example_generator_output">Sortie SHA256 d&#8217;un script pour générer de nombreux hachages en itérant sur un nombre aléatoire</a>.</p>
</div>
<div id="sha256_example_generator_output" class="exampleblock data-line-459">
<div class="title">Example 31. Sortie SHA256 d&#8217;un script pour générer de nombreux hachages en itérant sur un nombre aléatoire</div>
<div class="content">
<div class="listingblock data-line-461">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python hash_example.py</code></pre>
</div>
</div>
<div class="listingblock data-line-465">
<div class="content">
<pre>I am Satoshi Nakamoto0 =&gt; a80a81401765c8eddee25df36728d732...
I am Satoshi Nakamoto1 =&gt; f7bc9a6304a4647bb41241a677b5345f...
I am Satoshi Nakamoto2 =&gt; ea758a8134b115298a1583ffb80ae629...
I am Satoshi Nakamoto3 =&gt; bfa9779618ff072c903d773de30c99bd...
I am Satoshi Nakamoto4 =&gt; bce8564de9a83c18c31944a66bde992f...
I am Satoshi Nakamoto5 =&gt; eb362c3cf3479be0a97a20163589038e...
I am Satoshi Nakamoto6 =&gt; 4a2fd48e3be420d0d28e202360cfbaba...
I am Satoshi Nakamoto7 =&gt; 790b5a1349a5f2b909bf74d0d166b17a...
I am Satoshi Nakamoto8 =&gt; 702c45e5b15aa54b625d68dd947f1597...
I am Satoshi Nakamoto9 =&gt; 7007cf7dd40f5e933cd89fff5b791ff0...
I am Satoshi Nakamoto10 =&gt; c2f38c81992f4614206a21537bd634a...
I am Satoshi Nakamoto11 =&gt; 7045da6ed8a914690f087690e1e8d66...
I am Satoshi Nakamoto12 =&gt; 60f01db30c1a0d4cbce2b4b22e88b9b...
I am Satoshi Nakamoto13 =&gt; 0ebc56d59a34f5082aaef3d66b37a66...
I am Satoshi Nakamoto14 =&gt; 27ead1ca85da66981fd9da01a8c6816...
I am Satoshi Nakamoto15 =&gt; 394809fb809c5f83ce97ab554a2812c...
I am Satoshi Nakamoto16 =&gt; 8fa4992219df33f50834465d3047429...
I am Satoshi Nakamoto17 =&gt; dca9b8b4f8d8e1521fa4eaa46f4f0cd...
I am Satoshi Nakamoto18 =&gt; 9989a401b2a3a318b01e9ca9a22b0f3...
I am Satoshi Nakamoto19 =&gt; cda56022ecb5b67b2bc93a2d764e75f...</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-489">
<p>Chaque phrase produit un résultat de hachage complètement différent. Ils semblent complètement aléatoires, mais vous pouvez reproduire les résultats exacts de cet exemple sur n&#8217;importe quel ordinateur avec Python et voir les mêmes hachages exacts.</p>
</div>
<div class="paragraph data-line-491">
<p>Le nombre utilisé comme variable dans un tel scénario est appelé un <em>nonce</em> (ou nombre aléatoire). Le nonce est utilisé pour faire varier la sortie d&#8217;une fonction cryptographique, dans ce cas pour faire varier l&#8217;empreinte SHA256 de la phrase.</p>
</div>
<div class="paragraph data-line-493">
<p>Pour relever le défi de cet algorithme, fixons-nous un objectif : trouver une phrase qui produit un hachage hexadécimal commençant par un zéro. Heureusement, ce n&#8217;est pas difficile ! <a href="#sha256_example_generator_output">Sortie SHA256 d&#8217;un script pour générer de nombreux hachages en itérant sur un nombre aléatoire</a> montre que la phrase "I am Satoshi Nakamoto13" produit le hash <code>0ebc56d59a34f5082aaef3d66b37a661696c2b618e62432727216ba9531041a5</code>, ce qui correspond à nos critères. Il a fallu 13 tentatives pour le trouver. En termes de probabilités, si la sortie de la fonction de hachage est uniformément distribuée, nous nous attendrions à trouver un résultat avec un 0 comme préfixe hexadécimal une fois tous les 16 hachages (un sur 16 chiffres hexadécimaux de 0 à F). En termes numériques, cela signifie trouver une valeur de hachage inférieure à <code>0x100000000000000000000000000000000000000000000000000000000000</code>. Nous appelons ce seuil la <em>cible</em> et le but est de trouver un hachage qui est numériquement égal ou inférieur à la cible. Si nous diminuons la cible, la tâche de trouver un hachage inférieur à la cible devient de plus en plus difficile.</p>
</div>
<div class="paragraph data-line-495">
<p>Pour donner une analogie simple, imaginez un jeu où les joueurs lancent une paire de dés à plusieurs reprises, en essayant de lancer autant ou moins qu&#8217;une cible spécifiée. Au premier tour, l&#8217;objectif est de 11. À moins que vous ne lanciez un double-six, vous gagnez. Au tour suivant, l&#8217;objectif est de 10. Les joueurs doivent lancer 10 ou moins pour gagner, encore une fois une tâche facile. Disons que quelques tours plus tard, l&#8217;objectif est tombé à 5. Maintenant, plus de la moitié des lancers de dés dépasseront l&#8217;objectif et seront donc invalides. Il faut exponentiellement plus de lancers de dés pour gagner, plus la cible est basse. Finalement, lorsque l&#8217;objectif est de 2 (le minimum possible), un seul lancer sur 36, soit 2 % d&#8217;entre eux, produira un résultat gagnant.</p>
</div>
<div class="paragraph data-line-497">
<p>Du point de vue d&#8217;un observateur qui sait que la cible du jeu de dés est 2, si quelqu&#8217;un a réussi à lancer un lancer gagnant, on peut supposer qu&#8217;il a tenté, en moyenne, 36 lancers. En d&#8217;autres termes, on peut estimer la quantité de travail nécessaire pour réussir à partir de la difficulté imposée par la cible. Lorsque l&#8217;algorithme est basé sur une fonction déterministe telle que SHA256, l&#8217;entrée elle-même constitue la <em>preuve</em> qu&#8217;une certaine quantité de <em>travail</em> a été effectuée pour produire un résultat égal ou inférieur à la cible. Par conséquent, la <em>Preuve de travail</em>.</p>
</div>
<div class="admonitionblock tip data-line-500">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-501">
<p>Même si chaque tentative produit un résultat aléatoire, la probabilité de tout résultat possible peut être calculée à l&#8217;avance. Par conséquent, un résultat d&#8217;une difficulté spécifiée constitue la preuve d&#8217;une quantité de travail spécifique.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-504">
<p>Dans <a href="#sha256_example_generator_output">Sortie SHA256 d&#8217;un script pour générer de nombreux hachages en itérant sur un nombre aléatoire</a>, le "nonce" gagnant est 13 et ce résultat peut être confirmé par n&#8217;importe qui indépendamment. N&#8217;importe qui peut ajouter le nombre 13 comme suffixe à la phrase "Je suis Satoshi Nakamoto" et calculer le hachage, en vérifiant qu&#8217;il est inférieur à la cible. Le résultat réussi est également une preuve de travail, car cela prouve que nous avons fait le travail pour trouver ce nonce. Alors qu&#8217;il ne faut qu&#8217;un seul calcul de hachage pour vérifier, il nous a fallu 13 calculs de hachage pour trouver un nonce qui a fonctionné. Si nous avions une cible inférieure (difficulté plus élevée), il faudrait beaucoup plus de calculs de hachage pour trouver un nonce approprié, mais un seul calcul de hachage pour que quiconque puisse le vérifier. De plus, en connaissant la cible, n&#8217;importe qui peut estimer la difficulté à l&#8217;aide de statistiques et donc savoir combien de travail a été nécessaire pour trouver un tel nonce.</p>
</div>
<div class="admonitionblock tip data-line-507">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-508">
<p>La preuve de travail doit produire un hachage qui est <em>égal ou inférieur à</em> la cible. Une cible plus élevée signifie qu&#8217;il est moins difficile de trouver un hachage égal ou inférieur à la cible. Une cible inférieure signifie qu&#8217;il est plus difficile de trouver un hachage égal ou inférieur à la cible. La cible et la difficulté sont inversement liées.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-512">
<p> La preuve de travail de Bitcoin est très similaire au défi présenté dans <a href="#sha256_example_generator_output">Sortie SHA256 d&#8217;un script pour générer de nombreux hachages en itérant sur un nombre aléatoire</a>. Le mineur construit un bloc candidat rempli de transactions. Ensuite, le mineur calcule le hachage de l&#8217;en-tête de ce bloc et voit s&#8217;il est égal ou inférieur à la <em>cible</em> actuelle. Si le hachage est supérieur à la cible, le mineur modifiera le nonce (généralement en l&#8217;incrémentant simplement de un) et réessayera. À la difficulté actuelle du réseau Bitcoin, les mineurs doivent essayer des quadrillions de fois avant de trouver un nonce qui se traduit par un hachage d&#8217;en-tête de bloc suffisamment bas.</p>
</div>
<div class="paragraph data-line-514">
<p>Un algorithme de preuve de travail très simplifié est implémenté en Python dans <a href="#pow_example1">Mise en œuvre simplifiée de la preuve de travail</a>.</p>
</div>
<div id="pow_example1" class="exampleblock data-line-518">
<div class="title">Example 32. Mise en œuvre simplifiée de la preuve de travail</div>
<div class="content">
<div class="listingblock data-line-520">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python
# exemple d'algorithme de preuve de travail

import hashlib
import time

max_nonce = 2 ** 32 # 4 billion

def proof_of_work(header, difficulty_bits):

    # calculer l'objectif de difficulté
    target = 2 ** (256-difficulty_bits)

    for nonce in xrange(max_nonce):
        hash_result = hashlib.sha256(str(header)+str(nonce)).hexdigest()

        # vérifier s'il s'agit d'un résultat valide, en dessous de la cible
        if long(hash_result, 16) &lt; target:
            print "Success with nonce %d" % nonce
            print "Hash is %s" % hash_result
            return (hash_result,nonce)

    print "Failed after %d (max_nonce) tries" % nonce
    return nonce


if __name__ == '__main__':

    nonce = 0
    hash_result = ''

    # difficulté de 0 à 31 bits
    for difficulty_bits in xrange(32):

        difficulty = 2 ** difficulty_bits
        print "Difficulty: %ld (%d bits)" % (difficulty, difficulty_bits)

        print "Starting search..."

        # point de contrôle de l'heure actuelle
        start_time = time.time()

        # faire un nouveau bloc qui inclut le hachage du bloc précédent nous simulons un bloc de transactions - juste une chaîne
        new_block = 'test block with transactions' + hash_result

        # trouver un nonce valide pour le nouveau bloc
        (hash_result, nonce) = proof_of_work(new_block, difficulty_bits)

        # point de contrôle combien de temps il a fallu pour trouver un résultat
        end_time = time.time()

        elapsed_time = end_time - start_time
        print "Elapsed Time: %.4f seconds" % elapsed_time

        if elapsed_time &gt; 0:

            # estimer les hachages par seconde
            hash_power = float(long(nonce)/elapsed_time)
            print "Hashing Power: %ld hashes per second" % hash_power</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-525">
<p>En exécutant ce code, vous pouvez définir la difficulté souhaitée (en bits, combien de bits de tête doivent être nuls) et voir combien de temps il faut à votre ordinateur pour trouver une solution. Dans <a href="#pow_example_outputs">Exécution de l&#8217;exemple de preuve de travail pour diverses difficultés</a>, vous pouvez voir comment cela fonctionne sur un ordinateur portable moyen.</p>
</div>
<div id="pow_example_outputs" class="exampleblock data-line-529">
<div class="title">Example 33. Exécution de l&#8217;exemple de preuve de travail pour diverses difficultés</div>
<div class="content">
<div class="listingblock data-line-531">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python proof-of-work-example.py*</code></pre>
</div>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre>Difficulty: 1 (0 bits)

[...]

Difficulty: 8 (3 bits)
Starting search...
Success with nonce 9
Hash is 1c1c105e65b47142f028a8f93ddf3dabb9260491bc64474738133ce5256cb3c1
Elapsed Time: 0.0004 seconds
Hashing Power: 25065 hashes per second
Difficulty: 16 (4 bits)
Starting search...
Success with nonce 25
Hash is 0f7becfd3bcd1a82e06663c97176add89e7cae0268de46f94e7e11bc3863e148
Elapsed Time: 0.0005 seconds
Hashing Power: 52507 hashes per second
Difficulty: 32 (5 bits)
Starting search...
Success with nonce 36
Hash is 029ae6e5004302a120630adcbb808452346ab1cf0b94c5189ba8bac1d47e7903
Elapsed Time: 0.0006 seconds
Hashing Power: 58164 hashes per second

[...]

Difficulty: 4194304 (22 bits)
Starting search...
Success with nonce 1759164
Hash is 0000008bb8f0e731f0496b8e530da984e85fb3cd2bd81882fe8ba3610b6cefc3
Elapsed Time: 13.3201 seconds
Hashing Power: 132068 hashes per second
Difficulty: 8388608 (23 bits)
Starting search...
Success with nonce 14214729
Hash is 000001408cf12dbd20fcba6372a223e098d58786c6ff93488a9f74f5df4df0a3
Elapsed Time: 110.1507 seconds
Hashing Power: 129048 hashes per second
Difficulty: 16777216 (24 bits)
Starting search...
Success with nonce 24586379
Hash is 0000002c3d6b370fccd699708d1b7cb4a94388595171366b944d68b2acce8b95
Elapsed Time: 195.2991 seconds
Hashing Power: 125890 hashes per second

[...]

Difficulty: 67108864 (26 bits)
Starting search...
Success with nonce 84561291
Hash is 0000001f0ea21e676b6dde5ad429b9d131a9f2b000802ab2f169cbca22b1e21a
Elapsed Time: 665.0949 seconds
Hashing Power: 127141 hashes per second</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-591">
<p>Comme vous pouvez le constater, augmenter la difficulté de 1 bit entraîne un doublement du temps nécessaire pour trouver une solution. Si vous pensez à l&#8217;ensemble de l&#8217;espace numérique de 256 bits, chaque fois que vous contraignez un bit de plus à zéro, vous réduisez l&#8217;espace de recherche de moitié. Dans <a href="#pow_example_outputs">Exécution de l&#8217;exemple de preuve de travail pour diverses difficultés</a>, il faut 84 millions de tentatives de hachage pour trouver un nonce qui produit un hachage avec 26 bits de tête en zéro. Même à une vitesse de plus de 120 000 hachages par seconde, il faut tout de même 10 minutes sur un portable pour trouver cette solution.</p>
</div>
<div class="paragraph data-line-593">
<p>Au moment de la rédaction, le réseau tente de trouver un bloc dont le hachage d&#8217;en-tête est égal ou inférieur à :</p>
</div>
<div class="listingblock data-line-595">
<div class="content">
<pre>0000000000000000029AB900000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-599">
<p>Comme vous pouvez le voir, il y a beaucoup de zéros au début de cette cible, ce qui signifie que la plage acceptable de hachages est beaucoup plus petite, il est donc plus difficile de trouver un hachage valide. Il faudra en moyenne plus de 1,8 zêta de hachages (mille milliards de milliards de hachages) pour que le réseau découvre le bloc suivant. Cela semble être une tâche impossible, mais heureusement, le réseau apporte 3 exa-hachages par seconde (EH/sec) de puissance de traitement, ce qui permettra de trouver un bloc en environ 10 minutes en moyenne.</p>
</div>
</div>
<div class="sect3 data-line-602">
<h4 id="target_bits">Représentation cible</h4>
<div class="paragraph data-line-604">
<p>Dans <a href="#block277316">Utiliser la ligne de commande pour récupérer le bloc 277,316</a>, nous avons vu que le bloc contient la cible, dans une notation appelée "bits cible" ou simplement "bits", qui dans le bloc 277 316 a la valeur <code>0x1903a30c</code>. Cette notation exprime la cible de preuve de travail sous la forme d&#8217;un format coefficient/exposant, avec les deux premiers chiffres hexadécimaux pour l&#8217;exposant et les six chiffres hexadécimaux suivants pour le coefficient. Dans ce bloc, par conséquent, l&#8217;exposant est <code>0x19</code> et le coefficient est <code>0x03a30c</code>.</p>
</div>
<div class="paragraph data-line-606">
<p>La formule pour calculer la cible de difficulté à partir de cette représentation est :</p>
</div>
<ul class="simplelist">
  <li>cible = coefficient * 2 <sup>(8*(exposant–3))</sup></li>
</ul>
<div class="paragraph data-line-614">
<p>En utilisant cette formule et la valeur des bits de difficulté 0x1903a30c, nous obtenons :</p>
</div>
<ul class="simplelist">
  <li>cible = 0x03a30c * 2 <sup>0x08*(0x19-0x03)</sup></li>
  <li>=> cible = 0x03a30c * 2 <sup>(0x08*0x16)</sup></li>
  <li>=> cible = 0x03a30c * 2 <sup>0xB0</sup></li>
</ul>
<div class="paragraph data-line-624">
<p>qui en décimal est :</p>
</div>
<ul class="simplelist">
  <li>=> cible = 238 348 * 2 <sup>176</sup></li>
  <li>=> cible =<br/> 22 829 202 948 393 929 850 749 706 076 701 368 331 072 452 018 388 575 715 328</li>
</ul>
<div class="paragraph data-line-633">
<p>retour en hexadécimal :</p>
</div>
<ul class="simplelist">
  <li>=> cible =<br/> 0x0000000000000003A30C000000000000000000000000000000000000000000</li>
</ul>
<div class="paragraph data-line-641">
<p>Cela signifie qu&#8217;un bloc valide pour la hauteur 277 316 est celui qui a un hachage d&#8217;en-tête de bloc inférieur à cette cible. En binaire, ce nombre doit avoir plus de 60 bits de tête mis à zéro. Avec ce niveau de difficulté, un seul mineur traitant 1 billion de hachages par seconde (1 terahash par seconde ou 1 TH/sec) ne trouverait une solution qu&#8217;une fois tous les 8 496 blocs ou une fois tous les 59 jours, en moyenne.</p>
</div>
</div>
<div class="sect3 data-line-644">
<h4 id="target">Reciblage pour ajuster la difficulté</h4>
<div class="paragraph data-line-646">
<p> Comme nous l&#8217;avons vu, la cible détermine la difficulté et affecte donc le temps qu&#8217;il faut pour trouver une solution à l&#8217;algorithme de preuve de travail. Cela conduit à des questions évidentes : pourquoi la difficulté est-elle ajustable, qui l&#8217;ajuste et comment ?</p>
</div>
<div class="paragraph data-line-648">
<p>Les blocs de Bitcoin sont générés toutes les 10 minutes, en moyenne. C&#8217;est le battement de cœur de bitcoin et sous-tend la fréquence d&#8217;émission de devises et la rapidité de règlement des transactions. Il doit rester constant non seulement à court terme, mais sur une période de plusieurs décennies. Au cours de cette période, on s&#8217;attend à ce que la puissance des ordinateurs continue d&#8217;augmenter à un rythme rapide. De plus, le nombre de participants à l&#8217;exploitation minière et les ordinateurs qu&#8217;ils utilisent changeront également constamment. Pour maintenir le temps de génération de bloc à 10 minutes, la difficulté de minage doit être ajustée pour tenir compte de ces changements. En fait, la cible de preuve de travail est un paramètre dynamique qui est périodiquement ajusté pour atteindre un objectif d&#8217;intervalle de bloc de 10 minutes. En termes simples, l&#8217;objectif est défini de sorte que la puissance minière actuelle se traduise par un intervalle de bloc de 10 minutes.</p>
</div>
<div class="paragraph data-line-650">
<p>Comment, alors, un tel ajustement s&#8217;effectue-t-il dans un réseau totalement décentralisé ? Le reciblage se produit automatiquement et sur chaque nœud indépendamment. Tous les 2 016 blocs, tous les nœuds reciblent la preuve de travail. L&#8217;équation de reciblage mesure le temps qu&#8217;il a fallu pour trouver les 2 016 derniers blocs et le compare au temps prévu de 20 160 minutes (2 016 blocs multipliés par l&#8217;intervalle de bloc de 10 minutes souhaité). Le rapport entre la durée réelle et la durée souhaitée est calculé et un ajustement proportionnel (à la hausse ou à la baisse) est apporté à la cible. En termes simples : si le réseau trouve des blocs plus rapidement que toutes les 10 minutes, la difficulté augmente (la cible diminue). Si la découverte de blocs est plus lente que prévu, la difficulté diminue (la cible augmente).</p>
</div>
<div class="paragraph data-line-652">
<p>L&#8217;équation peut se résumer ainsi :</p>
</div>
<div class="listingblock data-line-654">
<div class="content">
<pre>Nouvel objectif = Ancien objectif * (Heure réelle des 2016 derniers blocs / 20160 minutes)</pre>
</div>
</div>
<div class="paragraph data-line-658">
<p><a href="#retarget_code">Reciblage de la preuve de travail avec CalculateNextWorkRequired() dans pow.cpp</a> montre le code utilisé dans le client Bitcoin Core.</p>
</div>
<div id="retarget_code" class="exampleblock data-line-662">
<div class="title">Example 34. Reciblage de la preuve de travail avec CalculateNextWorkRequired() dans pow.cpp</div>
<div class="content">
<div class="listingblock data-line-664">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">   // Limiter le pas de réglage
    int64_t nActualTimespan = pindexLast-&gt;GetBlockTime() - nFirstBlockTime;
    LogPrintf("  nActualTimespan = %d  before bounds\n", nActualTimespan);
    if (nActualTimespan &lt; params.nPowTargetTimespan/4)
        nActualTimespan = params.nPowTargetTimespan/4;
    if (nActualTimespan &gt; params.nPowTargetTimespan*4)
        nActualTimespan = params.nPowTargetTimespan*4;

    // Recibler
    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);
    arith_uint256 bnNew;
    arith_uint256 bnOld;
    bnNew.SetCompact(pindexLast-&gt;nBits);
    bnOld = bnNew;
    bnNew *= nActualTimespan;
    bnNew /= params.nPowTargetTimespan;

    if (bnNew &gt; bnPowLimit)
        bnNew = bnPowLimit;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-690">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-691">
<p>Bien que l&#8217;étalonnage cible se produise tous les 2 016 blocs, en raison d&#8217;une erreur de un par un dans le client Bitcoin Core d&#8217;origine, il est basé sur le temps total des 2 015 blocs précédents (et non 2 016 comme il se doit), ce qui entraîne un biais de reciblage vers une difficulté plus élevée de 0,05 %.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-695">
<p>Les paramètres <code>Interval</code> (2 016 blocs) et <code>TargetTimespan</code> (deux semaines en 1 209 600 secondes) sont définis dans <em>chainparams.cpp</em>.</p>
</div>
<div class="paragraph data-line-697">
<p>Pour éviter une volatilité extrême de la difficulté, l&#8217;ajustement de reciblage doit être inférieur à un facteur quatre (4) par cycle. Si l&#8217;ajustement cible requis est supérieur à un facteur de quatre, il sera ajusté d&#8217;un facteur de 4 et pas plus. Tout autre ajustement sera effectué au cours de la prochaine période de reciblage, car le déséquilibre persistera au cours des 2 016 prochains blocs. Par conséquent, des écarts importants entre la puissance de hachage et la difficulté peuvent nécessiter plusieurs cycles de blocs de 2 016 pour s&#8217;équilibrer.</p>
</div>
<div class="admonitionblock tip data-line-700">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-701">
<p>La difficulté d&#8217;extraction d&#8217;un bloc de bitcoins est d&#8217;environ '10 minutes de traitement' pour l&#8217;ensemble du réseau, sur la base du temps qu&#8217;il a fallu pour extraire les 2 016 blocs précédents, ajusté tous les 2 016 blocs. Ceci est réalisé en abaissant ou en élevant la cible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-704">
<p>Notez que la cible est indépendante du nombre de transactions ou de la valeur des transactions. Cela signifie que la quantité de puissance de hachage et donc d&#8217;électricité dépensée pour sécuriser le bitcoin est également entièrement indépendante du nombre de transactions. Bitcoin peut évoluer et parvenir à une adoption plus large et rester sécurisé sans aucune augmentation de la puissance de hachage par rapport au niveau actuel. L&#8217;augmentation de la puissance de hachage représente les forces du marché alors que de nouveaux mineurs entrent sur le marché pour concourir pour la récompense. Tant qu&#8217;une puissance de hachage suffisante est sous le contrôle des mineurs agissant honnêtement à la recherche de la récompense, cela suffit pour empêcher les attaques de "prise de contrôle" et, par conséquent, il en est suffisant pour sécuriser le bitcoin.</p>
</div>
<div class="paragraph data-line-706">
<p>La difficulté du minage est étroitement liée au coût de l&#8217;électricité et au taux de change du bitcoin vis-à-vis de la monnaie utilisée pour payer l&#8217;électricité. Les systèmes de minage hautes performances sont à peu près aussi efficaces que possible avec la génération actuelle de fabrication de silicium, convertissant l&#8217;électricité en calcul de hachage au taux le plus élevé possible. La principale influence sur le marché minier est le prix d&#8217;un kilowattheure d&#8217;électricité en bitcoin, car cela détermine la rentabilité du minage et donc les incitations à entrer ou à sortir du marché minier.</p>
</div>
</div>
</div>
<div class="sect2 data-line-708">
<h3 id="_réussir_à_miner_le_bloc">Réussir à miner le bloc</h3>
<div class="paragraph data-line-710">
<p>Comme nous l&#8217;avons vu précédemment, le nœud de Jing a construit un bloc candidat et l&#8217;a préparé pour le minage. Jing possède plusieurs plates-formes de minage matériel avec des circuits intégrés spécifiques à l&#8217;application, où des centaines de milliers de circuits intégrés exécutent l&#8217;algorithme SHA256 en parallèle à des vitesses incroyables. Beaucoup de ces machines spécialisées sont connectées à son nœud minier via USB ou un réseau local. Ensuite, le nœud de minage exécuté sur le bureau de Jing transmet l&#8217;en-tête de bloc à son matériel de minage, qui commence à tester des milliards de nonces par seconde. Parce que le nonce n&#8217;est que de 32 bits, après avoir épuisé toutes les possibilités de nonce (environ 4 milliards), le matériel de minage modifie l&#8217;en-tête de bloc (en ajustant l&#8217;espace ou l&#8217;horodatage supplémentaire du nonce coinbase) et réinitialise le compteur de nonce, en testant de nouvelles combinaisons.</p>
</div>
<div class="paragraph data-line-712">
<p>Près de 11 minutes après avoir commencé à miner le bloc 277 316, l&#8217;une des machines de minage de matériel trouve une solution et la renvoie au nœud de minage.</p>
</div>
<div class="paragraph data-line-714">
<p>Lorsqu&#8217;il est inséré dans l&#8217;en-tête de bloc, le nonce 924 591 752 produit un hachage de bloc de :</p>
</div>
<div class="listingblock data-line-716">
<div class="content">
<pre>0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</pre>
</div>
</div>
<div class="paragraph data-line-720">
<p>qui est inférieur à la cible :</p>
</div>
<div class="listingblock data-line-722">
<div class="content">
<pre>0000000000000003A30C000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-726">
<p>Immédiatement, le nœud minier de Jing transmet le bloc à tous ses pairs. Ils reçoivent, valident puis propagent le nouveau bloc. Au fur et à mesure que le bloc se répand sur le réseau, chaque nœud l&#8217;ajoute à sa propre copie de la chaîne de blocs, l&#8217;étendant à une nouvelle hauteur de 277 316 blocs. Au fur et à mesure que les nœuds miniers reçoivent et valident le bloc, ils abandonnent leurs efforts pour trouver un bloc à la même hauteur et commencent immédiatement à calculer le bloc suivant dans la chaîne, en utilisant le bloc de Jing comme "parent". En construisant sur le bloc nouvellement découvert de Jing, les autres mineurs "votent" essentiellement avec leur puissance minière et approuvent le bloc de Jing et la chaîne qu&#8217;il prolonge.</p>
</div>
<div class="paragraph data-line-728">
<p>Dans la section suivante, nous examinerons le processus utilisé par chaque nœud pour valider un bloc et sélectionner la chaîne la plus longue, créant ainsi le consensus qui forme la chaîne de blocs décentralisée.</p>
</div>
</div>
<div class="sect2 data-line-730">
<h3 id="_validation_dun_nouveau_bloc">Validation d&#8217;un nouveau bloc</h3>
<div class="paragraph data-line-732">
<p>La troisième étape du mécanisme de consensus de bitcoin est l&#8217;indépendante validation de chaque nouveau bloc par chaque nœud du réseau. Au fur et à mesure que le bloc nouvellement résolu se déplace sur le réseau, chaque nœud effectue une série de tests pour le valider avant de le propager à ses pairs. Cela garantit que seuls les blocs valides sont propagés sur le réseau. La validation indépendante garantit également que les mineurs qui agissent honnêtement obtiennent leurs blocs incorporés dans la chaîne de blocs, gagnant ainsi la récompense. Les mineurs qui agissent de manière malhonnête voient leurs blocs rejetés et non seulement perdent la récompense, mais gaspillent également les efforts déployés pour trouver une solution de preuve de travail, encourant ainsi le coût de l&#8217;électricité sans compensation.</p>
</div>
<div class="paragraph data-line-734">
<p>Lorsqu&#8217;un nœud reçoit un nouveau bloc, il valide le bloc en le comparant à une longue liste de critères qui doivent tous être remplis ; sinon, le bloc est rejeté. Ces critères peuvent être vus dans le client Bitcoin Core dans les fonctions <code>CheckBlock</code> et <code>CheckBlockHeader</code> et incluent :</p>
</div>
<div class="ulist data-line-736">
<ul>
<li class="data-line-736">
<p>La structure de données du bloc est syntaxiquement valide</p>
</li>
<li class="data-line-737">
<p>Le hachage de l&#8217;en-tête de bloc est égal ou inférieur à la cible (applique la preuve de travail)</p>
</li>
<li class="data-line-738">
<p>L&#8217;horodatage du bloc est inférieur à deux heures dans le futur (en tenant compte des erreurs de temps)</p>
</li>
<li class="data-line-739">
<p>La taille du bloc est dans les limites acceptables</p>
</li>
<li class="data-line-740">
<p>La première transaction (et seulement la première) est une transaction coinbase</p>
</li>
<li class="data-line-741">
<p>Toutes les transactions dans le bloc sont valides en utilisant la liste de contrôle des transactions décrite dans <a href="#tx_verification">Vérification indépendante des transactions</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-743">
<p>La validation indépendante de chaque nouveau bloc par chaque nœud du réseau garantit que les mineurs ne peuvent pas tricher. Dans les sections précédentes, nous avons vu comment les mineurs peuvent écrire une transaction qui leur attribue le nouveau bitcoin créé dans le bloc et réclamer les frais de transaction. Pourquoi les mineurs n&#8217;écrivent-ils pas eux-mêmes une transaction pour mille bitcoins au lieu de la bonne récompense ? Parce que chaque nœud valide les blocs selon les mêmes règles. Une transaction coinbase invalide rendrait l&#8217;ensemble du bloc invalide, ce qui entraînerait le rejet du bloc et, par conséquent, cette transaction ne ferait jamais partie du grand livre. Les mineurs doivent construire un bloc parfait, basé sur les règles partagées que tous les nœuds suivent, et l&#8217;exploiter avec une solution correcte à la preuve de travail. Pour ce faire, ils dépensent beaucoup d&#8217;électricité dans l&#8217;exploitation minière, et s&#8217;ils trichent, toute l&#8217;électricité et les efforts sont gaspillés. C&#8217;est pourquoi la validation indépendante est un élément clé du consensus décentralisé.</p>
</div>
</div>
<div class="sect2 data-line-745">
<h3 id="_assemblage_et_sélection_de_chaînes_de_blocs">Assemblage et sélection de chaînes de blocs</h3>
<div class="paragraph data-line-747">
<p>La dernière étape du mécanisme de consensus décentralisé de Bitcoin est l&#8217;assemblage de blocs en chaînes et la sélection de la chaîne avec le plus de preuves de travail. Une fois qu&#8217;un nœud a validé un nouveau bloc, il tentera alors d&#8217;assembler une chaîne en connectant le bloc à la chaîne de blocs existante.</p>
</div>
<div class="paragraph data-line-749">
<p>Les nœuds maintiennent trois ensembles de blocs : ceux connectés à la chaîne de blocs principale, ceux qui forment des branches de la chaîne de blocs principale (chaînes secondaires) et enfin, les blocs qui n&#8217;ont pas de parent connu dans les chaînes connues (orphelins). Les blocs invalides sont rejetés dès que l&#8217;un des critères de validation échoue et ne sont donc inclus dans aucune chaîne.</p>
</div>
<div class="paragraph data-line-751">
<p>La "chaîne principale" à tout moment est la chaîne de blocs <em>valide</em> à laquelle est associée la preuve de travail la plus cumulative. Dans la plupart des cas, il s&#8217;agit également de la chaîne contenant le plus de blocs, à moins qu&#8217;il n&#8217;y ait deux chaînes de longueur égale et que l&#8217;une ait plus de preuve de travail. La chaîne principale aura également des branches avec des blocs qui sont des "frères et sœurs" des blocs de la chaîne principale. Ces blocs sont valides mais ne font pas partie de la chaîne principale. Elles sont conservées pour référence future, au cas où l&#8217;une de ces chaînes serait étendue au-delà de la chaîne principale en cours. Dans la section suivante (<a href="#forks">Fourches de chaîne de blocs</a>), nous verrons comment des chaînes secondaires se produisent à la suite d&#8217;une extraction quasi simultanée de blocs à la même hauteur.</p>
</div>
<div class="paragraph data-line-753">
<p>Lorsqu&#8217;un nouveau bloc est reçu, un nœud essaie de l&#8217;insérer dans la chaîne de blocs existante. Le nœud examinera le champ "hachage du bloc précédent" du bloc, qui est la référence au parent du bloc. Ensuite, le nœud tentera de trouver ce parent dans la chaîne de blocs existante. La plupart du temps, le parent sera la "pointe" de la chaîne principale, ce qui signifie que ce nouveau bloc étend la chaîne principale. Par exemple, le nouveau bloc 277,316 a une référence au hachage de son bloc parent 277,315. La plupart des nœuds qui reçoivent 277 316 auront déjà le bloc 277 315 comme pointe de leur chaîne principale et relieront donc le nouveau bloc et étendront cette chaîne.</p>
</div>
<div class="paragraph data-line-755">
<p>Parfois, comme nous le verrons dans <a href="#forks">Fourches de chaîne de blocs</a>, le nouveau bloc prolonge une chaîne qui n&#8217;est pas la chaîne principale. Dans ce cas, le nœud attachera le nouveau bloc à la chaîne secondaire qu&#8217;il prolonge, puis comparera le travail de la chaîne secondaire à la chaîne principale. Si la chaîne secondaire a plus de travail cumulé que la chaîne principale, le nœud <em>reconvergera</em> sur la chaîne secondaire, ce qui signifie qu&#8217;il sélectionnera la chaîne secondaire comme sa nouvelle chaîne principale, faisant de l&#8217;ancienne chaîne principale une chaîne secondaire. Si le nœud est un mineur, il construira maintenant un bloc étendant cette nouvelle chaîne plus longue.</p>
</div>
<div class="paragraph data-line-757">
<p>Si un bloc valide est reçu et qu&#8217;aucun parent n&#8217;est trouvé dans les chaînes existantes, ce bloc est considéré comme "orphelin". Les blocs orphelins sont enregistrés dans le bassin de blocs orphelins où ils resteront jusqu&#8217;à ce que leur parent soit reçu. Une fois que le parent est reçu et lié aux chaînes existantes, l&#8217;orphelin peut être retiré du bassin d&#8217;orphelins et lié au parent, ce qui en fait une partie d&#8217;une chaîne. Les blocs orphelins se produisent généralement lorsque deux blocs extraits dans un court laps de temps sont reçus dans l&#8217;ordre inverse (enfant avant parent).</p>
</div>
<div class="paragraph data-line-759">
<p>En sélectionnant la chaîne valide de plus grand travail cumulé, tous les nœuds finissent par parvenir à un consensus à l&#8217;échelle du réseau. Les divergences temporaires entre les chaînes sont finalement résolues au fur et à mesure que du travail est ajouté, étendant l&#8217;une des chaînes possibles. Les nœuds de minage « votent » avec leur puissance de minage en choisissant quelle chaîne étendre en minant le bloc suivant. Lorsqu&#8217;ils exploitent un nouveau bloc et étendent la chaîne, le nouveau bloc lui-même représente leur vote.</p>
</div>
<div class="paragraph data-line-761">
<p>Dans la section suivante, nous verrons comment les divergences entre les chaînes concurrentes (les fourches) sont résolues par la sélection indépendante de la chaîne de plus grand travail cumulatif.</p>
</div>
<div class="sect3 data-line-764">
<h4 id="forks">Fourches de chaîne de blocs</h4>
<div class="paragraph data-line-766">
<p>Parce que la chaîne de blocs est une structure de données décentralisée, différentes copies de celle-ci ne sont pas toujours cohérentes. Les blocs peuvent arriver à différents nœuds à des moments différents, ce qui amène les nœuds à avoir différentes perspectives de la chaîne de blocs. Pour résoudre ce problème, chaque nœud sélectionne et tente toujours d&#8217;étendre la chaîne de blocs qui représente le plus de preuve de travail, également connue sous le nom de chaîne la plus longue ou de chaîne de travail cumulative la plus importante. En additionnant le travail enregistré dans chaque bloc d&#8217;une chaîne, un nœud peut calculer la quantité totale de travail qui a été dépensée pour créer cette chaîne. Tant que tous les nœuds sélectionnent la plus grande chaîne de travail cumulatif, le réseau mondial Bitcoin finit par converger vers un état cohérent. Les fourches se produisent sous forme d&#8217;incohérences temporaires entre les versions de la chaîne de blocs, qui sont résolues par une éventuelle reconvergence à mesure que d&#8217;autres blocs sont ajoutés à l&#8217;une des fourches.</p>
</div>
<div class="admonitionblock tip data-line-769">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-770">
<p>Les fourches de chaîne de blocs décrites dans cette section se produisent naturellement (accidentellement) en raison de retards de transmission dans le réseau mondial. Plus loin dans ce chapitre, nous verrons également les fourches délibérément induites (embranchements divergents et embranchements convergents), qui sont utilisés pour modifier les règles de consensus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-773">
<p>Dans les quelques diagrammes suivants, nous suivons la progression d&#8217;un événement d'"embranchement" (ou de fourche) à travers le réseau. Le diagramme est une représentation simplifiée du réseau Bitcoin. À des fins d&#8217;illustration, différents blocs sont représentés sous différentes formes (étoile, triangle, triangle inversé, losange), répartis sur le réseau. Chaque nœud du réseau est représenté par un cercle.</p>
</div>
<div class="paragraph data-line-775">
<p>Chaque nœud a sa propre perspective de la chaîne de blocs mondiale. Au fur et à mesure que chaque nœud reçoit des blocs de ses voisins, il met à jour sa propre copie de la chaîne de blocs, en sélectionnant la plus grande chaîne de travail cumulée. À des fins d&#8217;illustration, chaque nœud contient une forme qui représente le bloc qui, selon lui, est actuellement la pointe de la chaîne principale. Donc, si vous voyez une forme d&#8217;étoile dans le nœud, cela signifie que le bloc en étoile est la pointe de la chaîne principale, en ce qui concerne ce nœud.</p>
</div>
<div class="paragraph data-line-777">
<p>Dans le premier diagramme (<a href="#fork1">Avant la bifurcation, tous les nœuds ont la même perspective</a>), le réseau a une perspective unifiée de la chaîne de blocs, avec le bloc étoile comme pointe de la chaîne principale.</p>
</div>
<div id="fork1" class="imageblock smallereighty data-line-782">
<div class="content">
<img src="images/mbc2_1002.png" alt="Avant la bifurcation - tous les nœuds ont la même perspective">
</div>
<div class="title">Figure 64. Avant la bifurcation, tous les nœuds ont la même perspective</div>
</div>
<div class="paragraph data-line-784">
<p>Un "embranchement" (ou une "fourche") se produit chaque fois qu&#8217;il y a deux blocs valides différents à la même hauteur de bloc en compétition pour former la chaîne de blocs la plus longue. Cela se produit dans des conditions normales chaque fois que deux mineurs résolvent l&#8217;algorithme de preuve de travail dans un court laps de temps l&#8217;un de l&#8217;autre. Alors que les deux mineurs découvrent une solution pour leurs blocs candidats respectifs, ils diffusent immédiatement leur propre bloc "gagnant" à leurs voisins immédiats qui commencent à propager le bloc sur le réseau. Chaque nœud qui reçoit un bloc valide l&#8217;incorpore dans sa chaîne de blocs, étendant la chaîne de blocs d&#8217;un bloc. Si ce nœud voit plus tard un autre bloc valide étendre le même parent (à la même hauteur de bloc), il connecte le deuxième bloc sur une chaîne secondaire, bifurquant sa chaîne principale. En conséquence, certains nœuds "verront" un bloc gagnant en premier, tandis que d&#8217;autres nœuds verront l&#8217;autre bloc gagnant en premier, et deux versions concurrentes de la chaîne de blocs émergeront.</p>
</div>
<div class="paragraph data-line-786">
<p>Dans <a href="#fork2">Visualisation d&#8217;un événement d&#8217;embranchement (fourche) de la chaîne de blocs: deux blocs trouvés simultanément</a>, on voit deux mineurs (Nœud X et Nœud Y) qui minent deux blocs différents presque simultanément. Ces deux blocs sont des enfants du bloc étoile et étendent la chaîne en s&#8217;appuyant sur le bloc étoile. Pour nous aider à le suivre, l&#8217;un est visualisé comme un bloc triangulaire provenant du nœud X, et l&#8217;autre est représenté comme un bloc triangulaire inversé provenant du nœud Y.</p>
</div>
<div id="fork2" class="imageblock smallersixty data-line-791">
<div class="content">
<img src="images/mbc2_1003.png" alt="Visualisation d&#8217;un événement d&#8217;embranchement (fourche) de la chaîne de blocs : deux blocs trouvés simultanément">
</div>
<div class="title">Figure 65. Visualisation d&#8217;un événement d&#8217;embranchement (fourche) de la chaîne de blocs: deux blocs trouvés simultanément</div>
</div>
<div class="paragraph data-line-793">
<p>Supposons, par exemple, que le mineur Nœud X trouve une solution de preuve de travail pour un bloc "triangle" qui étend la chaîne de blocs, en s&#8217;appuyant sur le bloc parent "étoile". Presque simultanément, le mineur Nœud Y qui étendait également la chaîne du bloc "étoile" trouve une solution pour le bloc "triangle inversé", son bloc candidat. Maintenant, il y a deux blocs possibles ; un que nous appelons "triangle", originaire du Nœud X ; et un que nous appelons "triangle inversé", originaire du nœud Y. Les deux blocs ont été extraits avec succès, les deux blocs sont valides (contiennent une solution valide à la preuve de travail), et les deux blocs étendent le même parent (bloc "étoile"). Les deux blocs contiennent probablement la plupart des mêmes transactions, avec seulement peut-être quelques différences dans l&#8217;ordre des transactions.</p>
</div>
<div class="paragraph data-line-795">
<p>Au fur et à mesure que les deux blocs se propagent, certains nœuds reçoivent d&#8217;abord le bloc "triangle" et d&#8217;autres reçoivent le bloc "triangle inversé" en premier. Comme indiqué dans <a href="#fork3">Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : deux blocs se propagent, divisant le réseau</a>, le réseau se scinde en deux perspectives différentes de la chaîne de blocs; un côté surmonté du bloc triangle, l&#8217;autre du bloc triangle renversé.</p>
</div>
<div id="fork3" class="imageblock smallersixty data-line-800">
<div class="content">
<img src="images/mbc2_1004.png" alt="Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : deux blocs se propagent, divisant le réseau">
</div>
<div class="title">Figure 66. Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : deux blocs se propagent, divisant le réseau</div>
</div>
<div class="paragraph data-line-802">
<p>Dans <a href="#fork3">Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : deux blocs se propagent, divisant le réseau</a>, le mineur Nœud X a extrait (créé) le bloc triangulaire et a étendu la chaîne d&#8217;étoiles avec. Par conséquent, le Nœud X considère initialement la chaîne avec le bloc "triangle" comme la chaîne principale. Plus tard, le Nœud X a également reçu le bloc "triangle inversé" qui a été extrait par le Nœud Y. Puisqu&#8217;il a été reçu en deuxième, il est supposé avoir "perdu" la course. Pourtant, le bloc "triangle inversé" n&#8217;est pas écarté. Il est lié au bloc parent "étoile" et forme une chaîne secondaire. Alors que le Nœud X suppose que sa chaîne principale est la chaîne gagnante, il conserve la chaîne "perdante" afin qu&#8217;il dispose des informations nécessaires pour reconverger si la chaîne "perdante" finit par "gagner".</p>
</div>
<div class="paragraph data-line-804">
<p>De l&#8217;autre côté du réseau, le mineur Nœud Y construit une chaîne de blocs basée sur sa propre perspective de la séquence des événements. Le mineur Nœud Y a extrait (créé) le "triangle inversé" et considère initialement cette chaîne comme la chaîne principale (la chaîne "gagnante"). Lorsqu&#8217;il a ensuite reçu le bloc "triangle" extrait par le Nœud X, il l&#8217;a connecté au parent du bloc "étoile" en tant que chaîne secondaire.</p>
</div>
<div class="paragraph data-line-806">
<p>Aucun des deux côtés n&#8217;est "correct" ou "incorrect". Les deux sont des perspectives valables de la chaîne de blocs. Ce n&#8217;est qu&#8217;avec le recul qu&#8217;une seule l&#8217;emportera, en fonction de la façon dont ces deux chaînes concurrentes sont prolongées par des travaux supplémentaires.</p>
</div>
<div class="paragraph data-line-808">
<p>Chaque nœud de minage dont la perspective ressemble au Nœud X commencera immédiatement à miner un bloc candidat qui étend la chaîne avec un "triangle" comme pointe. En liant "triangle" en tant que parent de leurs blocs de candidats, ils votent avec leur pouvoir de hachage. Leur vote soutient la chaîne qu&#8217;ils ont élue comme chaîne principale.</p>
</div>
<div class="paragraph data-line-810">
<p>Tout nœud minier dont la perspective ressemble au Nœud Y commencera à construire un bloc candidat avec un "triangle inversé" comme parent, étendant la chaîne qu&#8217;ils croient être la chaîne principale. Et voilà, la course recommence.</p>
</div>
<div class="paragraph data-line-812">
<p>Les fourches sont presque toujours résolues en un bloc de temps (10 minutes en moyenne). Alors qu&#8217;une partie de la puissance de hachage du réseau est dédiée à la construction au-dessus du "triangle" en tant que parent, une autre partie de la puissance de hachage est concentrée sur la construction au-dessus du "triangle inversé". Même si la puissance de hachage est presque également répartie, il est probable qu&#8217;un groupe de mineurs trouvera une solution et la propagera avant que l&#8217;autre groupe de mineurs ait trouvé des solutions. Disons, par exemple, que les mineurs construisant au-dessus du "triangle" trouvent un nouveau bloc "losange" qui prolonge la chaîne (par exemple, étoile-triangle-losange). Ils propagent immédiatement ce nouveau bloc et l&#8217;ensemble du réseau le considère comme une solution valide, comme indiqué dans <a href="#fork4">Visualisation d&#8217;un événement d&#8217;un embranchement de la chaîne de blocs : un nouveau bloc étend une fourche, reconvergeant le réseau. Le Nœud X et le Nœud Y considèrent maintenant le bloc "triangle inversé" comme un bloc obsolète.</a>.</p>
</div>
<div class="paragraph data-line-814">
<p>Tous les nœuds qui avaient choisi "triangle" comme vainqueur au tour précédent étendront simplement la chaîne d&#8217;un bloc supplémentaire. Cependant, les nœuds qui ont choisi "triangle inversé" comme gagnant verront désormais deux chaînes : étoile-triangle-losange et étoile-triangle inversé. La chaîne étoile-triangle-losange est maintenant plus longue (plus de travail cumulé) que l&#8217;autre chaîne. En conséquence, ces nœuds définiront la chaîne étoile-triangle-losange comme chaîne principale et transformeront la chaîne étoile-triangle inversé en une chaîne secondaire, comme indiqué dans <a href="#fork5">Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : le réseau reconverge sur une nouvelle chaîne la plus longue</a>. Il s&#8217;agit d&#8217;une reconvergence en chaîne, car ces nœuds sont obligés de revoir leur vision de la chaîne de blocs pour intégrer les nouvelles preuves d&#8217;une chaîne plus longue. Tous les mineurs travaillant à l&#8217;extension de la chaîne étoile-inversée-triangle arrêteront désormais ce travail car leur bloc candidat est désormais considéré comme un enfant d&#8217;un bloc périmé, car son parent "triangle-inversé" n&#8217;est plus sur la chaîne la plus longue . Étant donné que le bloc triangle inversé est désormais obsolète, le mineur Nœud Y (qui a miné ce bloc) ne pourra pas dépenser la récompense de minage pour ce bloc, même si ce bloc était valide et a été miné avec succès. Les transactions dans le "triangle inversé" qui ne sont pas dans le "triangle" sont réinsérées dans le mempool pour être incluses dans le bloc suivant pour devenir une partie de la chaîne principale. L&#8217;ensemble du réseau reconverge sur une seule chaîne de blocs étoile-triangle-losange, avec "losange" comme dernier bloc de la chaîne. Tous les mineurs commencent immédiatement à travailler sur des blocs candidats qui font référence à "losange" comme parent pour étendre la chaîne étoile-triangle-losange.</p>
</div>
<div id="fork4" class="imageblock smallereighty data-line-819">
<div class="content">
<img src="images/mbc2_1005.png" alt="Visualisation d&#8217;un événement d&#8217;un embranchement de la chaîne de blocs : un nouveau bloc étend une fourche">
</div>
<div class="title">Figure 67. Visualisation d&#8217;un événement d&#8217;un embranchement de la chaîne de blocs : un nouveau bloc étend une fourche, reconvergeant le réseau. Le Nœud X et le Nœud Y considèrent maintenant le bloc "triangle inversé" comme un bloc obsolète.</div>
</div>
<div id="fork5" class="imageblock smallereighty data-line-824">
<div class="content">
<img src="images/mbc2_1006.png" alt="Visualisation d&#8217;un événement d&#8217;un embranchement de la chaîne de blocs : le réseau reconverge sur la nouvelle chaîne la plus longue">
</div>
<div class="title">Figure 68. Visualisation d&#8217;un événement d&#8217;embranchement de la chaîne de blocs : le réseau reconverge sur une nouvelle chaîne la plus longue</div>
</div>
<div class="paragraph data-line-826">
<p>Il est théoriquement possible qu&#8217;une fourche s&#8217;étende à deux blocs, si deux blocs sont trouvés presque simultanément par des mineurs sur les "côtés" opposés d&#8217;une fourche précédente. Cependant, la probabilité que cela se produise est très faible. Alors qu&#8217;une fourche à un bloc peut se produire tous les jours, une fourche à deux blocs se produit au plus une fois toutes les quelques semaines.</p>
</div>
<div class="paragraph data-line-828">
<p>L&#8217;intervalle de bloc de Bitcoin de 10 minutes est un compromis de conception entre des temps de confirmation rapides (règlement des transactions) et la probabilité d&#8217;une fourche. Un temps de bloc plus rapide rendrait les transactions plus rapides mais conduirait à des fourches de chaîne de blocs plus fréquentes, tandis qu&#8217;un temps de bloc plus lent réduirait le nombre de fourches mais ralentirait le règlement.</p>
</div>
</div>
</div>
<div class="sect2 data-line-830">
<h3 id="_lexploitation_minière_et_la_course_au_hachage">L&#8217;exploitation minière et la course au hachage</h3>
<div class="paragraph data-line-832">
<p>L&#8217;exploitation minière de Bitcoin est une industrie extrêmement compétitive. La puissance de hachage a augmenté de façon exponentielle chaque année d&#8217;existence du bitcoin. Certaines années, la croissance a reflété un changement complet de technologie, comme en 2010 et 2011, lorsque de nombreux mineurs sont passés de l&#8217;exploitation de processeurs CPU à l&#8217;exploitation de GPU et à l&#8217;exploitation de réseau prédiffusé programmable par l&#8217;utilisateur (FPGA). En 2013, l&#8217;introduction de l&#8217;exploitation minière ASIC a conduit à un autre bond de géant dans la puissance minière, en plaçant la fonction SHA256 directement sur des puces de silicium spécialisées à des fins d&#8217;exploitation minière. Les premières puces de ce type pourraient fournir plus de puissance de minage dans une seule boîte que l&#8217;ensemble du réseau Bitcoin en 2010.</p>
</div>
<div class="paragraph data-line-834">
<p>La liste suivante montre la puissance de hachage totale du réseau Bitcoin en terahachages/sec (TH/sec), depuis sa création en 2009 (source : Blockchain.com) :</p>
</div>
<div class="dlist data-line-836">
<dl>
<dt class="hdlist1">2009 </dt>
<dd>
<p>0,000004 – 0,00001 TH/sec (croissance 2,40×)</p>
</dd>
<dt class="hdlist1">2010 </dt>
<dd>
<p>0,00001 – 0,14 TH/sec (14 247× croissance)</p>
</dd>
<dt class="hdlist1">2011 </dt>
<dd>
<p>0,14 – 9,49 TH/sec (croissance de 63,92×)</p>
</dd>
<dt class="hdlist1">2012 </dt>
<dd>
<p>9,49 – 22 TH/sec (croissance 2,32×)</p>
</dd>
<dt class="hdlist1">2013 </dt>
<dd>
<p>22.04 – 15 942 TH/sec (croissance de 723,32×)</p>
</dd>
<dt class="hdlist1">2014 </dt>
<dd>
<p>15 942 – 306 333 TH/sec (croissance de 19,21×)</p>
</dd>
<dt class="hdlist1">2015 </dt>
<dd>
<p>306 333 – 881 232 TH/sec (croissance de 2,87×)</p>
</dd>
<dt class="hdlist1">2016 </dt>
<dd>
<p>881 232 – 2 807 540 TH/sec (croissance 3,18×)</p>
</dd>
<dt class="hdlist1">2017 </dt>
<dd>
<p>2 807 540 – 18 206 558 TH/sec (6,48× croissance)</p>
</dd>
<dt class="hdlist1">2018 </dt>
<dd>
<p>18 206 558 – 41 801 528 TH/sec (croissance de 2,29×)</p>
</dd>
<dt class="hdlist1">2019 </dt>
<dd>
<p>41 801 528 – 109 757 127 TH/sec (croissance de 2,62×)</p>
</dd>
<dt class="hdlist1">2020 </dt>
<dd>
<p>109 757 127 – 149 064 869 TH/sec (croissance de 1,35×)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-849">
<p>Dans le graphique en <a href="#network_hashing_power">Puissance de hachage totale, terahachages par seconde (TH/sec) (graphique sur une échelle linéaire)</a>, nous pouvons voir que la puissance de hachage du réseau Bitcoin a augmenté au cours des deux dernières années. Comme vous pouvez le constater, la concurrence entre les mineurs et la croissance du bitcoin ont entraîné une augmentation exponentielle de la puissance de hachage (total des hachages par seconde sur le réseau).</p>
</div>
<div id="network_hashing_power" class="imageblock data-line-853">
<div class="content">
<img src="images/mbc2_1007.png" alt="Taux de hachage du réseau">
</div>
<div class="title">Figure 69. Puissance de hachage totale, terahachages par seconde (TH/sec) (graphique sur une échelle linéaire)</div>
</div>
<div class="paragraph data-line-855">
<p>Alors que la quantité de puissance de hachage appliquée à l&#8217;extraction de bitcoins a explosé, la difficulté a augmenté pour l&#8217;égaler. La métrique de difficulté dans le graphique affiché dans <a href="#bitcoin_difficulty">Métrique de la difficulté de minage de Bitcoin (graphique sur une échelle logarithmique)</a> est mesuré comme un rapport de la difficulté actuelle sur la difficulté minimale (la difficulté du premier bloc).</p>
</div>
<div id="bitcoin_difficulty" class="imageblock data-line-859">
<div class="content">
<img src="images/mbc2_1008.png" alt="Difficulté Bitcoin">
</div>
<div class="title">Figure 70. Métrique de la difficulté de minage de Bitcoin (graphique sur une échelle logarithmique)</div>
</div>
<div class="paragraph data-line-861">
<p>Au cours des deux dernières années, les puces minières ASIC sont devenues de plus en plus denses, se rapprochant de la pointe de la fabrication de silicium avec une taille de caractéristique (résolution) de 7 nanomètres (nm). Actuellement, les fabricants d&#8217;ASIC visent à dépasser les fabricants de puces CPU à usage général, en concevant des puces avec une taille de fonctionnalité de 5 nm, car la rentabilité de l&#8217;exploitation minière fait avancer cette industrie encore plus rapidement que l&#8217;informatique générale. Il n&#8217;y a plus de pas de géant dans l&#8217;extraction de bitcoins, car l&#8217;industrie a atteint l&#8217;avant-garde de la loi de Moore, qui stipule que la densité de calcul doublera environ tous les 18 mois. Pourtant, la puissance minière du réseau continue de progresser à un rythme exponentiel alors que la course aux puces à plus haute densité s&#8217;accompagne d&#8217;une course aux centres de données à plus haute densité où des milliers de ces puces peuvent être déployées. Il ne s&#8217;agit plus de savoir combien d&#8217;extraction peut être effectuée avec une seule puce, mais combien de puces peuvent être insérées dans un bâtiment, tout en dissipant la chaleur et en fournissant une puissance adéquate.</p>
</div>
<div class="sect3 data-line-864">
<h4 id="extra_nonce">La solution nonce (nombre aléatoire) supplémentaire</h4>
<div class="paragraph data-line-866">
<p>Depuis 2012, l&#8217;extraction de bitcoins a évolué pour résoudre une limitation fondamentale dans la structure de l&#8217;en-tête de bloc. Au début du bitcoin, un mineur pouvait trouver un bloc en parcourant le nonce jusqu&#8217;à ce que le hachage résultant soit égal ou inférieur à la cible. Au fur et à mesure que la difficulté augmentait, les mineurs parcouraient souvent les 4 milliards de valeurs du nonce sans trouver de bloc. Cependant, cela a été facilement résolu en mettant à jour l&#8217;horodatage du bloc pour tenir compte du temps écoulé. Étant donné que l&#8217;horodatage fait partie de l&#8217;en-tête, la modification permettrait aux mineurs de parcourir à nouveau les valeurs du nonce avec des résultats différents. Cependant, une fois que le matériel de minage a dépassé 4 GH/sec, cette approche est devenue de plus en plus difficile car les valeurs nonce ont été épuisées en moins d&#8217;une seconde. Alors que l&#8217;équipement de minage ASIC commençait à pousser puis à dépasser le taux de hachage TH/sec, le logiciel de minage avait besoin de plus d&#8217;espace pour les valeurs nonce afin de trouver des blocs valides. L&#8217;horodatage pourrait être un peu étiré, mais le déplacer trop loin dans le futur rendrait le bloc invalide. Une nouvelle source de "changement" était nécessaire dans l&#8217;en-tête du bloc. La solution consistait à utiliser la transaction coinbase comme source de valeurs nonce supplémentaires. Étant donné que le script coinbase peut stocker entre 2 et 100 octets de données, les mineurs ont commencé à utiliser cet espace comme espace nonce supplémentaire, leur permettant d&#8217;explorer une gamme beaucoup plus large de valeurs d&#8217;en-tête de bloc pour trouver des blocs valides. La transaction coinbase est incluse dans l&#8217;arborescence de Merkle, ce qui signifie que tout changement dans le script coinbase entraîne la modification de la racine de Merkle. Huit octets de nonce supplémentaires, plus les 4 octets de nonce "standard" permettent aux mineurs d&#8217;explorer un total de 2<sup>96</sup> (8 suivis de 28 zéros) possibilités <em>par seconde</em> sans avoir à modifier l&#8217;horodatage. Si, à l&#8217;avenir, les mineurs pouvaient parcourir toutes ces possibilités, ils pourraient alors modifier l&#8217;horodatage. Il y a également plus d&#8217;espace dans le script coinbase pour l&#8217;expansion future de l&#8217;espace nonce supplémentaire.</p>
</div>
</div>
<div class="sect3 data-line-869">
<h4 id="mining_pools">Groupes miniers</h4>
<div class="paragraph data-line-871">
<p>Dans cet environnement hautement concurrentiel, les mineurs travaillant seuls (également appelés mineurs solo) n&#8217;ont aucune chance. La probabilité qu&#8217;ils trouvent un bloc pour compenser leurs coûts d&#8217;électricité et de matériel est si faible que cela représente un pari, comme jouer à la loterie. Même le système minier ASIC grand public le plus rapide ne peut pas suivre les systèmes commerciaux qui empilent des dizaines de milliers de ces puces dans des entrepôts géants à proximité de centrales hydroélectriques. Les mineurs collaborent désormais pour former des groupes de minage, mettant en commun leur pouvoir de hachage et partageant la récompense entre des milliers de participants. En participant à un groupe, les mineurs obtiennent une plus petite part de la récompense globale, mais sont généralement récompensés tous les jours, ce qui réduit l&#8217;incertitude.</p>
</div>
<div class="paragraph data-line-873">
<p>Prenons un exemple précis. Supposons qu&#8217;un mineur ait acheté du matériel de minage avec un taux de hachage combiné de 14 000 gigahachages par seconde (GH/s), soit 14 TH/s. En 2017, cet équipement coûte environ 2 500 $ US. Le matériel consomme 1375 watts (1,3 kW) d&#8217;électricité lorsqu&#8217;il fonctionne, 33 kW-heures par jour, à un coût de 1 $ à 2 $ par jour à des tarifs d&#8217;électricité très bas. À la difficulté actuelle du bitcoin, le mineur pourra extraire un bloc en solo environ une fois tous les 4 ans. Comment calcule-t-on cette probabilité ? Il est basé sur un taux de hachage à l&#8217;échelle du réseau de 3 EH/sec (en 2017) et le taux du mineur de 14 TH/sec :</p>
</div>
<ul class="simplelist">
  <li>P = (14 * 10<sup>12</sup> / 3 * 10<sup>18</sup> ) * 210 240 = 0,98</li>
</ul>
<div class="paragraph data-line-881">
<p>&#8230;&#8203;où 210 240 est le nombre de blocs en quatre ans. Le mineur a une probabilité de 98 % de trouver un bloc sur quatre ans, sur la base du taux de hachage global au début de la période.</p>
</div>
<div class="paragraph data-line-883">
<p>Si le mineur trouve un seul bloc dans ce délai, le paiement de 6,25 bitcoins, à environ 1 000 $ par bitcoin, se traduira par un paiement unique de 6 250 $, ce qui produira un bénéfice net d&#8217;environ 750 $. Cependant, la chance de trouver un bloc dans une période de 4 ans dépend de la chance du mineur. Il pourrait trouver deux blocs en 4 ans et faire un profit plus important. Ou il pourrait ne pas trouver de bloc pendant 5 ans et subir une grosse perte financière. Pire encore, la difficulté de l&#8217;algorithme Bitcoin de preuve de travail est susceptible d&#8217;augmenter considérablement au cours de cette période, au rythme actuel de croissance de la puissance de hachage, ce qui signifie que le mineur a au plus un an pour atteindre le seuil de rentabilité avant que le matériel soit effectivement obsolète et que ce dernier soit remplacé par du matériel de minage plus puissant. Financièrement, cela n&#8217;a de sens qu&#8217;à très faible coût d&#8217;électricité (moins de 1 cent par kWh) et uniquement à très grande échelle.</p>
</div>
<div class="paragraph data-line-885">
<p>Les "pools" ou groupes de minage coordonnent plusieurs centaines ou milliers de mineurs, sur des protocoles de minage de groupe spécialisés. Les mineurs individuels configurent leur équipement minier pour se connecter à un serveur de pool et spécifient une adresse Bitcoin, qui recevra leur part des récompenses. Leur matériel de minage reste connecté au serveur du pool pendant le minage, synchronisant leurs efforts avec les autres mineurs. Ainsi, les mineurs du pool partagent l&#8217;effort d&#8217;extraction d&#8217;un bloc, puis partagent les récompenses.</p>
</div>
<div class="paragraph data-line-887">
<p>Les blocs réussis paient la récompense à une adresse Bitcoin de groupe, plutôt qu&#8217;à des mineurs individuels. Le serveur de groupe effectuera périodiquement des paiements aux adresses Bitcoin des mineurs, une fois que leur part des récompenses aura atteint un certain seuil. En règle générale, le serveur de groupe facture un pourcentage des récompenses pour la fourniture du service de minage de groupe.</p>
</div>
<div class="paragraph data-line-889">
<p>Les mineurs participant à un groupe se partagent le travail de recherche d&#8217;une solution à un bloc candidat, gagnant des "actions" pour leur contribution minière. Le groupe de minage fixe un objectif plus élevé (difficulté moindre) pour gagner une part, généralement plus de 1 000 fois plus facile que l&#8217;objectif du réseau Bitcoin. Lorsqu&#8217;un membre du groupe exploite avec succès un bloc, la récompense est gagnée par le groupe, puis partagée avec tous les mineurs proportionnellement au nombre d&#8217;actions qu&#8217;ils ont contribué à l&#8217;effort.</p>
</div>
<div class="paragraph data-line-891">
<p>Les groupes sont ouvertes à tout mineur, grand ou petit, professionnel ou amateur. Un groupe aura donc certains participants avec une seule petite machine de minage, et d&#8217;autres avec un garage rempli de matériel de minage haut de gamme. Certains exploiteront quelques dizaines de kilowatts d&#8217;électricité, d&#8217;autres exploiteront un centre de données consommant un mégawatt d&#8217;électricité. Comment un groupe de minage mesure-t-il les contributions individuelles, de manière à répartir équitablement les récompenses, sans possibilité de tricherie ? La réponse est d&#8217;utiliser l&#8217;algorithme de preuve de travail de Bitcoin pour mesurer la contribution de chaque mineur du groupe, mais avec une difficulté inférieure afin que même les plus petits mineurs du groupe gagnent une part suffisamment fréquemment pour qu&#8217;il soit intéressant de contribuer au groupe. En fixant une difficulté inférieure pour gagner des actions, le groupe mesure la quantité de travail effectué par chaque mineur. Chaque fois qu&#8217;un mineur de groupe trouve un hachage d&#8217;en-tête de bloc égal ou inférieur à la cible du groupe, il prouve qu&#8217;il a effectué le travail de hachage pour trouver ce résultat. Plus important encore, le travail de recherche de parts contribue, de manière statistiquement mesurable, à l&#8217;effort global pour trouver un hachage égal ou inférieur à la cible du réseau Bitcoin. Des milliers de mineurs essayant de trouver des hachages de faible valeur finiront par en trouver un suffisamment bas pour satisfaire la cible du réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-893">
<p>Revenons à l&#8217;analogie d&#8217;un jeu de dés. Si les joueurs de dés lancent des dés avec un objectif de lancer égal ou inférieur à quatre (la difficulté globale du réseau), un groupe fixerait un objectif plus facile, en comptant combien de fois les joueurs du groupe ont réussi à lancer égal ou inférieur à huit. Lorsque les joueurs du pool lancent un nombre égal ou inférieur à huit (l&#8217;objectif de partage du groupe) mais supérieur à quatre (supérieur à la difficulté globale du réseau), ils gagnent des parts, mais ni eux ni le groupe ne gagnent la partie car ils n&#8217;y parviennent pas à atteindre la cible (égale ou inférieure à quatre). Les joueurs de groupe atteindront beaucoup plus souvent l&#8217;objectif de groupe le plus facile, leur faisant gagner des parts très régulièrement, même s&#8217;ils n&#8217;atteignent pas l&#8217;objectif plus difficile de gagner la partie. De temps en temps, l&#8217;un des joueurs du groupe lancera les dés combinés égal ou inférieur à quatre, le joueur du groupe gagne une part et l&#8217;ensemble du groupe gagne la partie. Ensuite, les gains peuvent être distribués aux joueurs du groupe en fonction du nombre de parts que chacun a gagné. Même si l&#8217;objectif de huit ou moins n&#8217;était pas gagnant, c&#8217;était un moyen juste de mesurer les lancers de dés pour les joueurs, et cela produit parfois un lancer de quatre ou moins.</p>
</div>
<div class="paragraph data-line-895">
<p>De même, un groupe de minage définira une cible de groupe (plus élevée et plus facile) qui garantira qu&#8217;un mineur de groupe individuel peut trouver des hachages d&#8217;en-tête de bloc qui sont souvent égaux ou inférieurs à la cible du pool, gagnant ainsi des actions. De temps en temps, l&#8217;une de ces tentatives produira un hachage d&#8217;en-tête de bloc égal ou inférieur à la cible du réseau Bitcoin, ce qui en fait un bloc valide et l&#8217;ensemble du groupe gagne.</p>
</div>
<div class="sect4 data-line-897">
<h5 id="_groupes_gérées">Groupes gérées</h5>
<div class="paragraph data-line-899">
<p> La plupart des groupes de minage sont "gérés", ce qui signifie qu&#8217;une entreprise ou un individu gère un serveur de groupe. Le propriétaire du serveur de groupe est appelé <em>opérateur de pool</em> (ou <em>opérateur de groupe</em>), et il facture aux mineurs du groupe un pourcentage des gains.</p>
</div>
<div class="paragraph data-line-901">
<p>Le serveur de groupe exécute un logiciel spécialisé et un protocole de minage en groupe qui coordonnent les activités des mineurs en groupe. Le serveur de groupe est également connecté à un ou plusieurs nœuds Bitcoin complets et a un accès direct à une copie complète de la base de données, c-à-d la chaîne de blocs. Cela permet au serveur de groupe de valider les blocs et les transactions au nom des mineurs en groupe, les soulageant ainsi du fardeau d&#8217;exécuter un nœud complet. Pour les mineurs en groupe, il s&#8217;agit d&#8217;une considération importante, car un nœud complet nécessite un ordinateur dédié avec au moins 300 à 350 Go de stockage persistant (disque) et au moins 2 à 4 Go de mémoire (RAM). De plus, le logiciel bitcoin exécuté sur le nœud complet doit être surveillé, entretenu et mis à jour fréquemment. Tout temps d&#8217;arrêt causé par un manque d&#8217;entretien ou un manque de ressources nuira à la rentabilité du mineur. Pour de nombreux mineurs, la possibilité d&#8217;exploiter sans exécuter un nœud complet est un autre grand avantage de rejoindre un groupe géré.</p>
</div>
<div class="paragraph data-line-903">
<p>Les mineurs en groupe se connectent au serveur de groupe à l&#8217;aide d&#8217;un protocole de minage tel que Stratum (STM) ou GetBlockTemplate (GBT). Une norme plus ancienne appelée GetWork (GWK) est pour la plupart obsolète depuis fin 2012, car elle ne prend pas facilement en charge l&#8217;extraction à des taux de hachage supérieurs à 4 GH/s. Les protocoles STM et GBT créent des blocs <em>modèles</em> qui contiennent un modèle d&#8217;en-tête de bloc candidat. Le serveur de groupe construit un bloc candidat en agrégeant les transactions, en ajoutant une transaction coinbase (avec un espace nonce supplémentaire), en calculant la racine de Merkle et en se liant au hachage de bloc précédent. L&#8217;en-tête du bloc candidat est ensuite envoyé à chacun des mineurs du groupe en tant que modèle. Chaque mineur du groupe exploite ensuite le modèle de bloc, à une cible plus élevée (plus facile) que la cible du réseau Bitcoin, et renvoie tous les résultats réussis au serveur du groupe pour gagner des parts.</p>
</div>
</div>
<div class="sect4 data-line-905">
<h5 id="_groupe_de_minage_pair_à_pair_p2pool">Groupe de minage pair à pair (P2Pool)</h5>
<div class="paragraph data-line-907">
<p>Les groupes gérés créent la possibilité de tricherie par l&#8217;opérateur du groupe, qui pourrait diriger l&#8217;effort du groupe pour doubler les transactions ou invalider les blocs (voir <a href="#consensus_attacks">Attaques par consensus</a>). De plus, les serveurs de groupe centralisés représentent un point de défaillance unique. Si le serveur du groupe est en panne ou est ralenti par une attaque par déni de service, les mineurs du groupe ne peuvent pas exploiter. En 2011, pour résoudre ces problèmes de centralisation, une nouvelle méthode de minage en groupe a été proposée et mise en place : P2Pool, un pool de minage pair à pair sans opérateur central.</p>
</div>
<div class="paragraph data-line-909">
<p>P2Pool fonctionne en décentralisant les fonctions du serveur de groupe, en implémentant un système parallèle de type chaîne de blocs appelé <em>chaîne de partage</em>. Une chaîne de partage est une chaîne de blocs fonctionnant à une difficulté inférieure à la chaîne de blocs Bitcoin. La chaîne de partage permet aux mineurs en groupe de collaborer dans un groupe décentralisé en extrayant des parts sur la chaîne de partage à raison d&#8217;un bloc de partage toutes les 30 secondes. Chacun des blocs de la chaîne de partage enregistre une récompense de part proportionnelle pour les mineurs du groupe qui contribuent au travail, se reportant aux parts du bloc de partage précédent. Lorsque l&#8217;un des blocs de partage atteint également l&#8217;objectif du réseau Bitcoin, il est propagé et inclus dans la chaîne de blocs Bitcoin, récompensant tous les mineurs du groupe qui ont contribué à toutes les parts qui ont précédé le bloc de partage gagnant. Essentiellement, au lieu qu&#8217;un serveur de groupe garde une trace des actions et des récompenses des mineurs en groupe, la chaîne de partage permet à tous les mineurs en groupe de suivre toutes les actions en utilisant un mécanisme de consensus décentralisé comme le mécanisme de consensus de chaîne de blocs de Bitcoin.</p>
</div>
<div class="paragraph data-line-911">
<p>L&#8217;extraction de P2Pool est plus complexe que l&#8217;extraction de groupe car elle nécessite que les mineurs en groupe exécutent un ordinateur dédié avec suffisamment d&#8217;espace disque, de mémoire et de bande passante Internet pour prendre en charge un nœud Bitcoin complet et le logiciel de nœud P2Pool. Les mineurs P2Pool connectent leur matériel de minage à leur nœud P2Pool local, qui simule les fonctions d&#8217;un serveur de pool en envoyant des modèles de bloc au matériel de minage. Sur P2Pool, les mineurs de pool individuels construisent leurs propres blocs candidats, agrégeant les transactions un peu comme les mineurs en solo, mais exploitent ensuite en collaboration sur la chaîne de partage. P2Pool est une approche hybride qui présente l&#8217;avantage de paiements beaucoup plus granulaires que le minage en solo, mais sans donner trop de contrôle à un opérateur de pool comme les groupes gérés.</p>
</div>
<div class="paragraph data-line-914">
<p>Même si P2Pool réduit la concentration du pouvoir par les opérateurs de groupes de minage, il est concevable qu&#8217;il soit vulnérable à 51 % des attaques contre la chaîne de partage elle-même. Une adoption beaucoup plus large de P2Pool ne résout pas le problème d&#8217;attaque de 51 % pour le bitcoin lui-même. Au contraire, P2Pool rend le bitcoin plus robuste dans l&#8217;ensemble, dans le cadre d&#8217;un écosystème minier diversifié.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-917">
<h3 id="consensus_attacks">Attaques par consensus</h3>
<div class="paragraph data-line-919">
<p>Le mécanisme de consensus de Bitcoin est, du moins théoriquement, vulnérable aux attaques des mineurs (ou les groupes) qui tentent d&#8217;utiliser leur pouvoir de hachage à des fins malhonnêtes ou destructrices. Comme nous l&#8217;avons vu, le mécanisme de consensus dépend du fait qu&#8217;une majorité de mineurs agissent honnêtement dans leur propre intérêt. Cependant, si un mineur ou un groupe de mineurs peut atteindre une part importante de la puissance minière, il peut attaquer le mécanisme de consensus afin de perturber la sécurité et la disponibilité du réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-921">
<p>Il est important de noter que les attaques de consensus ne peuvent affecter que le consensus futur, ou au mieux, le passé le plus récent (dizaines de blocs). Le registre de Bitcoin devient de plus en plus immuable au fil du temps. Alors qu&#8217;en théorie, une fourche peut être réalisé à n&#8217;importe quelle profondeur, en pratique, la puissance de calcul nécessaire pour forcer une fourche très profonde est immense, rendant les anciens blocs pratiquement immuables. Les attaques par consensus n&#8217;affectent pas non plus la sécurité des clés privées et de l&#8217;algorithme de signature (ECDSA). Une attaque par consensus ne peut pas voler des bitcoins, dépenser des bitcoins sans signatures, rediriger des bitcoins ou autrement modifier des transactions passées ou des enregistrements de propriété. Les attaques par consensus ne peuvent affecter que les blocs les plus récents et provoquer des interruptions par déni de service sur la création de futurs blocs.</p>
</div>
<div class="paragraph data-line-923">
<p>Un scénario d&#8217;attaque contre le mécanisme de consensus est appelé "l&#8217;attaque à 51 %". Dans ce scénario, un groupe de mineurs, contrôlant la majorité (51%) de la puissance de hachage totale du réseau, s&#8217;entend pour attaquer le bitcoin. Avec la capacité d&#8217;exploiter la majorité des blocs, les mineurs attaquants peuvent provoquer des "fourches" délibérés dans la chaîne de blocs et doubler les transactions ou exécuter des attaques par déni de service contre des transactions ou des adresses spécifiques. Une attaque fourche/double-dépense est l&#8217;endroit où l&#8217;attaquant provoque l&#8217;invalidation de blocs précédemment confirmés en forgeant en dessous d&#8217;eux et en reconvergeant sur une chaîne alternative. Avec une puissance suffisante, un attaquant peut invalider six blocs ou plus à la suite, provoquant l&#8217;invalidation de transactions considérées comme immuables (six confirmations). Notez qu&#8217;une double dépense ne peut être effectuée que sur les propres transactions de l&#8217;attaquant, pour lesquelles l&#8217;attaquant peut produire une signature valide. Dépenser deux fois ses propres transactions est rentable si, en invalidant une transaction, l&#8217;attaquant peut obtenir un paiement ou un produit d&#8217;échange irréversible sans le payer.</p>
</div>
<div class="paragraph data-line-925">
<p>Examinons un exemple pratique d&#8217;une attaque à 51 %. Dans le premier chapitre, nous avons examiné une transaction entre Alice et Bob pour une tasse de café. Bob, le propriétaire du café, est prêt à accepter le paiement pour des tasses de café sans attendre de confirmation (extraction en bloc), car le risque de double dépense pour une tasse de café est faible par rapport à la commodité d&#8217;un service client rapide . Ceci est similaire à la pratique des cafés qui acceptent les paiements par carte de crédit sans signature pour des montants inférieurs à 25 $, car le risque de rétrofacturation par carte de crédit est faible tandis que le coût de retarder la transaction pour obtenir une signature est comparativement plus élevé. En revanche, vendre un article plus cher pour du bitcoin présente le risque d&#8217;une attaque à double dépense, où l&#8217;acheteur diffuse une transaction concurrente qui dépense les mêmes intrants (UTXO) et annule le paiement au commerçant. Une attaque par double dépense peut se produire de deux manières : soit avant qu&#8217;une transaction ne soit confirmée, soit si l&#8217;attaquant profite d&#8217;une fourche de chaîne de blocs pour annuler plusieurs blocs. Une attaque à 51 % permet aux attaquants de doubler leurs propres transactions dans la nouvelle chaîne, annulant ainsi la transaction correspondante dans l&#8217;ancienne chaîne.</p>
</div>
<div class="paragraph data-line-927">
<p>Dans notre exemple, l&#8217;attaquant malveillant Mallory se rend dans la galerie de Carol et achète un magnifique triptyque représentant Satoshi Nakamoto en Prométhée. Carol vend les peintures "The Great Fire" pour 250 000 $ en bitcoins à Mallory. Au lieu d&#8217;attendre six confirmations ou plus sur la transaction, Carol emballe et remet les peintures à Mallory après une seule confirmation. Mallory travaille avec un complice, Paul, qui exploite un grand groupe minier, et le complice lance une attaque à 51 % dès que la transaction de Mallory est incluse dans un bloc. Paul ordonne au groupe minier de reminer la même hauteur de bloc que le bloc contenant la transaction de Mallory, en remplaçant le paiement de Mallory à Carol par une transaction qui double la même entrée que le paiement de Mallory. La transaction à double dépense consomme le même UTXO et le rembourse au portefeuille de Mallory, au lieu de le payer à Carol, permettant essentiellement à Mallory de conserver le bitcoin. Paul dirige ensuite le groupe de minage pour exploiter un bloc supplémentaire, de manière à rendre la chaîne contenant la transaction à double dépense plus longue que la chaîne d&#8217;origine (provoquant une bifurcation sous le bloc contenant la transaction de Mallory). Lorsque la fourche de la chaîne de blocs se résout en faveur de la nouvelle chaîne (plus longue), la transaction à double dépense remplace le paiement initial à Carol. Carol manque maintenant les trois peintures et n&#8217;a pas non plus de paiement en bitcoin. Tout au long de cette activité, les participants au groupe de minage de Paul pourraient parfaitement ignorer la tentative de double dépense, car ils minent avec des mineurs automatisés et ne peuvent pas surveiller chaque transaction ou chaque bloc.</p>
</div>
<div class="paragraph data-line-929">
<p>Pour se protéger contre ce type d&#8217;attaque, un commerçant vendant des articles de grande valeur doit attendre au moins six confirmations avant remettre le produit à l&#8217;acheteur. Alternativement, le commerçant doit utiliser un compte multisignature à garantie bloqué, attendant à nouveau plusieurs confirmations après le financement du compte à garantie bloqué. Plus le nombre de confirmations s&#8217;écoule, plus il devient difficile d&#8217;invalider une transaction avec une attaque à 51 %. Pour les articles de grande valeur, le paiement par bitcoin sera toujours pratique et efficace même si l&#8217;acheteur doit attendre 24 heures pour la livraison, ce qui correspondrait à environ 144 confirmations.</p>
</div>
<div class="paragraph data-line-931">
<p>En plus d&#8217;une attaque à double dépense, l&#8217;autre scénario d&#8217;une attaque par consensus consiste à refuser le service à des participants Bitcoin spécifiques (adresses Bitcoin spécifiques). Un attaquant disposant de la majorité de la puissance minière peut simplement ignorer des transactions spécifiques. S&#8217;ils sont inclus dans un bloc miné par un autre mineur, l&#8217;attaquant peut délibérément bifurquer et réminer ce bloc, en excluant à nouveau les transactions spécifiques. Ce type d&#8217;attaque peut entraîner un déni de service prolongé contre une adresse spécifique ou un ensemble d&#8217;adresses aussi longtemps que l&#8217;attaquant contrôle la majorité de la puissance de minage.</p>
</div>
<div class="paragraph data-line-933">
<p>Malgré son nom, le scénario d&#8217;attaque à 51 % ne nécessite pas réellement 51 % de la puissance de hachage. En fait, une telle attaque peut être tentée avec un pourcentage plus faible de la puissance de hachage. Le seuil de 51 % est simplement le niveau auquel une telle attaque est presque garantie de réussir. Une attaque consensuelle est essentiellement un bras de fer pour le bloc suivant et le groupe "le plus fort" a plus de chances de gagner. Avec moins de puissance de hachage, la probabilité de succès est réduite, car d&#8217;autres mineurs contrôlent la génération de certains blocs avec leur puissance de minage "honnête". Une façon de voir les choses est que plus un attaquant a de puissance de hachage, plus la fourche qu&#8217;il peut délibérément créer est long, plus il peut invalider de blocs dans le passé récent ou plus il peut contrôler de blocs dans le futur. Des groupes de recherche en sécurité ont utilisé la modélisation statistique pour affirmer que divers types d&#8217;attaques par consensus sont possibles avec aussi peu que 30 % de la puissance de hachage.</p>
</div>
<div class="paragraph data-line-935">
<p>L&#8217;augmentation massive de la puissance de hachage totale a sans doute rendu le bitcoin insensible aux attaques d&#8217;un seul mineur. Il n&#8217;y a aucun moyen pour un mineur solo de contrôler plus qu&#8217;un petit pourcentage de la puissance minière totale. Cependant, la centralisation du contrôle causée par les groupes de minage a introduit le risque d&#8217;attaques à but lucratif par un opérateur de groupe de minage. L&#8217;opérateur d&#8217;un groupe géré contrôle la construction des blocs candidats et contrôle également les transactions incluses. Cela donne à l&#8217;opérateur du groupe le pouvoir d&#8217;exclure des transactions ou d&#8217;introduire des transactions à double dépense. Si un tel abus de pouvoir est fait de manière limitée et subtile, un opérateur de groupe pourrait éventuellement profiter d&#8217;une attaque par consensus sans se faire remarquer.</p>
</div>
<div class="paragraph data-line-937">
<p>Cependant, tous les attaquants ne seront pas motivés par le profit. Un scénario d&#8217;attaque potentiel est celui où un attaquant a l&#8217;intention de perturber le réseau Bitcoin sans avoir la possibilité de profiter d&#8217;une telle perturbation. Une attaque malveillante visant à paralyser le bitcoin nécessiterait d&#8217;énormes investissements et une planification secrète, mais pourrait éventuellement être lancée par un attaquant bien financé, très probablement parrainé par l&#8217;État. Alternativement, un attaquant bien financé pourrait attaquer le consensus de bitcoin en amassant simultanément du matériel de minage, en compromettant les opérateurs de groupe et en attaquant d&#8217;autres groupes par déni de service. Tous ces scénarios sont théoriquement possibles, mais de plus en plus impraticables à mesure que la puissance de hachage globale du réseau Bitcoin continue de croître de façon exponentielle.</p>
</div>
<div class="paragraph data-line-939">
<p>Sans aucun doute, une attaque sérieuse du consensus éroderait la confiance dans le bitcoin à court terme, provoquant éventuellement une baisse significative des prix. Cependant, le réseau et les logiciels Bitcoin évoluent constamment, de sorte que les attaques par consensus se heurteraient à des contre-mesures immédiates de la part de la communauté bitcoin, rendant le bitcoin plus robuste.</p>
</div>
</div>
<div class="sect2 data-line-942">
<h3 id="consensus_changes">Modification des règles de consensus</h3>
<div class="paragraph data-line-944">
<p>Les règles de consensus déterminent la validité des transactions et des blocs. Ces règles constituent la base de la collaboration entre tous les nœuds Bitcoin et sont responsables de la convergence de toutes les perspectives locales en une seule chaîne de blocs cohérente sur l&#8217;ensemble du réseau.</p>
</div>
<div class="paragraph data-line-946">
<p>Alors que les règles de consensus sont invariables à court terme et doivent être cohérentes à travers tous les nœuds, elles ne sont pas invariables à long terme. Afin d&#8217;évoluer et de développer le système Bitcoin, les règles doivent changer de temps en temps pour s&#8217;adapter aux nouvelles fonctionnalités, améliorations ou corrections de bogues. Contrairement au développement de logiciels traditionnels, cependant, les mises à niveau vers un système de consensus sont beaucoup plus difficiles et nécessitent une coordination entre tous les participants.</p>
</div>
<div class="sect3 data-line-950">
<h4 id="hard_forks">Embranchements divergents</h4>
<div class="paragraph data-line-951">
<p>Dans <a href="#forks">Fourches de chaîne de blocs</a> nous avons examiné comment le réseau Bitcoin peut brièvement diverger, avec deux parties du réseau suivant deux branches différentes de la chaîne de blocs pendant une courte période. Nous avons vu comment ce processus se produit naturellement, dans le cadre du fonctionnement normal du réseau et comment le réseau reconverge sur une chaîne de blocs commune après le minage d&#8217;un ou plusieurs blocs.</p>
</div>
<div class="paragraph data-line-953">
<p>Il existe un autre scénario dans lequel le réseau peut diverger en deux chaînes suivantes : un changement dans les règles de consensus. Ce type de fourche ou embranchement est appelé <em>embranchement divergent</em> (<em>hard fork</em>), car après l&#8217;embranchement ou la fourche, le réseau ne reconverge pas sur une seule chaîne. Au lieu de cela, les deux chaînes évoluent indépendamment. Les embranchements divergents se produisent lorsqu&#8217;une partie du réseau fonctionne selon un ensemble de règles de consensus différent du reste du réseau. Cela peut se produire à cause d&#8217;un bogue ou à cause d&#8217;un changement délibéré dans l&#8217;implémentation des règles de consensus.</p>
</div>
<div class="paragraph data-line-955">
<p>Les embranchements divergents peuvent être utilisés pour modifier les règles du consensus, mais ils nécessitent une coordination entre tous les participants au système. Tous les nœuds qui ne se mettent pas à niveau vers les nouvelles règles de consensus ne peuvent pas participer au mécanisme de consensus et sont forcés à une chaîne distincte au moment de l&#8217;embranchement divergent. Ainsi, un changement introduit par un embranchement divergent peut être considéré comme non « compatible en aval », dans la mesure où les systèmes non mis à niveau ne peuvent pas traiter les nouvelles règles de consensus après l&#8217;événement d&#8217;embranchement divergent.</p>
</div>
<div class="paragraph data-line-957">
<p>Examinons les mécanismes d&#8217;un embranchement divergent avec un exemple spécifique.</p>
</div>
<div class="paragraph data-line-959">
<p><a href="#blockchainwithforks">Une chaîne de blocs avec des fourches</a> montre une chaîne de blocs avec deux fourches. À la hauteur de bloc 4, une fourche à un bloc se produit. C&#8217;est le type de fourche spontané que nous avons vu dans <a href="#forks">Fourches de chaîne de blocs</a>. Avec le minage du bloc 5, le réseau reconverge sur une chaîne et l&#8217;embranchement est résolu.</p>
</div>
<div id="blockchainwithforks" class="imageblock data-line-963">
<div class="content">
<img src="images/mbc2_1009.png" alt="Une chaîne de blocs avec des fourches">
</div>
<div class="title">Figure 71. Une chaîne de blocs avec des fourches</div>
</div>
<div class="paragraph data-line-965">
<p>Plus tard, cependant, à la hauteur de bloc 6, une bifurcation divergente se produit. Supposons qu&#8217;une nouvelle implémentation du client soit publiée avec un changement dans les règles de consensus. À partir de la hauteur de bloc 7, les mineurs exécutant cette nouvelle implémentation accepteront un nouveau type de signature numérique, appelons-le une signature "Smores", qui n&#8217;est pas basée sur ECDSA. Immédiatement après, un nœud exécutant la nouvelle implémentation crée une transaction qui contient une signature Smores et un mineur avec le logiciel mis à jour mine le bloc 7b contenant cette transaction.</p>
</div>
<div class="paragraph data-line-967">
<p>Tout nœud ou mineur qui n&#8217;a pas mis à jour le logiciel pour valider les signatures Smores est désormais incapable de traiter le bloc 7b. De leur point de vue, la transaction qui contenait une signature Smores et le bloc 7b qui contenait cette transaction sont invalides, car ils les évaluent sur la base des anciennes règles de consensus. Ces nœuds rejetteront la transaction et le bloc et ne les propageront pas. Tous les mineurs qui utilisent les anciennes règles n&#8217;accepteront pas le bloc 7b et continueront à exploiter un bloc candidat dont le parent est le bloc 6. En fait, les mineurs utilisant les anciennes règles peuvent même ne pas recevoir le bloc 7b si tous les nœuds auxquels ils sont connectés sont obéissant également aux anciennes règles et donc ne propageant pas le bloc. À terme, ils pourront exploiter le bloc 7a, qui est valide selon les anciennes règles et ne contient aucune transaction avec des signatures Smores.</p>
</div>
<div class="paragraph data-line-969">
<p>Les deux chaînes continuent de diverger à partir de ce point. Les mineurs de la chaîne "b" continueront d&#8217;accepter et d&#8217;exploiter les transactions contenant des signatures Smores, tandis que les mineurs de la chaîne "a" continueront d&#8217;ignorer ces transactions. Même si le bloc 8b ne contient aucune transaction signée Smores, les mineurs de la chaîne "a" ne peuvent pas le traiter. Pour eux, il semble être un bloc orphelin, car son parent "7b" n&#8217;est pas reconnu comme un bloc valide.</p>
</div>
</div>
<div class="sect3 data-line-971">
<h4 id="_embranchements_divergents_logiciel_réseau_exploitation_minière_et_chaîne">Embranchements divergents : logiciel, réseau, exploitation minière et chaîne</h4>
<div class="paragraph data-line-973">
<p>Pour les développeurs de logiciels, le terme "fourche" a une autre signification, ajoutant de la confusion au terme "fourche divergente". Dans les logiciels à source libre, une fourche se produit lorsqu&#8217;un groupe de développeurs choisit de suivre une feuille de route logicielle différente et démarre une implémentation concurrente d&#8217;un projet à source libre. Nous avons déjà discuté de deux circonstances qui conduiront à un embranchement divergent en Bitcoin : un bogue dans les règles de consensus et une modification délibérée des règles de consensus. Dans le cas d&#8217;une modification délibérée des règles de consensus, une fourche logicielle précède l&#8217;embranchement divergent. Cependant, pour que ce type d&#8217;embranchement divergent se produise, une nouvelle implémentation logicielle des règles de consensus doit être développée, adoptée et lancée.</p>
</div>
<div class="paragraph data-line-975">
<p>Des exemples de fourches logicielles qui ont tenté de modifier les règles de consensus incluent Bitcoin XT, Bitcoin Classic et, plus récemment, Bitcoin Unlimited. Cependant, aucun de ces fourches logiciels n&#8217;a abouti à un embranchement divergent. Bien qu&#8217;une fourche logicielle soit une condition préalable nécessaire, il n&#8217;est pas suffisant en soi pour qu&#8217;un embranchement divergent se produise. Pour qu&#8217;un embranchement divergent se produise, l&#8217;implémentation concurrente doit être adoptée et les nouvelles règles activées, par les mineurs, les portefeuilles et les nœuds intermédiaires. A l&#8217;inverse, il existe de nombreuses implémentations alternatives de Bitcoin Core, et même des fourches logiciels, qui ne changent pas les règles de consensus, et sauf par bogue, peuvent coexister sur le réseau et interagir sans provoquer d&#8217;embranchement divergent.</p>
</div>
<div class="paragraph data-line-977">
<p>Les règles de consensus peuvent différer de manière évidente et explicite, dans la validation des transactions ou des blocs. Les règles peuvent également différer de manière plus subtile, dans la mise en œuvre des règles de consensus telles qu&#8217;elles s&#8217;appliquent aux scripts bitcoin ou aux primitives cryptographiques telles que les signatures numériques. Enfin, les règles de consensus peuvent différer de manière imprévue en raison des contraintes de consensus implicites imposées par les limitations du système ou les détails de mise en œuvre. Un exemple de ce dernier a été vu dans l&#8217;embranchement divergent imprévu lors de la mise à niveau de Bitcoin Core 0.7 vers 0.8, qui a été causé par une limitation de l&#8217;implémentation de Berkeley DB utilisée pour stocker les blocs.</p>
</div>
<div class="paragraph data-line-979">
<p>Conceptuellement, nous pouvons considérer qu&#8217;un embranchement divergent se développe en quatre étapes : une fourche logiciel, une fourche du réseau, une fourche de minage et une fourche de chaîne.</p>
</div>
<div class="paragraph data-line-981">
<p>Le processus commence lorsqu&#8217;une implémentation alternative du client, avec des règles de consensus modifiées, est créée par les développeurs.</p>
</div>
<div class="paragraph data-line-983">
<p>Lorsque cette implémentation fourchée est déployée dans le réseau, un certain pourcentage de mineurs, d&#8217;utilisateurs de portefeuille et de nœuds intermédiaires peuvent adopter et exécuter cette implémentation. Une fourche résultante dépendra de l&#8217;application ou non des nouvelles règles de consensus aux blocs, aux transactions ou à tout autre aspect du système. Si les nouvelles règles de consensus concernent les transactions, un portefeuille créant une transaction selon les nouvelles règles peut précipiter une fourche réseau, suivi d&#8217;un embranchement divergent lorsque la transaction est extraite dans un bloc. Si les nouvelles règles concernent les blocs, le processus d&#8217;embranchement divergent commencera lorsqu&#8217;un bloc sera miné selon les nouvelles règles.</p>
</div>
<div class="paragraph data-line-985">
<p>Tout d&#8217;abord, le réseau bifurquera. Les nœuds basés sur l&#8217;implémentation d&#8217;origine des règles de consensus rejetteront toutes les transactions et tous les blocs créés selon les nouvelles règles. De plus, les nœuds qui suivent les règles de consensus d&#8217;origine seront temporairement bannis et déconnectés de tous les nœuds qui leur envoient ces transactions et blocs invalides. En conséquence, le réseau va se partitionner en deux : les anciens nœuds ne resteront connectés qu&#8217;aux anciens nœuds et les nouveaux nœuds ne seront connectés qu&#8217;aux nouveaux nœuds. Une transaction ou un bloc unique basé sur les nouvelles règles se répercutera sur le réseau et entraînera la partition en deux réseaux.</p>
</div>
<div class="paragraph data-line-987">
<p>Une fois qu&#8217;un mineur utilisant les nouvelles règles exploite un bloc, la puissance et la chaîne de minage bifurqueront également. Les nouveaux mineurs exploiteront le nouveau bloc, tandis que les anciens mineurs exploiteront une chaîne distincte basée sur les anciennes règles. Le réseau partitionné fera en sorte que les mineurs opérant selon des règles de consensus distinctes ne recevront probablement pas les blocs les uns des autres, car ils sont connectés à deux réseaux distincts.</p>
</div>
</div>
<div class="sect3 data-line-989">
<h4 id="_mineurs_divergents_et_difficulté">Mineurs divergents et difficulté</h4>
<div class="paragraph data-line-991">
<p>Alors que les mineurs divergent pour exploiter deux chaînes différentes, la puissance de hachage est répartie entre les chaînes. La puissance minière peut être répartie dans n&#8217;importe quelle proportion entre les deux chaînes. Les nouvelles règles ne peuvent être suivies que par une minorité, ou par la grande majorité de la puissance minière.</p>
</div>
<div class="paragraph data-line-993">
<p>Supposons, par exemple, une répartition de 80 % à 20 %, la majorité de la puissance minière utilisant les nouvelles règles de consensus. Supposons également que la fourche se produise immédiatement après une période de reciblage.</p>
</div>
<div class="paragraph data-line-995">
<p>Les deux chaînes hériteraient chacune de la difficulté de la période de reciblage. Les nouvelles règles consensuelles auraient 80 % de la puissance minière précédemment disponible qui leur serait engagée. Du point de vue de cette chaîne, la puissance minière a subitement reculé de 20 % par rapport à la période précédente. Des blocs seront trouvés en moyenne toutes les 12,5 minutes, ce qui représente la baisse de 20 % de la puissance minière disponible pour prolonger cette chaîne. Ce taux d&#8217;émission de blocs se poursuivra (sauf modification de la puissance de hachage) jusqu&#8217;à ce que les blocs de 2016 soient extraits, ce qui prendra environ 25 200 minutes (à 12,5 minutes par bloc), soit 17,5 jours. Après 17,5 jours, un reciblage se produira et la difficulté s&#8217;ajustera (réduite de 20%) pour produire à nouveau des blocs de 10 minutes, en fonction de la quantité réduite de puissance de hachage dans cette chaîne.</p>
</div>
<div class="paragraph data-line-997">
<p>La chaîne minoritaire, minant selon les anciennes règles avec seulement 20 % de la puissance de hachage, sera confrontée à une tâche beaucoup plus difficile. Sur cette chaîne, les blocs seront désormais minés toutes les 50 minutes en moyenne. La difficulté ne sera pas ajustée pour les blocs de 2016, qui prendront 100 800 minutes, soit environ 10 semaines à miner. En supposant une capacité fixe par bloc, cela se traduira également par une réduction de la capacité de transaction par un facteur de 5, car il y a moins de blocs par heure disponibles pour enregistrer les transactions.</p>
</div>
</div>
<div class="sect3 data-line-999">
<h4 id="_embranchements_divergents_litigieux">Embranchements divergents litigieux</h4>
<div class="paragraph data-line-1001">
<p>C&#8217;est l&#8217;aube du développement de logiciels consensuels. Tout comme le développement à source libre a changé à la fois les méthodes et les produits des logiciels et a créé de nouvelles méthodologies, de nouveaux outils et de nouvelles communautés dans son sillage, le développement de logiciels consensuels représente également une nouvelle frontière en informatique. Des débats, des expériences et des tribulations de la feuille de route de développement du bitcoin, nous verrons émerger de nouveaux outils, pratiques, méthodologies et communautés de développement.</p>
</div>
<div class="paragraph data-line-1003">
<p>Les fourches dures sont considérées comme risquées car elles obligent une minorité à se mettre à niveau ou à rester sur une chaîne minoritaire. Le risque de scinder l&#8217;ensemble du système en deux systèmes concurrents est considéré par beaucoup comme un risque inacceptable. En conséquence, de nombreux développeurs hésitent à utiliser le mécanisme d&#8217;embranchement divergent pour mettre en œuvre des mises à niveau des règles de consensus, à moins qu&#8217;il n&#8217;y ait un soutien quasi unanime de l&#8217;ensemble du réseau. Toutes les propositions d&#8217;embranchement divergent qui ne bénéficient pas d&#8217;un soutien quasi unanime sont considérées comme trop "controversées" à tenter sans risquer une partition du système.</p>
</div>
<div class="paragraph data-line-1005">
<p>La question des embranchements divergents est très controversée dans la communauté du développement de Bitcoin, en particulier en ce qui concerne toute modification proposée aux règles de consensus contrôlant la limite de taille de bloc maximale. Certains développeurs sont opposés à toute forme d&#8217;embranchement divergent, le considérant comme trop risqué. D&#8217;autres considèrent le mécanisme d&#8217;embranchement divergent comme un outil essentiel pour mettre à niveau les règles de consensus d&#8217;une manière qui évite la "dette technique" et offre une rupture nette avec le passé. Enfin, certains développeurs voient les embranchements divergents comme un mécanisme qui devrait être utilisé rarement, avec beaucoup de planification préalable et uniquement sous un consensus quasi unanime.</p>
</div>
<div class="paragraph data-line-1007">
<p>Nous avons déjà vu l&#8217;émergence de nouvelles méthodologies pour faire face aux risques d&#8217;embranchements divergents. Dans la section suivante, nous examinerons les embranchements convergents et les méthodes BIP-34 et BIP-9 pour la signalisation et l&#8217;activation des modifications de consensus.</p>
</div>
</div>
<div class="sect3 data-line-1009">
<h4 id="_embranchements_convergents">Embranchements convergents</h4>
<div class="paragraph data-line-1011">
<p>Tous les changements de règles de consensus ne provoquent pas un embranchement divergent. Seuls les changements de consensus qui sont incompatibles en aval provoquent un embranchement ou fourche. Si la modification est implémentée de telle manière qu&#8217;un client non mis à niveau voit toujours la transaction ou le bloc comme valide selon les règles précédentes, la modification peut se produire sans fourche.</p>
</div>
<div class="paragraph data-line-1013">
<p>Le terme <em>embranchement convergent</em> (<em>soft fork</em>) a été introduit pour distinguer cette méthode de mise à niveau d&#8217;un "embranchement divergent" (hard fork). En pratique, un embranchement convergent n&#8217;est pas du tout un embranchement ou une fourche. Un embranchement convergent est une modification compatible avec les règles de consensus qui permet aux clients non mis à niveau de continuer à fonctionner en consensus avec les nouvelles règles.</p>
</div>
<div class="paragraph data-line-1015">
<p>Un aspect des embranchements convergents qui n&#8217;est pas immédiatement évident est que les mises à niveau d&#8217;embranchement convergent ne peuvent être utilisées que pour restreindre les règles de consensus, pas pour les étendre. Afin d&#8217;être compatibles en aval, les transactions et les blocs créés selon les nouvelles règles doivent également être valides selon les anciennes règles, mais pas l&#8217;inverse. Les nouvelles règles ne peuvent que limiter ce qui est valide; sinon, ils déclencheront un embranchement divergent s&#8217;ils sont rejetés selon les anciennes règles.</p>
</div>
<div class="paragraph data-line-1017">
<p>Les embranchements convergents peuvent être implémentés de plusieurs façons - le terme ne spécifie pas une méthode particulière, mais plutôt un ensemble de méthodes qui ont toutes une chose en commun : elles ne nécessitent pas la mise à niveau de tous les nœuds ou ne forcent pas les nœuds non mis à niveau hors de consensus.</p>
</div>
<div class="sect4 data-line-1019">
<h5 id="_embranchements_convergents_redéfinissant_les_opcodes_nop">Embranchements convergents redéfinissant les opcodes NOP</h5>
<div class="paragraph data-line-1021">
<p>Un certain nombre de embranchements convergents ont été implémentés dans bitcoin, sur la base de la réinterprétation d&#8217;opcodes NOP. Bitcoin Script avait dix opcodes réservés pour une utilisation future, NOP1 à NOP10. Selon les règles de consensus, la présence de ces opcodes dans un script est interprétée comme un opérateur nul, ce qui signifie qu&#8217;ils n&#8217;ont aucun effet. L&#8217;exécution continue après l&#8217;opcode NOP comme s&#8217;il n&#8217;était pas là.</p>
</div>
<div class="paragraph data-line-1023">
<p>Un embranchement convergent peut donc modifier la sémantique d&#8217;un code NOP pour lui donner un nouveau sens. Par exemple, BIP-65 (<code>CHECKLOCKTIMEVERIFY</code>) a réinterprété l&#8217;opcode NOP2. Les clients implémentant BIP-65 interprètent NOP2 comme <code>OP_CHECKLOCKTIMEVERIFY</code> et imposent une règle de consensus de verrouillage absolu sur UTXO qui contient cet opcode dans leurs scripts de verrouillage. Ce changement est un embranchement convergent car une transaction valide sous BIP-65 est également valide sur tout client qui n&#8217;implémente pas (ignore) BIP-65. Pour les anciens clients, le script contient un code NOP, qui est ignoré.</p>
</div>
</div>
<div class="sect4 data-line-1025">
<h5 id="_autres_façons_de_mettre_à_niveau_lembranchement_convergent">Autres façons de mettre à niveau l&#8217;embranchement convergent</h5>
<div class="paragraph data-line-1027">
<p>La réinterprétation des opcodes NOP était à la fois prévue et un mécanisme évident pour les mises à niveau consensuelles. Récemment, cependant, un autre mécanisme d&#8217;embranchement convergent a été introduit qui ne repose pas sur les opcodes NOP pour un type très spécifique de changement de consensus. Ceci est examiné plus en détail dans <a href="#segwit">Témoin séparé</a>. Segwit est une modification architecturale de la structure d&#8217;une transaction, qui déplace le script de déverrouillage (témoin) de l&#8217;intérieur de la transaction vers une structure de données externe (en la séparant). Segwit a été initialement envisagé comme une mise à niveau de embranchement divergent, car il modifiait une structure fondamentale (transaction). En novembre 2015, un développeur travaillant sur Bitcoin Core a proposé un mécanisme par lequel segwit pourrait être introduit en tant que embranchement convergent. Le mécanisme utilisé pour cela est une modification du script de verrouillage d&#8217;UTXO créé selon les règles segwit, de sorte que les clients non mis à niveau voient le script de verrouillage comme échangeable avec n&#8217;importe quel script de déverrouillage. En conséquence, segwit peut être introduit sans nécessiter que chaque nœud soit mis à niveau ou séparé de la chaîne : un embranchement convergent.</p>
</div>
<div class="paragraph data-line-1029">
<p>Il est probable qu&#8217;il existe d&#8217;autres mécanismes, encore à découvrir, par lesquels les mises à niveau peuvent être effectuées de manière compatible avec les versions ultérieures en tant qu&#8217;embranchement convergent.</p>
</div>
</div>
</div>
<div class="sect3 data-line-1031">
<h4 id="_critiques_dembranchements_convergents">Critiques d&#8217;embranchements convergents</h4>
<div class="paragraph data-line-1033">
<p>Les embranchements convergents basés sur les opcodes NOP sont relativement peu controversés. Les opcodes NOP ont été placés dans Bitcoin Script dans le but explicite de permettre des mises à niveau non perturbatrices.</p>
</div>
<div class="paragraph data-line-1035">
<p>Cependant, de nombreux développeurs craignent que d&#8217;autres méthodes de mises à niveau d&#8217;embranchements convergents ne fassent des compromis inacceptables. Les critiques courantes des changements d&#8217;embranchement convergent incluent:</p>
</div>
<div class="dlist data-line-1037">
<dl>
<dt class="hdlist1">Dette technique</dt>
<dd>
<p>Étant donné que les embranchements convergents sont plus complexes techniquement qu&#8217;une mise à niveau de embranchements divergents, ils introduisent la <em>dette technique</em>, un terme qui fait référence à l&#8217;augmentation du coût futur de la maintenance du code en raison des compromis de conception effectués dans le passé. La complexité du code augmente à son tour la probabilité de bogues et de failles de sécurité.</p>
</dd>
<dt class="hdlist1">Assouplissement de la validation</dt>
<dd>
<p>les clients non mis à niveau voient les transactions comme valides, sans évaluer les règles de consensus modifiées. En effet, les clients non mis à niveau ne valident pas en utilisant la gamme complète des règles de consensus, car ils sont aveugles aux nouvelles règles. Cela s&#8217;applique aux mises à niveau basées sur NOP, ainsi qu&#8217;aux autres mises à niveau d&#8217;embranchements convergents.</p>
</dd>
<dt class="hdlist1">Mises à niveau irréversibles</dt>
<dd>
<p>Étant donné que les embranchements convergents créent des transactions avec des contraintes de consensus supplémentaires, elles deviennent des mises à niveau irréversibles dans la pratique. Si une mise à niveau d&#8217;embranchement convergent devait être annulée après avoir été activée, toute transaction créée selon les nouvelles règles pourrait entraîner une perte de fonds selon les anciennes règles. Par exemple, si une transaction CLTV est évaluée selon les anciennes règles, il n&#8217;y a pas de contrainte de timelock et elle peut être dépensée à tout moment. Par conséquent, les critiques soutiennent qu&#8217;un embranchement convergent défaillant qui devait être annulé à cause d&#8217;un bogue entraînerait presque certainement une perte de fonds.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 data-line-1044">
<h3 id="softforksignaling">Signalisation d&#8217;embranchement convergent avec la version du bloc</h3>
<div class="paragraph data-line-1046">
<p>Puisque les embranchements convergents permettent aux clients non mis à jour de continuer à fonctionner dans le cadre du consensus, le mécanisme pour « activer » un embranchement convergent consiste à signaler que les mineurs sont prêts : une majorité de mineurs doit convenir qu&#8217;ils sont prêts et disposés à appliquer les nouvelles règles consensuelles. Pour coordonner leurs actions, il existe un mécanisme de signalisation qui leur permet de montrer leur soutien à un changement de règle consensuel. Ce mécanisme a été introduit avec l&#8217;activation de BIP-34 en mars 2013 et remplacé par l&#8217;activation de BIP-9 en juillet 2016.</p>
</div>
<div class="sect3 data-line-1048">
<h4 id="_signalisation_et_activation_bip_34">Signalisation et activation BIP-34</h4>
<div class="paragraph data-line-1050">
<p> La première implémentation, dans BIP-34, utilisait le champ de version de bloc pour permettre aux mineurs de signaler qu&#8217;ils étaient prêts pour un changement de règle de consensus spécifique. Avant le BIP-34, la version du bloc était définie par la valeur "1" par <em>convention</em> non appliquée par <em>consensus</em>.</p>
</div>
<div class="paragraph data-line-1052">
<p>BIP-34 a défini un changement de règle de consensus qui exigeait que le champ de données coinbase d&#8217;une entrée de transaction coinbase contienne la hauteur du bloc. Avant le BIP-34, les données coinbase pouvaient contenir toutes les données arbitraires que les mineurs choisissaient d&#8217;inclure. Après l&#8217;activation de BIP-34, les blocs valides devaient contenir une hauteur de bloc spécifique au début des données coinbase et être identifiés par un numéro de version supérieur ou égal à "2".</p>
</div>
<div class="paragraph data-line-1054">
<p>Pour signaler le changement et l&#8217;activation de BIP-34, les mineurs ont défini la version du bloc à "2" au lieu de "1". Cela n&#8217;a pas immédiatement rendu les blocs de la version "1" invalides. Une fois activés, les blocs de la version "1" deviendraient invalides et tous les blocs de la version "2" devraient contenir la hauteur du bloc dans la coinbase pour être valides.</p>
</div>
<div class="paragraph data-line-1056">
<p>BIP-34 a défini un mécanisme d&#8217;activation en deux étapes, basé sur une fenêtre glissante de 1000 blocs. Un mineur signalerait sa préparation individuelle pour le BIP-34 en construisant des blocs avec "2" comme numéro de version. À proprement parler, ces blocs n&#8217;avaient pas encore à se conformer à la nouvelle règle de consensus consistant à inclure la hauteur de bloc dans la transaction coinbase car la règle de consensus n&#8217;avait pas encore été activée. Les règles de consensus activées en deux étapes :</p>
</div>
<div class="ulist data-line-1058">
<ul>
<li class="data-line-1058">
<p>Si 75 % (750 des 1000 blocs les plus récents) sont marqués avec la version "2", alors les blocs de la version "2" doivent contenir la hauteur du bloc dans la transaction coinbase ou ils sont rejetés comme invalides. Les blocs de version "1" sont toujours acceptés par le réseau et n&#8217;ont pas besoin de contenir de hauteur de bloc. Les anciennes et les nouvelles règles de consensus coexistent pendant cette période.</p>
</li>
<li class="data-line-1060">
<p>Lorsque 95 % (950 des 1 000 blocs les plus récents) sont de version "2", les blocs de version "1" ne sont plus considérés comme valides. Les blocs de la version "2" ne sont valides que s&#8217;ils contiennent la hauteur de bloc dans le coinbase (selon le seuil précédent). Par la suite, tous les blocs doivent respecter les nouvelles règles de consensus et tous les blocs valides doivent contenir la hauteur de bloc dans la transaction coinbase.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1062">
<p>Après une signalisation et une activation réussies selon les règles BIP-34, ce mécanisme a été utilisé deux fois de plus pour activer les embranchements convergents :</p>
</div>
<div class="ulist data-line-1064">
<ul>
<li class="data-line-1064">
<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a> Le codage DER strict des signatures a été activé par une signalisation de style BIP-34 avec une version de bloc "3" et invalidant la version "2" des blocs.</p>
</li>
<li class="data-line-1066">
<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> <code>CHECKLOCKTIMEVERIFY</code> a été activé par la signalisation de style BIP-34 avec une version de bloc "4" et invalidant la version "3" des blocs.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1068">
<p>Après l&#8217;activation de BIP-65, le mécanisme de signalisation et d&#8217;activation de BIP-34 a été retiré et remplacé par le mécanisme de signalisation BIP-9 décrit ci-après.</p>
</div>
<div class="paragraph data-line-1070">
<p>La norme est définie dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34 (Block v2, Height in Coinbase)</a>.</p>
</div>
</div>
<div class="sect3 data-line-1072">
<h4 id="_signalisation_et_activation_bip_9">Signalisation et activation BIP-9</h4>
<div class="paragraph data-line-1074">
<p> Le mécanisme utilisé par BIP-34, BIP-66 et BIP-65 a réussi à activer trois embranchements convergents. Cependant, il a été remplacé car il présentait plusieurs limitations :</p>
</div>
<div class="ulist data-line-1076">
<ul>
<li class="data-line-1076">
<p>En utilisant la valeur entière de la version du bloc, un seul embranchement convergent pouvait être activé à la fois, il fallait donc une coordination entre les propositions d&#8217;embranchements convergents et un accord sur leur hiérarchisation et leur séquencement.</p>
</li>
<li class="data-line-1078">
<p>De plus, étant donné que la version de bloc était incrémentée, le mécanisme n&#8217;offrait pas de moyen simple de rejeter une modification et d&#8217;en proposer une autre. Si d&#8217;anciens clients étaient toujours en cours d&#8217;exécution, ils pourraient confondre la signalisation d&#8217;une nouvelle modification avec la signalisation de la modification précédemment rejetée.</p>
</li>
<li class="data-line-1080">
<p>Chaque nouveau changement réduit irrévocablement les versions de blocs disponibles pour les changements futurs.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1082">
<p>Le BIP-9 a été proposé pour surmonter ces défis et améliorer le rythme et la facilité de mise en œuvre des changements futurs.</p>
</div>
<div class="paragraph data-line-1084">
<p>BIP-9 interprète la version de bloc comme un champ de bits au lieu d&#8217;un entier. Étant donné que la version de bloc était à l&#8217;origine utilisée comme entier, versions 1 à 4, seuls 29 bits restent disponibles pour être utilisés comme champ de bits. Cela laisse 29 bits qui peuvent être utilisés pour signaler indépendamment et simultanément la disponibilité sur 29 propositions différentes.</p>
</div>
<div class="paragraph data-line-1086">
<p>BIP-9 fixe également un temps maximum pour la signalisation et l&#8217;activation. De cette façon, les mineurs n&#8217;ont pas besoin de signaler indéfiniment. Si une proposition n&#8217;est pas activée dans le délai <code>TIMEOUT</code> (défini dans la proposition), la proposition est considérée comme rejetée. La proposition peut être soumise à nouveau pour signalisation avec un bit différent, renouvelant la période d&#8217;activation.</p>
</div>
<div class="paragraph data-line-1088">
<p>De plus, après que le <code>TIMEOUT</code> est passé et qu&#8217;une fonctionnalité a été activée ou rejetée, le bit de signalisation peut être réutilisé pour une autre fonctionnalité sans confusion. Ainsi, jusqu&#8217;à 29 changements peuvent être signalés en parallèle et après <code>TIMEOUT</code> les bits peuvent être "recyclés" pour proposer de nouveaux changements.</p>
</div>
<div class="admonitionblock note data-line-1091">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1092">
<p>Alors que les bits de signalisation peuvent être réutilisés ou recyclés, tant que la période de vote ne se chevauche pas, les auteurs du BIP-9 recommandent que les bits ne soient réutilisés que lorsque cela est nécessaire ; un comportement inattendu peut se produire en raison de bogues dans des logiciels plus anciens. En bref, nous ne devrions pas nous attendre à voir une réutilisation tant que les 29 bits n&#8217;auront pas été utilisés une fois.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1095">
<p>Les modifications proposées sont identifiées par une structure de données contenant les champs suivants :</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Une brève description utilisée pour distinguer les propositions. Le plus souvent, le BIP décrivant la proposition, comme "bipN", où N est le numéro du BIP.</p>
</dd>
<dt class="hdlist1">bit</dt>
<dd>
<p>0 à 28, le bit dans la version de bloc que les mineurs utilisent pour signaler l&#8217;approbation de cette proposition.</p>
</dd>
<dt class="hdlist1">starttime</dt>
<dd>
<p>Le temps (basé sur le temps passé médian, ou MTP) auquel la signalisation commence après lequel la valeur du bit est interprétée comme signalant la préparation de la proposition.</p>
</dd>
<dt class="hdlist1">endtime</dt>
<dd>
<p>Le temps (basé sur MTP) après lequel le changement est considéré comme rejeté s&#8217;il n&#8217;a pas atteint le seuil d&#8217;activation.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1105">
<p>Contrairement à BIP-34, BIP-9 compte la signalisation d&#8217;activation dans des intervalles entiers en fonction de la période de reciblage de difficulté de 2016 blocs. Pour chaque période de reciblage, si la somme des blocs signalant une proposition dépasse 95 % (1 916 sur 2016), la proposition sera activée une période de reciblage plus tard.</p>
</div>
<div class="paragraph data-line-1107">
<p>BIP-9 propose un diagramme d&#8217;état de proposition pour illustrer les différentes étapes et transitions d&#8217;une proposition, comme indiqué dans <a href="#bip9states">BIP-9 diagramme de transition d&#8217;état</a>.</p>
</div>
<div class="paragraph data-line-1109">
<p>Les propositions commencent dans l&#8217;état <code>DEFINED</code>, une fois que leurs paramètres sont connus (définis) dans le logiciel bitcoin. Pour les blocs avec MTP après l&#8217;heure de début, l&#8217;état de la proposition passe à <code>STARTED</code>. Si le seuil de vote est dépassé dans une période de reciblage et que le délai d&#8217;attente n&#8217;a pas été dépassé, l&#8217;état de la proposition passe à <code>LOCKED_IN</code>. Une période de reciblage plus tard, la proposition devient <code>ACTIVE</code>. Les propositions restent perpétuellement dans l&#8217;état <code>ACTIVE</code> une fois qu&#8217;elles atteignent cet état. Si le délai d&#8217;attente s&#8217;est écoulé avant que le seuil de vote n&#8217;ait été atteint, l&#8217;état de la proposition passe à <code>FAILED</code>, indiquant une proposition rejetée. Les propositions <code>FAILED</code> restent perpétuellement dans cet état.</p>
</div>
<div id="bip9states" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_1010.png" alt="Diagramme de transition d&#8217;état de la proposition BIP-9">
</div>
<div class="title">Figure 72. BIP-9 diagramme de transition d&#8217;état</div>
</div>
<div class="paragraph data-line-1115">
<p>BIP-9 a d&#8217;abord été implémenté pour l&#8217;activation de <code>CHECKSEQUENCEVERIFY</code> et des BIP associés (68, 112, 113). La proposition nommée "csv" a été activée avec succès en juillet 2016.</p>
</div>
<div class="paragraph data-line-1117">
<p>La norme est définie dans <a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9 (Version bits with timeout and delay)</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1119">
<h3 id="_développement_de_logiciel_de_consensus">Développement de logiciel de consensus</h3>
<div class="paragraph data-line-1121">
<p>Le logiciel de consensus continue d&#8217;évoluer et il y a beaucoup de discussions sur les divers mécanismes pour changer le règles consensuelles. De par sa nature même, le bitcoin place la barre très haute en matière de coordination et de consensus pour les changements. En tant que système décentralisé, il n&#8217;a pas d'"autorité" qui puisse imposer sa volonté aux participants du réseau. Le pouvoir est réparti entre plusieurs groupes tels que les mineurs, les développeurs principaux, les développeurs de portefeuilles, les échanges, les commerçants et les utilisateurs finaux. Les décisions ne peuvent être prises unilatéralement par aucun de ces groupes. Par exemple, alors que les mineurs peuvent théoriquement changer les règles à la majorité simple (51%), ils sont contraints par le consentement des autres circonscriptions. S&#8217;ils agissent unilatéralement, le reste des participants peut simplement refuser de les suivre, gardant l&#8217;activité économique sur une chaîne minoritaire. Sans activité économique (transactions, marchands, portefeuilles, échanges), les mineurs exploiteront une pièce sans valeur avec des blocs vides. Cette diffusion du pouvoir signifie que tous les participants doivent se coordonner, sinon aucun changement ne peut être apporté. Le statu quo est l&#8217;état stable de ce système avec seulement quelques changements possibles s&#8217;il y a un fort consensus à une très large majorité. Le seuil de 95 % pour les embranchements convergents reflète cette réalité.</p>
</div>
<div class="paragraph data-line-1123">
<p>Il est important de reconnaître qu&#8217;il n&#8217;y a pas de solution parfaite pour le développement d&#8217;un consensus. Les embranchements divergents et les embranchements convergents impliquent des compromis. Pour certains types de changements, les embranchements convergents peuvent être un meilleur choix ; pour d&#8217;autres, les embranchements divergents peuvent être un meilleur choix. Il n&#8217;y a pas de choix parfait; les deux comportent des risques. La seule caractéristique constante du développement de logiciels consensuels est que le changement est difficile et que le consensus oblige à faire des compromis.</p>
</div>
<div class="paragraph data-line-27">
<p>Certains y voient une faiblesse des systèmes de consensus. Avec le temps, vous finirez peut-être par le voir comme moi, comme la plus grande force du système.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ch11">Sécurité de Bitcoin</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-4">
<p>Sécuriser le bitcoin est un défi car le bitcoin n&#8217;est pas une référence abstraite à la valeur, comme le solde d&#8217;un compte bancaire. Bitcoin ressemble beaucoup à de l&#8217;argent numérique ou à de l&#8217;or. Vous avez probablement entendu l&#8217;expression, "La possession est les neuf dixièmes de la loi." Eh bien, en bitcoin, la possession correspond aux dix dixièmes de la loi. La possession des clés pour déverrouiller le bitcoin équivaut à la possession d&#8217;espèces ou d&#8217;un morceau de métal précieux. Vous pouvez le perdre, l&#8217;égarer, le faire voler ou donner accidentellement le mauvais montant à quelqu&#8217;un. Dans chacun de ces cas, l&#8217;usager n&#8217;a aucun recours, comme s&#8217;il déposait de l&#8217;argent sur un trottoir public.</p>
</div>
<div class="paragraph data-line-6">
<p>Cependant, le bitcoin a des capacités que l&#8217;argent, l&#8217;or et les comptes bancaires n&#8217;ont pas. Un portefeuille bitcoin, contenant vos clés, peut être sauvegardé comme n&#8217;importe quel fichier. Il peut être stocké en plusieurs exemplaires, même imprimé sur papier pour une copie papier. Vous ne pouvez pas "sauvegarder" de l&#8217;argent, de l&#8217;or ou des comptes bancaires. Le bitcoin est suffisamment différent de tout ce qui a précédé pour que nous devions également penser à la sécurité du bitcoin d&#8217;une manière nouvelle.</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_principes_de_sécurité">Principes de sécurité</h3>
<div class="paragraph data-line-10">
<p>Le principe fondamental du bitcoin est la décentralisation et il a des implications importantes pour la sécurité. Un modèle centralisé, tel qu&#8217;une banque traditionnelle ou un réseau de paiement, dépend du contrôle d&#8217;accès et de la vérification pour garder les mauvais acteurs hors du système. En comparaison, un système décentralisé comme Bitcoin pousse la responsabilité et le contrôle aux utilisateurs. Étant donné que la sécurité du réseau est basée sur la preuve de travail et non sur le contrôle d&#8217;accès, le réseau peut être ouvert et aucun cryptage n&#8217;est requis pour le trafic bitcoin.</p>
</div>
<div class="paragraph data-line-12">
<p>Sur un réseau de paiement traditionnel, tel qu&#8217;un système de carte de crédit, le paiement est ouvert car il contient l&#8217;identifiant privé de l&#8217;utilisateur (le numéro de carte de crédit). Après le débit initial, toute personne ayant accès à l&#8217;identifiant peut "extraire" des fonds et facturer le propriétaire encore et encore. Ainsi, le réseau de paiement doit être sécurisé de bout en bout avec un cryptage et doit garantir qu&#8217;aucun espion ou intermédiaire ne puisse compromettre le trafic de paiement, en transit ou lorsqu&#8217;il est stocké (au repos). Si un acteur malveillant accède au système, il peut compromettre les transactions en cours <em>et</em> les jetons de paiement qui peuvent être utilisés pour créer de nouvelles transactions. Pire encore, lorsque les données des clients sont compromises, les clients sont exposés au vol d&#8217;identité et doivent prendre des mesures pour empêcher l&#8217;utilisation frauduleuse des comptes compromis.</p>
</div>
<div class="paragraph data-line-14">
<p>Bitcoin est radicalement différent. Une transaction bitcoin n&#8217;autorise qu&#8217;une valeur spécifique à un destinataire spécifique et ne peut être falsifiée ou modifiée. Il ne révèle aucune information privée, telle que l&#8217;identité des parties, et ne peut être utilisé pour autoriser des paiements supplémentaires. Par conséquent, un réseau de paiement bitcoin n&#8217;a pas besoin d&#8217;être crypté ou protégé contre les écoutes clandestines. En fait, vous pouvez diffuser des transactions en bitcoins sur un canal public ouvert, tel qu&#8217;un WiFi ou un Bluetooth non sécurisé, sans perte de sécurité.</p>
</div>
<div class="paragraph data-line-16">
<p>Le modèle de sécurité décentralisé de Bitcoin donne beaucoup de pouvoir aux utilisateurs. Ce pouvoir s&#8217;accompagne de la responsabilité de maintenir le secret des clés. Pour la plupart des utilisateurs, ce n&#8217;est pas facile à faire, en particulier sur les appareils informatiques à usage général tels que les smartphones ou les ordinateurs portables connectés à Internet. Bien que le modèle décentralisé de Bitcoin empêche le type de compromis de masse observé avec les cartes de crédit, de nombreux utilisateurs ne sont pas en mesure de sécuriser correctement leurs clés et se font pirater, un par un.</p>
</div>
<div class="sect3 data-line-19">
<h4 id="_développer_des_systèmes_bitcoin_en_toute_sécurité">Développer des systèmes Bitcoin en toute sécurité</h4>
<div class="paragraph data-line-21">
<p>Le principe le plus important pour les développeurs de bitcoins est la décentralisation. La plupart des développeurs connaissent les modèles de sécurité centralisés et pourraient être tentés d&#8217;appliquer ces modèles à leurs applications bitcoin, avec des résultats désastreux.</p>
</div>
<div class="paragraph data-line-23">
<p>La sécurité de Bitcoin repose sur un contrôle décentralisé des clés et sur une validation indépendante des transactions par les mineurs. Si vous souhaitez tirer parti de la sécurité du bitcoin, vous devez vous assurer que vous restez dans le modèle de sécurité du bitcoin. En termes simples : ne retirez pas le contrôle des clés aux utilisateurs et ne retirez pas les transactions de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-25">
<p>Par exemple, de nombreux premiers échanges de bitcoins ont concentré tous les fonds des utilisateurs dans un seul portefeuille "chaud" avec des clés stockées sur un seul serveur. Une telle conception supprime le contrôle des utilisateurs et centralise le contrôle des clés dans un système unique. De nombreux systèmes de ce type ont été piratés, avec des conséquences désastreuses pour leurs clients.</p>
</div>
<div class="paragraph data-line-27">
<p>Une autre erreur courante consiste à retirer les transactions "hors chaîne de blocs" dans un effort malavisé pour réduire les frais de transaction ou accélérer le traitement des transactions. Un système "hors chaîne de blocs" enregistrera les transactions sur un registre interne centralisé et ne les synchronisera qu&#8217;occasionnellement avec la chaîne de blocs Bitcoin. Cette pratique, encore une fois, remplace la sécurité du bitcoin décentralisée par une approche propriétaire et centralisée. Lorsque les transactions sont hors chaîne de blocs, des registres centralisés mal sécurisés peuvent être falsifiés, détournant des fonds et épuisant les réserves, sans que l&#8217;on s&#8217;en aperçoive.</p>
</div>
<div class="paragraph data-line-29">
<p>À moins que vous ne soyez prêt à investir massivement dans la sécurité opérationnelle, plusieurs couches de contrôle d&#8217;accès et des audits (comme le font les banques traditionnelles), vous devez réfléchir très attentivement avant de retirer des fonds du contexte de sécurité décentralisé de Bitcoin. Même si vous disposez des fonds et de la discipline nécessaires pour mettre en œuvre un modèle de sécurité robuste, une telle conception ne fait que reproduire le modèle fragile des réseaux financiers traditionnels, en proie au vol d&#8217;identité, à la corruption et au détournement de fonds. Pour tirer parti du modèle de sécurité décentralisé unique de Bitcoin, vous devez éviter la tentation d&#8217;architectures centralisées qui pourraient vous sembler familières mais qui finissent par renverser la sécurité de Bitcoin.</p>
</div>
</div>
<div class="sect3 data-line-31">
<h4 id="_la_racine_de_la_confiance">La racine de la confiance</h4>
<div class="paragraph data-line-33">
<p>L&#8217;architecture de sécurité traditionnelle est basée sur un concept appelé <em>racine de confiance</em>, qui est un noyau de confiance utilisé comme base pour la sécurité de l&#8217;ensemble du système ou de l&#8217;application. L&#8217;architecture de sécurité est développée autour de la racine de la confiance sous la forme d&#8217;une série de cercles concentriques, comme des couches dans un oignon, étendant la confiance vers l&#8217;extérieur depuis le centre. Chaque couche s&#8217;appuie sur la couche interne la plus fiable à l&#8217;aide de contrôles d&#8217;accès, de signatures numériques, de cryptage et d&#8217;autres primitives de sécurité. À mesure que les systèmes logiciels deviennent plus complexes, ils sont plus susceptibles de contenir des bogues, ce qui les rend vulnérables aux compromis de sécurité. Par conséquent, plus un système logiciel devient complexe, plus il est difficile à sécuriser. Le concept de racine de confiance garantit que la plus grande partie de la confiance est placée dans la partie la moins complexe du système, et donc la moins vulnérable, tandis que des logiciels plus complexes sont superposés autour d&#8217;elle. Cette architecture de sécurité est répétée à différentes échelles, établissant d&#8217;abord une racine de confiance dans le matériel d&#8217;un système unique, puis étendant cette racine de confiance à travers le système d&#8217;exploitation jusqu&#8217;aux services système de niveau supérieur, et enfin sur de nombreux serveurs superposés en cercles concentriques de diminution de la confiance.</p>
</div>
<div class="paragraph data-line-35">
<p>L&#8217;architecture de sécurité Bitcoin est différente. En bitcoin, le système de consensus crée un grand livre public de confiance qui est complètement décentralisé. Une chaîne de blocs correctement validée utilise le bloc de gen&#8217;se comme racine de confiance, construisant une chaîne de confiance jusqu&#8217;au bloc actuel. Les systèmes Bitcoin peuvent et doivent utiliser la chaîne de blocs comme racine de confiance. Lors de la conception d&#8217;une application bitcoin complexe composée de services sur de nombreux systèmes différents, vous devez examiner attentivement l&#8217;architecture de sécurité afin de déterminer où la confiance est placée. En fin de compte, la seule chose à laquelle il faut explicitement faire confiance est une chaîne de blocs entièrement validée. Si votre application accorde explicitement ou implicitement sa confiance à autre chose qu&#8217;à la chaîne de blocs, cela devrait être une source de préoccupation car elle introduit une vulnérabilité. Une bonne méthode pour évaluer l&#8217;architecture de sécurité de votre application consiste à considérer chaque composant individuel et à évaluer un scénario hypothétique où ce composant est complètement compromis et sous le contrôle d&#8217;un acteur malveillant. Prenez tour à tour chaque composant de votre application et évaluez les impacts sur la sécurité globale si ce composant est compromis. Si votre application n&#8217;est plus sécurisée lorsque des composants sont compromis, cela montre que vous avez mal placé la confiance dans ces composants. Une application bitcoin sans vulnérabilités ne devrait être vulnérable qu&#8217;à une compromission du mécanisme de consensus bitcoin, ce qui signifie que sa racine de confiance est basée sur la partie la plus solide de l&#8217;architecture de sécurité bitcoin.</p>
</div>
<div class="paragraph data-line-37">
<p>Les nombreux exemples d&#8217;échanges de bitcoins piratés servent à souligner ce point, car leur architecture et leur conception de sécurité échouent même sous l&#8217;examen le plus occasionnel. Ces implémentations centralisées avaient explicitement investi la confiance dans de nombreux composants en dehors de la chaîne de blocs Bitcoin, tels que les portefeuilles actifs, les bases de données de grand livre centralisées, les clés de chiffrement vulnérables et les schémas similaires.</p>
</div>
</div>
</div>
<div class="sect2 data-line-40">
<h3 id="_meilleures_pratiques_de_sécurité_des_utilisateurs">Meilleures pratiques de sécurité des utilisateurs</h3>
<div class="paragraph data-line-42">
<p>Les humains ont utilisé des contrôles de sécurité physique depuis des milliers d&#8217;années. En comparaison, notre expérience en matière de sécurité numérique a moins de 50 ans. Les systèmes d&#8217;exploitation modernes à usage général ne sont pas très sécurisés et ne sont pas particulièrement adaptés au stockage de l&#8217;argent numérique. Nos ordinateurs sont constamment exposés à des menaces externes via des connexions Internet permanentes. Ils exécutent des milliers de composants logiciels de centaines d&#8217;auteurs, souvent avec un accès illimité aux fichiers de l&#8217;utilisateur. Un seul logiciel malveillant, parmi les milliers installés sur votre ordinateur, peut compromettre votre clavier et vos fichiers, en volant tout bitcoin stocké dans les applications de portefeuille. Le niveau de maintenance informatique requis pour maintenir un ordinateur exempt de virus et de chevaux de Troie dépasse le niveau de compétence de tous, sauf d&#8217;une infime minorité d&#8217;utilisateurs d&#8217;ordinateurs.</p>
</div>
<div class="paragraph data-line-44">
<p>Malgré des décennies de recherche et d&#8217;avancées en matière de sécurité de l&#8217;information, les actifs numériques sont toujours terriblement vulnérables face à un adversaire déterminé. Même les systèmes les plus protégés et les plus restreints, dans les sociétés de services financiers, les agences de renseignement et les sous-traitants de la défense, sont fréquemment piratés. Bitcoin crée des actifs numériques qui ont une valeur intrinsèque et peuvent être volés et détournés vers de nouveaux propriétaires instantanément et irrévocablement. Cela crée une incitation massive pour les pirates. Jusqu&#8217;à présent, les pirates devaient convertir des informations d&#8217;identité ou des jetons de compte, tels que des cartes de crédit et des comptes bancaires, en valeur après les avoir compromis. Malgré la difficulté de clôturer et de blanchir les informations financières, nous avons vu des vols sans cesse croissants. Bitcoin intensifie ce problème car il n&#8217;a pas besoin d&#8217;être clôturé ou blanchi; c&#8217;est la valeur intrinsèque d&#8217;un actif numérique.</p>
</div>
<div class="paragraph data-line-46">
<p>Heureusement, le bitcoin crée également les incitations à améliorer la sécurité informatique. Alors qu&#8217;auparavant le risque de compromission informatique était vague et indirect, le bitcoin rend ces risques clairs et évidents. La détention de bitcoins sur un ordinateur sert à concentrer l&#8217;esprit de l&#8217;utilisateur sur la nécessité d&#8217;améliorer la sécurité informatique. En conséquence directe de la prolifération et de l&#8217;adoption accrue du bitcoin et d&#8217;autres monnaies numériques, nous avons assisté à une escalade des techniques de piratage et des solutions de sécurité. En termes simples, les pirates ont désormais une cible très juteuse et les utilisateurs ont une incitation claire à se défendre.</p>
</div>
<div class="paragraph data-line-48">
<p>Au cours des trois dernières années, en conséquence directe de l&#8217;adoption du bitcoin, nous avons assisté à d&#8217;énormes innovations dans le domaine de la sécurité de l&#8217;information sous la forme de cryptage matériel, de stockage de clés et de portefeuilles matériels, de technologie multisignature et de séquestre numérique. Dans les sections suivantes, nous examinerons diverses meilleures pratiques pour la sécurité pratique des utilisateurs.</p>
</div>
<div class="sect3 data-line-50">
<h4 id="_stockage_physique_des_bitcoins">Stockage physique des bitcoins</h4>
<div class="paragraph data-line-52">
<p>Parce que la plupart des utilisateurs sont beaucoup plus à l&#8217;aise avec la sécurité physique qu&#8217;avec la sécurité des informations, une méthode très efficace pour protéger les bitcoins consiste à les convertir sous forme physique. Les clés Bitcoin ne sont rien de plus que de longs chiffres. Cela signifie qu&#8217;ils peuvent être stockés sous une forme physique, telle qu&#8217;imprimés sur du papier ou gravés sur une pièce de métal. La sécurisation des clés devient alors aussi simple que la sécurisation physique de la copie imprimée des clés bitcoin. Un ensemble de clés bitcoin imprimées sur papier s&#8217;appelle un "portefeuille papier" et de nombreux outils gratuits peuvent être utilisés pour les créer. Personnellement, je conserve la grande majorité de mes bitcoins (99 % ou plus) stockés sur des portefeuilles en papier, cryptés avec BIP-38, avec plusieurs copies enfermées dans des coffres-forts.  Garder le bitcoin hors ligne est appelé <em>stockage à froid</em> (<em>cold storage</em>) et c&#8217;est l&#8217;une des techniques de sécurité les plus efficaces. Un système de stockage à froid est un système dans lequel les clés sont générées sur un système hors ligne (jamais connecté à Internet) et stockées hors ligne, soit sur papier, soit sur un support numérique, comme une clé USB.</p>
</div>
</div>
<div class="sect3 data-line-54">
<h4 id="_portefeuilles_matériels">Portefeuilles matériels</h4>
<div class="paragraph data-line-56">
<p>À long terme, la sécurité des bitcoins prendra de plus en plus la forme de portefeuilles matériels inviolables. Contrairement à un smartphone ou à un ordinateur de bureau, un portefeuille matériel bitcoin n&#8217;a qu&#8217;un seul objectif : conserver les bitcoins en toute sécurité. Sans logiciel à usage général à compromettre et avec des interfaces limitées, les portefeuilles matériels peuvent offrir un niveau de sécurité presque infaillible aux utilisateurs non experts. Je m&#8217;attends à voir les portefeuilles matériels devenir la méthode prédominante de stockage de bitcoins. Pour un exemple d&#8217;un tel portefeuille matériel, voir le <a href="https://trezor.io/" data-href="https://trezor.io/">Trezor</a>.</p>
</div>
</div>
<div class="sect3 data-line-58">
<h4 id="_équilibrer_les_risques">Équilibrer les risques</h4>
<div class="paragraph data-line-60">
<p>Bien que la plupart des utilisateurs soient à juste titre préoccupés par le vol de bitcoins, le risque est encore plus grand. Les fichiers de données se perdent tout le temps. S&#8217;ils contiennent du bitcoin, la perte est beaucoup plus douloureuse. Dans le but de sécuriser leurs portefeuilles bitcoin, les utilisateurs doivent faire très attention à ne pas aller trop loin et finir par perdre le bitcoin. En juillet 2011, un projet bien connu de sensibilisation et d&#8217;éducation au bitcoin a perdu près de 7 000 bitcoins. Dans leur effort pour prévenir le vol, les propriétaires avaient mis en place une série complexe de sauvegardes cryptées. En fin de compte, ils ont accidentellement perdu les clés de cryptage, rendant les sauvegardes sans valeur et perdant une fortune. Comme cacher de l&#8217;argent en l&#8217;enterrant dans le désert, si vous sécurisez trop bien votre bitcoin, vous ne pourrez peut-être plus le retrouver.</p>
</div>
</div>
<div class="sect3 data-line-62">
<h4 id="_risque_de_diversification">Risque de diversification</h4>
<div class="paragraph data-line-64">
<p>Porteriez-vous toute votre valeur nette en espèces dans votre portefeuille ? La plupart des gens considéreraient cela comme imprudent, mais les utilisateurs de bitcoins conservent souvent tous leurs bitcoins dans un seul portefeuille. Au lieu de cela, les utilisateurs devraient répartir le risque entre plusieurs portefeuilles bitcoin diversifiés. Les utilisateurs prudents ne conserveront qu&#8217;une petite fraction, peut-être moins de 5%, de leur bitcoin dans un portefeuille en ligne ou mobile comme "monnaie de poche". Le reste doit être réparti entre quelques mécanismes de stockage différents, tels qu&#8217;un portefeuille de bureau et hors ligne (stockage à froid).</p>
</div>
</div>
<div class="sect3 data-line-66">
<h4 id="_multisig_et_gouvernance">Multisig et gouvernance</h4>
<div class="paragraph data-line-68">
<p>Chaque fois qu&#8217;une entreprise ou un particulier stocke de grandes quantités de bitcoins, il doit envisager d&#8217;utiliser une adresse Bitcoin multisignature. Les adresses multisignatures sécurisent les fonds en exigeant un nombre minimum de signatures pour effectuer un paiement. Les clés de signature doivent être stockées dans un certain nombre d&#8217;endroits différents et sous le contrôle de différentes personnes. Dans un environnement d&#8217;entreprise, par exemple, les clés doivent être générées de manière indépendante et détenues par plusieurs dirigeants de l&#8217;entreprise, afin de garantir qu&#8217;aucune personne ne puisse compromettre les fonds. Les adresses multisignatures peuvent également offrir une redondance, où une seule personne détient plusieurs clés qui sont stockées à différents endroits.</p>
</div>
</div>
<div class="sect3 data-line-70">
<h4 id="_capacité_de_survie">Capacité de survie</h4>
<div class="paragraph data-line-72">
<p>Une considération de sécurité importante souvent négligée est la disponibilité, en particulier dans un contexte d&#8217;incapacité ou de décès du détenteur de la clé. Les utilisateurs de Bitcoin sont invités à utiliser des mots de passe complexes et à garder leurs clés sécurisées et privées, sans les partager avec qui que ce soit. Malheureusement, cette pratique rend presque impossible pour la famille de l&#8217;utilisateur de récupérer des fonds si l&#8217;utilisateur n&#8217;est pas disponible pour les débloquer. Dans la plupart des cas, en fait, les familles des utilisateurs de bitcoins pourraient ignorer complètement l&#8217;existence des fonds en bitcoins.</p>
</div>
<div class="paragraph data-line-74">
<p>Si vous avez beaucoup de bitcoins, vous devriez envisager de partager les détails d&#8217;accès avec un parent ou un avocat de confiance. Un régime de survie plus complexe peut être mis en place avec un accès multi-signatures et une planification successorale par l&#8217;intermédiaire d&#8217;un avocat spécialisé en tant qu'"exécuteur d&#8217;actifs numériques".</p>
</div>
</div>
</div>
<div class="sect2 data-line-76">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-29">
<p>Bitcoin est une technologie complètement nouvelle, sans précédent et complexe. Au fil du temps, nous développerons de meilleurs outils et pratiques de sécurité plus faciles à utiliser par des non-experts. Pour l&#8217;instant, les utilisateurs de bitcoin peuvent utiliser de nombreux conseils discutés ici pour profiter d&#8217;une expérience bitcoin sécurisée et sans problème.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="ch12">Applications pour les chaînes de blocs</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-4">
<p>Appuyons-nous maintenant sur notre compréhension du bitcoin en le considérant comme une <em>plate-forme d&#8217;application</em>. De nos jours, de nombreuses personnes utilisent le terme "chaîne de blocs" ou "chaîne de blocs" pour désigner toute plate-forme d&#8217;application qui partage les principes de conception du bitcoin. Le terme est souvent mal utilisé et appliqué à de nombreuses choses qui ne fournissent pas les principales fonctionnalités fournies par la chaîne de blocs de Bitcoin.</p>
</div>
<div class="paragraph data-line-6">
<p>Dans ce chapitre, nous examinerons les fonctionnalités offertes par la chaîne de blocs Bitcoin, en tant que plate-forme d&#8217;application. Nous considérerons les <em>primitives</em> de construction d&#8217;applications, qui forment les blocs de construction de toute application chaîne de blocs. Nous examinerons plusieurs applications importantes qui utilisent ces primitives, telles que les canaux de paiement (état) et les canaux de paiement routés (Lightning Network).</p>
</div>
<div class="sect2 data-line-8">
<h3 id="_présentation_4">Présentation</h3>
<div class="paragraph data-line-10">
<p>Le système Bitcoin a été conçu comme un système de monnaie et de paiement décentralisé. Cependant, la plupart de ses fonctionnalités sont dérivées de constructions de niveau beaucoup plus bas qui peuvent être utilisées pour des applications beaucoup plus larges. Bitcoin n&#8217;a pas été construit avec des composants tels que des comptes, des utilisateurs, des soldes et des paiements. Au lieu de cela, il utilise un langage de script transactionnel avec des fonctions cryptographiques de bas niveau, comme nous l&#8217;avons vu dans <a href="#transactions">Opérations</a>. Tout comme les concepts de niveau supérieur des comptes, des soldes et des paiements peuvent être dérivés de ces primitives de base, il en va de même pour de nombreuses autres applications complexes. Ainsi, la chaîne de blocs Bitcoin peut devenir une plate-forme applicative offrant des services de confiance aux applications, tels que les contrats intelligents, dépassant de loin l&#8217;objectif initial de la monnaie numérique et des paiements.</p>
</div>
</div>
<div class="sect2 data-line-12">
<h3 id="_structures_de_base_les_primitives">Structures de base (les primitives)</h3>
<div class="paragraph data-line-14">
<p>Lorsqu&#8217;il fonctionne correctement et sur le long terme, le système Bitcoin offre certaines garanties, qui peuvent servir de structures de base pour créer des applications. Ceux-ci inclus:</p>
</div>
<div class="dlist data-line-16">
<dl>
<dt class="hdlist1">Pas de double dépense</dt>
<dd>
<p>La garantie la plus fondamentale de l&#8217;algorithme de consensus décentralisé de Bitcoin garantit qu&#8217;aucun UTXO ne peut être dépensé deux fois.</p>
</dd>
<dt class="hdlist1">Immuabilité</dt>
<dd>
<p>Une fois qu&#8217;une transaction est enregistrée dans la chaîne de blocs et que suffisamment de travail a été ajouté avec les blocs suivants, les données de la transaction deviennent immuables. L&#8217;immuabilité est garantie par l&#8217;énergie, car la réécriture de la chaîne de blocs nécessite une dépense d&#8217;énergie pour produire une preuve de travail. L&#8217;énergie requise et donc le degré d&#8217;immuabilité augmentent avec la quantité de travail engagé au-dessus du bloc contenant une transaction.</p>
</dd>
<dt class="hdlist1">Neutralité</dt>
<dd>
<p>Le réseau Bitcoin décentralisé propage des transactions valides quelle que soit l&#8217;origine ou le contenu de ces transactions. Cela signifie que n&#8217;importe qui peut créer une transaction valide avec des frais suffisants et être sûr qu&#8217;il sera en mesure de transmettre cette transaction et de l&#8217;inclure dans la chaîne de blocs à tout moment.</p>
</dd>
<dt class="hdlist1">Horodatage sécurisé</dt>
<dd>
<p>Les règles de consensus rejettent tout bloc dont l&#8217;horodatage est trop éloigné dans le passé ou dans le futur. Cela garantit que les horodatages sur les blocs sont fiables. L&#8217;horodatage sur un bloc implique une garantie non dépensée avant pour les entrées de toutes les transactions incluses.</p>
</dd>
<dt class="hdlist1">Autorisation</dt>
<dd>
<p>Les signatures numériques, validées dans un réseau décentralisé, offrent des garanties d&#8217;autorisation. Les scripts qui contiennent une exigence de signature numérique ne peuvent être exécutés sans l&#8217;autorisation du détenteur de la clé privée impliquée dans le script.</p>
</dd>
<dt class="hdlist1">Auditabilité</dt>
<dd>
<p>Toutes les transactions sont publiques et peuvent être auditées. Toutes les transactions et tous les blocs sont liés dans une chaîne ininterrompue jusqu&#8217;au bloc de genèse.</p>
</dd>
<dt class="hdlist1">Comptabilité</dt>
<dd>
<p>Dans toute transaction (à l&#8217;exception de la transaction coinbase), la valeur des entrées est égale à la valeur des sorties plus les frais. Il n&#8217;est pas possible de créer ou de détruire de la valeur bitcoin dans une transaction. Les sorties ne peuvent pas dépasser les entrées.</p>
</dd>
<dt class="hdlist1">Non-expiration</dt>
<dd>
<p>Une transaction valide n&#8217;expire pas. S&#8217;il est valable aujourd&#8217;hui, il le sera dans un avenir proche, tant que les intrants ne seront pas dépensés et que les règles de consensus ne changeront pas.</p>
</dd>
<dt class="hdlist1">Intégrité</dt>
<dd>
<p>Une transaction bitcoin signée avec <code>SIGHASH_ALL</code> ou des parties d&#8217;une transaction signée par un autre type <code>SIGHASH</code> ne peuvent pas être modifiées sans invalider la signature, invalidant ainsi la transaction elle-même.</p>
</dd>
<dt class="hdlist1">Atomicité des transactions</dt>
<dd>
<p>Les transactions Bitcoin sont atomiques. Ils sont valides et confirmés (minés) ou non. Les transactions partielles ne peuvent pas être extraites et il n&#8217;y a pas d&#8217;état intermédiaire pour une transaction. À tout moment, une transaction est minée ou non.</p>
</dd>
<dt class="hdlist1">Unités de valeur discrètes (indivisibles)</dt>
<dd>
<p>Les sorties de transaction sont des unités de valeur discrètes et indivisibles. Elles peuvent être dépensés ou non dépensés, en totalité. Elles ne peuvent pas être divisés ou partiellement dépensés.</p>
</dd>
<dt class="hdlist1">Quorum de contrôle</dt>
<dd>
<p>les contraintes de multisignature dans les scripts imposent un quorum d&#8217;autorisation, prédéfini dans le schéma de multisignature. L&#8217;exigence M-de-N est appliquée par les règles de consensus.</p>
</dd>
<dt class="hdlist1">Verrou temporel</dt>
<dd>
<p>Toute clause de script contenant un verrou temporel relatif ou absolu ne peut être exécutée qu&#8217;après que son âge dépasse le temps spécifié.</p>
</dd>
<dt class="hdlist1">Réplication</dt>
<dd>
<p>Le stockage décentralisé de la chaîne de blocs garantit que lorsqu&#8217;une transaction est extraite, après des confirmations suffisantes, elle est répliquée sur le réseau et devient durable et résistante aux coupures de courant, aux pertes de données, etc.</p>
</dd>
<dt class="hdlist1">Protection contre la falsification</dt>
<dd>
<p>Une transaction ne peut dépenser que des sorties existantes et validées. Il n&#8217;est pas possible de créer ou de contrefaire de la valeur.</p>
</dd>
<dt class="hdlist1">Cohérence</dt>
<dd>
<p>En l&#8217;absence de partitions de mineurs, les blocs enregistrés dans la chaîne de blocs sont sujets à une réorganisation ou à un désaccord avec une probabilité décroissante de manière exponentielle, en fonction de la profondeur à laquelle ils sont enregistrés. Une fois profondément enregistrés, le calcul et l&#8217;énergie nécessaires pour changer rendent le changement pratiquement irréalisable.</p>
</dd>
<dt class="hdlist1">Enregistrement de l&#8217;état externe</dt>
<dd>
<p>Une transaction peut valider une valeur de données, via <code>OP_RETURN</code>, représentant une transition d&#8217;état dans une machine à états externe.</p>
</dd>
<dt class="hdlist1">Émission prévisible</dt>
<dd>
<p>Moins de 21 millions de bitcoins seront émis, à un rythme prévisible.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-52">
<p>La liste des blocs de construction (ou structures de base) n&#8217;est pas complète et d&#8217;autres sont ajoutées à chaque nouvelle fonctionnalité introduite dans le bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-54">
<h3 id="_applications_à_partir_des_structures_de_base">Applications à partir des structures de base</h3>
<div class="paragraph data-line-56">
<p>Les structures de base proposés par bitcoin sont des éléments d&#8217;une plateforme de confiance qui peuvent être utilisés pour composer des applications. Voici quelques exemples d&#8217;applications qui existent aujourd&#8217;hui et les blocs de construction qu&#8217;elles utilisent :</p>
</div>
<div class="dlist data-line-58">
<dl>
<dt class="hdlist1">Preuve d&#8217;existence (notaire numérique)</dt>
<dd>
<p>Immuabilité ` Horodatage ` Durabilité. Une empreinte numérique peut être validée avec une transaction dans la chaîne de blocs, prouvant qu&#8217;un document existait (horodatage) au moment où il a été enregistré. L&#8217;empreinte digitale ne pourra pas être modifiée ex-post-facto (Immutabilité) et la preuve sera conservée de façon permanente (Durabilité).</p>
</dd>
<dt class="hdlist1">Kickstarter (Lighthouse)</dt>
<dd>
<p>Cohérence ` Atomicité ` Intégrité. Si vous signez une entrée et la sortie (intégrité) d&#8217;une transaction de collecte de fonds, d&#8217;autres peuvent contribuer à la collecte de fonds mais elle ne peut pas être dépensée (atomicité) tant que l&#8217;objectif (valeur de sortie) n&#8217;est pas financé (cohérence).</p>
</dd>
<dt class="hdlist1">Canaux de paiement</dt>
<dd>
<p>Quorum de contrôle ` Verrou temporel ` Pas de double dépense ` Non-expiration ` Résistance à la censure + Autorisation. Un multisig 2-of-2 (Quorum) avec un verrou temporel (Verrou temporel) utilisé comme transaction de "règlement" d&#8217;un canal de paiement peut être détenu (Non-expiration) et dépensé à tout moment (Résistance à la censure) par l&#8217;une ou l&#8217;autre des parties (Autorisation). Les deux parties peuvent alors créer des transactions d&#8217;engagement qui doublent (Pas de double dépense) le règlement sur un verrou temporel plus court (Verrou temporel).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2 data-line-64">
<h3 id="_counterparty">Counterparty</h3>
<div class="paragraph data-line-66">
<p>Conterparty est une couche de protocole construite au-dessus de bitcoin. Le protocole Counterparty offre la possibilité de créer et d&#8217;échanger des actifs virtuels et des jetons. De plus, Counterparty propose un échange décentralisé d&#8217;actifs. Conterparty met également en œuvre des contrats intelligents, basés sur la machine virtuelle Ethereum (EVM).</p>
</div>
<div class="paragraph data-line-68">
<p>Conterparty intègre des métadonnées dans les transactions bitcoin, en utilisant l&#8217;opcode <code>OP_RETURN</code> ou des adresses multisignatures 1 sur N qui encodent les métadonnées à la place des clés publiques. En utilisant ces mécanismes, Counterparty implémente une couche de protocole encodée dans les transactions bitcoin. La couche de protocole supplémentaire peut être interprétée par des applications compatibles avec Conterparty, telles que les portefeuilles et les explorateurs de chaînes de blocs, ou toute application construite à l&#8217;aide des bibliothèques de Conterparty.</p>
</div>
<div class="paragraph data-line-70">
<p>Conterparty peut être utilisée comme plate-forme pour d&#8217;autres applications et services, à leur tour. Par exemple, Tokenly est une plate-forme construite sur Counterparty qui permet aux créateurs de contenu, aux artistes et aux entreprises d&#8217;émettre des jetons qui expriment la propriété numérique et peuvent être utilisés pour louer, accéder, échanger ou acheter du contenu, des produits et des services. D&#8217;autres applications tirant parti de Counterparty incluent des jeux (Spells of Genesis) et des projets de grille informatique (Folding Coin).</p>
</div>
<div class="paragraph data-line-72">
<p>Plus de détails sur Counterparty peuvent être trouvés sur <a href="https://counterparty.io" class="undefined" data-href="https://counterparty.io">https://counterparty.io</a>. Le projet à source libre est disponible sur <a href="https://github.com/CounterpartyXCP" class="undefined" data-href="https://github.com/CounterpartyXCP">https://github.com/CounterpartyXCP</a>.</p>
</div>
</div>
<div class="sect2 data-line-75">
<h3 id="state_channels">Canaux de paiement et canaux d&#8217;état</h3>
<div class="paragraph data-line-77">
<p><em>Les canaux de paiement</em> sont un mécanisme sans confiance pour échanger des bitcoins transactions entre deux parties, en dehors de la chaîne de blocs Bitcoin. Ces transactions, qui seraient valides si elles étaient réglées sur la chaîne de blocs Bitcoin, sont plutôt détenues hors chaîne, agissant comme des <em>billets à ordre</em> pour un éventuel règlement par lots. Étant donné que les transactions ne sont pas réglées, elles peuvent être échangées sans la latence de règlement habituelle, ce qui permet un débit de transaction extrêmement élevé, une latence faible (inférieure à la milliseconde) et une granularité fine (niveau satoshi).</p>
</div>
<div class="paragraph data-line-79">
<p>En fait, le terme <em>canal</em> est une métaphore. Les canaux d&#8217;état sont des constructions virtuelles représentées par l&#8217;échange d&#8217;état entre deux parties, en dehors de la chaîne de blocs. Il n&#8217;y a pas de "canaux" en soi et le mécanisme de transport de données sous-jacent n&#8217;est pas le canal. Nous utilisons le terme canal pour représenter la relation et l&#8217;état partagé entre deux parties, en dehors de la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-81">
<p>Pour expliquer davantage ce concept, pensez à un flux TCP. Du point de vue des protocoles de niveau supérieur, il s&#8217;agit d&#8217;une "interface de connexion" connectant deux applications sur Internet. Mais si vous regardez le trafic réseau, un flux TCP n&#8217;est qu&#8217;un canal virtuel sur des paquets IP. Chaque extrémité du flux TCP séquence et assemble les paquets IP pour créer l&#8217;illusion d&#8217;un flux d&#8217;octets. En dessous, ce sont tous les paquets déconnectés. De même, un canal de paiement n&#8217;est qu&#8217;une série de transactions. S&#8217;ils sont correctement séquencés et connectés, ils créent des obligations remboursables auxquelles vous pouvez faire confiance même si vous ne faites pas confiance à l&#8217;autre côté du canal.</p>
</div>
<div class="paragraph data-line-83">
<p>Dans cette section, nous examinerons différentes formes de canaux de paiement. Premièrement, nous examinerons les mécanismes utilisés pour construire un canal de paiement unidirectionnel (unidirectionnel) pour un service de micropaiement mesuré, tel que le streaming vidéo. Ensuite, nous développerons ce mécanisme et introduirons des canaux de paiement bidirectionnels. Enfin, nous verrons comment des canaux bidirectionnels peuvent être connectés de bout en bout pour former des canaux multisauts dans un réseau routé, d&#8217;abord proposé sous le nom de <em>Lightning Network</em>.</p>
</div>
<div class="paragraph data-line-85">
<p>Les canaux de paiement font partie du concept plus large d&#8217;un <em>canal d&#8217;état</em>, qui représente une altération d&#8217;état hors chaîne, sécurisée par un éventuel règlement dans une chaîne de blocs. Un canal de paiement est un canal d&#8217;état où l&#8217;état modifié est le solde d&#8217;une monnaie virtuelle.</p>
</div>
<div class="sect3 data-line-87">
<h4 id="_canaux_détat_concepts_de_base_et_terminologie">Canaux d&#8217;état, concepts de base et terminologie</h4>
<div class="paragraph data-line-89">
<p>Un canal d&#8217;état est établi entre deux parties, par le biais d&#8217;une transaction qui verrouille un état partagé sur la chaîne de blocs. C&#8217;est ce qu&#8217;on appelle la <em>transaction de financement</em> ou <em>transaction d&#8217;ancrage</em>. Cette transaction unique doit être transmise au réseau et exploitée pour établir le canal. Dans l&#8217;exemple d&#8217;un canal de paiement, l&#8217;état bloqué est le solde initial (en devise) du canal.</p>
</div>
<div class="paragraph data-line-91">
<p>Les deux parties échangent alors des transactions signées, appelées <em>transactions d&#8217;engagement</em>, qui modifient l&#8217;état initial. Ces transactions sont des transactions valides dans la mesure où elles <em>pourraient</em> être soumises pour règlement par l&#8217;une ou l&#8217;autre des parties, mais sont plutôt détenues hors chaîne par chaque partie en attendant la fermeture du canal. Les mises à jour d&#8217;état peuvent être créées aussi rapidement que chaque partie peut créer, signer et transmettre une transaction à l&#8217;autre partie. En pratique, cela signifie que des milliers de transactions par seconde peuvent être échangées.</p>
</div>
<div class="paragraph data-line-93">
<p>Lors de l&#8217;échange de transactions d&#8217;engagement, les deux parties invalident également les états précédents, de sorte que la transaction d&#8217;engagement la plus récente est toujours la seule qui puisse être remboursée. Cela empêche l&#8217;une ou l&#8217;autre des parties de tricher en fermant unilatéralement le canal avec un état antérieur expiré qui lui est plus favorable que l&#8217;état actuel. Nous examinerons les différents mécanismes qui peuvent être utilisés pour invalider l&#8217;état antérieur dans la suite de ce chapitre.</p>
</div>
<div class="paragraph data-line-95">
<p>Enfin, le canal peut être fermé soit de manière coopérative, en soumettant une <em>transaction de règlement</em> finale à la chaîne de blocs, soit unilatéralement, par l&#8217;une ou l&#8217;autre des parties soumettant la dernière transaction d&#8217;engagement à la chaîne de blocs. Une option de fermeture unilatérale est nécessaire au cas où l&#8217;une des parties se déconnecte de manière inattendue. La transaction de règlement représente l&#8217;état final du canal et est réglée sur la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-97">
<p>Pendant toute la durée de vie de la chaîne, seules deux transactions doivent être soumises pour minage sur la chaîne de blocs : les transactions de financement et de règlement. Entre ces deux états, les deux parties peuvent échanger un nombre illimité de transactions d&#8217;engagement qui ne sont jamais vues par personne d&#8217;autre, ni soumises à la chaîne de blocs.</p>
</div>
<div class="paragraph data-line-99">
<p><a href="#payment_channel">Un canal de paiement entre Bob et Alice, montrant les transactions de financement, d&#8217;engagement et de règlement</a> illustre un canal de paiement entre Bob et Alice, montrant les transactions de financement, d&#8217;engagement et de règlement.</p>
</div>
<div id="payment_channel" class="imageblock data-line-103">
<div class="content">
<img src="images/mbc2_1201.png" alt="Un canal de paiement entre Bob et Alice, montrant les transactions de financement, d&#8217;engagement et de règlement">
</div>
<div class="title">Figure 73. Un canal de paiement entre Bob et Alice, montrant les transactions de financement, d&#8217;engagement et de règlement</div>
</div>
</div>
<div class="sect3 data-line-105">
<h4 id="_exemple_de_canal_de_paiement_simple">Exemple de canal de paiement simple</h4>
<div class="paragraph data-line-107">
<p>Pour expliquer les canaux d&#8217;état, nous commençons par un exemple très simple. Nous démontrons un canal à sens unique, ce qui signifie que la valeur ne circule que dans une seule direction. Nous partirons également de l&#8217;hypothèse naïve que personne n&#8217;essaie de tricher, pour garder les choses simples. Une fois que nous aurons expliqué l&#8217;idée de base du canal, nous examinerons ce qu&#8217;il faut pour le rendre sans confiance afin qu&#8217;aucune des parties ne puisse tricher, même si elle essaie de le faire.</p>
</div>
<div class="paragraph data-line-109">
<p>Pour cet exemple, nous supposerons deux participants : Emma et Fabian. Fabian propose un service de diffusion vidéo en continu facturé à la seconde via un canal de micropaiement. Fabian facture 0,01 millibit (0,00001 BTC) par seconde de vidéo, ce qui équivaut à 36 millibits (0,036 BTC) par heure de vidéo. Emma est une utilisatrice qui achète ce service de diffusion vidéo en continu auprès de Fabian. <a href="#emma_fabian_streaming_video">Emma achète la vidéo en continu de Fabian avec un canal de paiement, payant pour chaque seconde de vidéo</a> montre Emma achetant le service de diffusion vidéo en continu de Fabian en utilisant un canal de paiement.</p>
</div>
<div id="emma_fabian_streaming_video" class="imageblock data-line-113">
<div class="content">
<img src="images/mbc2_1202.png" alt="Emma achète la diffusion vidéo en continu de Fabian avec un canal de paiement, payant pour chaque seconde de vidéo">
</div>
<div class="title">Figure 74. Emma achète la vidéo en continu de Fabian avec un canal de paiement, payant pour chaque seconde de vidéo</div>
</div>
<div class="paragraph data-line-115">
<p>Dans cet exemple, Fabian et Emma utilisent un logiciel spécial qui gère à la fois le canal de paiement et la diffusion vidéo en continu. Emma exécute le logiciel dans son navigateur, Fabian l&#8217;exécute sur un serveur. Le logiciel inclut les fonctionnalités de base du portefeuille bitcoin et peut créer et signer des transactions bitcoin. Le concept et le terme "canal de paiement" sont complètement cachés aux utilisateurs. Ce qu&#8217;ils voient, c&#8217;est une vidéo payée à la seconde.</p>
</div>
<div class="paragraph data-line-117">
<p>Pour mettre en place le canal de paiement, Emma et Fabian établissent une adresse multisignature 2 sur 2, chacun d&#8217;eux détenant l&#8217;une des clés. Du point de vue d&#8217;Emma, le logiciel de son navigateur présente un code QR avec une adresse P2SH (commençant par "3") et lui demande de soumettre un "dépôt" pour jusqu&#8217;à 1 heure de vidéo. L&#8217;adresse est alors financée par Emma. La transaction d&#8217;Emma, payant à l&#8217;adresse multisignature, est la transaction de financement ou d&#8217;ancrage pour le canal de paiement.</p>
</div>
<div class="paragraph data-line-119">
<p>Pour cet exemple, disons qu&#8217;Emma finance la chaîne avec 36 millibits (0,036 BTC). Cela permettra à Emma de consommer <em>jusqu&#8217;à</em> 1 heure de diffusion vidéo en continu. La transaction de financement dans ce cas fixe le montant maximum qui peut être transmis dans ce canal, en définissant la <em>capacité du canal</em>.</p>
</div>
<div class="paragraph data-line-121">
<p>La transaction de financement consomme une ou plusieurs entrées du portefeuille d&#8217;Emma, approvisionnant les fonds. Il crée une sortie d&#8217;une valeur de 36 millibits payée à l&#8217;adresse multisignature 2 sur 2 contrôlée conjointement entre Emma et Fabian. Il peut avoir des sorties supplémentaires pour revenir au portefeuille d&#8217;Emma.</p>
</div>
<div class="paragraph data-line-123">
<p>Une fois la transaction de financement confirmée, Emma peut commencer à diffuser la vidéo. Le logiciel d&#8217;Emma crée et signe une transaction d&#8217;engagement qui modifie le solde du canal pour créditer 0,01 millibit à l&#8217;adresse de Fabian et rembourser 35,99 millibits à Emma. La transaction signée par Emma consomme la sortie de 36 millibits créée par la transaction de financement et crée deux sorties : une pour son remboursement, l&#8217;autre pour le paiement de Fabian. La transaction n&#8217;est que partiellement signée - elle nécessite deux signatures (2 sur 2), mais n&#8217;a que la signature d&#8217;Emma. Lorsque le serveur de Fabian reçoit cette transaction, il ajoute la deuxième signature (pour l&#8217;entrée 2 sur 2) et la renvoie à Emma avec 1 seconde de vidéo. Désormais, les deux parties ont une transaction d&#8217;engagement entièrement signée que l&#8217;une ou l&#8217;autre peut racheter, représentant le solde à jour correct du canal. Aucune des parties ne diffuse cette transaction sur le réseau.</p>
</div>
<div class="paragraph data-line-125">
<p>Au tour suivant, le logiciel d&#8217;Emma crée et signe une autre transaction d&#8217;engagement (engagement #2) qui consomme la <em>même</em> sortie 2 sur 2 de la transaction de financement. La seconde transaction d&#8217;engagement alloue une sortie de 0,02 millibits à l&#8217;adresse de Fabian et une sortie de 35,98 millibits à l&#8217;adresse d&#8217;Emma. Cette nouvelle transaction est le paiement de deux secondes cumulées de vidéo. Le logiciel de Fabian signe et renvoie la deuxième transaction d&#8217;engagement, ainsi qu&#8217;une autre seconde de vidéo.</p>
</div>
<div class="paragraph data-line-127">
<p>De cette manière, le logiciel d&#8217;Emma continue d&#8217;envoyer des transactions d&#8217;engagement au serveur de Fabian en échange de diffusion vidéo en continu. Le solde de la chaîne s&#8217;accumule progressivement en faveur de Fabian, car Emma consomme plus de secondes de vidéo. Disons qu&#8217;Emma regarde 600 secondes (10 minutes) de vidéo, créant et signant 600 transactions d&#8217;engagement. La dernière transaction d&#8217;engagement (#600) aura deux sorties, divisant le solde de la chaîne, 6 millibits pour Fabian et 30 millibits pour Emma.</p>
</div>
<div class="paragraph data-line-129">
<p>Enfin, Emma sélectionne "Stop" pour arrêter le streaming vidéo. Fabian ou Emma peuvent maintenant transmettre la transaction d&#8217;état finale pour règlement. Cette dernière transaction est la <em>transaction de règlement</em> et paie Fabian pour toute la vidéo consommée par Emma, remboursant le reste de la transaction de financement à Emma.</p>
</div>
<div class="paragraph data-line-131">
<p><a href="#video_payment_channel">Le canal de paiement d&#8217;Emma avec Fabian, montrant les transactions d&#8217;engagement qui mettent à jour le solde du canal</a> montre le canal entre Emma et Fabian et les transactions d&#8217;engagement qui mettent à jour le solde du canal.</p>
</div>
<div class="paragraph data-line-133">
<p>Au final, seules deux transactions sont enregistrées sur la chaîne de bocs : la transaction de financement qui établit le canal et une transaction de règlement qui répartit correctement le solde final entre les deux participants.</p>
</div>
<div id="video_payment_channel" class="imageblock data-line-137">
<div class="content">
<img src="images/mbc2_1203.png" alt="Le canal de paiement d&#8217;Emma avec Fabian, montrant les transactions d&#8217;engagement qui mettent à jour le solde du canal">
</div>
<div class="title">Figure 75. Le canal de paiement d&#8217;Emma avec Fabian, montrant les transactions d&#8217;engagement qui mettent à jour le solde du canal</div>
</div>
</div>
<div class="sect3 data-line-139">
<h4 id="_créer_des_canaux_sans_confiance">Créer des canaux sans confiance</h4>
<div class="paragraph data-line-141">
<p>Le canal que nous venons de décrire fonctionne, mais seulement si les deux parties coopèrent, sans échec ni tentative de tricherie. Examinons certains des scénarios qui cassent ce canal et voyons ce qui est nécessaire pour les réparer :</p>
</div>
<div class="ulist data-line-143">
<ul>
<li class="data-line-143">
<p>Une fois la transaction de financement effectuée, Emma a besoin de la signature de Fabian pour récupérer l&#8217;argent. Si Fabian disparaît, les fonds d&#8217;Emma sont enfermés dans un 2 sur 2 et effectivement perdus. Ce canal, tel que construit, entraîne une perte de fonds si l&#8217;une des parties se déconnecte avant qu&#8217;il y ait au moins une transaction d&#8217;engagement signée par les deux parties.</p>
</li>
<li class="data-line-145">
<p>Pendant que le canal est en cours d&#8217;exécution, Emma peut prendre n&#8217;importe laquelle des transactions d&#8217;engagement que Fabian a contresignées et en transmettre une à la chaîne de blocs. Pourquoi payer 600 secondes de vidéo, si elle peut transmettre la transaction d&#8217;engagement #1 et ne payer que 1 seconde de vidéo ? La chaîne échoue car Emma peut tricher en diffusant un engagement préalable qui est en sa faveur.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-147">
<p>Ces deux problèmes peuvent être résolus avec des verrous temporels. Voyons comment nous pourrions utiliser des verrous temporels au niveau des transactions (<code>nLocktime</code>).</p>
</div>
<div class="paragraph data-line-149">
<p>Emma ne peut pas risquer de financer un multisig 2 sur 2 à moins qu&#8217;elle n&#8217;ait un remboursement garanti. Pour résoudre ce problème, Emma construit les transactions de financement et de remboursement en même temps. Elle signe la transaction de financement mais ne la transmet à personne. Emma transmet uniquement la transaction de remboursement à Fabian et obtient sa signature.</p>
</div>
<div class="paragraph data-line-151">
<p>La transaction de remboursement agit comme la première transaction d&#8217;engagement et son verrou temporel établit la limite supérieure pour la durée de vie du canal. Dans ce cas, Emma pourrait définir le <code>nLocktime</code> sur 30 jours ou 4320 blocs dans le futur. Toutes les transactions d&#8217;engagement ultérieures doivent avoir un verrou temporel plus court, afin qu&#8217;elles puissent être remboursées avant la transaction de remboursement.</p>
</div>
<div class="paragraph data-line-153">
<p>Maintenant qu&#8217;Emma a une transaction de remboursement entièrement signée, elle peut transmettre en toute confiance la transaction de financement signée en sachant qu&#8217;elle pourra éventuellement, après l&#8217;expiration du délai, racheter la transaction de remboursement même si Fabian disparaît.</p>
</div>
<div class="paragraph data-line-155">
<p>Chaque transaction d&#8217;engagement que les parties échangent pendant la durée de vie du canal sera verrouillée dans le futur. Mais le délai sera légèrement plus court pour chaque engagement afin que l&#8217;engagement le plus récent puisse être remboursé avant l&#8217;engagement précédent qu&#8217;il invalide. En raison de nLockTime, aucune des parties ne peut propager avec succès l&#8217;une des transactions d&#8217;engagement jusqu&#8217;à l&#8217;expiration de leur verrouillage temporel. Si tout va bien, ils coopéreront et fermeront le canal gracieusement avec une transaction de règlement, rendant inutile la transmission d&#8217;une transaction d&#8217;engagement intermédiaire. Sinon, la transaction d&#8217;engagement la plus récente peut être propagée pour régler le compte et invalider toutes les transactions d&#8217;engagement précédentes.</p>
</div>
<div class="paragraph data-line-157">
<p>Par exemple, si la transaction d&#8217;engagement #1 est verrouillée dans le temps sur 4320 blocs à l&#8217;avenir, alors la transaction d&#8217;engagement #2 est verrouillée dans le temps sur 4319 blocs dans le futur. La transaction d&#8217;engagement #600 peut être dépensée 600 blocs avant que la transaction d&#8217;engagement #1 ne devienne valide.</p>
</div>
<div class="paragraph data-line-159">
<p><a href="#timelocked_commitments">Chaque engagement fixe un délai plus court, ce qui lui permet d&#8217;être dépensé avant que les engagements précédents ne deviennent valides</a> montre chaque transaction d&#8217;engagement définissant un verrou temporel plus court, lui permettant d&#8217;être dépensé avant que les engagements précédents ne deviennent valides.</p>
</div>
<div id="timelocked_commitments" class="imageblock data-line-163">
<div class="content">
<img src="images/mbc2_1204.png" alt="Chaque engagement fixe un délai plus court, ce qui lui permet d&#8217;être dépensé avant que les engagements précédents ne deviennent valides">
</div>
<div class="title">Figure 76. Chaque engagement fixe un délai plus court, ce qui lui permet d&#8217;être dépensé avant que les engagements précédents ne deviennent valides</div>
</div>
<div class="paragraph data-line-165">
<p>Chaque transaction d&#8217;engagement ultérieure doit avoir un verrou temporel plus court afin qu&#8217;elle puisse être diffusée avant ses prédécesseurs et avant la transaction de remboursement. La possibilité de diffuser un engagement plus tôt garantit qu&#8217;il sera en mesure de dépenser la sortie de financement et d&#8217;empêcher toute autre transaction d&#8217;engagement d&#8217;être remboursée en dépensant la sortie. Les garanties offertes par la chaîne de blocs Bitcoin, empêchant les doubles dépenses et appliquant des verrous temporels, permettent effectivement à chaque transaction d&#8217;engagement d&#8217;invalider ses prédécesseurs.</p>
</div>
<div class="paragraph data-line-167">
<p>Les canaux d&#8217;état utilisent des verrous temporels pour appliquer des contrats intelligents dans une dimension temporelle. Dans cet exemple, nous avons vu comment la dimension temporelle garantit que la transaction d&#8217;engagement la plus récente devient valide avant tout engagement antérieur. Ainsi, la transaction d&#8217;engagement la plus récente peut être transmise, dépensant les entrées et invalidant les transactions d&#8217;engagement précédentes. L&#8217;application de contrats intelligents avec des délais absolus protège contre la tricherie par l&#8217;une des parties. Cette implémentation n&#8217;a besoin de rien de plus que des verrous temporels absolus au niveau de la transaction (<code>nLocktime</code>). Ensuite, nous verrons comment les verrous temporels au niveau du script, <code>CHECKLOCKTIMEVERIFY</code> et <code>CHECKSEQUENCEVERIFY</code>, peuvent être utilisés pour construire des canaux d&#8217;état plus flexibles, utiles et sophistiqués.</p>
</div>
<div class="paragraph data-line-169">
<p>La première forme de canal de paiement unidirectionnel a été présentée sous la forme d&#8217;un prototype d&#8217;application de streaming vidéo en 2015 par une équipe de développeurs argentins.</p>
</div>
<div class="paragraph data-line-171">
<p>Les verrous temporels ne sont pas le seul moyen d&#8217;invalider les transactions d&#8217;engagement antérieures. Dans les sections suivantes, nous verrons comment une clé de révocation peut être utilisée pour obtenir le même résultat. Les verrous temporels sont efficaces mais ils ont deux inconvénients distincts. En établissant un verrou temporel maximal lors de la première ouverture du canal, ils limitent la durée de vie du canal. Pire, ils obligent les implémentations de canaux à trouver un équilibre entre autoriser des canaux à longue durée de vie et obliger l&#8217;un des participants à attendre très longtemps un remboursement en cas de fermeture prématurée. Par exemple, si vous autorisez le canal à rester ouvert pendant 30 jours, en réglant le délai de remboursement sur 30 jours, si l&#8217;une des parties disparaît immédiatement, l&#8217;autre partie doit attendre 30 jours pour un remboursement. Plus le point final est éloigné, plus le remboursement est éloigné.</p>
</div>
<div class="paragraph data-line-173">
<p>Le deuxième problème est que puisque chaque transaction d&#8217;engagement ultérieure doit décrémenter le verrouillage temporel, il existe une limite explicite sur le nombre de transactions d&#8217;engagement qui peuvent être échangées entre les parties. Par exemple, un canal de 30 jours, définissant un verrouillage temporel de 4320 blocs dans le futur, ne peut accepter que 4320 transactions d&#8217;engagement intermédiaires avant de devoir être clôturé. Il y a un danger à définir l&#8217;intervalle de transaction d&#8217;engagement de verrouillage de temps à 1 bloc. En définissant l&#8217;intervalle de verrouillage entre les transactions d&#8217;engagement sur 1 bloc, un développeur crée une charge très lourde pour les participants au canal qui doivent être vigilants, rester en ligne et regarder, et être prêts à transmettre la bonne transaction d&#8217;engagement à tout moment.</p>
</div>
<div class="paragraph data-line-175">
<p>Maintenant que nous comprenons comment les verrous temporels peuvent être utilisés pour invalider des engagements antérieurs, nous pouvons voir la différence entre fermer le canal de manière coopérative et le fermer unilatéralement en diffusant une transaction d&#8217;engagement. Toutes les transactions d&#8217;engagement sont verrouillées dans le temps, par conséquent, la diffusion d&#8217;une transaction d&#8217;engagement impliquera toujours d&#8217;attendre jusqu&#8217;à ce que le verrouillage ait expiré. Mais si les deux parties s&#8217;entendent sur le solde final et savent qu&#8217;elles détiennent toutes les deux des transactions d&#8217;engagement qui feront éventuellement de ce solde une réalité, elles peuvent construire une transaction de règlement sans verrou temporel représentant ce même solde. Dans une clôture coopérative, l&#8217;une ou l&#8217;autre des parties prend la transaction d&#8217;engagement la plus récente et construit une transaction de règlement qui est identique à tous points de vue, sauf qu&#8217;elle omet le verrou temporel. Les deux parties peuvent signer cette transaction de règlement en sachant qu&#8217;il n&#8217;y a aucun moyen de tricher et d&#8217;obtenir un solde plus favorable. En signant et en transmettant de manière coopérative la transaction de règlement, ils peuvent fermer le canal et racheter leur solde immédiatement. Dans le pire des cas, l&#8217;une des parties peut être mesquine, refuser de coopérer et forcer l&#8217;autre partie à conclure unilatéralement la transaction d&#8217;engagement la plus récente. Mais s&#8217;ils le font, ils doivent aussi attendre leurs fonds.</p>
</div>
</div>
<div class="sect3 data-line-177">
<h4 id="_engagements_révocables_asymétriques">Engagements révocables asymétriques</h4>
<div class="paragraph data-line-179">
<p>Une meilleure façon de gérer les états d&#8217;engagement antérieurs est de les révoquer explicitement. Cependant, ce n&#8217;est pas facile à réaliser. Une caractéristique clé du bitcoin est qu&#8217;une fois qu&#8217;une transaction est valide, elle reste valide et n&#8217;expire pas. La seule façon d&#8217;annuler une transaction est de doubler ses entrées avec une autre transaction avant qu&#8217;elle ne soit minée. C&#8217;est pourquoi nous avons utilisé des verrous temporels dans l&#8217;exemple de canal de paiement simple ci-dessus pour nous assurer que les engagements les plus récents pourraient être dépensés avant que les engagements plus anciens ne soient valides. Cependant, l&#8217;enchaînement des engagements dans le temps crée un certain nombre de contraintes qui rendent les canaux de paiement difficiles à utiliser.</p>
</div>
<div class="paragraph data-line-181">
<p>Même si une transaction ne peut pas être annulée, elle peut être construite de manière à rendre son utilisation indésirable. Pour ce faire, nous donnons à chaque partie une <em>clé de révocation</em> qui peut être utilisée pour punir l&#8217;autre partie si elle essaie de tricher. Ce mécanisme de révocation des opérations d&#8217;engagement préalable a été initialement proposé dans le cadre du Lightning Network.</p>
</div>
<div class="paragraph data-line-183">
<p>Pour expliquer les clés de révocation, nous allons construire un canal de paiement plus complexe entre deux échanges gérés par Hitesh et Irene. Hitesh et Irene gèrent respectivement des échanges de bitcoins en Inde et aux États-Unis. Les clients de l&#8217;échange indien d&#8217;Hitesh envoient souvent des paiements aux clients de l&#8217;échange américain d&#8217;Irene et vice versa. Actuellement, ces transactions se produisent sur la chaîne de blocs Bitcoin, mais cela signifie payer des frais et attendre plusieurs blocs pour les confirmations. La mise en place d&#8217;un canal de paiement entre les bourses réduira considérablement les coûts et accélérera le flux des transactions.</p>
</div>
<div class="paragraph data-line-185">
<p>Hitesh et Irene démarrent le canal en construisant en collaboration une transaction de financement, chacun finançant la chaîne avec 5 bitcoins.
Le solde initial est de 5 bitcoins pour Hitesh et de 5 bitcoins pour Irene. La transaction de financement verrouille l&#8217;état du canal dans un multisig 2 sur 2, comme dans l&#8217;exemple d&#8217;un canal simple.</p>
</div>
<div class="paragraph data-line-188">
<p>La transaction de financement peut avoir une ou plusieurs entrées de Hitesh (ajoutant jusqu&#8217;à 5 bitcoins ou plus) et une ou plusieurs entrées d&#8217;Irene (ajoutant jusqu&#8217;à 5 bitcoins ou plus). Les entrées doivent légèrement dépasser la capacité du canal afin de couvrir les frais de transaction. La transaction a une sortie qui verrouille les 10 bitcoins au total sur une adresse multisig 2 sur 2 contrôlée à la fois par Hitesh et Irene. La transaction de financement peut également avoir une ou plusieurs sorties rendant la monnaie à Hitesh et Irene si leurs entrées ont dépassé leur contribution de canal prévue. Il s&#8217;agit d&#8217;une transaction unique avec des entrées offertes et signées par deux parties. Il doit être construit en collaboration et signé par chaque partie avant d&#8217;être transmis.</p>
</div>
<div class="paragraph data-line-190">
<p>Maintenant, au lieu de créer une transaction d&#8217;engagement unique que les deux parties signent, Hitesh et Irene créent deux transactions d&#8217;engagement différentes qui sont <em>asymétriques</em>.</p>
</div>
<div class="paragraph data-line-192">
<p>Hitesh a une transaction d&#8217;engagement avec deux sorties. La première sortie paie à Irene les 5 bitcoins qui lui sont dus <em>immédiatement</em>. La deuxième sortie paie à Hitesh les 5 bitcoins qui lui sont dus, mais seulement après un verrou temporel de 1000 blocs. Les sorties de transaction ressemblent à ceci :</p>
</div>
<div class="listingblock data-line-194">
<div class="content">
<pre>Input: 2-of-2 funding output, signed by Irene

Output 0 &lt;5 bitcoin&gt;:
    &lt;Irene's Public Key&gt; CHECKSIG

Output 1 &lt;5 bitcoin&gt;:
    &lt;1000 blocks&gt;
    CHECKSEQUENCEVERIFY
    DROP
    &lt;Hitesh's Public Key&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-207">
<p>Irène a une transaction d&#8217;engagement différente avec deux sorties. La première sortie paie à Hitesh les 5 bitcoins qui lui sont dus immédiatement. La deuxième sortie paie à Irene les 5 bitcoins qui lui sont dus mais seulement après un verrou temporel de 1000 blocs. La transaction d&#8217;engagement qu&#8217;Irene détient (signée par Hitesh) ressemble à ceci :</p>
</div>
<div class="listingblock data-line-209">
<div class="content">
<pre>Input: 2-of-2 funding output, signed by Hitesh

Output 0 &lt;5 bitcoin&gt;:
    &lt;Hitesh's Public Key&gt; CHECKSIG

Output 1 &lt;5 bitcoin&gt;:
    &lt;1000 blocks&gt;
    CHECKSEQUENCEVERIFY
    DROP
    &lt;Irene's Public Key&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-222">
<p>De cette façon, chaque partie a une transaction d&#8217;engagement, dépensant la sortie de financement 2 sur 2. Cette entrée est signée par l'<em>autre</em> partie. À tout moment, la partie détenant la transaction peut également signer (remplir le 2 sur 2) et diffuser. Cependant, s&#8217;ils diffusent la transaction d&#8217;engagement, il paie immédiatement l&#8217;autre partie alors qu&#8217;elle doit attendre l&#8217;expiration d&#8217;un verrou temporel. En imposant un délai au remboursement de l&#8217;une des sorties, nous désavantageons légèrement chaque partie lorsqu&#8217;elle choisit de diffuser unilatéralement une opération d&#8217;engagement. Mais un délai ne suffit pas à lui seul à encourager une conduite équitable.</p>
</div>
<div class="paragraph data-line-224">
<p><a href="#asymmetric_commitments">Deux opérations d&#8217;engagement asymétriques avec paiement différé pour le titulaire de l&#8217;opération</a> montre deux opérations d&#8217;engagement asymétriques, où la sortie payant le titulaire de l&#8217;engagement est retardée.</p>
</div>
<div id="asymmetric_commitments" class="imageblock data-line-228">
<div class="content">
<img src="images/mbc2_1205.png" alt="Deux opérations d&#8217;engagement asymétriques avec retard de paiement pour le porteur de l&#8217;opération">
</div>
<div class="title">Figure 77. Deux opérations d&#8217;engagement asymétriques avec paiement différé pour le titulaire de l&#8217;opération</div>
</div>
<div class="paragraph data-line-230">
<p>Nous introduisons maintenant le dernier élément de ce schéma : une clé de révocation qui empêche un tricheur de diffuser un engagement expiré. La clé de révocation permet à la partie lésée de sanctionner le tricheur en prélevant tout le solde de la chaîne.</p>
</div>
<div class="paragraph data-line-232">
<p>La clé de révocation est composée de deux secrets, chacun généré indépendamment par chaque participant du canal. Il est similaire à un multisig 2 sur 2, mais construit à l&#8217;aide de l&#8217;arithmétique de la courbe elliptique, de sorte que les deux parties connaissent la clé publique de révocation mais que chaque partie ne connaît que la moitié de la clé secrète de révocation.</p>
</div>
<div class="paragraph data-line-234">
<p>À chaque tour, les deux parties révèlent leur moitié du secret de révocation à l&#8217;autre partie, donnant ainsi à l&#8217;autre partie (qui a maintenant les deux moitiés) les moyens de réclamer la sortie de pénalité si cette transaction révoquée est jamais diffusée.</p>
</div>
<div class="paragraph data-line-236">
<p>Chacune des transactions d&#8217;engagement a une sortie "retardée". Le script de rachat pour cette sortie permet à une partie de la racheter après 1000 blocs, <em>ou</em> à l&#8217;autre partie de la racheter si elle a une clé de révocation, pénalisant la transmission d&#8217;un engagement révoqué.</p>
</div>
<div class="paragraph data-line-238">
<p>Ainsi, lorsque Hitesh crée une transaction d&#8217;engagement pour Irene à signer, il rend la deuxième sortie payable à lui-même après 1000 blocs, ou à la clé publique de révocation (dont il ne connaît que la moitié du secret). Hitesh construit cette transaction. Il ne révélera sa moitié du secret de révocation à Irène que lorsqu&#8217;il sera prêt à passer à un nouvel état de canal et qu&#8217;il voudra révoquer cet engagement.</p>
</div>
<div class="paragraph data-line-240">
<p>Le script de la deuxième sortie ressemble à ceci :</p>
</div>
<div class="listingblock data-line-242">
<div class="content">
<pre>Output 0 &lt;5 bitcoin&gt;:
    &lt;Irene's Public Key&gt; CHECKSIG

Output 1 &lt;5 bitcoin&gt;:
IF
# Sortie de pénalité de révocation
    &lt;Revocation Public Key&gt;
ELSE
    &lt;1000 blocks&gt;
    CHECKSEQUENCEVERIFY
    DROP
    &lt;Hitesh's Public Key&gt;
ENDIF
CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-259">
<p>Irène peut signer cette transaction en toute confiance, car si elle est transmise, elle lui paiera immédiatement ce qui lui est dû. Hitesh détient la transaction, mais sait que s&#8217;il la transmet dans une fermeture de canal unilatérale, il devra attendre 1000 blocs pour être payé.</p>
</div>
<div class="paragraph data-line-261">
<p>Lorsque le canal passe à l&#8217;état suivant, Hitesh doit <em>révoquer</em> cette transaction d&#8217;engagement avant qu&#8217;Irene n&#8217;accepte de signer la prochaine transaction d&#8217;engagement. Pour cela, il lui suffit d&#8217;envoyer sa moitié de <em>clé de révocation</em> à Irène. Une fois qu&#8217;Irene a les deux moitiés de la clé secrète de révocation pour cet engagement, elle peut signer le prochain engagement en toute confiance. Elle sait que si Hitesh essaie de tricher en publiant l&#8217;engagement précédent, elle peut utiliser la clé de révocation pour racheter la sortie retardée de Hitesh. <em>Si Hitesh triche, Irene obtient les DEUX sorties</em>. Pendant ce temps, Hitesh n&#8217;a que la moitié du secret de révocation pour cette clé publique de révocation et ne peut pas racheter la sortie avant 1000 blocs. Irene pourra racheter la sortie et punir Hitesh avant que les 1000 blocs ne se soient écoulés.</p>
</div>
<div class="paragraph data-line-263">
<p>Le protocole de révocation est bilatéral, ce qui signifie qu&#8217;à chaque tour, à mesure que l&#8217;état du canal est avancé, les deux parties échangent de nouveaux engagements, échangent des secrets de révocation pour les engagements précédents et signent les nouvelles transactions d&#8217;engagement de l&#8217;autre. Au fur et à mesure qu&#8217;ils acceptent un nouvel état, ils rendent l&#8217;état antérieur inutilisable, en se donnant mutuellement les secrets de révocation nécessaires pour sanctionner toute tricherie.</p>
</div>
<div class="paragraph data-line-265">
<p>Regardons un exemple de la façon dont cela fonctionne. L&#8217;un des clients d&#8217;Irene souhaite envoyer 2 bitcoins à l&#8217;un des clients de Hitesh. Pour transmettre 2 bitcoins à travers le canal, Hitesh et Irene doivent faire avancer l&#8217;état du canal pour refléter le nouvel équilibre. Ils s&#8217;engageront dans un nouvel état (état numéro 2) où les 10 bitcoins de la chaîne sont divisés, 7 bitcoins pour Hitesh et 3 bitcoins pour Irene. Pour faire progresser l&#8217;état du canal, ils créeront chacun de nouvelles transactions d&#8217;engagement reflétant le nouveau solde du canal.</p>
</div>
<div class="paragraph data-line-267">
<p>Comme auparavant, ces transactions d&#8217;engagement sont asymétriques de sorte que la transaction d&#8217;engagement que chaque partie détient les oblige à attendre si ils la remboursent. Surtout, avant de signer de nouvelles transactions d&#8217;engagement, ils doivent d&#8217;abord échanger des clés de révocation pour invalider l&#8217;engagement précédent. Dans ce cas particulier, les intérêts de Hitesh sont alignés sur l&#8217;état réel de la chaîne et il n&#8217;a donc aucune raison de diffuser un état antérieur. Cependant, pour Irene, l&#8217;état numéro 1 lui laisse un solde plus élevé que l&#8217;état 2. Quand Irene donne à Hitesh la clé de révocation pour sa transaction d&#8217;engagement précédente (état numéro 1), elle révoque effectivement sa capacité à tirer profit de la régression du canal vers un précédent. état parce qu&#8217;avec la clé de révocation, Hitesh peut racheter sans délai les deux sorties de la transaction d&#8217;engagement précédente. Cela signifie que si Irene diffuse l&#8217;état antérieur, Hitesh peut exercer son droit de prendre toutes les sorties.</p>
</div>
<div class="paragraph data-line-269">
<p>Il est important de noter que la révocation ne se produit pas automatiquement. Alors que Hitesh a la capacité de punir Irene pour avoir triché, il doit surveiller la chaîne de blocs avec diligence pour détecter des signes de tricherie. S&#8217;il voit une diffusion d&#8217;une transaction d&#8217;engagement préalable, il dispose de 1000 blocs pour agir et utiliser la clé de révocation pour contrecarrer la tricherie d&#8217;Irène et la punir en prenant la totalité du solde, les 10 bitcoins.</p>
</div>
<div class="paragraph data-line-271">
<p>Les engagements révocables asymétriques avec blocages temporels relatifs (<code>CSV</code>) sont une bien meilleure façon de mettre en œuvre les canaux de paiement et une innovation très importante dans cette technologie. Avec cette construction, le canal peut rester ouvert indéfiniment et peut avoir des milliards de transactions d&#8217;engagement intermédiaires. Dans les implémentations prototypes de Lightning Network, l&#8217;état d&#8217;engagement est identifié par un index de 48 bits, permettant plus de 281 000 milliards (2,8 x 10<sup>14</sup>) de transitions d&#8217;état dans n&#8217;importe quel canal !</p>
</div>
</div>
<div class="sect3 data-line-273">
<h4 id="_contrats_de_verrouillage_du_temps_de_hachage_htlc">Contrats de verrouillage du temps de hachage (HTLC)</h4>
<div class="paragraph data-line-275">
<p>Les canaux de paiement peuvent être encore étendus avec un type spécial de contrat intelligent qui permet aux participants d&#8217;engager des fonds dans un secret remboursable, avec un délai d&#8217;expiration. Cette fonctionnalité est appelée <em>contrats de verrouillage du temps de hachage</em> (<em>Hash Time Lock Contract</em>), ou <em>HTLC</em>, et est utilisée à la fois dans les canaux de paiement bidirectionnels et routés.</p>
</div>
<div class="paragraph data-line-277">
<p>Expliquons d&#8217;abord la partie "hachage" du HTLC. Pour créer un HTLC, le destinataire prévu du paiement créera d&#8217;abord un <code>R</code> secret. Ils calculent ensuite le hash de ce secret <code>H</code> :</p>
</div>
<div class="listingblock data-line-279">
<div class="content">
<pre>H = Hachage(R)</pre>
</div>
</div>
<div class="paragraph data-line-283">
<p>Cela produit un hachage <code>H</code> qui peut être inclus dans le script de verrouillage d&#8217;une sortie. Celui qui connaît le secret peut l&#8217;utiliser pour racheter la sortie. Le secret <code>R</code> est également appelé <em>préimage</em> pour la fonction de hachage. La préimage est simplement la donnée utilisée comme entrée dans une fonction de hachage.</p>
</div>
<div class="paragraph data-line-285">
<p>La deuxième partie d&#8217;un HTLC est le composant "verrou temporel". Si le secret n&#8217;est pas révélé, le payeur du HTLC peut obtenir un "remboursement" après un certain temps. Ceci est réalisé avec un verrouillage temporel absolu à l&#8217;aide de <code>CHECKLOCKTIMEVERIFY</code>.</p>
</div>
<div class="paragraph data-line-287">
<p>Le script implémentant un HTLC pourrait ressembler à ceci :</p>
</div>
<div class="listingblock data-line-289">
<div class="content">
<pre>IF
# Paiement si vous avez le secret R
    HASH160 &lt;H&gt; EQUALVERIFY
ELSE
# Remboursement après expiration du délai.
    &lt;locktime&gt; CHECKLOCKTIMEVERIFY DROP
    &lt;Payer Public Key&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-300">
<p>Toute personne connaissant le secret <code>R</code>, qui, lorsqu&#8217;il est haché, est égal à <code>H</code>, peut racheter cette sortie en exerçant la première clause du flux <code>IF</code>.</p>
</div>
<div class="paragraph data-line-302">
<p>Si le secret n&#8217;est pas révélé et que le HTLC est réclamé, après un certain nombre de blocages, le payeur peut demander un remboursement en utilisant la deuxième clause du flux <code>IF</code>.</p>
</div>
<div class="paragraph data-line-304">
<p>Il s&#8217;agit d&#8217;une implémentation de base d&#8217;un HTLC. Ce type de HTLC peut être échangé par <em>toute personne</em> qui a le secret <code>R</code>. Un HTLC peut prendre de nombreuses formes différentes avec de légères variations dans le script. Par exemple, l&#8217;ajout d&#8217;un opérateur <code>CHECKSIG</code> et d&#8217;une clé publique dans la première clause limite le rachat du hachage à un destinataire nommé, qui doit également connaître le secret <code>R</code>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-307">
<h3 id="lightning_network">Canaux de paiement routés (Lightning Network)</h3>
<div class="paragraph data-line-309">
<p> Le Lightning Network est un réseau routé proposé de canaux de paiement bidirectionnels connectés de bout en bout. Un tel réseau peut permettre à n&#8217;importe quel participant d&#8217;acheminer un paiement d&#8217;un canal à l&#8217;autre sans faire confiance à aucun des intermédiaires. Le Lightning Network était <a href="https://lightning.network/lightning-network-paper.pdf" data-href="https://lightning.network/lightning-network-paper.pdf">décrit pour la première fois par Joseph Poon et Thadeus Dryja en février 2015</a>, s&#8217;appuyant sur le concept de canaux de paiement tel que proposé et élaboré par de nombreux autres.</p>
</div>
<div class="paragraph data-line-311">
<p>Le "Lightning Network" fait référence à une conception spécifique pour un réseau de canaux de paiement routés, qui a maintenant été mis en œuvre par au moins cinq équipes de sources libres différentes. Les implémentations indépendantes sont coordonnées par un ensemble de normes d&#8217;interopérabilité décrites dans le <a href="https://bit.ly/2rBHeoL" data-href="https://bit.ly/2rBHeoL">document <em>Basics of Lightning Technology (BOLT)</em></a>.</p>
</div>
<div class="paragraph data-line-313">
<p>Des implémentations prototypes du Lightning Network ont été publiées par plusieurs équipes.</p>
</div>
<div class="paragraph data-line-315">
<p>Le Lightning Network est une possibilité de mise en place de canaux de paiement routés. Il existe plusieurs autres conceptions qui visent à atteindre des objectifs similaires, telles que Teechan et Tumblebit.</p>
</div>
<div class="sect3 data-line-317">
<h4 id="_exemple_de_réseau_lightning_de_base">Exemple de réseau Lightning de base</h4>
<div class="paragraph data-line-319">
<p> Voyons comment cela fonctionne.</p>
</div>
<div class="paragraph data-line-321">
<p>Dans cet exemple, nous avons cinq participants : Alice, Bob, Carol, Diana et Eric. Ces cinq participants ont ouvert des canaux de paiement entre eux, par paires. Alice a un canal de paiement avec Bob. Bob est connecté à Carol, Carol à Diana et Diana à Eric. Pour simplifier, supposons que chaque chaîne est financée avec 2 bitcoins par chaque participant, pour une capacité totale de 4 bitcoins dans chaque chaîne.</p>
</div>
<div class="paragraph data-line-323">
<p><a href="#lightning_network_fig">Une série de canaux de paiement bidirectionnels liés pour former un réseau Lightning qui peut acheminer un paiement d&#8217;Alice à Eric</a> montre cinq participants dans un Lightning Network, connectés par des canaux de paiement bidirectionnels qui peuvent être liés pour effectuer un paiement d&#8217;Alice à Eric (<a href="#lightning_network">Canaux de paiement routés (Lightning Network)</a>).</p>
</div>
<div id="lightning_network_fig" class="imageblock data-line-327">
<div class="content">
<img src="images/mbc2_1206.png" alt="Une série de canaux de paiement bidirectionnels liés pour former un Lightning Network">
</div>
<div class="title">Figure 78. Une série de canaux de paiement bidirectionnels liés pour former un réseau Lightning qui peut acheminer un paiement d&#8217;Alice à Eric</div>
</div>
<div class="paragraph data-line-329">
<p>Alice veut payer Eric 1 bitcoin. Cependant, Alice n&#8217;est pas connectée à Eric par un canal de paiement. La création d&#8217;un canal de paiement nécessite une transaction de financement, qui doit être engagée dans la chaîne de blocs Bitcoin. Alice ne veut pas ouvrir un nouveau canal de paiement et engager davantage de ses fonds. Y a-t-il un moyen de payer Eric, indirectement ?</p>
</div>
<div class="paragraph data-line-331">
<p><a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> montre le processus étape par étape d&#8217;acheminement d&#8217;un paiement d&#8217;Alice à Eric, à travers une série d&#8217;engagements HTLC sur les canaux de paiement reliant les participants.</p>
</div>
<div id="ln_payment_process" class="imageblock data-line-335">
<div class="content">
<img src="images/mbc2_1207.png" alt="Acheminement des paiements étape par étape via un réseau Lightning">
</div>
<div class="title">Figure 79. Acheminement des paiements étape par étape via un réseau Lightning</div>
</div>
<div class="paragraph data-line-337">
<p>Alice exécute un nœud Lightning Network (LN) qui assure le suivi de son canal de paiement vers Bob et a la capacité de découvrir des itinéraires entre les canaux de paiement. Le nœud LN d&#8217;Alice a également la capacité de se connecter via Internet au nœud LN d&#8217;Eric. Le nœud LN d&#8217;Eric crée un <code>R</code> secret à l&#8217;aide d&#8217;un générateur de nombres aléatoires. Le nœud d&#8217;Eric ne révèle ce secret à personne. Au lieu de cela, le nœud d&#8217;Eric calcule un hachage <code>H</code> du secret <code>R</code> et transmet ce hachage au nœud d&#8217;Alice (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 1).</p>
</div>
<div class="paragraph data-line-339">
<p>Maintenant, le nœud LN d&#8217;Alice construit une route entre le nœud LN d&#8217;Alice et le nœud LN d&#8217;Eric. L&#8217;algorithme de routage utilisé sera examiné plus en détail plus tard, mais pour l&#8217;instant supposons que le nœud d&#8217;Alice puisse trouver une route efficace.</p>
</div>
<div class="paragraph data-line-341">
<p>Le nœud d&#8217;Alice construit alors un HTLC, payable au hash <code>H</code>, avec un délai de remboursement de 10 blocs (bloc actuel + 10), pour un montant de 1,003 bitcoin (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 2). Le supplément de 0,003 sera utilisé pour compenser les nœuds intermédiaires pour leur participation à cette voie de paiement. Alice offre ce HTLC à Bob, déduisant 1,003 bitcoin de son solde de canal avec Bob et l&#8217;engageant sur le HTLC. Le HTLC a la signification suivante : <em>"Alice engage 1,003 de son solde de canal à payer à Bob si Bob connaît le secret, ou remboursé sur le solde d&#8217;Alice si 10 blocs s&#8217;écoulent."</em> Le solde de canal entre Alice et Bob est maintenant exprimé par des transactions d&#8217;engagement avec trois sorties : solde de 2 bitcoins à Bob, solde de 0,997 bitcoin à Alice, 1,003 bitcoin engagé dans le HTLC d&#8217;Alice. Le solde d&#8217;Alice est réduit du montant engagé dans le HTLC.</p>
</div>
<div class="paragraph data-line-343">
<p>Bob s&#8217;est maintenant engagé à ce que s&#8217;il parvient à obtenir le secret ` R ` dans les 10 prochains blocs, il puisse réclamer les 1,003 verrouillés par Alice. Avec cet engagement en main, le nœud de Bob construit un HTLC sur son canal de paiement avec Carol. Le HTLC de Bob engage 1,002 bitcoin dans le hachage <code>H</code> pendant 9 blocs, que Carol peut échanger si elle a le secret <code>R</code> (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 3). Bob sait que si Carol peut réclamer son HTLC, elle doit produire <code>R</code>. Si Bob a ` R ` dans neuf blocs, il peut l&#8217;utiliser pour lui réclamer le HTLC d&#8217;Alice. Il gagne également 0,001 bitcoin pour avoir engagé le solde de son canal pendant neuf blocs. Si Carol n&#8217;est pas en mesure de réclamer son HTLC et qu&#8217;il ne peut pas réclamer le HTLC d&#8217;Alice, tout revient aux soldes de canal précédents et personne n&#8217;est à perte. L&#8217;équilibre des canaux entre Bob et Carol est maintenant : 2 pour Carol, 0,998 pour Bob, 1,002 commis par Bob pour le HTLC.</p>
</div>
<div class="paragraph data-line-345">
<p>Carol s&#8217;est maintenant engagée à ce que si elle obtient <code>R</code> dans les neuf prochains blocs, elle puisse réclamer 1,002 bitcoin verrouillé par Bob. Elle peut désormais s&#8217;engager sur HTLC sur sa chaîne avec Diana. Elle engage un HTLC de 1.001 bitcoin au hachage <code>H</code>, pour huit blocs, que Diana peut racheter si elle a le secret <code>R</code> (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 4). Du point de vue de Carol, si cela fonctionne, elle est plus riche de 0,001 bitcoin et si ce n&#8217;est pas le cas, elle ne perd rien. Son HTLC à Diana n&#8217;est viable que si <code>R</code> est révélé, auquel cas elle peut réclamer le HTLC à Bob. L&#8217;équilibre des canaux entre Carol et Diana est désormais : 2 pour Diana, 0,999 pour Carol, 1,001 commis par Carol pour le HTLC.</p>
</div>
<div class="paragraph data-line-347">
<p>Enfin, Diana peut proposer un HTLC à Eric, engageant 1 bitcoin pour sept blocs à hacher <code>H</code> (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 5). L&#8217;équilibre des canaux entre Diana et Eric est maintenant : 2 à Eric, 1 à Diana, 1 commis par Diana au HTLC.</p>
</div>
<div class="paragraph data-line-349">
<p>Cependant, à ce saut dans la route, Eric <em>a</em> le secret <code>R</code>. Il peut donc prétendre au HTLC proposé par Diana. Il envoie <code>R</code> à Diana et réclame le 1 bitcoin, l&#8217;ajoutant au solde de son canal (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 6). L&#8217;équilibre des canaux est maintenant : 1 pour Diana, 3 pour Eric.</p>
</div>
<div class="paragraph data-line-351">
<p>Maintenant, Diana a un <code>R</code> secret. Par conséquent, elle peut désormais réclamer le HTLC à Carol. Diana transmet <code>R</code> à Carol et ajoute le bitcoin 1.001 au solde de son canal (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 7). Maintenant, l&#8217;équilibre des canaux entre Carol et Diana est : 0,999 pour Carol, 3,001 pour Diana. Diana a "gagné" 0,001 pour sa participation à cette voie de paiement.</p>
</div>
<div class="paragraph data-line-353">
<p>En revenant sur le parcours, le secret <code>R</code> permet à chaque participant de réclamer les HTLC restants. Carol réclame 1,002 à Bob, fixant le solde sur leur chaîne à : 0,998 à Bob, 3,002 à Carol (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 8). Enfin, Bob revendique le HTLC d&#8217;Alice (voir <a href="#ln_payment_process">Acheminement des paiements étape par étape via un réseau Lightning</a> étape 9). Leur solde de canaux est mis à jour comme suit : 0,997 pour Alice, 3,003 pour Bob.</p>
</div>
<div class="paragraph data-line-355">
<p>Alice a payé Eric 1 bitcoin sans ouvrir de chaîne à Eric. Aucune des parties intermédiaires de la voie de paiement n&#8217;avait à se faire confiance. Pour l&#8217;engagement à court terme de leurs fonds dans le canal, ils peuvent gagner une petite commission, le seul risque étant un léger retard de remboursement si le canal était fermé ou si le paiement acheminé échouait.</p>
</div>
</div>
<div class="sect3 data-line-357">
<h4 id="_transport_et_routage_du_lightning_network">Transport et routage du Lightning Network</h4>
<div class="paragraph data-line-359">
<p>Toutes les communications entre les nœuds LN sont cryptées point à point. De plus, les nœuds ont une clé publique à long terme qu&#8217;ils utilisent comme identifiant et pour s&#8217;authentifier les uns les autres.</p>
</div>
<div class="paragraph data-line-361">
<p>Chaque fois qu&#8217;un nœud souhaite envoyer un paiement à un autre nœud, il doit d&#8217;abord construire un <em>chemin</em> à travers le réseau en connectant des canaux de paiement avec une capacité suffisante. Les nœuds annoncent les informations de routage, y compris les canaux qu&#8217;ils ont ouverts, la capacité de chaque canal et les frais qu&#8217;ils facturent pour acheminer les paiements. Les informations de routage peuvent être partagées de diverses manières et différents protocoles de routage sont susceptibles d&#8217;émerger à mesure que la technologie Lightning Network progresse. Certaines implémentations de Lightning Network utilisent le protocole IRC comme mécanisme pratique permettant aux nœuds d&#8217;annoncer les informations de routage. Une autre implémentation de la découverte de route utilise un modèle P2P où les nœuds propagent les annonces de canal à leurs pairs, dans un modèle d'"inondation", similaire à la façon dont bitcoin propage les transactions. Les plans futurs incluent une proposition appelée <a href="https://bit.ly/2r5TACm" data-href="https://bit.ly/2r5TACm">Flare</a>, qui est un modèle de routage hybride avec des "quartiers" de nœuds locaux et des nœuds de balise à plus longue portée.</p>
</div>
<div class="paragraph data-line-363">
<p>Dans notre exemple précédent, le nœud d&#8217;Alice utilise l&#8217;un de ces mécanismes de découverte de route pour trouver un ou plusieurs chemins reliant son nœud au nœud d&#8217;Eric. Une fois que le nœud d&#8217;Alice a construit un chemin, elle initialisera ce chemin à travers le réseau, en propageant une série d&#8217;instructions cryptées et imbriquées pour connecter chacun des canaux de paiement adjacents.</p>
</div>
<div class="paragraph data-line-365">
<p>Il est important de noter que ce chemin n&#8217;est connu que du nœud d&#8217;Alice. Tous les autres participants de la route de paiement ne voient que les nœuds adjacents. Du point de vue de Carol, cela ressemble à un paiement de Bob à Diana. Carol ne sait pas que Bob transmet en fait un paiement d&#8217;Alice. Elle ne sait pas non plus que Diana transmettra un paiement à Eric.</p>
</div>
<div class="paragraph data-line-367">
<p>Il s&#8217;agit d&#8217;une fonctionnalité essentielle du Lightning Network, car elle garantit la confidentialité des paiements et rend très difficile l&#8217;application de la surveillance, de la censure ou des listes noires. Mais comment Alice établit-elle ce chemin de paiement, sans rien révéler aux nœuds intermédiaires ?</p>
</div>
<div class="paragraph data-line-369">
<p>Le Lightning Network implémente un protocole de routage en oignon basé sur un schéma appelé <a href="https://bit.ly/2q6ZDrP" data-href="https://bit.ly/2q6ZDrP">Sphinx</a>. Ce protocole de routage garantit qu&#8217;un expéditeur de paiement peut construire et communiquer un chemin à travers le Lightning Network tel que :</p>
</div>
<div class="ulist data-line-371">
<ul>
<li class="data-line-371">
<p>Les nœuds intermédiaires peuvent vérifier et décrypter leur portion d&#8217;informations de route et trouver le saut suivant.</p>
</li>
<li class="data-line-373">
<p>À part les sauts précédents et suivants, ils ne peuvent pas en savoir plus sur les autres nœuds faisant partie du chemin.</p>
</li>
<li class="data-line-375">
<p>Ils ne peuvent pas identifier la longueur du chemin de paiement, ni leur propre position dans ce chemin.</p>
</li>
<li class="data-line-377">
<p>Chaque partie du chemin est cryptée de telle manière qu&#8217;un attaquant au niveau du réseau ne peut pas associer les paquets de différentes parties du chemin les uns aux autres.</p>
</li>
<li class="data-line-379">
<p>Contrairement à Tor (un protocole d&#8217;anonymisation routé par couches d&#8217;oignon sur Internet), il n&#8217;y a pas de "nœuds de sortie" qui peuvent être placés sous surveillance. Les paiements n&#8217;ont pas besoin d&#8217;être transmis à la chaîne de blocs Bitcoin ; les nœuds mettent simplement à jour les soldes des canaux.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-381">
<p>En utilisant ce protocole routé en couches d&#8217;oignon, Alice enveloppe chaque élément du chemin dans une couche de cryptage, en commençant par la fin et en remontant. Elle crypte un message à Eric avec la clé publique d&#8217;Eric. Ce message est enveloppé dans un message crypté pour Diana, identifiant Eric comme le prochain destinataire. Le message à Diana est enveloppé dans un message crypté avec la clé publique de Carol et identifiant Diana comme le prochain destinataire. Le message à Carol est crypté avec la clé de Bob. Ainsi, Alice a construit cet "oignon" multicouche chiffré de messages. Elle l&#8217;envoie à Bob, qui ne peut que déchiffrer et déballer la couche externe. À l&#8217;intérieur, Bob trouve un message adressé à Carol qu&#8217;il peut transmettre à Carol mais ne peut pas se déchiffrer. En suivant le chemin, les messages sont transférés, décryptés, transférés, etc., jusqu&#8217;à Eric. Chaque participant ne connaît que le nœud précédent et suivant dans chaque saut.</p>
</div>
<div class="paragraph data-line-383">
<p>Chaque élément du chemin contient des informations sur le HTLC qui doivent être étendues au saut suivant, le montant qui est envoyé, les frais à inclure et l&#8217;expiration du temps de verrouillage CLTV (en blocs) du HTLC. Au fur et à mesure que les informations de route se propagent, les nœuds effectuent des engagements HTLC jusqu&#8217;au saut suivant.</p>
</div>
<div class="paragraph data-line-385">
<p>À ce stade, vous vous demandez peut-être comment il est possible que les nœuds ne connaissent pas la longueur du chemin et leur position dans ce chemin. Après tout, ils reçoivent un message et le transmettent au saut suivant. Ne devient-il pas plus court, leur permettant de déduire la taille du chemin et leur position ? Pour éviter cela, le chemin est toujours fixé à 20 sauts et rempli de données aléatoires. Chaque nœud voit le saut suivant et un message chiffré de longueur fixe à transmettre. Seul le destinataire final voit qu&#8217;il n&#8217;y a pas de saut suivant. Pour tout le monde, il semble qu&#8217;il y ait toujours 20 sauts de plus à faire.</p>
</div>
</div>
<div class="sect3 data-line-387">
<h4 id="_avantages_du_lightning_network">Avantages du Lightning Network</h4>
<div class="paragraph data-line-389">
<p>Un Lightning Network est une technologie de routage de deuxième couche. Il peut être appliqué à toute chaîne de blocs prenant en charge certaines fonctionnalités de base, telles que les transactions multisignatures, les verrous temporels et les contrats intelligents de base.</p>
</div>
<div class="paragraph data-line-391">
<p>Si un réseau Lightning est superposé au réseau Bitcoin, le réseau Bitcoin peut bénéficier d&#8217;une augmentation significative de la capacité, de la confidentialité, de la granularité et de la vitesse, sans sacrifier les principes de fonctionnement sans confiance sans intermédiaires :</p>
</div>
<div class="dlist data-line-393">
<dl>
<dt class="hdlist1">Confidentialité</dt>
<dd>
<p>Les paiements Lightning Network sont beaucoup plus privés que les paiements sur la chaîne de blocs Bitcoin, car ils ne sont pas publics. Bien que les participants à une route puissent voir les paiements se propager sur leurs canaux, ils ne connaissent ni l&#8217;expéditeur ni le destinataire.</p>
</dd>
<dt class="hdlist1">Fongibilité</dt>
<dd>
<p>Un Lightning Network rend beaucoup plus difficile l&#8217;application de la surveillance et des listes noires sur le bitcoin, augmentant la fongibilité de la monnaie.</p>
</dd>
<dt class="hdlist1">Vitesse</dt>
<dd>
<p>Les transactions Bitcoin utilisant Lightning Network sont réglées en millisecondes, plutôt qu&#8217;en minutes, car les HTLC sont effacés sans valider les transactions dans un bloc.</p>
</dd>
<dt class="hdlist1">Granularité</dt>
<dd>
<p>Un réseau Lightning peut permettre des paiements au moins aussi petits que la limite de "poussière" de bitcoin, peut-être même plus petite. Certaines propositions permettent des incréments subsatoshi.</p>
</dd>
<dt class="hdlist1">Capacité</dt>
<dd>
<p>Un Lightning Network augmente la capacité du système Bitcoin de plusieurs ordres de grandeur. Il n&#8217;y a pas de limite supérieure pratique au nombre de paiements par seconde pouvant être acheminés sur un réseau Lightning, car cela dépend uniquement de la capacité et de la vitesse de chaque nœud.</p>
</dd>
<dt class="hdlist1">Fonctionnement sans confiance</dt>
<dd>
<p>Un réseau Lightning utilise des transactions bitcoin entre des nœuds qui fonctionnent comme des pairs sans se faire confiance. Ainsi, un Lightning Network préserve les principes du système Bitcoin, tout en élargissant considérablement ses paramètres de fonctionnement.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-405">
<p>Bien sûr, comme mentionné précédemment, le protocole Lightning Network n&#8217;est pas le seul moyen de mettre en œuvre des canaux de paiement routés. D&#8217;autres systèmes proposés incluent Tumblebit et Teechan. À l&#8217;heure actuelle, cependant, le Lightning Network a déjà été déployé sur testnet. Plusieurs équipes différentes ont développé des implémentations concurrentes de LN et travaillent à une norme d&#8217;interopérabilité commune (appelée BOLT). Il est probable que Lightning Network sera le premier réseau de canaux de paiement routés à être déployé en production.</p>
</div>
</div>
</div>
<div class="sect2 data-line-407">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph data-line-31">
<p>Nous n&#8217;avons examiné que quelques-unes des applications émergentes qui peuvent être construites en utilisant la chaîne de blocs Bitcoin comme plate-forme de confiance. Ces applications élargissent la portée du bitcoin au-delà des paiements et au-delà des instruments financiers, pour englober de nombreuses autres applications où la confiance est essentielle. En décentralisant la base de confiance, la chaîne de blocs Bitcoin est une plate-forme qui engendrera de nombreuses applications révolutionnaires dans une grande variété d&#8217;industries.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="satoshi_whitepaper">Appendix A: Le livre blanc Bitcoin de Satoshi Nakamoto</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="admonitionblock note data-line-6">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-7">
<p>Ceci est le livre blanc original, reproduit dans son intégralité exactement tel qu&#8217;il a été publié par Satoshi Nakamoto en octobre 2008 et traduit (par assistance informatique) par Serafim Dos Santos en 2022 pour l&#8217;édition ouverte de <em>Maîtriser Bitcoin</em> (voir version originale <em>Mastering Bitcoin</em>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2 data-line-10">
<h3 id="_bitcoin_un_système_de_paiement_électronique_pair_à_pair">Bitcoin - Un système de paiement électronique pair à pair</h3>
<div class="paragraph data-line-12">
<p>Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-14">
<p><em>satoshin@gmx.com</em></p>
</div>
<div class="paragraph data-line-16">
<p><a href="https://bitcoin.org/en/" class="orm:hideurl"><em>www.bitcoin.org</em></a></p>
</div>
<div class="paragraph data-line-18">
<p><strong>Résumé.</strong> Une version purement pair à pair de la monnaie électronique permettrait d&#8217;envoyer des paiements en ligne directement d&#8217;une partie à une autre sans passer par une institution financière. Les signatures numériques fournissent une partie de la solution, mais les principaux avantages sont perdus si un tiers de confiance est toujours requis pour éviter les doubles dépenses. Nous proposons une solution au problème de la double dépense en utilisant un réseau pair à pair. Le réseau horodate les transactions en les hachant dans une chaîne continue de preuves de travail (proof-of-work) basées sur le hachage, formant un enregistrement qui ne peut pas être modifié sans refaire la preuve de travail. La chaîne la plus longue sert non seulement de preuve de la séquence d&#8217;événements observés, mais aussi de preuve qu&#8217;elle provient du plus grand bassin de puissance CPU. Tant que la majorité de la puissance du processeur est contrôlée par des nœuds qui ne coopèrent pas pour attaquer le réseau, ils généreront la plus longue chaîne et devanceront les attaquants. Le réseau lui-même nécessite une structure minimale. Les messages sont diffusés dans la mesure du possible, et les nœuds peuvent quitter et rejoindre le réseau à volonté, acceptant la plus longue chaîne de preuve de travail comme preuve de ce qui s&#8217;est passé pendant leur absence.</p>
</div>
<div class="sect3 data-line-20">
<h4 id="_introduction">Introduction</h4>
<div class="paragraph data-line-21">
<p>Le commerce sur Internet en est venu à s&#8217;appuyer presque exclusivement sur des institutions financières servant de tiers de confiance pour traiter les paiements électroniques. Bien que le système fonctionne assez bien pour la plupart des transactions, il souffre toujours des faiblesses inhérentes au modèle basé sur la confiance. Les transactions totalement irréversibles ne sont pas vraiment possibles, car les institutions financières ne peuvent éviter la médiation des différends. Le coût de la médiation augmente les coûts de transaction, limitant la taille pratique minimale des transactions et supprimant la possibilité de petites transactions occasionnelles, et il y a un coût plus important dans la perte de capacité à effectuer des paiements irréversibles pour des services irréversibles. Avec la possibilité d&#8217;inversion, le besoin de confiance se répand. Les commerçants doivent se méfier de leurs clients et les harceler pour obtenir plus d&#8217;informations qu&#8217;ils n&#8217;en auraient autrement besoin. Un certain pourcentage de fraude est accepté comme inévitable. Ces coûts et incertitudes de paiement peuvent être évités en personne en utilisant de la monnaie physique, mais aucun mécanisme n&#8217;existe pour effectuer des paiements via un canal de communication sans une partie de confiance.</p>
</div>
<div class="paragraph data-line-23">
<p>Ce qu&#8217;il faut, c&#8217;est un système de paiement électronique basé sur la preuve cryptographique au lieu de la confiance, permettant à deux parties consentantes d&#8217;effectuer des transactions directement l&#8217;une avec l&#8217;autre sans avoir besoin d&#8217;un tiers de confiance. Les transactions impossibles à annuler sur le plan informatique protégeraient les vendeurs contre la fraude, et des mécanismes de séquestre de routine pourraient facilement être mis en œuvre pour protéger les acheteurs. Dans cet article, nous proposons une solution au problème de la double dépense en utilisant un serveur d&#8217;horodatage distribué pair à pair pour générer une preuve informatique de l&#8217;ordre chronologique des transactions. Le système est sécurisé tant que les nœuds honnêtes contrôlent collectivement plus de puissance CPU que n&#8217;importe quel groupe coopérant de nœuds attaquants.</p>
</div>
</div>
<div class="sect3 data-line-25">
<h4 id="_transactions">Transactions</h4>
<div class="paragraph data-line-26">
<p>Nous définissons une pièce électronique (ou unité de cryptomonnaie) comme une chaîne de signatures numériques. Chaque propriétaire transfère la pièce au suivant en signant numériquement un résultat de hachage de la transaction précédente et la clé publique du propriétaire suivant et en les ajoutant à la fin de la pièce. Un bénéficiaire peut vérifier les signatures pour vérifier la chaîne de propriété.</p>
</div>
<div class="imageblock data-line-28">
<div class="content">
<img src="images/mbc2_abin01.png" alt="Transactions">
</div>
</div>
<div class="paragraph data-line-30">
<p>Le problème est bien sûr que le bénéficiaire ne peut pas vérifier que l&#8217;un des propriétaires n&#8217;a pas dépensé deux fois la pièce. Une solution courante consiste à introduire une autorité centrale de confiance, ou "maison ou hôtel de la monnaie", qui vérifie chaque transaction pour les doubles dépenses. Après chaque transaction, la pièce doit être retournée à l&#8217;hôtel de la monnaie pour émettre une nouvelle pièce, et seules les pièces émises directement par l&#8217;hôtel de la monnaie sont réputées ne pas être dépensées en double. Le problème avec cette solution est que le sort de l&#8217;ensemble du système monétaire dépend de la société qui gère la monnaie, chaque transaction devant passer par elle, tout comme une banque.</p>
</div>
<div class="paragraph data-line-32">
<p>Nous avons besoin d&#8217;un moyen pour que le bénéficiaire sache que les propriétaires précédents n&#8217;ont signé aucune transaction antérieure. Pour nos besoins, la première transaction est celle qui compte, donc nous ne nous soucions pas des tentatives ultérieures de doubler les dépenses. La seule façon de confirmer l&#8217;absence d&#8217;une transaction est d&#8217;être au courant de toutes les transactions. Dans le modèle basé sur la monnaie, la monnaie était au courant de toutes les transactions et décidait laquelle arrivait en premier. Pour y parvenir sans partie de confiance, les transactions doivent être annoncées publiquement [1], et nous avons besoin d&#8217;un système permettant aux participants de s&#8217;entendre sur un historique unique de l&#8217;ordre dans lequel elles ont été reçues. Le bénéficiaire doit avoir la preuve qu&#8217;au moment de chaque transaction, la majorité des nœuds ont convenu qu&#8217;il s&#8217;agissait du premier reçu.</p>
</div>
</div>
<div class="sect3 data-line-34">
<h4 id="_serveur_dhorodatage">Serveur d&#8217;horodatage</h4>
<div class="paragraph data-line-35">
<p>La solution que nous proposons commence par un serveur d&#8217;horodatage. Un serveur d&#8217;horodatage fonctionne en prenant un hachage d&#8217;un bloc d&#8217;éléments à horodater et en publiant largement le hachage, comme dans un journal ou une publication Usenet [2-5]. L&#8217;horodatage prouve que les données doivent avoir existé à l&#8217;époque, évidemment, pour entrer dans le hachage. Chaque horodatage inclut l&#8217;horodatage précédent dans son hachage, formant une chaîne où chaque horodatage supplémentaire renforce ceux qui le précèdent.</p>
</div>
<div class="imageblock data-line-37">
<div class="content">
<img src="images/mbc2_abin02.png" alt="serveur d&#8217;horodatage">
</div>
</div>
</div>
<div class="sect3 data-line-39">
<h4 id="_proof_of_work_ou_preuve_de_travail">Proof-of-Work (ou Preuve de travail)</h4>
<div class="paragraph data-line-40">
<p>Pour implémenter un serveur d&#8217;horodatage distribué sur une base pair à pair, nous devrons utiliser un système de preuve de travail similaire à Hashcash d&#8217;Adam Back [6], plutôt que des articles de journaux ou Usenet. La preuve de travail implique la recherche d&#8217;une valeur qui, lorsqu&#8217;elle est hachée, comme avec SHA-256, le hachage commence par un certain nombre de bits zéro. Le travail moyen requis est exponentiel dans le nombre de bits zéro requis et peut être vérifié en exécutant un seul hachage. Pour notre réseau d&#8217;horodatage, nous implémentons la preuve de travail en incrémentant un nonce dans le bloc jusqu&#8217;à ce qu&#8217;une valeur soit trouvée qui donne au hachage du bloc les bits zéro requis. Une fois que l&#8217;effort CPU a été dépensé pour satisfaire la preuve de travail, le bloc ne peut pas être modifié sans refaire le travail. Comme les blocs ultérieurs sont enchaînés après celui-ci, le travail de modification du bloc comprendrait la refonte de tous les blocs après celui-ci.</p>
</div>
<div class="imageblock data-line-42">
<div class="content">
<img src="images/mbc2_abin03.png" alt="preuve de travail">
</div>
</div>
<div class="paragraph data-line-44">
<p>La preuve de travail résout également le problème de la détermination de la représentation dans la prise de décision à la majorité. Si la majorité était basée sur une adresse IP, un vote, elle pourrait être renversée par toute personne capable d&#8217;allouer de nombreuses adresses IP. La preuve de travail est essentiellement un processeur, un vote. La décision majoritaire est représentée par la chaîne la plus longue, qui a investi le plus grand effort de preuve de travail. Si la majorité de la puissance du processeur est contrôlée par des nœuds honnêtes, la chaîne honnête se développera le plus rapidement et dépassera toutes les chaînes concurrentes. Pour modifier un bloc passé, un attaquant devrait refaire la preuve de travail du bloc et de tous les blocs qui le suivent, puis rattraper et dépasser le travail des nœuds honnêtes. Nous montrerons plus tard que la probabilité qu&#8217;une attaque plus lente rattrape le système, diminue de manière exponentielle à mesure que des blocs ultérieurs sont ajoutés.</p>
</div>
<div class="paragraph data-line-46">
<p>Pour compenser l&#8217;augmentation de la vitesse matérielle et l&#8217;intérêt variable pour l&#8217;exécution des nœuds au fil du temps, la difficulté de la preuve de travail est déterminée par une moyenne mobile ciblant un nombre moyen de blocs par heure. S&#8217;ils sont générés trop rapidement, la difficulté augmente.</p>
</div>
</div>
<div class="sect3 data-line-48">
<h4 id="_réseau">Réseau</h4>
<div class="paragraph data-line-50">
<p>Les étapes pour exécuter le réseau sont les suivantes :</p>
</div>
<div class="olist arabic data-line-52">
<ol class="arabic">
<li class="data-line-52">
<p>Les nouvelles transactions sont diffusées à tous les nœuds.</p>
</li>
<li class="data-line-53">
<p>Chaque nœud collecte les nouvelles transactions dans un bloc.</p>
</li>
<li class="data-line-54">
<p>Chaque nœud travaille à trouver une preuve de travail difficile pour son bloc.</p>
</li>
<li class="data-line-55">
<p>Lorsqu&#8217;un nœud trouve une preuve de travail, il diffuse le bloc à tous les nœuds.</p>
</li>
<li class="data-line-56">
<p>Les nœuds n&#8217;acceptent le bloc que si toutes les transactions qu&#8217;il contient sont valides et non déjà dépensées.</p>
</li>
<li class="data-line-57">
<p>Les nœuds expriment leur acceptation du bloc en travaillant à la création du bloc suivant dans la chaîne, en utilisant le hachage du bloc accepté comme hachage précédent.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-59">
<p>Les nœuds considèrent toujours que la chaîne la plus longue est la bonne et continueront à travailler pour l&#8217;étendre. Si deux nœuds diffusent simultanément des versions différentes du bloc suivant, certains nœuds peuvent recevoir l&#8217;un ou l&#8217;autre en premier. Dans ce cas, ils travaillent sur la première branche qu&#8217;ils ont reçue, mais conservent l&#8217;autre branche au cas où elle deviendrait plus longue. L&#8217;égalité sera rompue lorsque la prochaine preuve de travail sera trouvée et qu&#8217;une branche s&#8217;allongera ; les nœuds qui travaillaient sur l&#8217;autre branche passeront alors à la plus longue.</p>
</div>
<div class="paragraph data-line-61">
<p>Les diffusions de nouvelles transactions n&#8217;ont pas nécessairement besoin d&#8217;atteindre tous les nœuds. Tant qu&#8217;ils atteignent de nombreux nœuds, ils entreront dans un bloc avant longtemps. Les diffusions en bloc sont également tolérantes aux messages abandonnés. Si un nœud ne reçoit pas de bloc, il le demandera lorsqu&#8217;il recevra le bloc suivant et réalisera qu&#8217;il en a manqué un.</p>
</div>
</div>
<div class="sect3 data-line-63">
<h4 id="_incitatif">Incitatif</h4>
<div class="paragraph data-line-64">
<p>Par convention, la première transaction d&#8217;un bloc est une transaction spéciale qui démarre une nouvelle pièce appartenant au créateur du bloc. Cela ajoute une incitation pour les nœuds à prendre en charge le réseau et fournit un moyen de distribuer initialement les pièces en circulation, car il n&#8217;y a pas d&#8217;autorité centrale pour les émettre. L&#8217;ajout régulier d&#8217;une quantité constante de nouvelles pièces est analogue aux mineurs d&#8217;or qui dépensent des ressources pour ajouter de l&#8217;or à la circulation. Dans notre cas, c&#8217;est le temps CPU et l&#8217;électricité qui sont dépensés.</p>
</div>
<div class="paragraph data-line-66">
<p>L&#8217;incitation peut également être financée par des frais de transaction. Si la valeur de sortie d&#8217;une transaction est inférieure à sa valeur d&#8217;entrée, la différence est une commission de transaction qui s&#8217;ajoute à la valeur incitative du bloc contenant la transaction. Une fois qu&#8217;un nombre prédéterminé de pièces est entré en circulation, l&#8217;incitation peut passer entièrement aux frais de transaction et être totalement exempte d&#8217;inflation.</p>
</div>
<div class="paragraph data-line-68">
<p>L&#8217;incitation peut aider à encourager les nœuds à rester honnêtes. Si un attaquant cupide est capable d&#8217;assembler plus de puissance CPU que tous les nœuds honnêtes, il devrait choisir entre l&#8217;utiliser pour frauder les gens en volant leur paiements, ou l&#8217;utiliser pour générer de nouvelles pièces. Il devrait trouver plus avantageux de jouer selon les règles que de saper le système et la validité de sa propre richesse. De telles règles le favorise avec plus de nouvelles pièces plus que tout les nœuds réunis.</p>
</div>
</div>
<div class="sect3 data-line-70">
<h4 id="_récupération_despace_disque">Récupération d&#8217;espace disque</h4>
<p>Une fois que la dernière transaction d'une pièce est enterrée sous suffisamment de blocs, les transactions passées avant peuvent être supprimées pour économiser de l'espace disque. Pour faciliter cela sans casser le hachage du bloc, les transactions sont hachées dans un arbre Merkle <a href="#ref_seven">[7]</a> <a href="#ref_two">[2]</a> <a href="#ref_five">[5]</a> , avec seulement la racine incluse dans le hachage du bloc. Les vieux blocs peuvent ensuite être compactés en écrasant les branches de l'arbre. Les hachages intérieurs n'ont pas besoin d'être stockés.</p>
<div class="imageblock data-line-76">
<div class="content">
<img src="images/mbc2_abin04.png" alt="disque">
</div>
</div>
<div class="paragraph data-line-78">
<p>Un en-tête de bloc sans transactions serait d&#8217;environ 80 octets. Si nous supposons que les blocs sont générés toutes les 10 minutes, <code>80 octets * 6 * 24 * 365 = 4,2 Mo</code> par an. Avec des systèmes informatiques se vendant généralement avec 2 Go de RAM à partir de 2008 et la loi de Moore prédisant une croissance actuelle de 1,2 Go par an, le stockage ne devrait pas être un problème même si les en-têtes de bloc doivent être conservés en mémoire.</p>
</div>
</div>
<div class="sect3 data-line-80">
<h4 id="_vérification_de_paiement_simplifiée">Vérification de paiement simplifiée</h4>
<div class="paragraph data-line-81">
<p>Il est possible de vérifier les paiements sans exécuter un nœud de réseau complet. Un utilisateur n&#8217;a besoin que de conserver une copie des en-têtes de bloc de la chaîne de preuve de travail la plus longue, qu&#8217;il peut obtenir en interrogeant les nœuds du réseau jusqu&#8217;à ce qu&#8217;il soit convaincu qu&#8217;il a la chaîne la plus longue, et d&#8217;obtenir la branche Merkle reliant la transaction au bloc dont il est horodaté. Il ne peut pas vérifier la transaction par lui-même, mais en la liant à un endroit de la chaîne, il peut voir qu&#8217;un nœud du réseau l&#8217;a acceptée, et les blocs ajoutés après confirment que le réseau l&#8217;a acceptée aussi.</p>
</div>
<div class="imageblock data-line-83">
<div class="content">
<img src="images/mbc2_abin05.png" alt="spv">
</div>
</div>
<div class="paragraph data-line-85">
<p>Ainsi, la vérification est fiable tant que des nœuds honnêtes contrôlent le réseau, mais est plus vulnérable si le réseau est maîtrisé par un attaquant. Alors que les nœuds du réseau peuvent vérifier les transactions par eux-mêmes, la méthode simplifiée peut être trompée par les transactions fabriquées par un attaquant, tant que l&#8217;attaquant peut continuer à maîtriser le réseau. Une stratégie de protection contre cela consisterait à accepter les alertes des nœuds du réseau lorsqu&#8217;ils détectent un bloc invalide, incitant le logiciel de l&#8217;utilisateur à télécharger le bloc complet et les transactions alertées pour confirmer l&#8217;incohérence. Les entreprises qui reçoivent des paiements fréquents voudront probablement toujours exécuter leurs propres nœuds pour une sécurité plus indépendante et une vérification plus rapide.</p>
</div>
</div>
<div class="sect3 data-line-87">
<h4 id="_combiner_et_diviser_la_valeur">Combiner et diviser la valeur</h4>
<div class="paragraph data-line-88">
<p>Bien qu&#8217;il soit possible de gérer les pièces individuellement, il serait difficile d&#8217;effectuer une transaction distincte pour chaque centime d&#8217;un transfert. Pour permettre à la valeur d&#8217;être fractionnée et combinée, les transactions contiennent plusieurs entrées et sorties. Normalement, il y aura soit une seule entrée provenant d&#8217;une transaction précédente plus importante, soit plusieurs entrées combinant des montants plus petits, et au plus deux sorties  : une pour le paiement et une renvoyant la monnaie, le cas échéant, à l&#8217;expéditeur.</p>
</div>
<div class="imageblock data-line-90">
<div class="content">
<img src="images/mbc2_abin06.png" alt="séparateur de combinaison">
</div>
</div>
<div class="paragraph data-line-92">
<p>Il convient de noter que la diffusion, où une transaction dépend de plusieurs transactions, et ces transactions dépendent de beaucoup d&#8217;autres, n&#8217;est pas un problème ici. Il n&#8217;est jamais nécessaire d&#8217;extraire une copie autonome complète de l&#8217;historique d&#8217;une transaction.</p>
</div>
</div>
<div class="sect3 data-line-94">
<h4 id="_confidentialité">Confidentialité</h4>
<div class="paragraph data-line-95">
<p>Le modèle bancaire traditionnel atteint un niveau de confidentialité en limitant l&#8217;accès aux informations des parties concernées et au tierce partie de confiance. La nécessité d&#8217;annoncer publiquement toutes les transactions exclut cette méthode, mais la confidentialité peut toujours être préservée en interrompant le flux d&#8217;informations à un autre endroit  : en gardant les clés publiques anonymes. Le public peut voir que quelqu&#8217;un envoie un montant à quelqu&#8217;un d&#8217;autre, mais sans information liant la transaction à qui que ce soit. Ceci est similaire au niveau d&#8217;information publié par les bourses, où l&#8217;heure et la taille des transactions individuelles, la "bande", sont rendues publiques, mais sans dire qui étaient les parties.</p>
</div>
<div class="imageblock data-line-97">
<div class="content">
<img src="images/mbc2_abin07.png" alt="vie privée">
</div>
</div>
<div class="paragraph data-line-99">
<p>En tant que pare-feu supplémentaire, une nouvelle paire de clés doit être utilisée pour chaque transaction afin d&#8217;éviter qu&#8217;elles ne soient liées à un propriétaire commun. Certains liens sont encore inévitables avec les transactions multi-entrées, qui révèlent nécessairement que leurs entrées appartenaient au même propriétaire. Le risque est que si le propriétaire d&#8217;une clé est révélé, la liaison pourrait révéler d&#8217;autres transactions ayant appartenu au même propriétaire.</p>
</div>
</div>
<div class="sect3 data-line-101">
<h4 id="_calculs">Calculs</h4>
<div class="paragraph data-line-102">
<p>Nous considérons le scénario d&#8217;un attaquant essayant de générer une chaîne alternative plus rapidement que la chaîne honnête. Même si cela est accompli, cela n&#8217;ouvre pas le système à des changements arbitraires, comme créer de la valeur à partir de rien ou prendre de l&#8217;argent qui n&#8217;a jamais appartenu à l&#8217;attaquant. Les nœuds n&#8217;accepteront pas une transaction invalide comme paiement, et les nœuds honnêtes n&#8217;accepteront jamais un bloc les contenant. Un attaquant ne peut essayer de modifier qu&#8217;une de ses propres transactions pour récupérer l&#8217;argent qu&#8217;il a récemment dépensé.</p>
</div>
<div class="paragraph data-line-104">
<p>La course entre la chaîne honnête et une chaîne attaquante peut être caractérisée comme une marche aléatoire binomiale. L&#8217;événement de succès est la chaîne honnête prolongée d&#8217;un bloc, augmentant son avance de +1, et l&#8217;événement d&#8217;échec est la chaîne de l&#8217;attaquant prolongée d&#8217;un bloc, réduisant l&#8217;écart de -1.</p>
</div>
<p>La probabilité qu'un attaquant rattrape un déficit donné est analogue à un problème de la ruine du joueur (Gambler's Ruin). Supposons qu'un joueur avec un crédit illimité commence avec un déficit et joue potentiellement un nombre infini d'essais pour essayer d'atteindre le seuil de rentabilité. Nous pouvons calculer la probabilité qu'il atteigne jamais le seuil de rentabilité, ou qu'un attaquant rattrape jamais la chaîne honnête, comme suit <a href="#ref_eight">[8]</a>:</p>
<div class="paragraph data-line-110">
<p>p = probabilité qu&#8217;un nœud honnête trouve le bloc suivant</p>
</div>
<div class="paragraph data-line-112">
<p>q = probabilité que l&#8217;attaquant trouve le bloc suivant</p>
</div>
<div class="paragraph data-line-114">
<p>q<sub>z</sub> = probabilité que l&#8217;attaquant rattrape jamais z blocs derrière</p>
</div>
<div class="imageblock data-line-116">
<div class="content">
<img src="images/mbc2_abin08.png" alt="eq1">
</div>
</div>
<div class="paragraph data-line-118">
<p>Étant donné notre hypothèse que p &gt; q, la probabilité chute de façon exponentielle à mesure que le nombre de blocs que l&#8217;attaquant doit rattraper augmente. Avec les chances contre lui, s&#8217;il n&#8217;a pas un coup de chance deavant dès le début, ses chances deviennent infiniment petites à mesure qu&#8217;il prend du retard.</p>
</div>
<div class="paragraph data-line-120">
<p>Nous considérons maintenant combien de temps le destinataire d&#8217;une nouvelle transaction doit attendre avant d&#8217;être suffisamment certain que l&#8217;expéditeur ne peut pas modifier la transaction. Nous supposons que l&#8217;expéditeur est un attaquant qui veut faire croire au destinataire qu&#8217;il l&#8217;a payé pendant un certain temps, puis le changer pour se rembourser après un certain temps. Le destinataire sera alerté lorsque cela se produira, mais l&#8217;expéditeur espère qu&#8217;il sera trop tard.</p>
</div>
<div class="paragraph data-line-122">
<p>Le récepteur génère une nouvelle paire de clés et donne la clé publique à l&#8217;expéditeur peu de temps avant la signature. Cela évite à l&#8217;expéditeur de préparer une chaîne de blocs à l&#8217;avance en y travaillant continuellement jusqu&#8217;à ce qu&#8217;il ait la chance d&#8217;aller assez loin, puis d&#8217;exécuter la transaction à ce moment-là. Une fois la transaction envoyée, l&#8217;expéditeur malhonnête commence à travailler en secret sur une chaîne parallèle contenant une version alternative de sa transaction.</p>
</div>
<div class="paragraph data-line-124">
<p>Le destinataire attend que la transaction ait été ajoutée à un bloc et que z blocs aient été liés après celle-ci. Il ne connaît pas la progression exacte de l&#8217;attaquant, mais en supposant que les blocs honnêtes ont pris le temps moyen attendu par bloc, la progression potentielle de l&#8217;attaquant sera une distribution de Poisson avec une valeur attendue :</p>
</div>
<div class="imageblock data-line-126">
<div class="content">
<img src="images/mbc2_abin09.png" alt="eq2">
</div>
</div>
<div class="paragraph data-line-128">
<p>Pour obtenir la probabilité que l&#8217;attaquant puisse encore rattraper maintenant, nous multiplions la densité de Poisson pour chaque quantité de progrès qu&#8217;il aurait pu faire par la probabilité qu&#8217;il puisse rattraper à partir de ce point :</p>
</div>
<div class="imageblock data-line-130">
<div class="content">
<img src="images/mbc2_abin10.png" alt="eq3">
</div>
</div>
<div class="paragraph data-line-132">
<p>Réorganiser pour éviter de faire la somme de la queue infinie de la distribution&#8230;&#8203;</p>
</div>
<div class="imageblock data-line-134">
<div class="content">
<img src="images/mbc2_abin11.png" alt="eq4">
</div>
</div>
<div class="paragraph data-line-136">
<p>Conversion en code C&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-139">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;math.h&gt;
double AttackerSuccessProbability(double q, int z)
{
    double p = 1.0 - q;
    double lambda = z * (q / p);
    double sum = 1.0;
    int i, k;
    for (k = 0; k &lt;= z; k++)
    {
        double poisson = exp(-lambda);
        for (i = 1; i &lt;= k; i++)
            poisson *= lambda / i;
        sum -= poisson * (1 - pow(q / p, z - k));
    }
    return sum;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-158">
<p>En exécutant certains résultats, nous pouvons voir la probabilité chuter de façon exponentielle avec z.</p>
</div>
<div class="listingblock data-line-159">
<div class="content">
<pre>q=0.1
z=0 P=1.0000000
z=1 P=0.2045873
z=2 P=0.0509779
z=3 P=0.0131722
z=4 P=0.0034552
z=5 P=0.0009137
z=6 P=0.0002428
z=7 P=0.0000647
z=8 P=0.0000173
z=9 P=0.0000046
z=10 P=0.0000012</pre>
</div>
</div>
<div class="listingblock data-line-173">
<div class="content">
<pre>q=0.3
z=0 P=1.0000000
z=5 P=0.1773523
z=10 P=0.0416605
z=15 P=0.0101008
z=20 P=0.0024804
z=25 P=0.0006132
z=30 P=0.0001522
z=35 P=0.0000379
z=40 P=0.0000095
z=45 P=0.0000024
z=50 P=0.0000006</pre>
</div>
</div>
<div class="paragraph data-line-187">
<p>Résolution pour P inférieur à 0,1 %&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-188">
<div class="content">
<pre>P &lt; 0.001
q=0.10 z=5
q=0.15 z=8
q=0.20 z=11
q=0.25 z=15
q=0.30 z=24
q=0.35 z=41
q=0.40 z=89
q=0.45 z=340</pre>
</div>
</div>
</div>
<div class="sect3 data-line-200">
<h4 id="_conclusion_3">Conclusion</h4>
<div class="paragraph data-line-201">
<p>Nous avons proposé un système de transactions électroniques sans reposer sur la confiance. Nous avons commencé avec le cadre habituel des pièces fabriquées à partir de signatures numériques, qui offre un fort contrôle de propriété, mais qui est incomplet sans un moyen d&#8217;éviter les doubles dépenses. Pour résoudre ce problème, nous avons proposé un réseau pair à pair utilisant la preuve de travail pour enregistrer un historique public des transactions qui devient rapidement impossible à modifier par un attaquant si des nœuds honnêtes contrôlent la majorité de la puissance du processeur. Le réseau est robuste dans sa simplicité non structurée. Les nœuds fonctionnent tous en même temps avec peu de coordination. Ils n&#8217;ont pas besoin d&#8217;être identifiés, car les messages ne sont pas acheminés vers un endroit particulier et ne doivent être livrés que dans la mesure du possible. Les nœuds peuvent quitter et rejoindre le réseau à volonté, acceptant la chaîne de preuve de travail comme preuve de ce qui s&#8217;est passé pendant leur absence. Ils votent avec leur puissance CPU, exprimant leur acceptation des blocs valides en travaillant à les étendre et rejetant les blocs invalides en refusant de travailler dessus. Toutes les règles et incitations nécessaires peuvent être appliquées avec ce mécanisme de consensus.</p>
</div>
</div>
<div class="sect3 data-line-203">
<h4 id="_références">Références</h4>
<p>
<span id="ref_one">[1]</span> W. Dai, "b-money," <a href="http://www.weidai.com/bmoney.txt"><em>http://www.weidai.com/bmoney.txt</em></a>, 1998.
</p>
<p>
<span id="ref_two">[2]</span> H. Massias, X.S. Avila, and J.-J. Quisquater, "Design of a secure timestamping service with minimal trust requirements," In 20th Symposium on Information Theory in the Benelux, May 1999.
</p>
<p>
<span id="ref_three">[3]</span> S. Haber, W.S. Stornetta, "How to time-stamp a digital document," In Journal of Cryptology, vol 3, no 2, pages 99-111, 1991.
</p>

<p>
<span id="ref_four">[4]</span> D. Bayer, S. Haber, W.S. Stornetta, "Improving the efficiency and reliability of digital time-stamping," In Sequences II : Methods in Communication, Security and Computer Science, pages 329-334, 1993.
</p>

<p>
<span id="ref_five">[5]</span> S. Haber, W.S. Stornetta, "Secure names for bit-strings," In Proceedings of the 4th ACM Conference on Computer and Communications Security, pages 28-35, April 1997.
</p>

<p>
<span id="ref_six">[6]</span> A. Back, "Hashcash - a denial of service counter-measure," <a href="http://www.hashcash.org/papers/hashcash.pdf"><em>http://www.hashcash.org/papers/hashcash.pdf</em></a>, 2002.
</p>

<p>
<span id="ref_seven">[7]</span> R.C. Merkle, "Protocols for public key cryptosystems," In Proc. 1980 Symposium on Security and Privacy, IEEE Computer Society, pages 122-133, April 1980.
</p>

<p>
<span id="ref_eight">[8]</span> W. Feller, "An introduction to probability theory and its applications," 1957.
</p>
</div>
</div>
<div class="sect2 data-line-236">
<h3 id="_licence">Licence</h3>
<div class="paragraph data-line-238">
<p>Ce livre blanc a été publié en octobre 2008 par Satoshi Nakamoto. Il a ensuite été (2009) ajouté comme documentation de support au logiciel bitcoin, qui porte la même licence MIT. Il a été reproduit dans ce livre, sans modification autre que la mise en forme, selon les termes de la licence MIT :</p>
</div>
<div class="paragraph data-line-240">
<p>The MIT License (MIT)
Copyright (c) 2008 Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-243">
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
</div>
<div class="paragraph data-line-245">
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
</div>
<div class="paragraph data-line-33">
<p>THE SOFTWARE IS PROVIDED "AS IS," WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="tx_script_ops">Appendix B: Opérateurs, constantes et symboles du langage de script de transaction</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="admonitionblock note data-line-6">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-7">
<p>Tableaux et descriptions provenant de <a href="https://en.bitcoin.it/wiki/Script" class="undefined" data-href="https://en.bitcoin.it/wiki/Script">https://en.bitcoin.it/wiki/Script</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-10">
<p><a href="#tx_script_ops_table_pushdata">Pousser la valeur sur la pile</a> affiche les opérateurs pour pousser les valeurs sur la pile.</p>
</div>
<table id="tx_script_ops_table_pushdata" class="tableblock frame-all grid-all stretch data-line-15">
<caption class="title">Table 30. Pousser la valeur sur la pile</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0 ou OP_FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un tableau vide est poussé sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 à 75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01 à 0x4b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Poussez les N octets suivants sur la pile, où N est compris entre 1 et 75 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;octet de script suivant contient N, poussez les N octets suivants sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Les deux octets de script suivants contiennent N, poussez les N octets suivants sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Les quatre octets de script suivants contiennent N, poussez les N octets suivants sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Poussez la valeur "–1" sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interruption - Transaction non valide à moins qu&#8217;elle ne se trouve dans une clause OP_IF non exécutée</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1 ou OP_TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Poussez la valeur "1" sur la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2 à OP_16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x52 à 0x60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pour OP_N, poussez la valeur "N" sur la pile, par exemple, OP_2 pousse "2"</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-29">
<p><a href="#tx_script_ops_table_control">Contrôle de flux conditionnel</a> affiche les opérateurs de contrôle de flux conditionnel.</p>
</div>
<table id="tx_script_ops_table_control" class="tableblock frame-all grid-all stretch data-line-34">
<caption class="title">Table 31. Contrôle de flux conditionnel</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ne fais rien</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x62</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrompt la transaction non valide à moins qu&#8217;elle ne se trouve dans une clause OP_IF non exécutée</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exécute les instructions suivantes si le haut de la pile n&#8217;est pas 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exécute les instructions suivantes si le haut de la pile est 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrompt la transaction invalide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERNOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x66</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrompt la transaction invalide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ELSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exécuter uniquement si les instructions précédentes n&#8217;ont pas été exécutées</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ENDIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminer le bloc OP_IF, OP_NOTIF, OP_ELSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vérifie le haut de la pile, arrête et invalide la transaction si elle n&#8217;est pas VRAIE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arrête et invalide la transaction</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-48">
<p><a href="#tx_script_ops_table_timelock">Opérations de verrou temporel</a> affiche les opérateurs utilisés pour les verrous temporels.</p>
</div>
<table id="tx_script_ops_table_timelock" class="tableblock frame-all grid-all stretch data-line-53">
<caption class="title">Table 32. Opérations de verrou temporel</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY (précédemment OP_NOP2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marque la transaction comme non valide si l&#8217;élément supérieur de la pile est supérieur au champ nLockTime de la transaction, sinon l&#8217;évaluation du script continue comme si un OP_NOP avait été exécuté. La transaction est également invalide si 1. la pile est vide ; ou 2. l&#8217;élément de la pile supérieure est négatif ; ou 3. l&#8217;élément de la pile supérieure est supérieur ou égal à 500000000 alors que le champ nLockTime de la transaction est inférieur à 500000000, ou vice versa ; ou 4. le champ nSequence de l&#8217;entrée est égal à 0xffffffff. La sémantique précise est décrite dans la BIP-65</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSEQUENCEVERIFY (précédemment OP_NOP3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marque la transaction comme non valide si le temps de verrouillage relatif de l&#8217;entrée (appliqué par BIP 0068 avec nSequence) n&#8217;est pas égal ou supérieur à la valeur de l&#8217;élément de la pile supérieure. La sémantique précise est décrite dans BIP-112</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-59">
<p><a href="#tx_script_ops_table_stack">Opérations de pile</a> montre les opérateurs utilisés pour manipuler la pile.</p>
</div>
<table id="tx_script_ops_table_stack" class="tableblock frame-all grid-all stretch data-line-64">
<caption class="title">Table 33. Opérations de pile</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TOALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait l&#8217;élément supérieur de la pile et le pousse vers une autre pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_FROMALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait l&#8217;élément supérieur de la pile alternative et le pousse pour empiler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait top deux éléments de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dupliquer les deux éléments du haut de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_3DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dupliquer les trois premiers éléments de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copie les troisième et quatrième éléments de la pile vers le haut</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déplace les cinquième et sixième éléments de la pile vers le haut</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Échange les deux paires d&#8217;objets dans la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IFDUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x73</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplique l&#8217;élément du haut de la pile s&#8217;il n&#8217;est pas 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DEPTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x74</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compte les éléments sur la pile et pousse le décompte résultant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait l&#8217;élément du haut de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x76</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplique l&#8217;élément supérieur de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x77</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait le deuxième élément de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x78</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copie le deuxième élément de la pile et le pousse vers le haut</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PICK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait la valeur N du haut, puis copie le Nième élément en haut de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROLL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrait la valeur N du haut, puis déplacer le Nième élément vers le haut de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alterne les trois premiers éléments de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Échange les deux premiers éléments de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TUCK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copie l&#8217;élément supérieur et l&#8217;insère entre l&#8217;élément supérieur et le deuxième élément</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-87">
<p><a href="#tx_script_ops_table_splice">Opérations d&#8217;épissure de chaînes de caractère</a> affiche les opérateurs de chaîne.</p>
</div>
<table id="tx_script_ops_table_splice" class="tableblock frame-all grid-all stretch data-line-92">
<caption class="title">Table 34. Opérations d&#8217;épissure de chaînes de caractère</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_CAT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (concatène les deux premiers éléments)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_SUBSTR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (renvoie la sous-chaîne)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LEFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (renvoie la sous-chaîne gauche)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RIGHT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (renvoie la sous-chaîne droite)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calculer la longueur de la chaîne de l&#8217;élément supérieur et pousser le résultat</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-101">
<p><a href="#tx_script_ops_table_binmath">Arithmétique binaire et conditionnelles</a> affiche les opérateurs logiques arithmétiques et booléens binaires.</p>
</div>
<table id="tx_script_ops_table_binmath" class="tableblock frame-all grid-all stretch data-line-106">
<caption class="title">Table 35. Arithmétique binaire et conditionnelles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_INVERT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (Inverser les bits de l&#8217;élément supérieur)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_AND</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (booléen ET des deux premiers éléments)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_OR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (OU booléen des deux éléments supérieurs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_XOR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (XOR booléen des deux principaux éléments)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x87</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pousse TRUE (1) si les deux premiers éléments sont exactement égaux, pousse FALSE (0) sinon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identique à OP_EQUAL, mais exécute OP_VERIFY après pour arrêter si ce n&#8217;est pas TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interruption - Transaction non valide à moins qu&#8217;elle ne se trouve dans une clause OP_IF non exécutée</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interruption - Transaction non valide à moins qu&#8217;elle ne se trouve dans une clause OP_IF non exécutée</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-119">
<p><a href="#tx_script_ops_table_numbers">Opérateurs numériques</a> affiche les opérateurs numériques (arithmétiques).</p>
</div>
<table id="tx_script_ops_table_numbers" class="tableblock frame-all grid-all stretch data-line-124">
<caption class="title">Table 36. Opérateurs numériques</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajouter 1 à l&#8217;élément au dessus de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soustraire 1 de l&#8217;élément au dessus de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (multiplier l&#8217;élément au dessus de la pile par 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (diviser l&#8217;élément au dessus de la pile par 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverse le signe de l&#8217;élément au dessus de la pile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ABS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change le signe de l&#8217;élément au dessus de la pile en positif</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x91</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retourne l&#8217;élément du dessus si l&#8217;élément est 0 ou 1 booléen, sinon retourne 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0NOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x92</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Si l&#8217;élément supérieur est 0, renvoie 0, sinon renvoie 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x93</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort les deux éléments au dessus de la pile, les additionnes et pousse le résultat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x94</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort les deux éléments au dessus de la pile, soustrait le premier du second et pousse le résultat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (multiplie les deux premiers éléments)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (divise le deuxième élément par le premier élément)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MOD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x97</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (le reste divise le deuxième élément par le premier élément)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x98</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (décale le deuxième élément vers la gauche du nombre de bits du premier élément)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Désactivé (décale le deuxième élément vers la droite du nombre de bits du premier élément)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOLAND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ET booléen des deux premiers éléments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOOLOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OU booléen des deux premiers éléments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si les deux premiers éléments sont des nombres égaux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identique à NUMEQUAL, puis OP_VERIFY pour arrêter si ce n&#8217;est pas TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMNOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si les deux premiers éléments ne sont pas des nombres égaux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si le deuxième élément est inférieur à l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si le deuxième élément est supérieur à l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si le deuxième élément est inférieur ou égal à l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si le deuxième élément est supérieur ou égal à l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le plus petit des deux premiers éléments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le plus grand des deux premiers éléments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_WITHIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie TRUE si le troisième élément est compris entre le deuxième élément (ou égal) et le premier élément</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-156">
<p><a href="#tx_script_ops_table_crypto">Opérations cryptographiques et de hachage</a> affiche les opérateurs de fonction cryptographique.</p>
</div>
<table id="tx_script_ops_table_crypto" class="tableblock frame-all grid-all stretch data-line-161">
<caption class="title">Table 37. Opérations cryptographiques et de hachage</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RIPEMD160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoye le hachage RIPEMD160 de l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le hachage SHA1 de l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le hachage SHA256 de l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le hachage RIPEMD160(SHA256(x)) de l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renvoie le hachage SHA256(SHA256(x)) de l&#8217;élément supérieur</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CODESEPARATOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marque le début des données vérifiées par signature</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort une clé publique et une signature et valide la signature pour les données hachées de la transaction, renvoie TRUE si cela correspond</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIGNVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identique à CHECKSIG, puis OP_VERIFY pour arrêter si ce n&#8217;est pas TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xae</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exécute CHECKSIG pour chaque paire de signature et de clé publique fournie. Tous doivent correspondre. Un bogue dans la mise en œuvre affiche une valeur supplémentaire, préfixée par OP_0 comme solution de contournement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIGVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identique à CHECKMULTISIG, puis OP_VERIFY pour arrêter si ce n&#8217;est pas TRUE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-175">
<p><a href="#tx_script_ops_table_nop">Non opérateurs</a> affiche les symboles non opérateur.</p>
</div>
<table id="tx_script_ops_table_nop" class="tableblock frame-all grid-all stretch data-line-180">
<caption class="title">Table 38. Non opérateurs</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP1 à OP_NOP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb0 à 0xb9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ne fait rien, ignoré</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-186">
<p><a href="#tx_script_ops_table_internal">Codes OP réservés à un usage interne par l&#8217;analyseur</a> affiche les codes opérateur réservés à l&#8217;analyseur de script interne.</p>
</div>
<table id="tx_script_ops_table_internal" class="tableblock frame-all grid-all stretch data-line-191">
<caption class="title">Table 39. Codes OP réservés à un usage interne par l&#8217;analyseur</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbole</th>
<th class="tableblock halign-left valign-top">Valeur (hex)</th>
<th class="tableblock halign-left valign-top">La description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente un petit champ de données</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLINTEGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente un petit champ de données entier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente les champs de clé publique</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYHASH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente un champ de hachage de clé publique</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente un champ de clé publique</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_INVALIDOPCODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Représente tout code OP non attribué actuellement</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="appdxbitcoinimpproposals">Appendix C: Bitcoin Improvement Proposals (ou Propositions d&#8217;amélioration du Bitcoin)</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-5">
<p>Les Bitcoin Improvement Proposals (ou Propositions d&#8217;amélioration du Bitcoin) sont des documents de conception fournissant des informations à la communauté bitcoin ou décrivant une nouvelle fonctionnalité pour bitcoin ou ses processus ou son environnement.</p>
</div>
<div class="paragraph data-line-7">
<p>Conformément à BIP-01 <em>BIP Purpose and Guidelines</em>, il existe trois types de BIP :</p>
</div>
<div class="dlist data-line-9">
<dl>
<dt class="hdlist1"><em>Standard</em> BIP</dt>
<dd>
<p>Décrit tout changement qui affecte la plupart ou toutes les implémentations de bitcoin, comme un changement du protocole réseau, un changement des règles de validité de bloc ou de transaction, ou tout changement ou ajout qui affecte l&#8217;interopérabilité des applications utilisant bitcoin.</p>
</dd>
<dt class="hdlist1"><em>Informational</em> BIP</dt>
<dd>
<p>Décrit un problème de conception de bitcoin, ou fournit des directives générales ou des informations à la communauté bitcoin, mais ne propose pas de nouvelle fonctionnalité. Les BIP informationnels ne représentent pas nécessairement un consensus ou une recommandation de la communauté bitcoin, de sorte que les utilisateurs et les implémenteurs peuvent ignorer les BIP informationnels ou suivre leurs conseils.</p>
</dd>
<dt class="hdlist1"><em>Process</em> BIP</dt>
<dd>
<p>Décrit un processus bitcoin ou propose une modification (ou un événement dans) un processus. Les BIP de processus ressemblent aux BIP standard mais s&#8217;appliquent à des domaines autres que le protocole Bitcoin lui-même. Ils pourraient proposer une implémentation, mais pas à la base de code de Bitcoin ; elles nécessitent souvent un consensus communautaire ; et contrairement aux BIP informatifs, ils sont plus que des recommandations, et les utilisateurs ne sont généralement pas libres de les ignorer. Les exemples incluent les procédures, les directives, les modifications du processus de prise de décision et les modifications des outils ou de l&#8217;environnement utilisés dans le développement de Bitcoin. Tout méta-BIP est également considéré comme un processus BIP.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-13">
<p>Les BIP sont enregistrés dans un référentiel versionné sur GitHub : <a href="https://github.com/bitcoin/bips" data-href="https://github.com/bitcoin/bips">https://github.com/bitcoin/bips</a>. <a href="#table_d-1">Liste des BIPs</a> montre un instantané des BIP en avril 2017. Consultez le référentiel faisant autorité pour obtenir des informations à jour sur les BIP existants et leur contenu.</p>
</div>
<table id="table_d-1" class="tableblock frame-all grid-all stretch data-line-18">
<caption class="title">Table 40. Liste des BIPs</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">BIP#</th>
<th class="tableblock halign-left valign-top">Titre</th>
<th class="tableblock halign-left valign-top">Propriétaire</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Statut</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-1"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki">BIP-1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Purpose and Guidelines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remplacé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-2"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki">BIP-2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP process, revised</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actif</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-8"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki">BIP-8</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with guaranteed lock-in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-9"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with timeout and delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille, Peter Todd, Greg Maxwell, Rusty Russell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-10"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki">BIP-10</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Sig Transaction Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alan Reiner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-11"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki">BIP-11</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-12"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki">BIP-12</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-13"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki">BIP-13</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for pay-to-script-hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-14"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki">BIP-14</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol Version and User Agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki, Patrick Strateman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-15"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki">BIP-15</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Différé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-16"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki">BIP-16</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pay to Script Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-17"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki">BIP-17</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKHASHVERIFY (CHV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-18"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki">BIP-18</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hashScriptCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-19"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki">BIP-19</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions (Low SigOp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-20"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki">BIP-20</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remplacé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-21"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki">BIP-21</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nils Schneider, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-22"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki">BIP-22</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Fundamentals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-23"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki">BIP-23</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Pooled Mining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-30"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki">BIP-30</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-31"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP-31</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pong message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-32"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-33"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki">BIP-33</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratized Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-34"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block v2, Height in Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-35"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki">BIP-35</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mempool message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-36"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki">BIP-36</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stefan Thomas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-37"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP-37</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Bloom filtering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-39"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP-39</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mnemonic code for generating deterministic keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak, Aaron Voisine, Sean Bowe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-40"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki">BIP-40</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum wire protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre BIP attribué</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-41"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki">BIP-41</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum mining protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre BIP attribué</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-42"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki">BIP-42</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A finite monetary supply for Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-43"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki">BIP-43</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose Field for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Account Hierarchy for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-45"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Structure for Deterministic P2SH Multisignature Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuel Araoz, Ryan X. Charles, Matias Alejo Garcia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-47"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki">BIP-47</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reusable Payment Codes for Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-49"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki">BIP-49</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Derivation scheme for P2WPKH-nested-in-P2SH based accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Weigl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-50"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki">BIP-50</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">March 2013 Chain Fork Post-Mortem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-60"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki">BIP-60</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Length "version" Message (Relay-Transactions Field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-61"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki">BIP-61</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reject P2P message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-62"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki">BIP-62</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-63"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki">BIP-63</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stealth Addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre BIP attribué</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-64"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki">BIP-64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getutxo message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-65"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-66"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strict DER signatures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-67"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki">BIP-67</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deterministic Pay-to-script-hash multi-signature addresses through public key sorting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Jean-Pierre Rupp, Ruben de Vries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-68"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative lock-time using consensus-enforced sequence numbers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark Friedenbach, BtcDrak, Nicolas Dorier, kinoshitajona</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-69"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki">BIP-69</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lexicographical Indexing of Transaction Inputs and Outputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-70"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki">BIP-70</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen, Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-71"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki">BIP-71</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol MIME types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-72"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki">BIP-72</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitcoin: uri extensions for Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-73"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki">BIP-73</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use "Accept" header for response type negotiation with Payment Request URLs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stephen Pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-74"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki">BIP-74</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow zero value OP_RETURN in Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toby Padilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-75"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki">BIP-75</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out of Band Address Exchange using Payment Protocol Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justin Newton, Matt David, Aaron Voisine, James MacWhyte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-80"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki">BIP-80</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Non-Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Différé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-81"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki">BIP-81</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Différé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-83"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki">BIP-83</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Hierarchical Deterministic Key Trees</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-90"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki">BIP-90</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buried Deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-99"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki">BIP-99</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Motivation and deployment of consensus rule changes ([soft/hard]forks)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jorge Timón</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-101"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki">BIP-101</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase maximum block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-102"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki">BIP-102</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size increase to 2MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-103"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki">BIP-103</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size following technological growth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-104"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki">BIP-104</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Block75' - Max block size like difficulty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t.khan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-105"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki">BIP-105</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consensus based block size retargeting algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-106"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki">BIP-106</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamically Controlled Bitcoin Block Size Max Cap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upal Chakraborty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-107"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki">BIP-107</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic limit on the block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Washington Y. Sanchez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-109"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki">BIP-109</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two million byte size limit with sigop and sighash limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rejeté</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-111"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki">BIP-111</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NODE_BLOOM service bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-112"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHECKSEQUENCEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak, Mark Friedenbach, Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-113"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Median time-past as endpoint for lock-time calculations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Mark Friedenbach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-114"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki">BIP-114</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merkelized Abstract Syntax Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-120"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki">BIP-120</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-121"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki">BIP-121</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment URI scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-122"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki">BIP-122</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI scheme for Blockchain references / exploration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marco Pontello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-123"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki">BIP-123</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Classification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actif</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-124"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki">BIP-124</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Script Templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, William Swanson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-125"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki">BIP-125</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opt-in Full Replace-by-Fee Signaling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David A. Harding, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-126"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki">BIP-126</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Best Practices for Heterogeneous Input Script Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-130"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki">BIP-130</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendheaders message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-131"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki">BIP-131</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Coalescing Transaction" Specification (wildcard inputs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chris Priest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-132"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki">BIP-132</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Committee-based BIP Acceptance Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Andy Chase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retiré</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-133"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki">BIP-133</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feefilter message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Morcos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-134"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki">BIP-134</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flexible Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tom Zander</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-140"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki">BIP-140</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalized TXID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Decker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-141"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Consensus layer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-142"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki">BIP-142</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Différé</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-143"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Signature Verification for Version 0 Witness Program</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-144"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Peer Services)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-145"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate Updates for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-146"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki">BIP-146</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with signature encoding malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-147"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki">BIP-147</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with dummy stack element malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-148"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki">BIP-148</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory activation of segwit deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-150"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki">BIP-150</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-151"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki">BIP-151</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer-to-Peer Communication Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-152"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP-152</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compact Block Relay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-171"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki">BIP-171</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currency/exchange rate information API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-180"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki">BIP-180</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size/weight fraud proof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-199"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki">BIP-199</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hashed Time-Locked Contract transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sean Bowe, Daira Hopwood</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brouillon</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-4">
<h2 id="appdx_bitcore">Appendix D: Bitcore</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-7">
<p>Bitcore est une suite d&#8217;outils fournis par BitPay. Son objectif est de fournir des outils faciles à utiliser pour les développeurs Bitcoin. Presque tout le code de Bitcore est écrit en JavaScript. Il existe des modules écrits spécifiquement pour NodeJS. Enfin, le module "node" de Bitcore inclut le code C++ de Bitcoin Core. Veuillez consulter <a href="https://bitcore.io" class="undefined" data-href="https://bitcore.io">https://bitcore.io</a> pour plus d&#8217;informations.</p>
</div>
<div class="sect2 data-line-9">
<h3 id="_liste_des_fonctionnalités_de_bitcore">Liste des fonctionnalités de Bitcore</h3>
<div class="ulist data-line-11">
<ul>
<li class="data-line-11">
<p>Nœud complet Bitcoin (nœud bitcore)</p>
</li>
<li class="data-line-12">
<p>Explorateur de blocs (aperçu)</p>
</li>
<li class="data-line-13">
<p>Utilitaires de bloc, de transaction et de portefeuille (bitcore-lib)</p>
</li>
<li class="data-line-14">
<p>Communiquer directement avec le réseau P2P de Bitcoin (bitcore-p2p)</p>
</li>
<li class="data-line-15">
<p>Génération mnémonique d&#8217;entropie de valeur d&#8217;amorçage (bitcore-mnémonique)</p>
</li>
<li class="data-line-16">
<p>Protocole de paiement (bitcore-payment-protocol)</p>
</li>
<li class="data-line-17">
<p>Vérification et signature des messages (bitcore-message)</p>
</li>
<li class="data-line-18">
<p>Schéma de chiffrement intégré à courbe elliptique (bitcore-ecies)</p>
</li>
<li class="data-line-19">
<p>Service de portefeuille (bitcore-wallet-service)</p>
</li>
<li class="data-line-20">
<p>Client de portefeuille (bitcore-wallet-client)</p>
</li>
<li class="data-line-21">
<p>Intégration des services directement avec Bitcoin Core (bitcore-node)</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-23">
<h3 id="_exemples_de_bibliothèque_bitcore">Exemples de bibliothèque Bitcore</h3>
<div class="sect3 data-line-25">
<h4 id="_prérequis">Prérequis</h4>
<div class="ulist data-line-27">
<ul>
<li class="data-line-27">
<p>NodeJS &gt;= 4.x</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>Si vous utilisez NodeJS et le nœud REPL :</p>
</div>
<div class="listingblock data-line-32">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ npm install -g bitcore-lib bitcore-p2p</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-36">
<h4 id="_exemples_de_portefeuille_utilisant_bitcore_lib">Exemples de portefeuille utilisant bitcore-lib</h4>
<div class="paragraph data-line-38">
<p>Création d&#8217;une nouvelle adresse Bitcoin avec clé privée associée :</p>
</div>
<div class="listingblock data-line-40">
<div class="content">
<pre>&gt; bitcore = require('bitcore-lib')
&gt; privateKey = new bitcore.PrivateKey()
&gt; address = privateKey.toAddress().toString()</pre>
</div>
</div>
<div class="paragraph data-line-46">
<p>Création d&#8217;une clé privée déterministe hiérarchique et d&#8217;une adresse :</p>
</div>
<div class="listingblock data-line-48">
<div class="content">
<pre>&gt; hdPrivateKey = bitcore.HDPrivateKey()
&gt; hdPublicKey = bitcore.HDPublicKey(hdPrivateKey)
&gt; hdAddress = new bitcore.Address(hdPublicKey.publicKey).toString()</pre>
</div>
</div>
<div class="paragraph data-line-54">
<p>Création et signature d&#8217;une transaction depuis un UTXO :</p>
</div>
<div class="listingblock data-line-56">
<div class="content">
<pre>&gt; utxo = {
txId: txId, // identifiant de transaction contenant une sortie non dépensée
outputIndex: outputIndex, // index de sortie (par exemple 0)
  address: addressOfUtxo,
  script: bitcore.Script.buildPublicKeyHashOut(addressOfUtxo).toString(),
satoshis: satoshis // montant envoyé à l'adresse
}
&gt; fee = 3000 //défini de manière appropriée pour les conditions sur le réseau
&gt; tx = new bitcore.Transaction()
        .from(utxo)
        .to(address, 35000)
        .fee(fee)
        .enableRBF()
        .sign(privateKeyOfUtxo)</pre>
</div>
</div>
<div class="paragraph data-line-73">
<p>Remplacer la dernière transaction dans le mempool (replace-by-fee) :</p>
</div>
<div class="listingblock data-line-75">
<div class="content">
<pre>&gt; rbfTx = new Transaction()
           .from(utxo)
           .to(address, 35000)
           .fee(fee*2)
           .enableRBF()
           .sign(privateKeyOfUtxo);
&gt; tx.serialize();
&gt; rbfTx.serialize();</pre>
</div>
</div>
<div class="paragraph data-line-86">
<p>Diffuser une transaction sur le réseau Bitcoin
(remarque : ne diffusez que des transactions valides ; reportez-vous à <a href="https://bitnodes.21.co/nodes" class="undefined" data-href="https://bitnodes.21.co/nodes">https://bitnodes.21.co/nodes</a> pour les hôtes homologues) :</p>
</div>
<div class="olist arabic data-line-89">
<ol class="arabic">
<li class="data-line-89">
<p>Copiez le code ci-dessous dans un fichier appelé <em>broadcast.js</em>.</p>
</li>
<li class="data-line-90">
<p>Les variables <code>tx</code> et <code>rbfTx</code> sont la sortie de <code>tx.serialize()</code> et rbfTx.serialize(), respectivement.</p>
</li>
<li class="data-line-91">
<p>Afin de remplacer par des frais, l&#8217;homologue doit prendre en charge l&#8217;option bitcoind <code>mempoolreplace</code> et la définir sur 1.</p>
</li>
<li class="data-line-92">
<p>Exécutez le nœud de fichier <em>broadcast.js</em> :</p>
</li>
</ol>
</div>
<div class="listingblock data-line-94">
<div class="content">
<pre>var p2p = require('bitcore-p2p');
var bitcore = require('bitcore-lib');
var tx = new bitcore.Transaction('output from serialize function');
var rbfTx = new bitcore.Transaction('output from serialize function');
var host = 'ip address'; //use valid peer listening on tcp 8333
var peer = new p2p.Peer({host: host});
var messages = new p2p.Messages();
peer.on('ready', function() {
  var txs = [messages.Transaction(tx), messages.Transaction(rbfTx)];
  var index = 0;
  var interval = setInterval(function() {
    peer.sendMessage(txs[index++]);
    console.log('tx: ' ` index ` ' sent');
    if (index === txs.length) {
      clearInterval(interval);
      console.log('disconnecting from peer: ' + host);
      peer.disconnect();
    }
  }, 2000);
});
peer.connect();</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-3">
<h2 id="appdx-pycoin">Appendix E: pycoin, ku et tx</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-6">
<p>La bibliothèque Python <a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a>, initialement écrite et maintenue par Richard Kiss, est une bibliothèque basée sur Python qui prend en charge la manipulation des clés bitcoin et les transactions, même en prenant en charge suffisamment le langage de script pour traiter correctement les transactions non standard.</p>
</div>
<div class="paragraph data-line-8">
<p>La bibliothèque pycoin prend en charge Python 2 (2.7.x) et Python 3 (3.3 et versions ultérieures) et est livrée avec des utilitaires de ligne de commande pratiques, <code>ku</code> et tx.</p>
</div>
<div class="sect2 data-line-10">
<h3 id="_utilitaire_de_clé_ku">Utilitaire de clé (KU)</h3>
<div class="paragraph data-line-12">
<p>L&#8217;utilitaire de ligne de commande <code>ku</code> ("utilitaire de clé") est un utilitaire multi-usage pour manipuler les clés. Il prend en charge les clés BIP-32, le WIF et les adresses (bitcoin et alt coins). Voici quelques exemples.</p>
</div>
<div class="paragraph data-line-14">
<p>Créez une clé BIP-32 en utilisant les sources d&#8217;entropie par défaut de GPG et <em>/dev/random</em> :</p>
</div>
<div class="listingblock data-line-17">
<div class="content">
<pre>$ ku create

input           : create
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K3LU5ctPZTBnb9kTjA5Su9DcWHvXJemiJBsY7VqXUG7hipgdWaU
                    m2nhnzdvxJf5KJo9vjP2nABX65c5sFsWsV8oXcbpehtJi
public version  : xpub661MyMwAqRbcFpYYiuvZpKjKhnJDZYAkWSY76JvvD7FH4fsG3Nqiov2CfxzxY8
                    DGcpfT56AMFeo8M8KPkFMfLUtvwjwb6WPv8rY65L2q8Hz
tree depth      : 0
fingerprint     : 9d9c6092
parent f'print  : 00000000
child index     : 0
chain code      : 80574fb260edaa4905bc86c9a47d30c697c50047ed466c0d4a5167f6821e8f3c
private key     : yes
secret exponent : 112471538590155650688604752840386134637231974546906847202389294096567806844862
 hex            : f8a8a28b28a916e1043cc0aca52033a18a13cab1638d544006469bc171fddfbe
wif             : L5Z54xi6qJusQT42JHA44mfPVZGjyb4XBRWfxAzUWwRiGx1kV4sP
 uncompressed   : 5KhoEavGNNH4GHKoy2Ptu4KfdNp4r56L5B5un8FP6RZnbsz5Nmb
public pair x   : 76460638240546478364843397478278468101877117767873462127021560368290114016034
public pair y   : 59807879657469774102040120298272207730921291736633247737077406753676825777701
 x as hex       : a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 y as hex       : 843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
y parity        : odd
key pair as sec : 03a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 uncompressed   : 04a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
                    843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
hash160         : 9d9c609247174ae323acfc96c852753fe3c8819d
 uncompressed   : 8870d869800c9b91ce1eb460f4c60540f87c15d7
Bitcoin address : 1FNNRQ5fSv1wBi5gyfVBs2rkNheMGt86sp
 uncompressed   : 1DSS5isnH4FsVaLVjeVXewVSpfqktdiQAM</pre>
</div>
</div>
<div class="paragraph data-line-50">
<p>Créez une clé BIP-32 à partir d&#8217;une phrase secrète :</p>
</div>
<div class="admonitionblock warning data-line-53">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-54">
<p>La phrase secrète dans cet exemple est beaucoup trop facile à deviner.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-57">
<div class="content">
<pre>$ ku P:foo

input           : P:foo
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K31AgNK5pyVvW23gHnkBq2wh5aEk6g1s496M8ZMjxncCKZKgb5j
                    ZoY5eSJMJ2Vbyvi2hbmQnCuHBujZ2WXGTux1X2k9Krdtq
public version  : xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtS
                    VYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy
tree depth      : 0
fingerprint     : 5d353a2e
parent f'print  : 00000000
child index     : 0
chain code      : 5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc
private key     : yes
secret exponent : 65825730547097305716057160437970790220123864299761908948746835886007793998275
 hex            : 91880b0e3017ba586b735fe7d04f1790f3c46b818a2151fb2def5f14dd2fd9c3
wif             : L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH
 uncompressed   : 5JvNzA5vXDoKYJdw8SwwLHxUxaWvn9mDea6k1vRPCX7KLUVWa7W
public pair x   : 81821982719381104061777349269130419024493616650993589394553404347774393168191
public pair y   : 58994218069605424278320703250689780154785099509277691723126325051200459038290
 x as hex       : b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 y as hex       : 826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
y parity        : even
key pair as sec : 02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 uncompressed   : 04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
                    826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
hash160         : 5d353a2ecdb262477172852d57a3f11de0c19286
 uncompressed   : e5bd3a7e6cb62b4c820e51200fb1c148d79e67da
Bitcoin address : 19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii
 uncompressed   : 1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT</pre>
</div>
</div>
<div class="paragraph data-line-91">
<p>Obtenir des informations au format JSON :</p>
</div>
<div class="listingblock data-line-94">
<div class="content">
<pre>$ ku P:foo -P -j</pre>
</div>
</div>
<div class="listingblock data-line-98">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "y_parity": "even",
   "public_pair_y_hex": "826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "private_key": "no",
   "parent_fingerprint": "00000000",
   "tree_depth": "0",
   "network": "Bitcoin",
   "btc_address_uncompressed": "1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT",
   "key_pair_as_sec_uncompressed": "04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "public_pair_x_hex": "b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f",
   "wallet_key": "xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy",
   "chain_code": "5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc",
   "child_index": "0",
   "hash160_uncompressed": "e5bd3a7e6cb62b4c820e51200fb1c148d79e67da",
   "btc_address": "19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii",
   "fingerprint": "5d353a2e",
   "hash160": "5d353a2ecdb262477172852d57a3f11de0c19286",
   "input": "P:foo",
   "public_pair_x": "81821982719381104061777349269130419024493616650993589394553404347774393168191",
   "public_pair_y": "58994218069605424278320703250689780154785099509277691723126325051200459038290",
   "key_pair_as_sec": "02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-123">
<p>Clé publique BIP32 :</p>
</div>
<div class="listingblock data-line-125">
<div class="content">
<pre>$ ku -w -P P:foo
xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy</pre>
</div>
</div>
<div class="paragraph data-line-130">
<p>Générez une sous-clé :</p>
</div>
<div class="listingblock data-line-132">
<div class="content">
<pre>$ ku -w -s3/2 P:foo
xprv9wTErTSkjVyJa1v4cUTFMFkWMe5eu8ErbQcs9xajnsUzCBT7ykHAwdrxvG3g3f6BFk7ms5hHBvmbdutNmyg6iogWKxx6mefEw4M8EroLgKj</pre>
</div>
</div>
<div class="paragraph data-line-137">
<p>Sous-clé renforcée :</p>
</div>
<div class="listingblock data-line-139">
<div class="content">
<pre>$ ku -w -s3/2H P:foo
xprv9wTErTSu5AWGkDeUPmqBcbZWX1xq85ZNX9iQRQW9DXwygFp7iRGJo79dsVctcsCHsnZ3XU3DhsuaGZbDh8iDkBN45k67UKsJUXM1JfRCdn1</pre>
</div>
</div>
<div class="paragraph data-line-144">
<p>WIF:</p>
</div>
<div class="listingblock data-line-146">
<div class="content">
<pre>$ ku -W P:foo
L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH</pre>
</div>
</div>
<div class="paragraph data-line-151">
<p>Adresse:</p>
</div>
<div class="listingblock data-line-154">
<div class="content">
<pre>$ ku -a P:foo
19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii</pre>
</div>
</div>
<div class="paragraph data-line-161">
<p>Générez un tas de sous-clés :</p>
</div>
<div class="listingblock data-line-164">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -w
xprv9xWkBDfyBXmZjBG9EiXBpy67KK72fphUp9utJokEBFtjsjiuKUUDF5V3TU8U8cDzytqYnSekc8bYuJS8G3bhXxKWB89Ggn2dzLcoJsuEdRK
xprv9xWkBDfyBXmZnzKf3bAGifK593gT7WJZPnYAmvc77gUQVej5QHckc5Adtwxa28ACmANi9XhCrRvtFqQcUxt8rUgFz3souMiDdWxJDZnQxzx
xprv9xWkBDfyBXmZqdXA8y4SWqfBdy71gSW9sjx9JpCiJEiBwSMQyRxan6srXUPBtj3PTxQFkZJAiwoUpmvtrxKZu4zfsnr3pqyy2vthpkwuoVq
xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
xprv9xWkBDfyBXmZv2q3N66hhZ8DAcEnQDnXML1J62krJAcf7Xb1HJwuW2VMJQrCofY2jtFXdiEY8UsRNJfqK6DAdyZXoMvtaLHyWQx3FS4A9zw
xprv9xWkBDfyBXmZw4jEYXUHYc9fT25k9irP87n2RqfJ5bqbjKdT84Mm7Wtc2xmzFuKg7iYf7XFHKkSsaYKWKJbR54bnyAD9GzjUYbAYTtN4ruo</pre>
</div>
</div>
<div class="paragraph pagebreak-before data-line-175">
<p>Générez les adresses correspondantes :</p>
</div>
<div class="listingblock data-line-178">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -a
1MrjE78H1R1rqdFrmkjdHnPUdLCJALbv3x
1AnYyVEcuqeoVzH96zj1eYKwoWfwte2pxu
1GXr1kZfxE1FcK6ZRD5sqqqs5YfvuzA1Lb
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK
1Cz2rTLjRM6pMnxPNrRKp9ZSvRtj5dDUML
1WstdwPnU6HEUPme1DQayN9nm6j7nDVEM</pre>
</div>
</div>
<div class="paragraph data-line-189">
<p>Générez les WIF correspondants :</p>
</div>
<div class="listingblock data-line-192">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -W
L5a4iE5k9gcJKGqX3FWmxzBYQc29PvZ6pgBaePLVqT5YByEnBomx
Kyjgne6GZwPGB6G6kJEhoPbmyjMP7D5d3zRbHVjwcq4iQXD9QqKQ
L4B3ygQxK6zH2NQGxLDee2H9v4Lvwg14cLJW7QwWPzCtKHdWMaQz
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
L2oD6vA4TUyqPF8QG4vhUFSgwCyuuvFZ3v8SKHYFDwkbM765Nrfd
KzChTbc3kZFxUSJ3Kt54cxsogeFAD9CCM4zGB22si8nfKcThQn8C</pre>
</div>
</div>
<div class="paragraph data-line-204">
<p>Vérifiez que cela fonctionne en choisissant une chaîne BIP32 (celle correspondant à la sous-clé 0/3) :</p>
</div>
<div class="listingblock data-line-208">
<div class="content">
<pre>$ ku -W xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
$ ku -a xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK</pre>
</div>
</div>
<div class="paragraph data-line-216">
<p>Oui, ça a l&#8217;air familier.</p>
</div>
<div class="paragraph data-line-218">
<p>De l&#8217;exposant secret :</p>
</div>
<div class="listingblock data-line-221">
<div class="content">
<pre>$ ku 1

input           : 1
network         : Bitcoin
secret exponent : 1
 hex            : 1
wif             : KwDiBf89QgGbjEhKnhXJuH7LrciVrZi3qYjgd9M7rFU73sVHnoWn
 uncompressed   : 5HpHagT65TZzG1PH3CSu63k8DbpvD8s5ip4nEB3kEsreAnchuDf
public pair x   : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y   : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex       : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex       : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity        : even
key pair as sec : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed   : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                    483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed   : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH
 uncompressed   : 1EHNa6Q4Jz2uvNExL497mE43ikXhwF6kZm</pre>
</div>
</div>
<div class="paragraph data-line-245">
<p>Version Litecoin :</p>
</div>
<div class="listingblock data-line-248">
<div class="content">
<pre>$ ku -nL 1

input            : 1
network          : Litecoin
secret exponent  : 1
 hex             : 1
wif              : T33ydQRKp4FCW5LCLLUB7deioUMoveiwekdwUwyfRDeGZm76aUjV
 uncompressed    : 6u823ozcyt2rjPH8Z2ErsSXJB5PPQwK7VVTwwN4mxLBFrao69XQ
public pair x    : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y    : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex        : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex        : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity         : even
key pair as sec  : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed    : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                     483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed    : 91b24bf9f5288532960ac687abb035127b1d28a5
Litecoin address : LVuDpNCSSj6pQ7t9Pv6d6sUkLKoqDEVUnJ
 uncompressed    : LYWKqJhtPeGyBAw7WC8R3F7ovxtzAiubdM</pre>
</div>
</div>
<div class="paragraph data-line-272">
<p>Dogecoin WIF:</p>
</div>
<div class="listingblock data-line-275">
<div class="content">
<pre>$ ku -nD -W 1
QNcdLVw8fHkixm6NNyN6nVwxKek4u7qrioRbQmjxac5TVoTtZuot</pre>
</div>
</div>
<div class="paragraph data-line-281">
<p>Depuis la paire publique (sur Testnet) :</p>
</div>
<div class="listingblock data-line-284">
<div class="content">
<pre>$ ku -nT 55066263022277343669578718895168534326250603453777594175500187360389116729240,even

input                   : 550662630222773436695787188951685343262506034537775941755001873603
                            89116729240,even
network                 : Bitcoin testnet
public pair x           : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y           : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex               : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex               : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity                : even
key pair as sec         : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed           : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                            483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160                 : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed           : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin testnet address : mrCDrCybB6J1vRfbwM5hemdJz73FwDBC8r
 uncompressed           : mtoKs9V381UAhUia3d7Vb9GNak8Qvmcsme</pre>
</div>
</div>
<div class="paragraph data-line-305">
<p>Depuis hash160 :</p>
</div>
<div class="listingblock data-line-308">
<div class="content">
<pre>$ ku 751e76e8199196d454941c45d1b3a323f1433bd6

input           : 751e76e8199196d454941c45d1b3a323f1433bd6
network         : Bitcoin
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH</pre>
</div>
</div>
<div class="paragraph data-line-318">
<p>En tant qu&#8217;adresse Dogecoin :</p>
</div>
<div class="listingblock data-line-321">
<div class="content">
<pre>$ ku -nD 751e76e8199196d454941c45d1b3a323f1433bd6

input            : 751e76e8199196d454941c45d1b3a323f1433bd6
network          : Dogecoin
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
Dogecoin address : DFpN6QqFfUm3gKNaxN6tNcab1FArL9cZLE</pre>
</div>
</div>
<div class="sect3 data-line-330">
<h4 id="_utilitaire_de_transaction_tx">Utilitaire de transaction (TX)</h4>
<div class="paragraph data-line-332">
<p>
L&#8217;utilitaire de ligne de commande <code>tx</code> affichera les transactions sous une forme lisible par l&#8217;homme, récupérera les transactions de base du cache de transactions de pycoin ou des services Web (blockchain.info, blockcypher.com, blockr.io et chain.so sont actuellement pris en charge), fusionnera les transactions , ajoutera ou supprimera des entrées ou des sorties et signera des transactions.</p>
</div>
<div class="paragraph data-line-335">
<p>Voici quelques exemples.</p>
</div>
<div class="paragraph data-line-338">
<p>Voir la fameuse transaction de "pizza":</p>
</div>
<div class="listingblock data-line-341">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
warning: consider setting environment variable PYCOIN_CACHE_DIR=~/.pycoin_cache to cache transactions fetched via web services
warning: no service providers found for get_tx; consider setting environment variable PYCOIN_BTC_PROVIDERS
usage: tx [-h] [-t TRANSACTION_VERSION] [-l LOCK_TIME] [-n NETWORK] [-a]
          [-i address] [-f path-to-private-keys] [-g GPG_ARGUMENT]
          [--remove-tx-in tx_in_index_to_delete]
          [--remove-tx-out tx_out_index_to_delete] [-F transaction-fee] [-u]
          [-b BITCOIND_URL] [-o path-to-output-file]
          argument [argument ...]
tx: error: can't find Tx with id 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a</pre>
</div>
</div>
<div class="paragraph data-line-355">
<p>Oups! Nous n&#8217;avons pas mis en place de services Web. Faisons cela maintenant :</p>
</div>
<div class="listingblock data-line-359">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ PYCOIN_CACHE_DIR=~/.pycoin_cache
$ PYCOIN_BTC_PROVIDERS="block.io blockchain.info blockexplorer.com"
$ export PYCOIN_CACHE_DIR PYCOIN_BTC_PROVIDERS</code></pre>
</div>
</div>
<div class="paragraph data-line-366">
<p>Cela ne se fait pas automatiquement afin qu&#8217;un outil de ligne de commande ne divulgue pas d&#8217;informations potentiellement privées sur les transactions qui vous intéressent sur un site Web tiers. Si vous ne vous en souciez pas, vous pouvez mettre ces lignes dans votre <em>.profile</em>.</p>
</div>
<div class="paragraph data-line-368">
<p>Essayons encore:</p>
</div>
<div class="listingblock data-line-370">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (valid anytime)
Input:
  0:                          (unknown) from 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik receives 10000000.00000 mBTC
Total output 10000000.00000 mBTC
including unspents in hex dump since transaction not fully signed
010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

** can't validate transaction as source transactions missing</pre>
</div>
</div>
<div class="paragraph data-line-386">
<p>La dernière ligne apparaît car pour valider les signatures des transactions, vous avez techniquement besoin des transactions sources. Ajoutons donc <code>-a</code> pour augmenter les transactions avec des informations sources :</p>
</div>
<div class="listingblock data-line-388">
<div class="content">
<pre>$ tx -a 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
warning: transaction fees recommendations casually calculated and estimates may be incorrect
warning: transaction fee lower than (casually calculated) expected value of 0.1 mBTC, transaction might not propagate
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (valid anytime)
Input:
  0: 17WFx2GQZUmh6Up2NDNCEDk3deYomdNCfk from 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0 10000000.00000 mBTC  sig ok
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik receives 10000000.00000 mBTC
Total input  10000000.00000 mBTC
Total output 10000000.00000 mBTC
Total fees        0.00000 mBTC

010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

all incoming transaction values validated</pre>
</div>
</div>
<div class="paragraph data-line-408">
<p> Maintenant, regardons les sorties non dépensées pour une adresse spécifique (UTXO). Dans le bloc #1, nous voyons une transaction coinbase vers 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX. Utilisons <code>fetch_unspent</code> pour trouver toutes les pièces à cette adresse :</p>
</div>
<div class="listingblock data-line-410">
<div class="content">
<pre>$ fetch_unspent 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX
a3a6f902a51a2cbebede144e48a88c05e608c2cce28024041a5b9874013a1e2a/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/333000
cea36d008badf5c7866894b191d3239de9582d89b6b452b596f1f1b76347f8cb/31/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
065ef6b1463f552f675622a5d1fd2c08d6324b4402049f68e767a719e2049e8d/86/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
a66dddd42f9f2491d3c336ce5527d45cc5c2163aaed3158f81dc054447f447a2/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
ffd901679de65d4398de90cefe68d2c3ef073c41f7e8dbec2fb5cd75fe71dfe7/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100
d658ab87cc053b8dbcfd4aa2717fd23cc3edfe90ec75351fadd6a0f7993b461d/5/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/911
36ebe0ca3237002acb12e1474a3859bde0ac84b419ec4ae373e63363ebef731c/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100000
fd87f9adebb17f4ebb1673da76ff48ad29e64b7afa02fda0f2c14e43d220fe24/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1
dfdf0b375a987f17056e5e919ee6eadd87dad36c09c4016d4a03cea15e5c05e3/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
cb2679bfd0a557b2dc0d8a6116822f3fcbe281ca3f3e18d3855aa7ea378fa373/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
d6be34ccf6edddc3cf69842dce99fe503bf632ba2c2adb0f95c63f6706ae0c52/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/2000000
    0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098/0/410496b538e853519c726a2c91e61ec11600ae1390813a627c66fb8be7947be63c52da7589379515d4e0a604f8141781e62294721166bf621e73a82cbf2342c858eeac/5000000000</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-4">
<h2 id="appdx_bx">Appendix F: Commandes de l&#8217;explorateur Bitcoin (bx)</h2>
<div class="sectionbody">

<div style="margin:5% auto;">
    <a href="https://www.amazon.ca/dp/B09XRS3F2N" target="_newtab">
        <img src="../assets/MB2EO-SITE_AMAZON_BANNER-002.jpg" width="100%" alt="Bannière Amazon du livre Maîtriser Ethereum" style="border-radius:10px;" />
    </a>
</div>
<div class="paragraph data-line-6">
<p>Bitcoin Explorer (bx) est un outil en ligne de commande qui offre une variété de commandes pour la gestion des clés et la construction de transactions. Il fait partie de la bibliothèque Bitcoin libbitcoin.</p>
</div>
<div class="listingblock data-line-8">
<div class="content">
<pre>Usage: bx COMMAND [--help]

Info: The bx commands are:

address-decode
address-embed
address-encode
address-validate
base16-decode
base16-encode
base58-decode
base58-encode
base58check-decode
base58check-encode
base64-decode
base64-encode
bitcoin160
bitcoin256
btc-to-satoshi
ec-add
ec-add-secrets
ec-multiply
ec-multiply-secrets
ec-new
ec-to-address
ec-to-public
ec-to-wif
fetch-balance
fetch-header
fetch-height
fetch-history
fetch-stealth
fetch-tx
fetch-tx-index
hd-new
hd-private
hd-public
hd-to-address
hd-to-ec
hd-to-public
hd-to-wif
help
input-set
input-sign
input-validate
message-sign
message-validate
mnemonic-decode
mnemonic-encode
ripemd160
satoshi-to-btc
script-decode
script-encode
script-to-address
seed
send-tx
send-tx-node
send-tx-p2p
settings
sha160
sha256
sha512
stealth-decode
stealth-encode
stealth-public
stealth-secret
stealth-shared
tx-decode
tx-encode
uri-decode
uri-encode
validate-tx
watch-address
wif-to-ec
wif-to-public
wrap-decode
wrap-encode</pre>
</div>
</div>
<div class="paragraph data-line-88">
<p>Pour plus d&#8217;informations, consultez la <a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">page d&#8217;accueil Bitcoin Explorer</a> et <a href="https://github.com/libbitcoin/libbitcoin-explorer/wiki" data-href="https://github.com/libbitcoin/libbitcoin-explorer/wiki">guide d&#8217;usage Bitcoin Explorer</a>.</p>
</div>
<div class="sect2 data-line-90">
<h3 id="_exemples_dutilisation_de_la_commande_bx">Exemples d&#8217;utilisation de la commande bx</h3>
<div class="paragraph data-line-92">
<p>Regardons quelques exemples d&#8217;utilisation des commandes Bitcoin Explorer pour expérimenter avec des clés et des adresses.</p>
</div>
<div class="paragraph data-line-94">
<p>Générez une "valeur d&#8217;amorçage" aléatoire à l&#8217;aide de la commande seed, qui utilise le générateur de nombres aléatoires du système d&#8217;exploitation. Transmettez la valeur à la commande <code>ec-new</code> pour générer une nouvelle clé privée. Nous sauvegardons la sortie standard dans le fichier <em>private_key</em> :</p>
</div>
<div class="listingblock data-line-96">
<div class="content">
<pre>$ bx seed | bx ec-new &gt; private_key
$ cat private_key
73096ed11ab9f1db6135857958ece7d73ea7c30862145bcc4bbc7649075de474</pre>
</div>
</div>
<div class="paragraph data-line-102">
<p>Maintenant, générez la clé publique à partir de cette clé privée à l&#8217;aide de la commande ec-to-public. Nous passons le fichier <em>private_key</em> dans l&#8217;entrée standard et enregistrons la sortie standard de la commande dans un nouveau fichier <em>public_key</em> :</p>
</div>
<div class="listingblock data-line-104">
<div class="content">
<pre>$ bx ec-to-public &lt; private_key &gt; public_key
$ cat public_key
02fca46a6006a62dfdd2dbb2149359d0d97a04f430f12a7626dd409256c12be500</pre>
</div>
</div>
<div class="paragraph data-line-110">
<p>Nous pouvons reformater la <code>public_key</code> en tant qu&#8217;adresse à l&#8217;aide de la commande ec-to-address. Nous passons le fichier <em>public_key</em> dans l&#8217;entrée standard :</p>
</div>
<div class="listingblock data-line-112">
<div class="content">
<pre>$ bx ec-to-address &lt; public_key
17re1S4Q8ZHyCP8Kw7xQad1Lr6XUzWUnkG</pre>
</div>
</div>
<div class="paragraph data-line-117">
<p>Les clés générées de cette manière produisent un portefeuille non déterministe de type 0. Cela signifie que chaque clé est générée à partir d&#8217;une valeur d&#8217;amorçage indépendante. Les commandes de Bitcoin Explorer peuvent également générer des clés de manière déterministe, conformément au BIP-32. Dans ce cas, une clé "maître" est créée à partir d&#8217;une valeur d&#8217;amorçage, puis étendue de manière déterministe pour produire un arbre de sous-clés, résultant en un portefeuille déterministe de type 2.</p>
</div>
<div class="paragraph data-line-119">
<p>Tout d&#8217;abord, nous utilisons les commandes <code>seed</code> et <code>hd-new</code> pour générer une clé principale qui servira de base pour dériver une hiérarchie de clés :</p>
</div>
<div class="listingblock data-line-121">
<div class="content">
<pre>$ bx seed &gt; seed
$ cat seed
eb68ee9f3df6bd4441a9feadec179ff1

$ bx hd-new &lt; seed &gt; master
$ cat master
xprv9s21ZrQH143K2BEhMYpNQoUvAgiEjArAVaZaCTgsaGe6LsAnwubeiTcDzd23mAoyizm9cApe51gNfLMkBqkYoWWMCRwzfuJk8RwF1SVEpAQ</pre>
</div>
</div>
<div class="paragraph data-line-131">
<p>Nous utilisons maintenant la commande <code>hd-private</code> pour générer une clé de "compte" renforcée et une séquence de deux clés privées au sein du compte :</p>
</div>
<div class="listingblock data-line-133">
<div class="content">
<pre>$ bx hd-private --hard &lt; master &gt; account
$ cat account
xprv9vkDLt81dTKjwHB8fsVB5QK8cGnzveChzSrtCfvu3aMWvQaThp59ueufuyQ8Qi3qpjk4aKsbmbfxwcgS8PYbgoR2NWHeLyvg4DhoEE68A1n

$ bx hd-private --index 0 &lt; account
xprv9xHfb6w1vX9xgZyPNXVgAhPxSsEkeRcPHEUV5iJcVEsuUEACvR3NRY3fpGhcnBiDbvG4LgndirDsia1e9F3DWPkX7Tp1V1u97HKG1FJwUpU

$ bx hd-private --index 1 &lt; account
xprv9xHfb6w1vX9xjc8XbN4GN86jzNAZ6xHEqYxzbLB4fzHFd6VqCLPGRZFsdjsuMVERadbgDbziCRJru9n6tzEWrASVpEdrZrFidt1RDfn4yA3</pre>
</div>
</div>
<div class="paragraph data-line-145">
<p>Ensuite, nous utilisons la commande <code>hd-public</code> pour générer la séquence correspondante de deux clés publiques :</p>
</div>
<div class="listingblock data-line-147">
<div class="content">
<pre>$ bx hd-public --index 0 &lt; account
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-public --index 1 &lt; account
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-155">
<p>Les clés publiques peuvent également être dérivées de leurs clés privées correspondantes à l&#8217;aide de la commande hd-to-public :</p>
</div>
<div class="listingblock data-line-157">
<div class="content">
<pre>$ bx hd-private --index 0 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-private --index 1 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-165">
<p>Nous pouvons générer un nombre pratiquement illimité de clés dans une chaîne déterministe, toutes dérivées d&#8217;une seule valeur d&#8217;amorçage. Cette technique est utilisée dans de nombreuses applications de portefeuille pour générer des clés qui peuvent être sauvegardées et restaurées avec une seule valeur de départ. C&#8217;est plus facile que d&#8217;avoir à sauvegarder le portefeuille avec toutes ses clés générées de manière aléatoire à chaque fois qu&#8217;une nouvelle clé est créée.</p>
</div>
<div class="paragraph data-line-167">
<p>La valeur d&#8217;amorçage peut être encodée à l&#8217;aide de la commande mnemonic-encode :</p>
</div>
<div class="listingblock data-line-169">
<div class="content">
<pre>$ bx hd-mnemonic &lt; seed &gt; words
adore repeat vision worst especially veil inch woman cast recall dwell appreciate</pre>
</div>
</div>
<div class="paragraph data-line-174">
<p>La valeur d&#8217;amorçage peut ensuite être décodée à l&#8217;aide de la commande mnemonic-decode :</p>
</div>
<div class="listingblock data-line-176">
<div class="content">
<pre>$ bx mnemonic-decode &lt; words
eb68ee9f3df6bd4441a9feadec179ff1</pre>
</div>
</div>
<div class="paragraph data-line-43">
<p>L&#8217;encodage mnémonique peut faciliter l&#8217;enregistrement et même la mémorisation de la valeur d&#8217;amorçage.</p>
</div>
<div class="paragraph data-line-45">
<p>&lt;section data-type="index"/&gt;</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. "Bitcoin: A Peer-to-Peer Electronic Cash System," Satoshi Nakamoto (<a href="https://bitcoin.org/bitcoin.pdf" class="undefined" data-href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a>).
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-04-08 11:56:21 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>